{"file_contents":{"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/dashboard/urgent-actions.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertTriangle, Clock, FileSignature } from \"lucide-react\";\nimport type { DashboardMetrics } from \"@shared/schema\";\n\ninterface UrgentActionsProps {\n  urgentActions: DashboardMetrics['urgentActions'];\n}\n\nexport default function UrgentActions({ urgentActions }: UrgentActionsProps) {\n  const getActionIcon = (type: string) => {\n    switch (type) {\n      case \"overdue_payment\":\n        return { icon: AlertTriangle, color: \"bg-status-overdue/10 text-status-overdue\" };\n      case \"pending_response\":\n        return { icon: Clock, color: \"bg-status-pending/10 text-status-pending\" };\n      case \"contract_approval\":\n        return { icon: FileSignature, color: \"bg-brand-primary/10 text-brand-primary\" };\n      default:\n        return { icon: AlertTriangle, color: \"bg-gray-300/10 text-gray-600\" };\n    }\n  };\n\n  const getActionButton = (type: string) => {\n    switch (type) {\n      case \"overdue_payment\":\n        return { label: \"Follow Up\", variant: \"destructive\" as const };\n      case \"pending_response\":\n        return { label: \"Respond\", variant: \"default\" as const };\n      case \"contract_approval\":\n        return { label: \"Review\", variant: \"default\" as const };\n      default:\n        return { label: \"Action\", variant: \"default\" as const };\n    }\n  };\n\n  const formatDueDate = (date: Date | undefined) => {\n    if (!date) return \"\";\n    const now = new Date();\n    const diff = new Date(date).getTime() - now.getTime();\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n    \n    if (days < 0) return `Due ${Math.abs(days)} days ago`;\n    if (days === 0) return \"Due today\";\n    if (days === 1) return \"Due tomorrow\";\n    return `Due in ${days} days`;\n  };\n\n  if (urgentActions.length === 0) {\n    return (\n      <Card>\n        <CardHeader className=\"border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Urgent Actions Required</h3>\n            <Badge variant=\"outline\" className=\"text-green-600 border-green-600\">\n              All Clear\n            </Badge>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <div className=\"text-center py-8 text-gray-500\">\n            No urgent actions required at this time.\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">Urgent Actions Required</h3>\n          <Badge variant=\"destructive\">\n            {urgentActions.length} item{urgentActions.length !== 1 ? 's' : ''}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <div className=\"divide-y divide-gray-200\">\n          {urgentActions.map((action) => {\n            const { icon: Icon, color } = getActionIcon(action.type);\n            const { label, variant } = getActionButton(action.type);\n            \n            return (\n              <div key={action.id} className=\"p-6 flex items-center justify-between\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className={`w-10 h-10 ${color} rounded-full flex items-center justify-center`}>\n                    <Icon size={20} />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-gray-900\">{action.message}</p>\n                    {action.dueDate && (\n                      <p className=\"text-sm text-gray-500\">{formatDueDate(action.dueDate)}</p>\n                    )}\n                  </div>\n                </div>\n                <Button variant={variant} size=\"sm\">\n                  {label}\n                </Button>\n              </div>\n            );\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4049},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/smart-pitch-matching.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Brain, Target, Sparkles, Calendar, Heart, Users, Music, TrendingUp, Star } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Song, Deal } from \"@shared/schema\";\n\ninterface SyncAnalysis {\n  suitability: number;\n  reasoning: string;\n  sceneMatches: string[];\n  emotionalTones: string[];\n  narrativeElements: string[];\n  recommendedUsage: string[];\n  targetDemographics: string[];\n  similarReferences: string[];\n  themes: string[];\n  seasonality: string[];\n  occasions: string[];\n}\n\ninterface PitchRecommendation {\n  songId: number;\n  songTitle: string;\n  matchScore: number;\n  analysis: SyncAnalysis;\n}\n\ninterface ProjectBrief {\n  title: string;\n  description: string;\n  projectType: string;\n  targetAudience?: string;\n  sceneDescription?: string;\n  desiredMood?: string;\n  targetDemographics?: string;\n}\n\nexport default function SmartPitchMatching() {\n  const [showAnalysisDialog, setShowAnalysisDialog] = useState(false);\n  const [selectedSong, setSelectedSong] = useState<Song | null>(null);\n  const [projectBrief, setProjectBrief] = useState<ProjectBrief>({\n    title: \"\",\n    description: \"\",\n    projectType: \"\",\n    targetAudience: \"\",\n    sceneDescription: \"\",\n    desiredMood: \"\",\n    targetDemographics: \"\"\n  });\n  const [recommendations, setRecommendations] = useState<PitchRecommendation[]>([]);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const { toast } = useToast();\n\n  const { data: songs = [] } = useQuery({\n    queryKey: ['/api/songs'],\n  });\n\n  const analyzeMatch = async () => {\n    if (!projectBrief.title || !projectBrief.description) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please provide project title and description\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsAnalyzing(true);\n    try {\n      const response = await apiRequest('/api/smart-pitch-analyze', {\n        method: 'POST',\n        body: {\n          songs: songs.slice(0, 10), // Limit to first 10 songs for demo\n          projectBrief\n        }\n      });\n      \n      setRecommendations(response);\n      toast({\n        title: \"Analysis Complete\",\n        description: `Generated recommendations for ${response.length} songs`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Analysis Failed\",\n        description: \"Could not analyze songs for this project\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const getSuitabilityColor = (score: number) => {\n    if (score >= 8) return \"text-green-600 bg-green-50\";\n    if (score >= 6) return \"text-yellow-600 bg-yellow-50\";\n    if (score >= 4) return \"text-orange-600 bg-orange-50\";\n    return \"text-red-600 bg-red-50\";\n  };\n\n  const getScoreIcon = (score: number) => {\n    if (score >= 8) return <Star className=\"h-4 w-4 text-green-600\" />;\n    if (score >= 6) return <TrendingUp className=\"h-4 w-4 text-yellow-600\" />;\n    return <Target className=\"h-4 w-4 text-orange-600\" />;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            Smart Pitch Matching\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">Project Title</Label>\n              <Input\n                id=\"title\"\n                value={projectBrief.title}\n                onChange={(e) => setProjectBrief({ ...projectBrief, title: e.target.value })}\n                placeholder=\"e.g., Holiday Commercial for Target\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"projectType\">Project Type</Label>\n              <Select value={projectBrief.projectType} onValueChange={(value) => setProjectBrief({ ...projectBrief, projectType: value })}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select project type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"commercial\">Commercial</SelectItem>\n                  <SelectItem value=\"documentary\">Documentary</SelectItem>\n                  <SelectItem value=\"film\">Film</SelectItem>\n                  <SelectItem value=\"game\">Video Game</SelectItem>\n                  <SelectItem value=\"indie_film\">Indie Film</SelectItem>\n                  <SelectItem value=\"non_profit\">Non-Profit</SelectItem>\n                  <SelectItem value=\"podcast\">Podcast</SelectItem>\n                  <SelectItem value=\"promos\">Promos</SelectItem>\n                  <SelectItem value=\"social\">Social Media</SelectItem>\n                  <SelectItem value=\"sports\">Sports</SelectItem>\n                  <SelectItem value=\"student_film\">Student Film</SelectItem>\n                  <SelectItem value=\"trailers\">Trailers</SelectItem>\n                  <SelectItem value=\"tv\">TV Show</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"description\">Project Description</Label>\n            <Textarea\n              id=\"description\"\n              value={projectBrief.description}\n              onChange={(e) => setProjectBrief({ ...projectBrief, description: e.target.value })}\n              placeholder=\"Describe the project, its goals, and overall vision...\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"sceneDescription\">Scene Description</Label>\n              <Textarea\n                id=\"sceneDescription\"\n                value={projectBrief.sceneDescription}\n                onChange={(e) => setProjectBrief({ ...projectBrief, sceneDescription: e.target.value })}\n                placeholder=\"Describe the specific scenes where music will be used...\"\n                rows={2}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"desiredMood\">Desired Mood</Label>\n              <Input\n                id=\"desiredMood\"\n                value={projectBrief.desiredMood}\n                onChange={(e) => setProjectBrief({ ...projectBrief, desiredMood: e.target.value })}\n                placeholder=\"e.g., Uplifting, Nostalgic, Energetic\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"targetAudience\">Target Audience</Label>\n              <Input\n                id=\"targetAudience\"\n                value={projectBrief.targetAudience}\n                onChange={(e) => setProjectBrief({ ...projectBrief, targetAudience: e.target.value })}\n                placeholder=\"e.g., Families, Young Adults, Professionals\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"targetDemographics\">Target Demographics</Label>\n              <Input\n                id=\"targetDemographics\"\n                value={projectBrief.targetDemographics}\n                onChange={(e) => setProjectBrief({ ...projectBrief, targetDemographics: e.target.value })}\n                placeholder=\"e.g., 25-45, Parents, Urban\"\n              />\n            </div>\n          </div>\n\n          <Button \n            onClick={analyzeMatch} \n            disabled={isAnalyzing}\n            className=\"w-full\"\n          >\n            {isAnalyzing ? \"Analyzing...\" : \"Generate AI Recommendations\"}\n            <Sparkles className=\"ml-2 h-4 w-4\" />\n          </Button>\n        </CardContent>\n      </Card>\n\n      {recommendations.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>AI Recommendations</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {recommendations.map((rec) => (\n                <Card key={rec.songId} className=\"border\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div>\n                        <h4 className=\"font-semibold text-lg\">{rec.songTitle}</h4>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          {getScoreIcon(rec.matchScore)}\n                          <span className={`px-2 py-1 rounded-full text-sm font-medium ${getSuitabilityColor(rec.matchScore)}`}>\n                            {rec.matchScore}/10 Match\n                          </span>\n                        </div>\n                      </div>\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button variant=\"outline\" size=\"sm\">\n                            View Analysis\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                          <DialogHeader>\n                            <DialogTitle>{rec.songTitle} - Sync Analysis</DialogTitle>\n                          </DialogHeader>\n                          <Tabs defaultValue=\"overview\" className=\"w-full\">\n                            <TabsList className=\"grid w-full grid-cols-4\">\n                              <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n                              <TabsTrigger value=\"themes\">Themes</TabsTrigger>\n                              <TabsTrigger value=\"usage\">Usage</TabsTrigger>\n                              <TabsTrigger value=\"references\">References</TabsTrigger>\n                            </TabsList>\n                            \n                            <TabsContent value=\"overview\" className=\"space-y-4\">\n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Match Score</h4>\n                                <Progress value={rec.matchScore * 10} className=\"w-full\" />\n                                <p className=\"text-sm text-gray-600 mt-1\">{rec.matchScore}/10</p>\n                              </div>\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Analysis Summary</h4>\n                                <p className=\"text-sm leading-relaxed\">{rec.analysis.reasoning}</p>\n                              </div>\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Emotional Tones</h4>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {rec.analysis.emotionalTones.map((tone, idx) => (\n                                    <Badge key={idx} variant=\"secondary\">\n                                      <Heart className=\"w-3 h-3 mr-1\" />\n                                      {tone}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </div>\n                            </TabsContent>\n                            \n                            <TabsContent value=\"themes\" className=\"space-y-4\">\n                              <div>\n                                <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                                  <Music className=\"h-4 w-4\" />\n                                  Core Themes\n                                </h4>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {rec.analysis.themes.map((theme, idx) => (\n                                    <Badge key={idx} variant=\"outline\">\n                                      {theme}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </div>\n                              \n                              <Separator />\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                                  <Calendar className=\"h-4 w-4\" />\n                                  Seasonality & Occasions\n                                </h4>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                  <div>\n                                    <h5 className=\"font-medium mb-2\">Seasonal Relevance</h5>\n                                    <div className=\"flex flex-wrap gap-2\">\n                                      {rec.analysis.seasonality.map((season, idx) => (\n                                        <Badge key={idx} className=\"bg-blue-100 text-blue-800\">\n                                          {season}\n                                        </Badge>\n                                      ))}\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <h5 className=\"font-medium mb-2\">Special Occasions</h5>\n                                    <div className=\"flex flex-wrap gap-2\">\n                                      {rec.analysis.occasions.map((occasion, idx) => (\n                                        <Badge key={idx} className=\"bg-purple-100 text-purple-800\">\n                                          {occasion}\n                                        </Badge>\n                                      ))}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            </TabsContent>\n                            \n                            <TabsContent value=\"usage\" className=\"space-y-4\">\n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Recommended Usage</h4>\n                                <ul className=\"space-y-2\">\n                                  {rec.analysis.recommendedUsage.map((usage, idx) => (\n                                    <li key={idx} className=\"flex items-center gap-2\">\n                                      <Target className=\"h-4 w-4 text-green-600\" />\n                                      <span className=\"text-sm\">{usage}</span>\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                              \n                              <Separator />\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Scene Matches</h4>\n                                <ul className=\"space-y-2\">\n                                  {rec.analysis.sceneMatches.map((scene, idx) => (\n                                    <li key={idx} className=\"flex items-center gap-2\">\n                                      <Users className=\"h-4 w-4 text-blue-600\" />\n                                      <span className=\"text-sm\">{scene}</span>\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                              \n                              <Separator />\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Target Demographics</h4>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {rec.analysis.targetDemographics.map((demo, idx) => (\n                                    <Badge key={idx} variant=\"secondary\">\n                                      <Users className=\"w-3 h-3 mr-1\" />\n                                      {demo}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </div>\n                            </TabsContent>\n                            \n                            <TabsContent value=\"references\" className=\"space-y-4\">\n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Similar Successful Sync References</h4>\n                                <ul className=\"space-y-3\">\n                                  {rec.analysis.similarReferences.map((ref, idx) => (\n                                    <li key={idx} className=\"p-3 bg-gray-50 rounded-lg\">\n                                      <span className=\"text-sm font-medium\">{ref}</span>\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                              \n                              <Separator />\n                              \n                              <div>\n                                <h4 className=\"font-semibold mb-2\">Narrative Elements</h4>\n                                <ul className=\"space-y-2\">\n                                  {rec.analysis.narrativeElements.map((element, idx) => (\n                                    <li key={idx} className=\"flex items-center gap-2\">\n                                      <Music className=\"h-4 w-4 text-purple-600\" />\n                                      <span className=\"text-sm\">{element}</span>\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                            </TabsContent>\n                          </Tabs>\n                        </DialogContent>\n                      </Dialog>\n                    </div>\n                    \n                    <p className=\"text-sm text-gray-600 mb-3\">{rec.analysis.reasoning.substring(0, 150)}...</p>\n                    \n                    <div className=\"flex flex-wrap gap-2\">\n                      {rec.analysis.themes.slice(0, 3).map((theme, idx) => (\n                        <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                          {theme}\n                        </Badge>\n                      ))}\n                      {rec.analysis.themes.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{rec.analysis.themes.length - 3} more\n                        </Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":19781},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-40 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 pointer-events-none\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content> & {\n    hideClose?: boolean;\n  }\n>(({ className, children, hideClose, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg pointer-events-auto\",\n        className\n      )}\n      {...props}\n    >\n      {!hideClose && (\n        <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground z-[60] bg-white dark:bg-gray-800 border shadow-sm p-1.5 w-6 h-6 flex items-center justify-center\">\n          <X className=\"h-4 w-4\" />\n          <span className=\"sr-only\">Close</span>\n        </DialogPrimitive.Close>\n      )}\n      {children}\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":4069},"client/src/components/forms/add-calendar-event-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { insertCalendarEventSchema, type InsertCalendarEvent } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AddCalendarEventFormProps {\n  open: boolean;\n  onClose: () => void;\n  entityType?: string;\n  entityId?: number;\n}\n\nexport default function AddCalendarEventForm({ open, onClose, entityType, entityId }: AddCalendarEventFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertCalendarEvent>({\n    resolver: zodResolver(insertCalendarEventSchema),\n    defaultValues: {\n      title: \"\",\n      description: \"\",\n      startDate: new Date(),\n      endDate: undefined,\n      allDay: false,\n      entityType: entityType || \"deal\",\n      entityId: entityId || 0,\n      reminderMinutes: 60,\n      status: \"scheduled\",\n    },\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertCalendarEvent) => {\n      return await apiRequest(\"/api/calendar-events\", {\n        method: \"POST\",\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/calendar-events\"] });\n      toast({\n        title: \"Calendar event created\",\n        description: \"The calendar event has been successfully created.\",\n      });\n      onClose();\n      form.reset();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create calendar event. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertCalendarEvent) => {\n    mutation.mutate(data);\n  };\n\n  const formatDateForInput = (date: Date) => {\n    return date.toISOString().slice(0, 16);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Add Calendar Event</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Title</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Event title\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Description</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Event description\"\n                      className=\"min-h-[80px]\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"startDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Start Date</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"datetime-local\"\n                        {...field}\n                        value={formatDateForInput(field.value)}\n                        onChange={(e) => field.onChange(new Date(e.target.value))}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"endDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>End Date (Optional)</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"datetime-local\"\n                        {...field}\n                        value={field.value ? formatDateForInput(field.value) : \"\"}\n                        onChange={(e) => field.onChange(e.target.value ? new Date(e.target.value) : undefined)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"allDay\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                  <FormControl>\n                    <Checkbox\n                      checked={field.value}\n                      onCheckedChange={field.onChange}\n                    />\n                  </FormControl>\n                  <div className=\"space-y-1 leading-none\">\n                    <FormLabel>All Day Event</FormLabel>\n                  </div>\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"reminderMinutes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Reminder</FormLabel>\n                  <Select onValueChange={(value) => field.onChange(parseInt(value))} defaultValue={field.value.toString()}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select reminder time\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"0\">No reminder</SelectItem>\n                      <SelectItem value=\"15\">15 minutes before</SelectItem>\n                      <SelectItem value=\"30\">30 minutes before</SelectItem>\n                      <SelectItem value=\"60\">1 hour before</SelectItem>\n                      <SelectItem value=\"1440\">1 day before</SelectItem>\n                      <SelectItem value=\"2880\">2 days before</SelectItem>\n                      <SelectItem value=\"10080\">1 week before</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending}>\n                {mutation.isPending ? \"Creating...\" : \"Create Event\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":7559},"client/src/pages/analytics.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, TrendingDown, DollarSign, Music, Users, Target, Calendar, BarChart3 } from \"lucide-react\";\nimport { ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, BarChart, Bar, PieChart, Pie, Cell } from \"recharts\";\n\ninterface AnalyticsData {\n  revenue: {\n    total: number;\n    monthly: Array<{ month: string; amount: number; deals: number }>;\n    byGenre: Array<{ genre: string; amount: number; percentage: number }>;\n    byClient: Array<{ client: string; amount: number; deals: number }>;\n  };\n  performance: {\n    pitchSuccess: number;\n    averageDealValue: number;\n    averageTimeToClose: number;\n    topPerformingSongs: Array<{ song: string; artist: string; deals: number; revenue: number }>;\n    clientSuccess: Array<{ client: string; successRate: number; totalPitches: number }>;\n  };\n  trends: {\n    genrePopularity: Array<{ genre: string; count: number; trend: 'up' | 'down' | 'stable' }>;\n    seasonalTrends: Array<{ month: string; activity: number }>;\n    dealStages: Array<{ stage: string; count: number; averageDays: number }>;\n  };\n}\n\nconst COLORS = ['#8884d8', '#82ca9d', '#ffc658', '#ff7300', '#00ff00', '#ff00ff'];\n\nexport default function Analytics() {\n  const [timeRange, setTimeRange] = useState(\"12months\");\n  \n  // Mock data - in real app, this would come from API\n  const mockAnalytics: AnalyticsData = {\n    revenue: {\n      total: 45750,\n      monthly: [\n        { month: \"Jan\", amount: 3200, deals: 4 },\n        { month: \"Feb\", amount: 2800, deals: 3 },\n        { month: \"Mar\", amount: 4100, deals: 5 },\n        { month: \"Apr\", amount: 3800, deals: 4 },\n        { month: \"May\", amount: 5200, deals: 6 },\n        { month: \"Jun\", amount: 4600, deals: 5 },\n        { month: \"Jul\", amount: 3900, deals: 4 },\n        { month: \"Aug\", amount: 4800, deals: 6 },\n        { month: \"Sep\", amount: 5100, deals: 5 },\n        { month: \"Oct\", amount: 4200, deals: 4 },\n        { month: \"Nov\", amount: 4800, deals: 5 },\n        { month: \"Dec\", amount: 5150, deals: 6 },\n      ],\n      byGenre: [\n        { genre: \"Electronic\", amount: 15200, percentage: 33.2 },\n        { genre: \"Pop\", amount: 12300, percentage: 26.9 },\n        { genre: \"Cinematic\", amount: 8900, percentage: 19.5 },\n        { genre: \"Rock\", amount: 6100, percentage: 13.3 },\n        { genre: \"Hip Hop\", amount: 3250, percentage: 7.1 },\n      ],\n      byClient: [\n        { client: \"Netflix Studios\", amount: 12500, deals: 8 },\n        { client: \"Sony Pictures\", amount: 9800, deals: 6 },\n        { client: \"Universal Music\", amount: 7200, deals: 5 },\n        { client: \"Warner Bros\", amount: 6100, deals: 4 },\n        { client: \"Apple Music\", amount: 4850, deals: 3 },\n      ],\n    },\n    performance: {\n      pitchSuccess: 18.5,\n      averageDealValue: 1850,\n      averageTimeToClose: 45,\n      topPerformingSongs: [\n        { song: \"Urban Sunrise\", artist: \"Maya Chen\", deals: 3, revenue: 8400 },\n        { song: \"Midnight Drive\", artist: \"The Neon Collective\", deals: 2, revenue: 6200 },\n        { song: \"Digital Dreams\", artist: \"Alex Rivera\", deals: 2, revenue: 4800 },\n        { song: \"City Lights\", artist: \"Luna Park\", deals: 1, revenue: 3200 },\n        { song: \"Electric Soul\", artist: \"Maya Chen\", deals: 1, revenue: 2800 },\n      ],\n      clientSuccess: [\n        { client: \"Netflix Studios\", successRate: 25.0, totalPitches: 32 },\n        { client: \"Sony Pictures\", successRate: 22.2, totalPitches: 27 },\n        { client: \"Universal Music\", successRate: 19.2, totalPitches: 26 },\n        { client: \"Warner Bros\", successRate: 16.7, totalPitches: 24 },\n        { client: \"Apple Music\", successRate: 15.0, totalPitches: 20 },\n      ],\n    },\n    trends: {\n      genrePopularity: [\n        { genre: \"Electronic\", count: 45, trend: 'up' },\n        { genre: \"Pop\", count: 38, trend: 'up' },\n        { genre: \"Cinematic\", count: 32, trend: 'stable' },\n        { genre: \"Rock\", count: 28, trend: 'down' },\n        { genre: \"Hip Hop\", count: 22, trend: 'up' },\n      ],\n      seasonalTrends: [\n        { month: \"Jan\", activity: 15 },\n        { month: \"Feb\", activity: 12 },\n        { month: \"Mar\", activity: 18 },\n        { month: \"Apr\", activity: 22 },\n        { month: \"May\", activity: 28 },\n        { month: \"Jun\", activity: 25 },\n        { month: \"Jul\", activity: 20 },\n        { month: \"Aug\", activity: 24 },\n        { month: \"Sep\", activity: 30 },\n        { month: \"Oct\", activity: 26 },\n        { month: \"Nov\", activity: 22 },\n        { month: \"Dec\", activity: 19 },\n      ],\n      dealStages: [\n        { stage: \"Initial Contact\", count: 45, averageDays: 7 },\n        { stage: \"Pitch Sent\", count: 38, averageDays: 14 },\n        { stage: \"Under Review\", count: 22, averageDays: 21 },\n        { stage: \"Negotiating\", count: 15, averageDays: 12 },\n        { stage: \"Contract Sent\", count: 8, averageDays: 8 },\n        { stage: \"Closed Won\", count: 5, averageDays: 3 },\n      ],\n    },\n  };\n\n  const getTrendIcon = (trend: string) => {\n    switch (trend) {\n      case 'up': return <TrendingUp className=\"h-4 w-4 text-green-600\" />;\n      case 'down': return <TrendingDown className=\"h-4 w-4 text-red-600\" />;\n      default: return <BarChart3 className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  return (\n    <div>\n      <Header\n        title=\"Analytics & Reports\"\n        description=\"Comprehensive insights into your sync licensing performance\"\n      />\n\n      <div className=\"p-6\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <div className=\"flex space-x-4\">\n            <Select value={timeRange} onValueChange={setTimeRange}>\n              <SelectTrigger className=\"w-40\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"3months\">Last 3 Months</SelectItem>\n                <SelectItem value=\"6months\">Last 6 Months</SelectItem>\n                <SelectItem value=\"12months\">Last 12 Months</SelectItem>\n                <SelectItem value=\"24months\">Last 24 Months</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"overview\" className=\"space-y-6\">\n          <TabsList>\n            <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"revenue\">Revenue</TabsTrigger>\n            <TabsTrigger value=\"performance\">Performance</TabsTrigger>\n            <TabsTrigger value=\"trends\">Trends</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            {/* Key Metrics */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm text-gray-600\">Total Revenue</p>\n                      <p className=\"text-2xl font-bold\">${mockAnalytics.revenue.total.toLocaleString()}</p>\n                    </div>\n                    <DollarSign className=\"h-8 w-8 text-green-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm text-gray-600\">Success Rate</p>\n                      <p className=\"text-2xl font-bold\">{mockAnalytics.performance.pitchSuccess}%</p>\n                    </div>\n                    <Target className=\"h-8 w-8 text-blue-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm text-gray-600\">Avg Deal Value</p>\n                      <p className=\"text-2xl font-bold\">${mockAnalytics.performance.averageDealValue}</p>\n                    </div>\n                    <BarChart3 className=\"h-8 w-8 text-purple-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-sm text-gray-600\">Avg Time to Close</p>\n                      <p className=\"text-2xl font-bold\">{mockAnalytics.performance.averageTimeToClose} days</p>\n                    </div>\n                    <Calendar className=\"h-8 w-8 text-orange-600\" />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Revenue Chart */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Revenue Trend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <LineChart data={mockAnalytics.revenue.monthly}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" />\n                    <YAxis />\n                    <Tooltip formatter={(value) => [`$${value}`, 'Revenue']} />\n                    <Line type=\"monotone\" dataKey=\"amount\" stroke=\"#8884d8\" strokeWidth={2} />\n                  </LineChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"revenue\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {/* Revenue by Genre */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Revenue by Genre</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <PieChart>\n                      <Pie\n                        data={mockAnalytics.revenue.byGenre}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ genre, percentage }) => `${genre} ${percentage}%`}\n                        outerRadius={100}\n                        fill=\"#8884d8\"\n                        dataKey=\"amount\"\n                      >\n                        {mockAnalytics.revenue.byGenre.map((entry, index) => (\n                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip formatter={(value) => [`$${value}`, 'Revenue']} />\n                    </PieChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n\n              {/* Top Clients */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Top Clients by Revenue</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {mockAnalytics.revenue.byClient.map((client, index) => (\n                      <div key={client.client} className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-medium\">{client.client}</p>\n                          <p className=\"text-sm text-gray-600\">{client.deals} deals</p>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"font-bold\">${client.amount.toLocaleString()}</p>\n                          <Badge variant=\"outline\">#{index + 1}</Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"performance\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {/* Top Performing Songs */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Top Performing Songs</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {mockAnalytics.performance.topPerformingSongs.map((song, index) => (\n                      <div key={song.song} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-800 text-sm font-medium\">\n                            {index + 1}\n                          </div>\n                          <div>\n                            <p className=\"font-medium\">{song.song}</p>\n                            <p className=\"text-sm text-gray-600\">{song.artist}</p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"font-bold\">${song.revenue.toLocaleString()}</p>\n                          <p className=\"text-sm text-gray-600\">{song.deals} deals</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Client Success Rates */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Client Success Rates</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {mockAnalytics.performance.clientSuccess.map((client) => (\n                      <div key={client.client} className=\"space-y-2\">\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-sm font-medium\">{client.client}</span>\n                          <span className=\"text-sm text-gray-600\">{client.successRate}%</span>\n                        </div>\n                        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                          <div \n                            className=\"bg-blue-600 h-2 rounded-full\" \n                            style={{ width: `${client.successRate}%` }}\n                          />\n                        </div>\n                        <p className=\"text-xs text-gray-500\">{client.totalPitches} total pitches</p>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"trends\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {/* Genre Popularity Trends */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Genre Popularity Trends</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {mockAnalytics.trends.genrePopularity.map((genre) => (\n                      <div key={genre.genre} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-3\">\n                          {getTrendIcon(genre.trend)}\n                          <span className=\"font-medium\">{genre.genre}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-sm text-gray-600\">{genre.count} songs</span>\n                          <Badge variant={genre.trend === 'up' ? 'default' : genre.trend === 'down' ? 'destructive' : 'secondary'}>\n                            {genre.trend}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Seasonal Activity */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Seasonal Activity</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <BarChart data={mockAnalytics.trends.seasonalTrends}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"month\" />\n                      <YAxis />\n                      <Tooltip />\n                      <Bar dataKey=\"activity\" fill=\"#8884d8\" />\n                    </BarChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":17278},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/calendar.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport Header from \"@/components/layout/header\";\nimport AddCalendarEventForm from \"@/components/forms/add-calendar-event-form\";\nimport { Calendar as CalendarIcon, Clock, Plus, Edit, ChevronLeft, ChevronRight, Move, Trash2 } from \"lucide-react\";\nimport type { CalendarEvent } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Calendar() {\n  const [isAddFormOpen, setIsAddFormOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingEvent, setEditingEvent] = useState<CalendarEvent | null>(null);\n  const [editDate, setEditDate] = useState(\"\");\n  const [currentMonth, setCurrentMonth] = useState(new Date());\n  const [activeTab, setActiveTab] = useState(\"list\");\n  const [draggedEvent, setDraggedEvent] = useState<CalendarEvent | null>(null);\n  const [dragOverDay, setDragOverDay] = useState<Date | null>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: events = [], isLoading: eventsLoading, error: eventsError } = useQuery<CalendarEvent[]>({\n    queryKey: [\"/api/calendar-events\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/calendar-events\");\n      if (!response.ok) {\n        throw new Error('Failed to fetch calendar events');\n      }\n      return response.json();\n    },\n  });\n\n  const { data: deals = [], isLoading: dealsLoading, error: dealsError } = useQuery<any[]>({\n    queryKey: [\"/api/deals\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/deals\");\n      if (!response.ok) {\n        throw new Error('Failed to fetch deals');\n      }\n      return response.json();\n    },\n  });\n\n  const { data: songs = [], isLoading: songsLoading, error: songsError } = useQuery<any[]>({\n    queryKey: [\"/api/songs\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/songs\");\n      if (!response.ok) {\n        throw new Error('Failed to fetch songs');\n      }\n      return response.json();\n    },\n  });\n\n  const isLoading = eventsLoading || dealsLoading || songsLoading;\n  const error = eventsError || dealsError || songsError;\n\n  const getStatusColor = (status: string) => {\n    const colors = {\n      scheduled: \"bg-blue-100 text-blue-800\",\n      completed: \"bg-green-100 text-green-800\",\n      cancelled: \"bg-red-100 text-red-800\",\n    };\n    return colors[status as keyof typeof colors] || \"bg-gray-100 text-gray-800\";\n  };\n\n  const getEntityTypeColor = (entityType: string) => {\n    const colors = {\n      deal: \"bg-purple-100 text-purple-800\",\n      pitch: \"bg-orange-100 text-orange-800\",\n      payment: \"bg-green-100 text-green-800\",\n      song: \"bg-blue-100 text-blue-800\",\n      contact: \"bg-yellow-100 text-yellow-800\",\n    };\n    return colors[entityType as keyof typeof colors] || \"bg-gray-100 text-gray-800\";\n  };\n\n  const formatDate = (date: string | Date) => {\n    const dateObj = date instanceof Date ? date : new Date(date);\n    return dateObj.toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const formatEntityType = (type: string) => {\n    return type.charAt(0).toUpperCase() + type.slice(1);\n  };\n\n  // Combine calendar events with air dates from deals\n  const airDateEvents = deals\n    .filter((deal: any) => deal.airDate)\n    .map((deal: any) => {\n      // Parse date as local timezone to avoid timezone conversion issues\n      const airDateStr = deal.airDate.split('T')[0]; // Get YYYY-MM-DD\n      const [year, month, day] = airDateStr.split('-').map(Number);\n      const localDate = new Date(year, month - 1, day, 12, 0, 0); // Use noon to avoid timezone issues\n      \n      // Find the song title for this deal\n      const song = songs.find((s: any) => s.id === deal.songId);\n      const songTitle = song?.title || 'Unknown Song';\n      \n      return {\n        id: parseInt(`${deal.id}000`), // Convert to number with suffix to avoid conflicts\n        title: `Air Date: ${deal.projectName}`,\n        description: `Song: ${songTitle}`,\n        startDate: localDate,\n        endDate: localDate,\n        allDay: true,\n        entityType: 'deal',\n        entityId: deal.id,\n        status: 'scheduled',\n        reminderMinutes: 1440,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n    });\n\n  const allEvents = [...events, ...airDateEvents];\n\n  const filteredEvents = allEvents.filter(event =>\n    event.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    event.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    event.entityType.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const upcomingEvents = allEvents.filter(event => \n    new Date(event.startDate) > new Date() && event.status === 'scheduled'\n  ).slice(0, 5);\n\n  const overdueEvents = allEvents.filter(event => \n    new Date(event.startDate) < new Date() && event.status === 'scheduled'\n  );\n\n  // Monthly view helpers\n  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', \n                     'July', 'August', 'September', 'October', 'November', 'December'];\n  \n  const getEventsForMonth = (month: Date) => {\n    const start = new Date(month.getFullYear(), month.getMonth(), 1);\n    const end = new Date(month.getFullYear(), month.getMonth() + 1, 0);\n    \n    return allEvents.filter(event => {\n      const eventDate = new Date(event.startDate);\n      return eventDate >= start && eventDate <= end;\n    }).sort((a, b) => new Date(a.startDate).getTime() - new Date(b.startDate).getTime());\n  };\n\n  const currentMonthEvents = getEventsForMonth(currentMonth);\n\n  // Calendar grid helpers\n  const getDaysInMonth = (month: Date) => {\n    const year = month.getFullYear();\n    const monthIndex = month.getMonth();\n    const firstDay = new Date(year, monthIndex, 1);\n    const lastDay = new Date(year, monthIndex + 1, 0);\n    const startDate = new Date(firstDay);\n    startDate.setDate(startDate.getDate() - firstDay.getDay()); // Start from Sunday\n    \n    const days = [];\n    const current = new Date(startDate);\n    \n    // Generate 42 days (6 weeks) for the calendar grid\n    for (let i = 0; i < 42; i++) {\n      days.push(new Date(current));\n      current.setDate(current.getDate() + 1);\n    }\n    \n    return days;\n  };\n\n  const getEventsForDay = (day: Date) => {\n    const dayStart = new Date(day.getFullYear(), day.getMonth(), day.getDate());\n    const dayEnd = new Date(day.getFullYear(), day.getMonth(), day.getDate() + 1);\n    \n    return allEvents.filter(event => {\n      const eventDate = new Date(event.startDate);\n      return eventDate >= dayStart && eventDate < dayEnd;\n    });\n  };\n\n  const isToday = (date: Date) => {\n    const today = new Date();\n    return date.toDateString() === today.toDateString();\n  };\n\n  const isCurrentMonth = (date: Date) => {\n    return date.getMonth() === currentMonth.getMonth() && date.getFullYear() === currentMonth.getFullYear();\n  };\n\n  const calendarDays = getDaysInMonth(currentMonth);\n  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\n  const navigateMonth = (direction: 'prev' | 'next') => {\n    setCurrentMonth(prev => {\n      const newMonth = new Date(prev);\n      if (direction === 'prev') {\n        newMonth.setMonth(prev.getMonth() - 1);\n      } else {\n        newMonth.setMonth(prev.getMonth() + 1);\n      }\n      return newMonth;\n    });\n  };\n\n  // Edit air date mutation\n  const editAirDateMutation = useMutation({\n    mutationFn: async ({ eventId, newDate }: { eventId: number; newDate: string }) => {\n      return await apiRequest(`/api/calendar-events/${eventId}`, {\n        method: 'PUT',\n        body: {\n          startDate: newDate,\n          endDate: newDate,\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendar-events'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      toast({\n        title: \"Air date updated successfully\",\n        description: \"The air date has been updated in the calendar.\",\n      });\n      setEditingEvent(null);\n      setEditDate(\"\");\n    },\n    onError: (error) => {\n      console.error('Air date update error:', error);\n      toast({\n        title: \"Error updating air date\",\n        description: \"Failed to update the air date. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleEditAirDate = (event: CalendarEvent) => {\n    setEditingEvent(event);\n    setEditDate(new Date(event.startDate).toISOString().split('T')[0]);\n  };\n\n  const handleSaveEdit = () => {\n    if (editingEvent && editDate) {\n      editAirDateMutation.mutate({\n        eventId: editingEvent.id,\n        newDate: new Date(editDate).toISOString(),\n      });\n    }\n  };\n\n  // Delete calendar event mutation\n  const deleteCalendarEventMutation = useMutation({\n    mutationFn: async (eventId: number) => {\n      return await apiRequest(`/api/calendar-events/${eventId}`, {\n        method: 'DELETE',\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendar-events'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      toast({\n        title: \"Event deleted successfully\",\n        description: \"The calendar event has been removed.\",\n      });\n    },\n    onError: (error) => {\n      console.error('Calendar event delete error:', error);\n      toast({\n        title: \"Error deleting event\",\n        description: \"Failed to delete the calendar event. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleDeleteEvent = (eventId: number) => {\n    if (confirm(\"Are you sure you want to delete this calendar event?\")) {\n      deleteCalendarEventMutation.mutate(eventId);\n    }\n  };\n\n  // Check if an event is a real calendar event (not auto-generated from deals)\n  const isRealCalendarEvent = (event: CalendarEvent) => {\n    // Real calendar events have IDs < 1000 or are from the events array\n    // Auto-generated deal events have IDs like dealId * 1000\n    return events.some(e => e.id === event.id);\n  };\n\n  // Drag and drop handlers\n  const handleDragStart = (event: React.DragEvent, calendarEvent: CalendarEvent) => {\n    setDraggedEvent(calendarEvent);\n    event.dataTransfer.effectAllowed = 'move';\n    event.dataTransfer.setData('text/html', '');\n  };\n\n  const handleDragOver = (event: React.DragEvent, day: Date) => {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'move';\n    setDragOverDay(day);\n  };\n\n  const handleDragLeave = () => {\n    setDragOverDay(null);\n  };\n\n  const handleDrop = (event: React.DragEvent, targetDate: Date) => {\n    event.preventDefault();\n    \n    if (draggedEvent) {\n      const newDate = new Date(targetDate);\n      newDate.setHours(0, 0, 0, 0);\n      \n      try {\n        editAirDateMutation.mutate({\n          eventId: draggedEvent.id,\n          newDate: newDate.toISOString(),\n        });\n      } catch (error) {\n        console.error('Error during drag and drop:', error);\n        toast({\n          title: \"Error moving event\",\n          description: \"Failed to move the event. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n      \n      setDraggedEvent(null);\n      setDragOverDay(null);\n    }\n  };\n\n  const handleDragEnd = () => {\n    setDraggedEvent(null);\n    setDragOverDay(null);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <Header\n          title=\"Calendar\"\n          description=\"Manage important dates and deadlines for your sync licensing deals\"\n        />\n        <div className=\"grid gap-4\">\n          {[...Array(5)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-4 bg-muted rounded w-1/3\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-3 bg-muted rounded w-full\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center\">\n          <div className=\"text-lg text-red-600 mb-2\">Failed to load calendar data</div>\n          <p className=\"text-gray-600 mb-4\">Please check your connection and try again.</p>\n          <Button \n            onClick={() => window.location.reload()} \n            className=\"bg-brand-primary hover:bg-blue-700\"\n          >\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Header\n        title=\"Calendar\"\n        description=\"Manage important dates and deadlines for your sync licensing deals\"\n        searchPlaceholder=\"Search events...\"\n        onSearch={setSearchQuery}\n        onNewItem={() => setIsAddFormOpen(true)}\n        newItemLabel=\"New Event\"\n        showSearch={activeTab === \"list\"}\n        showNewButton={true}\n      />\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"list\">List View</TabsTrigger>\n          <TabsTrigger value=\"monthly\">Monthly List</TabsTrigger>\n          <TabsTrigger value=\"calendar\">Calendar Grid</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"list\" className=\"space-y-6\">\n\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Total Events</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{allEvents.length}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Upcoming</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{upcomingEvents.length}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Overdue</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">{overdueEvents.length}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">This Week</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {allEvents.filter(event => {\n                const eventDate = new Date(event.startDate);\n                const now = new Date();\n                const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\n                return eventDate >= now && eventDate <= weekFromNow;\n              }).length}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {upcomingEvents.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Upcoming Events</CardTitle>\n            <CardDescription>Your next 5 scheduled events</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {upcomingEvents.map((event) => (\n                <div key={event.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                  <div className=\"space-y-1\">\n                    <p className=\"font-medium\">{event.title}</p>\n                    {event.description && (\n                      <p className=\"text-sm text-muted-foreground\">{event.description}</p>\n                    )}\n                    <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                      <Clock className=\"h-4 w-4\" />\n                      <span>{formatDate(event.startDate)}</span>\n                      <Badge className={getEntityTypeColor(event.entityType)}>\n                        {formatEntityType(event.entityType)}\n                      </Badge>\n                    </div>\n                  </div>\n                  <Badge className={getStatusColor(event.status || 'scheduled')}>\n                    {event.status || 'scheduled'}\n                  </Badge>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>All Events</CardTitle>\n          <CardDescription>\n            Complete list of calendar events and deadlines\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Title</TableHead>\n                <TableHead>Date</TableHead>\n                <TableHead>Type</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Reminder</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredEvents.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={6} className=\"text-center py-8\">\n                    <CalendarIcon className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                    <p className=\"text-muted-foreground\">\n                      {allEvents.length === 0 \n                        ? \"No calendar events yet. Create your first event or add a deal with an air date!\"\n                        : \"No events match your search.\"\n                      }\n                    </p>\n                  </TableCell>\n                </TableRow>\n              ) : (\n                filteredEvents.map((event) => (\n                  <TableRow key={event.id}>\n                    <TableCell>\n                      <div>\n                        <p className=\"font-medium\">{event.title}</p>\n                        {event.description && (\n                          <p className=\"text-sm text-muted-foreground truncate max-w-xs\">\n                            {event.description}\n                          </p>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div>\n                        <p>{formatDate(event.startDate)}</p>\n                        {event.allDay && (\n                          <Badge variant=\"outline\" className=\"text-xs\">All Day</Badge>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge className={getEntityTypeColor(event.entityType)}>\n                        {formatEntityType(event.entityType)}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <Badge className={getStatusColor(event.status || 'scheduled')}>\n                        {event.status || 'scheduled'}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground\">\n                      {(event.reminderMinutes || 0) > 0 ? (\n                        `${event.reminderMinutes} min before`\n                      ) : (\n                        \"No reminder\"\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center space-x-2\">\n                        {isRealCalendarEvent(event) ? (\n                          <>\n                            <Button \n                              variant=\"ghost\" \n                              size=\"sm\"\n                              onClick={() => handleDeleteEvent(event.id)}\n                              data-testid={`delete-event-${event.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-red-600\" />\n                            </Button>\n                          </>\n                        ) : (\n                          <span className=\"text-xs text-muted-foreground\">\n                            From Deal\n                          </span>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n      </TabsContent>\n\n      <TabsContent value=\"monthly\" className=\"space-y-6\">\n        {/* Monthly View Header */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateMonth('prev')}\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <CardTitle className=\"text-xl\">\n                {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}\n              </CardTitle>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateMonth('next')}\n              >\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </CardHeader>\n        </Card>\n\n        {/* Monthly Events List */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Air Dates for {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}</CardTitle>\n            <CardDescription>\n              {currentMonthEvents.length} event{currentMonthEvents.length !== 1 ? 's' : ''} scheduled\n              {currentMonthEvents.length === 0 && currentMonth.getMonth() === 6 && currentMonth.getFullYear() === 2025 && (\n                <span className=\"text-muted-foreground\">  Fire Country is scheduled for August 1st - use the arrow button to navigate to August</span>\n              )}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {currentMonthEvents.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <CalendarIcon className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                <p className=\"text-muted-foreground\">No events scheduled for this month</p>\n                {currentMonth.getMonth() === 6 && currentMonth.getFullYear() === 2025 && (\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                     Fire Country is scheduled for August 1st - click the right arrow to navigate to August\n                  </p>\n                )}\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {currentMonthEvents.map((event) => (\n                  <div key={event.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center space-x-2\">\n                        <p className=\"font-medium\">{event.title}</p>\n                        <Badge className={getEntityTypeColor(event.entityType)}>\n                          {formatEntityType(event.entityType)}\n                        </Badge>\n                      </div>\n                      <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                        <Clock className=\"h-4 w-4\" />\n                        <span>{formatDate(event.startDate)}</span>\n                      </div>\n                      {event.description && (\n                        <p className=\"text-sm text-muted-foreground\">{event.description}</p>\n                      )}\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <Badge className={getStatusColor(event.status || 'scheduled')}>\n                        {event.status || 'scheduled'}\n                      </Badge>\n                      {event.entityType === 'deal' && (\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => handleEditAirDate(event)}\n                        >\n                          <Edit className=\"h-4 w-4 mr-1\" />\n                          Edit Date\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </TabsContent>\n\n      <TabsContent value=\"calendar\" className=\"space-y-6\">\n        {/* Calendar Grid Header */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateMonth('prev')}\n                aria-label=\"Go to previous month\"\n              >\n                <ChevronLeft className=\"h-4 w-4\" aria-hidden=\"true\" />\n              </Button>\n              <CardTitle className=\"text-xl\" aria-live=\"polite\">\n                {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}\n              </CardTitle>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateMonth('next')}\n                aria-label=\"Go to next month\"\n              >\n                <ChevronRight className=\"h-4 w-4\" aria-hidden=\"true\" />\n              </Button>\n            </div>\n          </CardHeader>\n        </Card>\n\n        {/* Calendar Grid */}\n        <Card>\n          <CardContent className=\"p-6\">\n            {/* Day names header */}\n            <div className=\"grid grid-cols-7 gap-1 mb-4\">\n              {dayNames.map((day) => (\n                <div key={day} className=\"p-2 text-center text-sm font-medium text-muted-foreground\">\n                  {day}\n                </div>\n              ))}\n            </div>\n\n            {/* Calendar days */}\n            <div className=\"grid grid-cols-7 gap-1\">\n              {calendarDays.map((day, index) => {\n                const dayEvents = getEventsForDay(day);\n                const isCurrentMonthDay = isCurrentMonth(day);\n                const isTodayDay = isToday(day);\n                const isDragOver = dragOverDay?.toDateString() === day.toDateString();\n                \n                return (\n                  <div\n                    key={index}\n                    className={`\n                      min-h-[60px] md:min-h-[100px] p-1 md:p-2 border rounded-lg transition-colors\n                      ${isCurrentMonthDay ? 'bg-background' : 'bg-muted/30'}\n                      ${isTodayDay ? 'ring-2 ring-primary' : ''}\n                      ${isDragOver ? 'ring-2 ring-blue-400 bg-blue-50 dark:bg-blue-900/20' : ''}\n                      hover:bg-muted/50\n                    `}\n                    onDragOver={(e) => handleDragOver(e, day)}\n                    onDragLeave={handleDragLeave}\n                    onDrop={(e) => handleDrop(e, day)}\n                  >\n                    {/* Day number */}\n                    <div className={`\n                      text-xs md:text-sm font-medium mb-1\n                      ${isCurrentMonthDay ? 'text-foreground' : 'text-muted-foreground'}\n                      ${isTodayDay ? 'text-primary font-bold' : ''}\n                    `}>\n                      {day.getDate()}\n                    </div>\n\n                    {/* Events for this day */}\n                    <div className=\"space-y-1\">\n                      {dayEvents.slice(0, 2).map((event) => (\n                        <div\n                          key={event.id}\n                          className={`\n                            text-xs p-1 rounded truncate cursor-move relative group\n                            ${event.entityType === 'deal' ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 hover:bg-gray-200'}\n                            dark:bg-blue-900 dark:text-blue-100 dark:hover:bg-blue-800\n                            ${draggedEvent?.id === event.id ? 'opacity-50' : ''}\n                          `}\n                          draggable={event.entityType === 'deal'}\n                          onDragStart={(e) => handleDragStart(e, event)}\n                          onDragEnd={handleDragEnd}\n                          onClick={() => event.entityType === 'deal' && handleEditAirDate(event)}\n                          title={`${event.title} - ${event.entityType === 'deal' ? 'Drag to move or click to edit' : 'Click to view'}`}\n                        >\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"truncate flex-1\">\n                              {event.title.replace('Air Date: ', '')}\n                            </span>\n                            {event.entityType === 'deal' && (\n                              <Move className=\"h-3 w-3 opacity-0 md:group-hover:opacity-100 transition-opacity ml-1 flex-shrink-0\" />\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                      {dayEvents.length > 2 && (\n                        <div className=\"text-xs text-muted-foreground\">\n                          +{dayEvents.length - 2} more\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      </TabsContent>\n      </Tabs>\n\n      {/* Edit Air Date Dialog */}\n      <Dialog open={!!editingEvent} onOpenChange={() => setEditingEvent(null)}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Air Date</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-date\">Air Date</Label>\n              <Input\n                id=\"edit-date\"\n                type=\"date\"\n                value={editDate}\n                onChange={(e) => setEditDate(e.target.value)}\n              />\n            </div>\n            <div className=\"flex justify-start space-x-2\">\n              <Button \n                onClick={handleSaveEdit}\n                disabled={!editDate || editAirDateMutation.isPending}\n              >\n                {editAirDateMutation.isPending ? \"Saving...\" : \"Save\"}\n              </Button>\n              <Button variant=\"outline\" onClick={() => setEditingEvent(null)}>\n                Close\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <AddCalendarEventForm\n        open={isAddFormOpen}\n        onClose={() => setIsAddFormOpen(false)}\n      />\n    </div>\n  );\n}","size_bytes":31556},"client/src/components/dashboard/deal-pipeline.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport DealDetailsDialog from \"@/components/deal-details-dialog\";\nimport type { DealWithRelations } from \"@shared/schema\";\n\ninterface DealPipelineProps {\n  deals: DealWithRelations[];\n  dealsByStatus: Record<string, number>;\n}\n\nexport default function DealPipeline({ deals, dealsByStatus }: DealPipelineProps) {\n  const [selectedDeal, setSelectedDeal] = useState<DealWithRelations | null>(null);\n  const [showDealDetails, setShowDealDetails] = useState(false);\n  const [selectedStatus, setSelectedStatus] = useState<string | null>(null);\n\n  const handleDealClick = (deal: DealWithRelations) => {\n    setSelectedDeal(deal);\n    setShowDealDetails(true);\n  };\n  const getStatusColor = (status: string) => {\n    // Normalize status to handle both underscore and space formats\n    const normalizedStatus = status.replace(/_/g, ' ').toLowerCase();\n    \n    switch (normalizedStatus) {\n      case \"new request\":\n        return \"bg-red-100 text-red-800\";\n      case \"pending approval\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"quoted\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"use confirmed\":\n        return \"bg-green-100 text-green-800\";\n      case \"being drafted\":\n        return \"bg-purple-100 text-purple-800\";\n      case \"out for signature\":\n        return \"bg-orange-100 text-orange-800\";\n      case \"payment received\":\n        return \"bg-emerald-100 text-emerald-800\";\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"not used\":\n        return \"bg-slate-100 text-slate-800\";\n      default:\n        return \"bg-gray-300/10 text-gray-600\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    switch (status) {\n      case \"new request\":\n        return \"New Request\";\n      case \"pending approval\":\n        return \"Pending Approval\";\n      case \"quoted\":\n        return \"Quoted\";\n      case \"use confirmed\":\n        return \"Use Confirmed\";\n      case \"being drafted\":\n        return \"Being Drafted\";\n      case \"out for signature\":\n        return \"Out for Signature\";\n      case \"payment received\":\n        return \"Payment Received\";\n      case \"completed\":\n        return \"Completed\";\n      case \"not used\":\n        return \"Not used\";\n      default:\n        return status.charAt(0).toUpperCase() + status.slice(1);\n    }\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"N/A\";\n    return new Date(date).toLocaleDateString();\n  };\n\n  const handleStatusFilter = (status: string) => {\n    if (selectedStatus === status) {\n      setSelectedStatus(null); // Clear filter if same status clicked\n    } else {\n      setSelectedStatus(status);\n    }\n  };\n\n  const filteredDeals = selectedStatus \n    ? deals.filter(deal => deal.status === selectedStatus)\n    : deals;\n\n  return (\n    <Card className=\"lg:col-span-2\">\n      <CardHeader className=\"border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Deal Pipeline</h3>\n            {selectedStatus && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm text-gray-500\">Filtered by:</span>\n                <Badge className={getStatusColor(selectedStatus)}>\n                  {getStatusLabel(selectedStatus)}\n                </Badge>\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\" \n                  onClick={() => setSelectedStatus(null)}\n                  className=\"text-gray-500 hover:text-gray-700 h-6 w-6 p-0\"\n                >\n                  \n                </Button>\n              </div>\n            )}\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" className=\"text-brand-primary hover:text-blue-700\">\n            View All\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-6\">\n        {/* Pipeline Stages */}\n        <div className=\"flex flex-nowrap gap-3 mb-6 overflow-x-auto\">\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"new request\" \n                ? \"bg-red-200 text-red-900 border-red-300 shadow-md\" \n                : \"bg-red-100 text-red-800 border-red-200 hover:bg-red-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"new request\")}\n          >\n            New Request ({dealsByStatus[\"new request\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"pending approval\" \n                ? \"bg-yellow-200 text-yellow-900 border-yellow-300 shadow-md\" \n                : \"bg-yellow-100 text-yellow-800 border-yellow-200 hover:bg-yellow-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"pending approval\")}\n          >\n            Pending Approval ({dealsByStatus[\"pending approval\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"quoted\" \n                ? \"bg-blue-200 text-blue-900 border-blue-300 shadow-md\" \n                : \"bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"quoted\")}\n          >\n            Quoted ({dealsByStatus.quoted || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"use confirmed\" \n                ? \"bg-green-200 text-green-900 border-green-300 shadow-md\" \n                : \"bg-green-100 text-green-800 border-green-200 hover:bg-green-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"use confirmed\")}\n          >\n            Use Confirmed ({dealsByStatus[\"use confirmed\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"being drafted\" \n                ? \"bg-purple-200 text-purple-900 border-purple-300 shadow-md\" \n                : \"bg-purple-100 text-purple-800 border-purple-200 hover:bg-purple-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"being drafted\")}\n          >\n            Being Drafted ({dealsByStatus[\"being drafted\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"out for signature\" \n                ? \"bg-orange-200 text-orange-900 border-orange-300 shadow-md\" \n                : \"bg-orange-100 text-orange-800 border-orange-200 hover:bg-orange-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"out for signature\")}\n          >\n            Out for Signature ({dealsByStatus[\"out for signature\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"payment received\" \n                ? \"bg-emerald-200 text-emerald-900 border-emerald-300 shadow-md\" \n                : \"bg-emerald-100 text-emerald-800 border-emerald-200 hover:bg-emerald-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"payment received\")}\n          >\n            Payment Received ({dealsByStatus[\"payment received\"] || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"completed\" \n                ? \"bg-green-200 text-green-900 border-green-300 shadow-md\" \n                : \"bg-green-100 text-green-800 border-green-200 hover:bg-green-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"completed\")}\n          >\n            Completed ({dealsByStatus.completed || 0})\n          </Badge>\n          <Badge \n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStatus === \"not used\" \n                ? \"bg-slate-200 text-slate-900 border-slate-300 shadow-md\" \n                : \"bg-slate-100 text-slate-800 border-slate-200 hover:bg-slate-150\"\n            }`}\n            onClick={() => handleStatusFilter(\"not used\")}\n          >\n            Not Used ({dealsByStatus[\"not used\"] || 0})\n          </Badge>\n        </div>\n\n        {/* Deals Table */}\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead>\n              <tr className=\"border-b border-gray-200\">\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">Project</th>\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">Song</th>\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">Status</th>\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">Value</th>\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">Updated</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {filteredDeals.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"py-8 text-center text-gray-500\">\n                    {selectedStatus \n                      ? `No deals found with status \"${getStatusLabel(selectedStatus)}\". Click the status badge again to clear the filter.`\n                      : \"No deals found. Create your first deal to get started.\"\n                    }\n                  </td>\n                </tr>\n              ) : (\n                filteredDeals.map((deal) => (\n                  <tr \n                    key={deal.id} \n                    className=\"hover:bg-gray-50 cursor-pointer\"\n                    onClick={() => handleDealClick(deal)}\n                  >\n                    <td className=\"py-3 px-4\">\n                      <div>\n                        <p className=\"font-medium text-gray-900\">{deal.projectName}</p>\n                        <p className=\"text-sm text-gray-500\">{deal.projectType}</p>\n                      </div>\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <div>\n                        <p className=\"font-medium text-gray-900\">{deal.song.title}</p>\n                        <p className=\"text-sm text-gray-500\">by {deal.song.artist}</p>\n                      </div>\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <Badge className={getStatusColor(deal.status)}>\n                        {getStatusLabel(deal.status)}\n                      </Badge>\n                    </td>\n                    <td className=\"py-3 px-4 font-medium text-gray-900\">\n                      {deal.ourFee && deal.ourRecordingFee \n                        ? `$${Number(deal.ourFee).toLocaleString()} / $${Number(deal.ourRecordingFee).toLocaleString()}`\n                        : deal.ourFee \n                          ? `$${Number(deal.ourFee).toLocaleString()}`\n                          : deal.ourRecordingFee\n                            ? `$${Number(deal.ourRecordingFee).toLocaleString()}`\n                            : \"TBD\"\n                      }\n                    </td>\n                    <td className=\"py-3 px-4 text-sm text-gray-500\">\n                      {formatDate(deal.updatedAt)}\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </CardContent>\n      \n      <DealDetailsDialog \n        deal={selectedDeal}\n        open={showDealDetails}\n        onClose={() => setShowDealDetails(false)}\n      />\n    </Card>\n  );\n}\n","size_bytes":11845},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"client/src/components/forms/add-contact-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertContactSchema, type InsertContact, type Contact } from \"@shared/schema\";\n\ninterface AddContactFormProps {\n  open: boolean;\n  onClose: () => void;\n  contact?: Contact; // For editing existing contacts\n  onContactCreated?: (contact: Contact) => void;\n  defaultRole?: string;\n}\n\nexport default function AddContactForm({ open, onClose, contact, onContactCreated, defaultRole }: AddContactFormProps) {\n  const { toast } = useToast();\n  const isEditing = !!contact;\n  \n  const form = useForm<InsertContact>({\n    resolver: zodResolver(insertContactSchema),\n    defaultValues: {\n      name: contact?.name || \"\",\n      email: contact?.email || \"\",\n      phone: contact?.phone || \"\",\n      company: contact?.company || \"\",\n      role: contact?.role || defaultRole || \"\",\n      notes: contact?.notes || \"\",\n    },\n  });\n\n  // Reset form when contact prop changes\n  useEffect(() => {\n    form.reset({\n      name: contact?.name || \"\",\n      email: contact?.email || \"\",\n      phone: contact?.phone || \"\",\n      company: contact?.company || \"\",\n      role: contact?.role || defaultRole || \"\",\n      notes: contact?.notes || \"\",\n    });\n  }, [contact, form, defaultRole]);\n\n  const createContactMutation = useMutation({\n    mutationFn: async (data: InsertContact) => {\n      console.log(\"Making API request with data:\", data);\n      const response = await apiRequest(\"/api/contacts\", {\n        method: \"POST\",\n        body: data\n      });\n      console.log(\"API response:\", response);\n      return response.json();\n    },\n    onSuccess: (newContact) => {\n      toast({\n        title: \"Success\",\n        description: \"Contact added successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      form.reset();\n      onClose();\n      if (onContactCreated) {\n        onContactCreated(newContact);\n      }\n    },\n    onError: (error) => {\n      console.error(\"Contact creation error:\", error);\n      toast({\n        title: \"Error\",\n        description: `Failed to add contact: ${error.message || error}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateContactMutation = useMutation({\n    mutationFn: async (data: InsertContact) => {\n      const response = await apiRequest(`/api/contacts/${contact?.id}`, {\n        method: \"PUT\",\n        body: data\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Contact updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      form.reset();\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update contact\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertContact) => {\n    console.log(\"Form submission data:\", data);\n    if (isEditing) {\n      updateContactMutation.mutate(data);\n    } else {\n      createContactMutation.mutate(data);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? \"Edit Contact\" : \"Add New Contact\"}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"name\">Name *</Label>\n            <Input\n              id=\"name\"\n              {...form.register(\"name\")}\n              placeholder=\"Enter contact name\"\n            />\n            {form.formState.errors.name && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.name.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"email\">Email *</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              {...form.register(\"email\")}\n              placeholder=\"Enter email address\"\n            />\n            {form.formState.errors.email && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.email.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"phone\">Phone</Label>\n            <Input\n              id=\"phone\"\n              {...form.register(\"phone\")}\n              placeholder=\"Enter phone number\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"company\">Company</Label>\n              <Input\n                id=\"company\"\n                {...form.register(\"company\")}\n                placeholder=\"Enter company name\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"role\">Role</Label>\n              <Input\n                id=\"role\"\n                {...form.register(\"role\")}\n                placeholder=\"e.g., Music Supervisor\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"notes\">Notes</Label>\n            <Textarea\n              id=\"notes\"\n              {...form.register(\"notes\")}\n              placeholder=\"Enter any additional notes\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createContactMutation.isPending || updateContactMutation.isPending}\n            >\n              {(createContactMutation.isPending || updateContactMutation.isPending) \n                ? (isEditing ? \"Updating...\" : \"Adding...\") \n                : (isEditing ? \"Update Contact\" : \"Add Contact\")}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":6510},"client/src/components/forms/add-deal-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertDealSchema, insertContactSchema, type InsertDeal, type InsertContact, type Song, type Contact } from \"@shared/schema\";\nimport { Plus, Building, User, FileText } from \"lucide-react\";\n\ninterface AddDealFormProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport default function AddDealForm({ open, onClose }: AddDealFormProps) {\n  const { toast } = useToast();\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [newContactName, setNewContactName] = useState(\"\");\n  const [newContactEmail, setNewContactEmail] = useState(\"\");\n  const [newContactPhone, setNewContactPhone] = useState(\"\");\n  const [newContactCompany, setNewContactCompany] = useState(\"\");\n  const [newContactRole, setNewContactRole] = useState(\"\");\n  const [newContactNotes, setNewContactNotes] = useState(\"\");\n  const [newContactProjects, setNewContactProjects] = useState(\"\");\n  \n  const form = useForm<InsertDeal>({\n    resolver: zodResolver(insertDealSchema),\n    defaultValues: {\n      projectName: \"\",\n      episodeNumber: \"\",\n      projectType: \"\",\n      projectDescription: \"\",\n      songId: undefined,\n      contactId: undefined,\n      \n      // Contact Information\n      licenseeCompanyName: \"\",\n      licenseeAddress: \"\",\n      licenseeContactName: \"\",\n      licenseeContactEmail: \"\",\n      licenseeContactPhone: \"\",\n      \n      musicSupervisorName: \"\",\n      musicSupervisorAddress: \"\",\n      musicSupervisorContactName: \"\",\n      musicSupervisorContactEmail: \"\",\n      musicSupervisorContactPhone: \"\",\n      \n      clearanceCompanyName: \"\",\n      clearanceCompanyAddress: \"\",\n      clearanceCompanyContactName: \"\",\n      clearanceCompanyContactEmail: \"\",\n      clearanceCompanyContactPhone: \"\",\n      \n      status: \"pitched\",\n      dealValue: undefined,\n      fullSongValue: undefined,\n      ourFee: undefined,\n      usage: \"\",\n      media: \"\",\n      territory: \"worldwide\",\n      term: \"\",\n      exclusivity: false,\n      exclusivityRestrictions: \"\",\n      \n      // Song Information\n      writers: \"\",\n      publishingInfo: \"\",\n      splits: \"\",\n      artist: \"\",\n      label: \"\",\n      artistLabelSplits: \"\",\n      \n      notes: \"\",\n      airDate: \"\",\n      pitchDate: undefined,\n    },\n  });\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n  });\n\n  const createDealMutation = useMutation({\n    mutationFn: async (data: InsertDeal) => {\n      // Debug: Log the form data\n      console.log(\"Form data:\", data);\n      \n      // Ensure all required fields are present and properly typed\n      const processedData = {\n        projectName: data.projectName || \"\",\n        projectType: data.projectType || \"\",\n        projectDescription: data.projectDescription || null,\n        songId: data.songId ? parseInt(data.songId.toString()) : null,\n        contactId: data.contactId ? parseInt(data.contactId.toString()) : null,\n        status: data.status || \"pitched\",\n        dealValue: data.dealValue ? parseFloat(data.dealValue.toString()) : null,\n        usage: data.usage || null,\n        territory: data.territory || \"worldwide\",\n        term: data.term || null,\n        exclusivity: data.exclusivity || false,\n        notes: data.notes || null,\n        pitchDate: data.pitchDate ? new Date(data.pitchDate).toISOString() : null,\n      };\n      \n      console.log(\"Processed data:\", processedData);\n      const response = await apiRequest(\"POST\", \"/api/deals\", processedData);\n      return response.json();\n    },\n    onSuccess: async (newDeal) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/deals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      \n      // Auto-create calendar event if airdate is set\n      if (newDeal.airDate) {\n        try {\n          await apiRequest(\"POST\", \"/api/calendar-events\", {\n            title: `${newDeal.projectName} - Air Date`,\n            description: `Air date for ${newDeal.projectName}`,\n            eventDate: newDeal.airDate,\n            entityType: \"deal\",\n            entityId: newDeal.id\n          });\n          queryClient.invalidateQueries({ queryKey: [\"/api/calendar-events\"] });\n        } catch (error) {\n          console.log(\"Failed to create calendar event:\", error);\n        }\n      }\n      \n      form.reset();\n      onClose();\n      toast({\n        title: \"Deal Added\",\n        description: newDeal.airDate \n          ? \"Deal has been added to the pipeline and calendar event created for air date\"\n          : \"Deal has been successfully added to the pipeline\"\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add deal\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createContactMutation = useMutation({\n    mutationFn: async (contactData: InsertContact) => {\n      const response = await apiRequest(\"POST\", \"/api/contacts\", contactData);\n      return response.json();\n    },\n    onSuccess: (newContact) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      // Auto-select the newly created contact\n      form.setValue(\"contactId\", newContact.id);\n      setShowAddContact(false);\n      resetContactForm();\n      toast({\n        title: \"Contact Created\",\n        description: \"New contact has been added and selected\"\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create contact\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const formatPhoneNumber = (value: string) => {\n    // Remove all non-numeric characters\n    const phoneNumber = value.replace(/[^\\d]/g, '');\n    \n    // Format based on length\n    if (phoneNumber.length <= 3) {\n      return phoneNumber;\n    } else if (phoneNumber.length <= 6) {\n      return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;\n    } else if (phoneNumber.length <= 10) {\n      return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6)}`;\n    } else {\n      // Handle international numbers or longer formats\n      return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;\n    }\n  };\n\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const formatted = formatPhoneNumber(e.target.value);\n    setNewContactPhone(formatted);\n  };\n\n  const resetContactForm = () => {\n    setNewContactName(\"\");\n    setNewContactEmail(\"\");\n    setNewContactPhone(\"\");\n    setNewContactCompany(\"\");\n    setNewContactRole(\"\");\n    setNewContactNotes(\"\");\n    setNewContactProjects(\"\");\n  };\n\n  const handleCreateContact = () => {\n    if (!newContactName || !newContactEmail) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in contact name and email\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    createContactMutation.mutate({\n      name: newContactName,\n      email: newContactEmail,\n      phone: newContactPhone,\n      company: newContactCompany,\n      role: newContactRole,\n      notes: `${newContactNotes}${newContactProjects ? '\\n\\nCurrent Projects:\\n' + newContactProjects : ''}`\n    });\n  };\n\n  const onSubmit = (data: InsertDeal) => {\n    console.log(\"Form submitted with data:\", data);\n    console.log(\"Form errors:\", form.formState.errors);\n    console.log(\"Form values:\", form.getValues());\n    \n    // Get current form values to check what's actually set\n    const currentValues = form.getValues();\n    \n    // Check each required field and set specific errors\n    const errors: any = {};\n    \n    if (!currentValues.projectName || currentValues.projectName.trim() === '') {\n      errors.projectName = { message: \"Project name is required\" };\n    }\n    \n    if (!currentValues.projectType) {\n      errors.projectType = { message: \"Project type is required\" };\n    }\n    \n    if (!currentValues.songId) {\n      errors.songId = { message: \"Song selection is required\" };\n    }\n    \n    if (!currentValues.contactId) {\n      errors.contactId = { message: \"Contact selection is required\" };\n    }\n    \n    // If there are validation errors, set them and return\n    if (Object.keys(errors).length > 0) {\n      Object.keys(errors).forEach(field => {\n        form.setError(field as any, errors[field]);\n      });\n      \n      toast({\n        title: \"Missing Required Fields\",\n        description: \"Please fill in all required fields highlighted in red\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Use the current form values instead of the submitted data to ensure we get the right types\n    const processedData = {\n      projectName: currentValues.projectName,\n      projectType: currentValues.projectType,\n      projectDescription: currentValues.projectDescription || null,\n      songId: currentValues.songId, // These should already be numbers from our setValue calls\n      contactId: currentValues.contactId, // These should already be numbers from our setValue calls\n      status: currentValues.status || \"pitched\",\n      dealValue: currentValues.dealValue ? parseFloat(currentValues.dealValue.toString()) : null,\n      usage: currentValues.usage || null,\n      territory: currentValues.territory || \"worldwide\",\n      term: currentValues.term || null,\n      exclusivity: currentValues.exclusivity || false,\n      notes: currentValues.notes || null,\n      airDate: currentValues.airDate ? new Date(currentValues.airDate).toISOString() : null,\n      pitchDate: null\n    };\n    \n    console.log(\"Final processed data to send:\", processedData);\n    console.log(\"Data types:\", {\n      songId: typeof processedData.songId,\n      contactId: typeof processedData.contactId,\n      songIdValue: processedData.songId,\n      contactIdValue: processedData.contactId\n    });\n    \n    createDealMutation.mutate(processedData);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>Add New Deal</DialogTitle>\n        </DialogHeader>\n        \n        {/* Display validation errors summary */}\n        {Object.keys(form.formState.errors).length > 0 && (\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-3 mb-4\">\n            <h4 className=\"text-sm font-medium text-red-800 mb-2\">Please fix the following errors:</h4>\n            <ul className=\"text-sm text-red-700 space-y-1\">\n              {Object.entries(form.formState.errors).map(([field, error]) => (\n                <li key={field} className=\"flex items-center gap-2\">\n                  <span className=\"w-2 h-2 bg-red-400 rounded-full\"></span>\n                  {error?.message || `${field} is required`}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n        \n        <form onSubmit={form.handleSubmit(onSubmit, (errors) => {\n          console.log(\"Form validation errors:\", errors);\n          toast({\n            title: \"Form Validation Error\",\n            description: \"Please check the required fields and try again\",\n            variant: \"destructive\"\n          });\n        })} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"projectName\">Project Name *</Label>\n              <Input\n                id=\"projectName\"\n                {...form.register(\"projectName\", { required: \"Project name is required\" })}\n                placeholder=\"Enter project name\"\n                className={form.formState.errors.projectName ? \"border-red-500 focus:border-red-500\" : \"\"}\n              />\n              {form.formState.errors.projectName && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.projectName.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"projectType\">Project Type *</Label>\n              <Select onValueChange={(value) => {\n                form.setValue(\"projectType\", value);\n                // Clear error when valid selection is made  \n                form.clearErrors(\"projectType\");\n              }} value={form.watch(\"projectType\")}>\n                <SelectTrigger className={form.formState.errors.projectType ? \"border-red-500 focus:border-red-500\" : \"\"}>\n                  <SelectValue placeholder=\"Select project type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"commercial\">Commercial</SelectItem>\n                  <SelectItem value=\"documentary\">Documentary</SelectItem>\n                  <SelectItem value=\"film\">Film</SelectItem>\n                  <SelectItem value=\"game\">Video Game</SelectItem>\n                  <SelectItem value=\"indie_film\">Indie Film</SelectItem>\n                  <SelectItem value=\"non_profit\">Non-Profit</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                  <SelectItem value=\"podcast\">Podcast</SelectItem>\n                  <SelectItem value=\"promos\">Promos</SelectItem>\n                  <SelectItem value=\"sports\">Sports</SelectItem>\n                  <SelectItem value=\"streaming\">Streaming Platform</SelectItem>\n                  <SelectItem value=\"student_film\">Student Film</SelectItem>\n                  <SelectItem value=\"trailers\">Trailers</SelectItem>\n                  <SelectItem value=\"tv\">TV Series</SelectItem>\n                </SelectContent>\n              </Select>\n              {form.formState.errors.projectType && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.projectType.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"projectDescription\">Project Description</Label>\n            <Textarea\n              id=\"projectDescription\"\n              {...form.register(\"projectDescription\")}\n              placeholder=\"Enter project description\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"songId\">Song *</Label>\n              <Select onValueChange={(value) => {\n                form.setValue(\"songId\", parseInt(value));\n                // Clear error when valid selection is made\n                form.clearErrors(\"songId\");\n              }} value={form.watch(\"songId\")?.toString()}>\n                <SelectTrigger className={form.formState.errors.songId ? \"border-red-500 focus:border-red-500\" : \"\"}>\n                  <SelectValue placeholder=\"Select a song\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {songs.map((song) => (\n                    <SelectItem key={song.id} value={song.id.toString()}>\n                      {song.title} - {song.artist}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {form.formState.errors.songId && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.songId.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"contactId\">Contact *</Label>\n              <Select onValueChange={(value) => {\n                if (value === \"add_new\") {\n                  setShowAddContact(true);\n                } else {\n                  form.setValue(\"contactId\", parseInt(value));\n                  // Clear error when valid selection is made\n                  form.clearErrors(\"contactId\");\n                }\n              }} value={form.watch(\"contactId\")?.toString()}>\n                <SelectTrigger className={form.formState.errors.contactId ? \"border-red-500 focus:border-red-500\" : \"\"}>\n                  <SelectValue placeholder=\"Select a contact\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {contacts.map((contact) => (\n                    <SelectItem key={contact.id} value={contact.id.toString()}>\n                      {contact.name} - {contact.company}\n                    </SelectItem>\n                  ))}\n                  <SelectItem value=\"add_new\" className=\"border-t border-gray-200 mt-1 pt-1\">\n                    <div className=\"flex items-center gap-2 text-blue-600\">\n                      <Plus className=\"h-4 w-4\" />\n                      Add New Contact\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n              {form.formState.errors.contactId && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.contactId.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"fullSongValue\">100% Song Value ($)</Label>\n              <Input\n                id=\"fullSongValue\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"fullSongValue\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"ourFee\">Our Fee Based on Splits ($)</Label>\n              <Input\n                id=\"ourFee\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"ourFee\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"usage\">Usage</Label>\n              <Input\n                id=\"usage\"\n                {...form.register(\"usage\")}\n                placeholder=\"e.g., Background, Opening, End Credits\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"airDate\">Air Date</Label>\n              <Input\n                id=\"airDate\"\n                type=\"date\"\n                {...form.register(\"airDate\")}\n                placeholder=\"When will this air?\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"territory\">Territory</Label>\n              <Input\n                id=\"territory\"\n                {...form.register(\"territory\")}\n                placeholder=\"e.g., Worldwide, US Only\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"term\">Term</Label>\n              <Input\n                id=\"term\"\n                {...form.register(\"term\")}\n                placeholder=\"e.g., Perpetual, 5 years\"\n              />\n            </div>\n            \n            <div className=\"flex items-center space-x-2 pt-8\">\n              <input\n                type=\"checkbox\"\n                id=\"exclusivity\"\n                {...form.register(\"exclusivity\")}\n                className=\"rounded\"\n              />\n              <Label htmlFor=\"exclusivity\">Exclusive Deal</Label>\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"notes\">Notes</Label>\n            <Textarea\n              id=\"notes\"\n              {...form.register(\"notes\")}\n              placeholder=\"Enter any additional notes\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createDealMutation.isPending}\n            >\n              {createDealMutation.isPending ? \"Adding...\" : \"Add Deal\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n      \n      {/* Add Contact Dialog */}\n      <Dialog open={showAddContact} onOpenChange={setShowAddContact}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add New Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactName\">Name *</Label>\n                <Input\n                  id=\"newContactName\"\n                  value={newContactName}\n                  onChange={(e) => setNewContactName(e.target.value)}\n                  placeholder=\"Contact name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactEmail\">Email *</Label>\n                <Input\n                  id=\"newContactEmail\"\n                  type=\"email\"\n                  value={newContactEmail}\n                  onChange={(e) => setNewContactEmail(e.target.value)}\n                  placeholder=\"email@company.com\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactPhone\">Phone</Label>\n                <Input\n                  id=\"newContactPhone\"\n                  type=\"tel\"\n                  value={newContactPhone}\n                  onChange={handlePhoneChange}\n                  placeholder=\"(555) 123-4567\"\n                  maxLength={14}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactCompany\">Company</Label>\n                <Input\n                  id=\"newContactCompany\"\n                  value={newContactCompany}\n                  onChange={(e) => setNewContactCompany(e.target.value)}\n                  placeholder=\"Company name\"\n                />\n              </div>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"newContactRole\">Role</Label>\n              <Input\n                id=\"newContactRole\"\n                value={newContactRole}\n                onChange={(e) => setNewContactRole(e.target.value)}\n                placeholder=\"Music Supervisor, Creative Director, etc.\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"newContactProjects\">Current Projects</Label>\n              <Textarea\n                id=\"newContactProjects\"\n                value={newContactProjects}\n                onChange={(e) => setNewContactProjects(e.target.value)}\n                placeholder=\"List current shows, films, or projects this contact is working on...\"\n                rows={3}\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"newContactNotes\">Notes</Label>\n              <Textarea\n                id=\"newContactNotes\"\n                value={newContactNotes}\n                onChange={(e) => setNewContactNotes(e.target.value)}\n                placeholder=\"Additional notes, preferences, or important information...\"\n                rows={3}\n              />\n            </div>\n            \n            <div className=\"flex space-x-4 pt-4\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => {\n                  setShowAddContact(false);\n                  resetContactForm();\n                }} \n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button \n                onClick={handleCreateContact}\n                className=\"flex-1\"\n                disabled={createContactMutation.isPending}\n              >\n                {createContactMutation.isPending ? \"Creating...\" : \"Create Contact\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </Dialog>\n  );\n}\n","size_bytes":24743},"client/src/pages/contacts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport AddContactForm from \"@/components/forms/add-contact-form\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, Mail, Phone, Building, Edit, Trash2 } from \"lucide-react\";\nimport type { Contact } from \"@shared/schema\";\n\nexport default function Contacts() {\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [showEditContact, setShowEditContact] = useState(false);\n  const [editingContact, setEditingContact] = useState<Contact | undefined>(undefined);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: contacts = [], isLoading, error } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\", searchQuery],\n    queryFn: async () => {\n      const url = new URL(\"/api/contacts\", window.location.origin);\n      if (searchQuery) {\n        url.searchParams.set(\"search\", searchQuery);\n      }\n      const response = await fetch(url.toString());\n      if (!response.ok) {\n        throw new Error('Failed to fetch contacts');\n      }\n      return response.json();\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div>\n        <Header\n          title=\"Contacts\"\n          description=\"Manage your music industry contacts and relationships\"\n          searchPlaceholder=\"Search contacts, companies...\"\n          newItemLabel=\"Add Contact\"\n        />\n        <div className=\"p-6\">\n          <div className=\"grid gap-6\" role=\"status\" aria-live=\"polite\" aria-label=\"Loading contacts\">\n            {[...Array(4)].map((_, i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start space-x-4\">\n                    <div className=\"w-16 h-16 bg-gray-200 rounded-lg\"></div>\n                    <div className=\"flex-1 space-y-3\">\n                      <div className=\"h-5 bg-gray-200 rounded w-1/3\"></div>\n                      <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\n                        <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n                      </div>\n                      <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n                    </div>\n                    <div className=\"flex space-x-2\">\n                      <div className=\"h-8 w-8 bg-gray-200 rounded\"></div>\n                      <div className=\"h-8 w-8 bg-gray-200 rounded\"></div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n            <span className=\"sr-only\">Loading contacts, please wait...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center\">\n          <div className=\"text-lg text-red-600 mb-2\">Failed to load contacts</div>\n          <p className=\"text-gray-600 mb-4\">Please check your connection and try again.</p>\n          <Button \n            onClick={() => window.location.reload()} \n            className=\"bg-brand-primary hover:bg-blue-700\"\n          >\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Contacts\"\n        description=\"Manage your music industry contacts and relationships\"\n        searchPlaceholder=\"Search contacts, companies...\"\n        newItemLabel=\"Add Contact\"\n        onSearch={setSearchQuery}\n        onNewItem={() => setShowAddContact(true)}\n      />\n      \n      <div className=\"p-6\">\n        {contacts.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-16\">\n              <Users className=\"h-12 w-12 text-gray-400 mb-4\" />\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No contacts found</h3>\n              <p className=\"text-gray-600 text-center mb-6\">\n                {searchQuery \n                  ? \"No contacts match your search criteria. Try adjusting your search terms.\"\n                  : \"Start building your network by adding your first contact.\"\n                }\n              </p>\n              <Button onClick={() => setShowAddContact(true)} className=\"bg-brand-primary hover:bg-blue-700\">\n                Add Your First Contact\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-6\">\n            {contacts.map((contact) => (\n              <Card key={contact.id} className=\"hover:shadow-md transition-shadow\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-start space-x-4\">\n                      <div className=\"w-16 h-16 bg-brand-primary/10 rounded-lg flex items-center justify-center\">\n                        <Users className=\"h-8 w-8 text-brand-primary\" />\n                      </div>\n                      \n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <h3 className=\"text-lg font-semibold text-gray-900\">{contact.name}</h3>\n                          {contact.role && (\n                            <span className=\"text-sm text-gray-600\"> {contact.role}</span>\n                          )}\n                        </div>\n                        \n                        {contact.company && (\n                          <div className=\"flex items-center space-x-2 mb-3\">\n                            <Building className=\"h-4 w-4 text-gray-400\" />\n                            <span className=\"text-gray-600\">{contact.company}</span>\n                          </div>\n                        )}\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-4\">\n                          <div className=\"flex items-center space-x-2\">\n                            <Mail className=\"h-4 w-4 text-gray-400\" />\n                            <a \n                              href={`mailto:${contact.email}`}\n                              className=\"text-brand-primary hover:underline\"\n                            >\n                              {contact.email}\n                            </a>\n                          </div>\n                          \n                          {contact.phone && (\n                            <div className=\"flex items-center space-x-2\">\n                              <Phone className=\"h-4 w-4 text-gray-400\" />\n                              <a \n                                href={`tel:${contact.phone}`}\n                                className=\"text-brand-primary hover:underline\"\n                              >\n                                {contact.phone}\n                              </a>\n                            </div>\n                          )}\n                        </div>\n                        \n                        {contact.notes && (\n                          <div className=\"mt-3\">\n                            <p className=\"text-sm font-medium text-gray-700 mb-1\">Notes:</p>\n                            <p className=\"text-sm text-gray-600\">{contact.notes}</p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex flex-col sm:flex-row gap-2 sm:space-x-2\">\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        className=\"w-full sm:w-auto\"\n                        onClick={() => {\n                          setEditingContact(contact);\n                          setShowEditContact(true);\n                        }}\n                      >\n                        <Edit className=\"h-4 w-4 mr-2 sm:mr-0\" />\n                        <span className=\"sm:hidden\">Edit</span>\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\" \n                        className=\"text-red-600 hover:text-red-700 w-full sm:w-auto\"\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2 sm:mr-0\" />\n                        <span className=\"sm:hidden\">Delete</span>\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <AddContactForm open={showAddContact} onClose={() => setShowAddContact(false)} />\n      \n      <AddContactForm \n        open={showEditContact} \n        onClose={() => {\n          setShowEditContact(false);\n          setEditingContact(undefined);\n        }}\n        contact={editingContact}\n      />\n    </div>\n  );\n}\n","size_bytes":9114},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/expense-tracking.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon, Plus, Receipt, DollarSign, FileText, Briefcase, Camera, Gavel, Megaphone } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Song } from \"@shared/schema\";\n\ninterface Expense {\n  id: number;\n  songId?: number;\n  category: string;\n  description: string;\n  amount: number;\n  date: Date;\n  receipt?: string;\n  taxDeductible: boolean;\n  createdAt: Date;\n  song?: Song;\n}\n\nconst expenseCategories = [\n  { value: \"production\", label: \"Production\", icon: Camera },\n  { value: \"marketing\", label: \"Marketing\", icon: Megaphone },\n  { value: \"legal\", label: \"Legal\", icon: Gavel },\n  { value: \"business\", label: \"Business\", icon: Briefcase },\n  { value: \"equipment\", label: \"Equipment\", icon: Receipt },\n  { value: \"travel\", label: \"Travel\", icon: DollarSign },\n  { value: \"software\", label: \"Software\", icon: FileText },\n  { value: \"other\", label: \"Other\", icon: Receipt }\n];\n\nexport default function ExpenseTracking() {\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [selectedSongId, setSelectedSongId] = useState<string>(\"\");\n  const [category, setCategory] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [date, setDate] = useState<Date>(new Date());\n  const [taxDeductible, setTaxDeductible] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const { toast } = useToast();\n\n  const { data: expenses = [] } = useQuery<Expense[]>({\n    queryKey: ['/api/expenses'],\n  });\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: ['/api/songs'],\n  });\n\n  const createExpenseMutation = useMutation({\n    mutationFn: async (expenseData: any) => {\n      return apiRequest('/api/expenses', {\n        method: 'POST',\n        body: expenseData\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/expenses'] });\n      setShowCreateDialog(false);\n      resetForm();\n      toast({\n        title: \"Expense Added\",\n        description: \"Expense has been recorded successfully\"\n      });\n    }\n  });\n\n  const resetForm = () => {\n    setSelectedSongId(\"\");\n    setCategory(\"\");\n    setDescription(\"\");\n    setAmount(\"\");\n    setDate(new Date());\n    setTaxDeductible(false);\n  };\n\n  const handleCreateExpense = () => {\n    if (!category || !description || !amount || !date) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    createExpenseMutation.mutate({\n      songId: selectedSongId ? parseInt(selectedSongId) : null,\n      category,\n      description,\n      amount: parseFloat(amount),\n      date: date.toISOString(),\n      taxDeductible\n    });\n  };\n\n  const filteredExpenses = useMemo(() => {\n    return expenses.filter((expense: Expense) => \n      selectedCategory === \"all\" || expense.category === selectedCategory\n    );\n  }, [expenses, selectedCategory]);\n\n  const expenseStats = useMemo(() => {\n    const totalExpenses = filteredExpenses.reduce((sum: number, expense: Expense) => sum + expense.amount, 0);\n    const taxDeductibleTotal = filteredExpenses\n      .filter((expense: Expense) => expense.taxDeductible)\n      .reduce((sum: number, expense: Expense) => sum + expense.amount, 0);\n    \n    return { totalExpenses, taxDeductibleTotal };\n  }, [filteredExpenses]);\n\n  const { totalExpenses, taxDeductibleTotal } = expenseStats;\n\n  const getCategoryIcon = (categoryValue: string) => {\n    const category = expenseCategories.find(cat => cat.value === categoryValue);\n    const IconComponent = category?.icon || Receipt;\n    return <IconComponent className=\"h-4 w-4\" />;\n  };\n\n  const getCategoryColor = (categoryValue: string) => {\n    const colors: Record<string, string> = {\n      production: \"bg-blue-100 text-blue-800\",\n      marketing: \"bg-green-100 text-green-800\",\n      legal: \"bg-red-100 text-red-800\",\n      business: \"bg-purple-100 text-purple-800\",\n      equipment: \"bg-yellow-100 text-yellow-800\",\n      travel: \"bg-orange-100 text-orange-800\",\n      software: \"bg-indigo-100 text-indigo-800\",\n      other: \"bg-gray-100 text-gray-800\"\n    };\n    return colors[categoryValue] || colors.other;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Expense Tracking</h2>\n          <p className=\"text-gray-600\">Track business expenses and tax deductibles</p>\n        </div>\n        <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Expense\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Add New Expense</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"category\">Category</Label>\n                <Select value={category} onValueChange={setCategory}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {expenseCategories.map((cat) => (\n                      <SelectItem key={cat.value} value={cat.value}>\n                        <div className=\"flex items-center gap-2\">\n                          <cat.icon className=\"h-4 w-4\" />\n                          {cat.label}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"song\">Related Song (Optional)</Label>\n                <Select value={selectedSongId} onValueChange={setSelectedSongId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a song\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {songs.map((song: Song) => (\n                      <SelectItem key={song.id} value={song.id.toString()}>\n                        {song.title} - {song.artist}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">Description</Label>\n                <Textarea\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Describe the expense...\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"amount\">Amount ($)</Label>\n                  <Input\n                    id=\"amount\"\n                    type=\"number\"\n                    value={amount}\n                    onChange={(e) => setAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Date</Label>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"outline\" className=\"w-full justify-start text-left\">\n                        <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                        {date ? format(date, \"PPP\") : \"Select date\"}\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={date}\n                        onSelect={(selectedDate) => {\n                          if (selectedDate) {\n                            setDate(selectedDate);\n                          }\n                        }}\n                        initialFocus\n                      />\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <Checkbox\n                  id=\"taxDeductible\"\n                  checked={taxDeductible}\n                  onCheckedChange={(checked) => {\n                    if (typeof checked === 'boolean') {\n                      setTaxDeductible(checked);\n                    }\n                  }}\n                />\n                <Label htmlFor=\"taxDeductible\">Tax deductible</Label>\n              </div>\n\n              <Button onClick={handleCreateExpense} className=\"w-full\">\n                Add Expense\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Expenses</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">${totalExpenses.toFixed(2)}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Tax Deductible</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">${taxDeductibleTotal.toFixed(2)}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Categories</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Categories</SelectItem>\n                {expenseCategories.map((cat) => (\n                  <SelectItem key={cat.value} value={cat.value}>\n                    {cat.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {filteredExpenses.map((expense: Expense) => (\n          <Card key={expense.id}>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2\">\n                    {getCategoryIcon(expense.category)}\n                    <span className=\"font-semibold\">{expense.description}</span>\n                    <Badge className={getCategoryColor(expense.category)}>\n                      {expenseCategories.find(cat => cat.value === expense.category)?.label}\n                    </Badge>\n                    {expense.taxDeductible && (\n                      <Badge variant=\"outline\">Tax Deductible</Badge>\n                    )}\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    {format(new Date(expense.date), \"MMM dd, yyyy\")}\n                  </p>\n                  {expense.song && (\n                    <p className=\"text-sm text-gray-600\">\n                      Song: {expense.song.title} - {expense.song.artist}\n                    </p>\n                  )}\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-xl font-bold\">${expense.amount.toFixed(2)}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":12831},"client/src/components/layout/sidebar.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Link } from \"wouter\";\nimport { Music, BarChart3, Handshake, Send, Users, DollarSign, FileText, ChartBar, Mail, Calendar as CalendarIcon, Folder, TrendingUp, Menu, GraduationCap } from \"lucide-react\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger, SheetClose } from \"@/components/ui/sheet\";\nimport { useState } from \"react\";\n\nconst navigation = [\n  { name: \"Dashboard\", href: \"/\", icon: BarChart3 },\n  { name: \"Song Database\", href: \"/songs\", icon: Music },\n  { name: \"Deal Pipeline\", href: \"/deals\", icon: Handshake },\n  { name: \"Sync Pitches\", href: \"/pitches\", icon: Send },\n  { name: \"Contacts\", href: \"/contacts\", icon: Users },\n  { name: \"Income Tracking\", href: \"/income\", icon: DollarSign },\n  { name: \"Playlists\", href: \"/playlists\", icon: Folder },\n  { name: \"Templates\", href: \"/templates\", icon: FileText },\n  { name: \"Email Templates\", href: \"/email-templates\", icon: Mail },\n  { name: \"Calendar\", href: \"/calendar\", icon: CalendarIcon },\n  { name: \"Analytics\", href: \"/analytics\", icon: TrendingUp },\n  { name: \"Reports\", href: \"/reports\", icon: ChartBar },\n];\n\nfunction SidebarContent({ isMobile, onNavigate, onStartTour }: { isMobile?: boolean; onNavigate?: () => void; onStartTour?: () => void }) {\n  const [location] = useLocation();\n\n  return (\n    <>\n      <div className=\"p-6 border-b border-border\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-xl font-bold text-card-foreground\">\n              <Music className=\"inline mr-2 text-brand-primary\" size={20} />\n              Sync Licensing\n            </h1>\n            <p className=\"text-sm text-muted-foreground mt-1\">Music Rights Management</p>\n          </div>\n          <ThemeToggle />\n        </div>\n      </div>\n      \n      <nav className=\"flex-1 p-4 space-y-2\">\n        {navigation.map((item) => {\n          const Icon = item.icon;\n          const isActive = location === item.href;\n          \n          const linkElement = (\n            <Link\n              href={item.href}\n              title={item.name}\n              aria-label={item.name}\n              aria-current={isActive ? \"page\" : undefined}\n              className={`flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ${\n                isActive\n                  ? \"text-white bg-brand-primary\"\n                  : \"text-card-foreground hover:bg-muted\"\n              }`}\n              data-testid={`nav-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n              onClick={onNavigate}\n            >\n              <Icon className=\"mr-3\" size={16} />\n              {item.name}\n            </Link>\n          );\n\n          // Only wrap with SheetClose on mobile\n          return isMobile ? (\n            <SheetClose key={item.name} asChild>\n              {linkElement}\n            </SheetClose>\n          ) : (\n            <div key={item.name}>\n              {linkElement}\n            </div>\n          );\n        })}\n      </nav>\n      \n      <div className=\"p-4 border-t border-border space-y-3\">\n        {onStartTour && (\n          <Button\n            onClick={onStartTour}\n            variant=\"outline\"\n            className=\"w-full justify-start\"\n            data-testid=\"take-tour-button\"\n          >\n            <GraduationCap className=\"mr-2\" size={16} />\n            Take a Tour\n          </Button>\n        )}\n        \n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-8 h-8 bg-brand-primary rounded-full flex items-center justify-center\">\n            <span className=\"text-white text-sm font-medium\">JM</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-card-foreground\">John Music</p>\n            <p className=\"text-xs text-muted-foreground\">Music Supervisor</p>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default function Sidebar({ onStartTour }: { onStartTour?: () => void }) {\n  const isMobile = useIsMobile();\n  const [open, setOpen] = useState(false);\n\n  if (isMobile) {\n    return (\n      <Sheet open={open} onOpenChange={setOpen}>\n        <SheetTrigger asChild>\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"fixed top-4 left-4 z-40 lg:hidden\"\n            data-testid=\"mobile-menu-button\"\n            aria-label=\"Open menu\"\n          >\n            <Menu className=\"h-4 w-4\" aria-hidden=\"true\" />\n          </Button>\n        </SheetTrigger>\n        <SheetContent side=\"left\" className=\"w-64 p-0\">\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Navigation Menu</SheetTitle>\n          </SheetHeader>\n          <div className=\"bg-card h-full flex flex-col\">\n            <SidebarContent isMobile={true} onNavigate={() => setOpen(false)} onStartTour={onStartTour} />\n          </div>\n        </SheetContent>\n      </Sheet>\n    );\n  }\n\n  return (\n    <aside className=\"hidden lg:flex w-64 bg-card shadow-sm border-r border-border flex-col\">\n      <SidebarContent isMobile={false} onStartTour={onStartTour} />\n    </aside>\n  );\n}\n","size_bytes":5258},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"replit.md":{"content":"# Sync Licensing Management System\n\n## Overview\nThis project is a comprehensive music sync licensing management system. Its primary purpose is to empower music industry professionals by providing tools to manage sync licensing deals, track revenue, organize music catalogs, and maintain industry contacts. The system aims to streamline operations with a modern web interface and a robust API backend, facilitating efficient deal management, financial oversight, and relationship management within the sync licensing ecosystem. Key capabilities include a comprehensive music catalog, deal pipeline tracking, revenue analytics, and intelligent features for pitch matching and contract generation.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Design Philosophy\nThe system adopts a full-stack TypeScript approach, ensuring type safety across both frontend and backend. It leverages modern web technologies for a responsive and performant user experience, with a focus on accessibility and intuitive design.\n\n### Frontend\n- **Framework**: React with TypeScript for component-based UI development.\n- **Build Tool**: Vite for rapid development and optimized production builds.\n- **UI/UX**: Radix UI for accessible, unstyled components, styled with shadcn/ui and Tailwind CSS for a customizable theme, supporting dark/light modes.\n- **State Management**: TanStack Query for efficient server state management, caching, and synchronization.\n- **Routing**: Wouter for lightweight client-side routing.\n- **Form Management**: React Hook Form integrated with Zod for robust form validation.\n- **Visuals**: Incorporates charts and metrics for business insights and uses Lucide React for consistent iconography.\n\n### Backend\n- **Runtime & Framework**: Node.js with Express.js for a powerful and flexible RESTful API.\n- **Database**: PostgreSQL, accessed via Drizzle ORM for type-safe database interactions and schema management (Drizzle Kit).\n- **Validation**: Zod schemas for rigorous request and response validation, ensuring data integrity.\n- **Build Process**: ESBuild for efficient production bundling of server code.\n\n### Core Features\n- **Dashboard**: Provides an overview of active deals, revenue, and pending actions.\n- **Music Catalog**: Manages comprehensive song metadata, including professional identifiers and rights information. Supports multiple artists and composers.\n- **Deal Pipeline**: Tracks licensing opportunities through various stages (New Request, Pending Approval, Quoted, Use Confirmed, Being Drafted, Out for Signature, Payment Received, Completed). Includes automatic date tracking for status changes.\n- **Contact & Relationship Management**: Manages industry contacts and client profiles, including inline contact creation.\n- **Financial Management**: Features revenue tracking, automated invoice generation, expense tracking, and detailed financial breakdowns (publishing and recording fees). Uses accurate ownership percentages for fee calculations: publishing fees use publishing ownership, recording fees use master ownership.\n- **Document Management**: Allows for file attachments (contracts, demos), document template generation, and version control for mixes/stems.\n- **Reporting & Analytics**: Offers comprehensive reporting, performance analytics, and market intelligence.\n- **AI & Automation**: Includes AI-powered smart pitch matching, workflow automation, and AI-assisted contract generation.\n- **Integration**: Supports calendar integration for air dates and built-in messaging.\n\n### Data Flow\nClient requests made via TanStack Query are processed by Express routes, which interact with PostgreSQL via Drizzle ORM. Type-safe responses are returned, updating the React UI through TanStack Query's state management.\n\n## External Dependencies\n\n- **Neon PostgreSQL**: Serverless PostgreSQL database for scalable and flexible data storage.\n- **Radix UI**: Headless UI component library for building accessible user interfaces.\n- **Tailwind CSS**: Utility-first CSS framework for rapid and consistent styling.\n- **Lucide React**: Icon library for a consistent visual language.\n- **Vite**: Frontend build tool for development and production.\n- **ESBuild**: Backend bundler for optimizing server code.\n- **TypeScript**: Used across the full stack for type safety.\n\n## Pending Integrations\n\n- **Email Sending (Resend)**: Email sending functionality has been designed with schema and placeholders in place, but awaiting RESEND_API_KEY setup. The `emailSends` table tracks sent emails. When ready to implement, use Resend integration or manually configure with API key.","size_bytes":4649},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/pages/songs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport ComprehensiveSongForm from \"@/components/forms/comprehensive-song-form\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Music, Play, Edit, Trash2 } from \"lucide-react\";\nimport type { Song } from \"@shared/schema\";\n\nexport default function Songs() {\n  const [showAddSong, setShowAddSong] = useState(false);\n  const [editingSong, setEditingSong] = useState<Song | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: songs = [], isLoading, error } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\", searchQuery],\n    queryFn: async () => {\n      const url = new URL(\"/api/songs\", window.location.origin);\n      if (searchQuery) {\n        url.searchParams.set(\"search\", searchQuery);\n      }\n      const response = await fetch(url.toString());\n      if (!response.ok) {\n        throw new Error('Failed to fetch songs');\n      }\n      return response.json();\n    },\n  });\n\n  const formatDuration = (seconds: number | null) => {\n    if (!seconds) return \"N/A\";\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  if (isLoading) {\n    return (\n      <div>\n        <Header\n          title=\"Song Database\"\n          description=\"Manage your music catalog with comprehensive metadata\"\n          searchPlaceholder=\"Search songs, artists, albums...\"\n          newItemLabel=\"Add Song\"\n        />\n        <div className=\"p-6\">\n          <div className=\"grid gap-6\">\n            {[...Array(4)].map((_, i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start space-x-4\">\n                    <div className=\"w-16 h-16 bg-gray-200 rounded-lg\"></div>\n                    <div className=\"flex-1 space-y-3\">\n                      <div className=\"h-5 bg-gray-200 rounded w-1/3\"></div>\n                      <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n                      <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n                      <div className=\"flex space-x-2\">\n                        <div className=\"h-6 bg-gray-200 rounded w-16\"></div>\n                        <div className=\"h-6 bg-gray-200 rounded w-20\"></div>\n                        <div className=\"h-6 bg-gray-200 rounded w-14\"></div>\n                      </div>\n                    </div>\n                    <div className=\"flex space-x-2\">\n                      <div className=\"h-8 w-8 bg-gray-200 rounded\"></div>\n                      <div className=\"h-8 w-8 bg-gray-200 rounded\"></div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center\">\n          <div className=\"text-lg text-red-600 mb-2\">Failed to load songs</div>\n          <p className=\"text-gray-600 mb-4\">Please check your connection and try again.</p>\n          <Button \n            onClick={() => window.location.reload()} \n            className=\"bg-brand-primary hover:bg-blue-700\"\n          >\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Song Database\"\n        description=\"Manage your music catalog with comprehensive metadata\"\n        searchPlaceholder=\"Search songs, artists, albums...\"\n        newItemLabel=\"Add Song\"\n        onSearch={setSearchQuery}\n        onNewItem={() => setShowAddSong(true)}\n      />\n      \n      <div className=\"p-6\">\n        {songs.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-16\">\n              <Music className=\"h-12 w-12 text-gray-400 mb-4\" />\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No songs found</h3>\n              <p className=\"text-gray-600 text-center mb-6\">\n                {searchQuery \n                  ? \"No songs match your search criteria. Try adjusting your search terms.\"\n                  : \"Start building your music catalog by adding your first song.\"\n                }\n              </p>\n              <Button onClick={() => setShowAddSong(true)} className=\"bg-brand-primary hover:bg-blue-700\">\n                Add Your First Song\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-6\">\n            {songs.map((song) => (\n              <Card key={song.id} className=\"hover:shadow-md transition-shadow\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-start space-x-4\">\n                      <div className=\"w-16 h-16 bg-brand-primary/10 rounded-lg flex items-center justify-center\">\n                        <Music className=\"h-8 w-8 text-brand-primary\" />\n                      </div>\n                      \n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <h3 className=\"text-lg font-semibold text-gray-900\">{song.title}</h3>\n                          <Button size=\"sm\" variant=\"ghost\" className=\"h-8 w-8 p-0\">\n                            <Play className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                        \n                        <p className=\"text-gray-600 mb-2\">by {song.artist}</p>\n                        \n                        <div className=\"flex flex-wrap gap-2 mb-3\">\n                          {song.genre && (\n                            <Badge variant=\"secondary\">{song.genre}</Badge>\n                          )}\n                          {song.mood && (\n                            <Badge variant=\"outline\">{song.mood}</Badge>\n                          )}\n                          {song.tags && song.tags.length > 0 && (\n                            song.tags.map((tag, index) => (\n                              <Badge key={index} variant=\"outline\">{tag}</Badge>\n                            ))\n                          )}\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600\">\n                          <div>\n                            <span className=\"font-medium\">Album:</span> {song.album || \"N/A\"}\n                          </div>\n                          <div>\n                            <span className=\"font-medium\">Duration:</span> {song.durationFormatted || formatDuration(song.duration)}\n                          </div>\n                          <div>\n                            <span className=\"font-medium\">BPM/Key:</span> {song.bpmKey || `${song.bpm || \"N/A\"} / ${song.key || \"N/A\"}`}\n                          </div>\n                          <div>\n                            <span className=\"font-medium\">Genre:</span> {song.genreSubGenre || song.genre || \"N/A\"}\n                          </div>\n                          {song.composer && (\n                            <div>\n                              <span className=\"font-medium\">Composer:</span> {song.composer}\n                            </div>\n                          )}\n                          {song.producer && (\n                            <div>\n                              <span className=\"font-medium\">Producer:</span> {song.producer}\n                            </div>\n                          )}\n                          {song.isrc && (\n                            <div>\n                              <span className=\"font-medium\">ISRC:</span> {song.isrc}\n                            </div>\n                          )}\n                          {song.publisher && (\n                            <div>\n                              <span className=\"font-medium\">Publisher:</span> {song.publisher}\n                            </div>\n                          )}\n                        </div>\n                        \n                        {/* Ownership Information */}\n                        {(song.publishingOwnership || song.masterOwnership) && (\n                          <div className=\"mt-3 p-3 bg-green-50 rounded-lg border border-green-200\">\n                            <div className=\"flex items-center space-x-4 text-sm\">\n                              <div className=\"font-semibold text-green-800\">Your Ownership:</div>\n                              {song.publishingOwnership && (\n                                <div className=\"text-green-700\">\n                                  <span className=\"font-medium\">Publishing: {song.publishingOwnership}%</span>\n                                </div>\n                              )}\n                              {song.masterOwnership && (\n                                <div className=\"text-green-700\">\n                                  <span className=\"font-medium\">Master: {song.masterOwnership}%</span>\n                                </div>\n                              )}\n                            </div>\n                            {song.splitDetails && (\n                              <p className=\"text-xs text-green-600 mt-1\">{song.splitDetails}</p>\n                            )}\n                          </div>\n                        )}\n                        \n                        {song.description && (\n                          <p className=\"text-sm text-gray-600 mt-3\">{song.description}</p>\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex space-x-2\">\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        onClick={() => setEditingSong(song)}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" className=\"text-red-600 hover:text-red-700\">\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Add Song Form */}\n      <ComprehensiveSongForm \n        open={showAddSong} \n        onClose={() => setShowAddSong(false)} \n      />\n      \n      {/* Edit Song Form */}\n      <ComprehensiveSongForm \n        open={!!editingSong} \n        onClose={() => setEditingSong(null)} \n        song={editingSong}\n      />\n    </div>\n  );\n}\n","size_bytes":10952},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/deal-details-dialog.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport ComprehensiveAddDealForm from \"@/components/forms/comprehensive-add-deal-form\";\nimport AttachmentsList from \"@/components/attachments-list\";\nimport { \n  Calendar, \n  DollarSign, \n  Building, \n  Music, \n  Globe, \n  Shield, \n  FileText, \n  Edit, \n  Trash2,\n  Users,\n  Clock,\n  CheckCircle,\n  ChevronDown,\n  ChevronRight\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { DealWithRelations } from \"@shared/schema\";\n\ninterface DealDetailsDialogProps {\n  deal: DealWithRelations | null;\n  open: boolean;\n  onClose: () => void;\n}\n\nexport default function DealDetailsDialog({ deal, open, onClose }: DealDetailsDialogProps) {\n  const { toast } = useToast();\n  const [showEditForm, setShowEditForm] = useState(false);\n  const [expandedPitches, setExpandedPitches] = useState<Set<number>>(new Set());\n  \n  const deleteDealMutation = useMutation({\n    mutationFn: async () => {\n      if (!deal) return;\n      return apiRequest(`/api/deals/${deal.id}`, { method: 'DELETE' });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      toast({\n        title: \"Deal deleted\",\n        description: \"The deal has been successfully deleted.\",\n      });\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error deleting deal\",\n        description: \"Failed to delete the deal. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  if (!deal) return null;\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"pitched\":\n        return \"bg-gray-100 text-gray-800\";\n      case \"pending approval\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"quoted\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"use confirmed\":\n        return \"bg-green-100 text-green-800\";\n      case \"being drafted\":\n        return \"bg-purple-100 text-purple-800\";\n      case \"out for signature\":\n        return \"bg-orange-100 text-orange-800\";\n      case \"payment received\":\n        return \"bg-emerald-100 text-emerald-800\";\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    switch (status) {\n      case \"pitched\":\n        return \"Pitched\";\n      case \"pending approval\":\n        return \"Pending Approval\";\n      case \"quoted\":\n        return \"Quoted\";\n      case \"use confirmed\":\n        return \"Use Confirmed\";\n      case \"being drafted\":\n        return \"Being Drafted\";\n      case \"out for signature\":\n        return \"Out for Signature\";\n      case \"payment received\":\n        return \"Payment Received\";\n      case \"completed\":\n        return \"Completed\";\n      default:\n        return status.charAt(0).toUpperCase() + status.slice(1);\n    }\n  };\n\n  const formatDate = (date: Date | null | string) => {\n    if (!date) return \"Not set\";\n    return new Date(date).toLocaleDateString();\n  };\n\n  const formatDateTime = (date: Date | null | string) => {\n    if (!date) return \"Not set\";\n    return new Date(date).toLocaleString();\n  };\n\n\n\n  const handleDelete = () => {\n    if (confirm(`Are you sure you want to delete the deal \"${deal.projectName}\"? This action cannot be undone.`)) {\n      deleteDealMutation.mutate();\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" hideClose>\n        <DialogHeader>\n          <div className=\"flex items-center justify-end space-x-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setShowEditForm(true)}>\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Edit\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={handleDelete}\n              disabled={deleteDealMutation.isPending}\n              className=\"text-red-600 hover:text-red-700\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Delete\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" onClick={onClose}>\n              Close\n            </Button>\n          </div>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"overview\" className=\"mt-6\">\n          <TabsList className=\"grid w-full grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-1\">\n            <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"timeline\">Timeline</TabsTrigger>\n            <TabsTrigger value=\"pitches\">Pitches</TabsTrigger>\n            <TabsTrigger value=\"payments\">Payments</TabsTrigger>\n            <TabsTrigger value=\"documents\">Documents</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Project Information */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <FileText className=\"h-5 w-5\" />\n                    <span>Project Details</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Project Title</label>\n                    <div className=\"flex items-center space-x-3\">\n                      <p className=\"text-gray-900\">{deal.projectName}</p>\n                      <Badge className={getStatusColor(deal.status)}>\n                        {getStatusLabel(deal.status)}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Project Type</label>\n                    <p className=\"text-gray-900 capitalize\">{deal.projectType}</p>\n                  </div>\n                  {deal.projectDescription && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Description</label>\n                      <p className=\"text-gray-900\">{deal.projectDescription}</p>\n                    </div>\n                  )}\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Territory</label>\n                    <p className=\"text-gray-900 flex items-center space-x-2\">\n                      <Globe className=\"h-4 w-4\" />\n                      <span className=\"capitalize\">{deal.territory}</span>\n                    </p>\n                  </div>\n                  {deal.term && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Term</label>\n                      <p className=\"text-gray-900\">{deal.term}</p>\n                    </div>\n                  )}\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Exclusivity</label>\n                    <p className=\"text-gray-900 flex items-center space-x-2\">\n                      <Shield className=\"h-4 w-4\" />\n                      <span>{deal.exclusivity ? \"Exclusive\" : \"Non-exclusive\"}</span>\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Song Information */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <Music className=\"h-5 w-5\" />\n                    <span>Song Details</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Title</label>\n                    <p className=\"text-gray-900 font-medium\">{deal.song.title}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Artist</label>\n                    <p className=\"text-gray-900\">{deal.song.artist}</p>\n                  </div>\n                  {deal.song.album && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Album</label>\n                      <p className=\"text-gray-900\">{deal.song.album}</p>\n                    </div>\n                  )}\n                  {deal.song.composer && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Composer</label>\n                      <p className=\"text-gray-900\">{deal.song.composer}</p>\n                    </div>\n                  )}\n                  {deal.song.publisher && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Publisher</label>\n                      <p className=\"text-gray-900\">{deal.song.publisher}</p>\n                    </div>\n                  )}\n                  {/* Ownership Information */}\n                  {(deal.song.publishingOwnership || deal.song.masterOwnership) && (\n                    <div className=\"mt-4 p-3 bg-green-50 rounded-lg border border-green-200\">\n                      <div className=\"flex items-center space-x-4 text-sm\">\n                        <div className=\"font-semibold text-green-800\">Your Ownership:</div>\n                        {deal.song.publishingOwnership && (\n                          <div className=\"text-green-700\">\n                            <span className=\"font-medium\">Publishing: {deal.song.publishingOwnership}%</span>\n                          </div>\n                        )}\n                        {deal.song.masterOwnership && (\n                          <div className=\"text-green-700\">\n                            <span className=\"font-medium\">Master: {deal.song.masterOwnership}%</span>\n                          </div>\n                        )}\n                      </div>\n                      {deal.song.splitDetails && (\n                        <p className=\"text-xs text-green-600 mt-1\">{deal.song.splitDetails}</p>\n                      )}\n                    </div>\n                  )}\n                  {deal.restrictions && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Restrictions</label>\n                      <p className=\"text-gray-900 text-sm\">{deal.restrictions}</p>\n                    </div>\n                  )}\n                  {deal.song.description && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Description</label>\n                      <p className=\"text-gray-900 text-sm\">{deal.song.description}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Contact Information */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <Users className=\"h-5 w-5\" />\n                    <span>Contact Details</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Name</label>\n                    <p className=\"text-gray-900 font-medium\">{deal.contact.name}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600\">Email</label>\n                    <p className=\"text-gray-900\">{deal.contact.email}</p>\n                  </div>\n                  {deal.contact.phone && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Phone</label>\n                      <p className=\"text-gray-900\">{deal.contact.phone}</p>\n                    </div>\n                  )}\n                  {deal.contact.company && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Company</label>\n                      <p className=\"text-gray-900 flex items-center space-x-2\">\n                        <Building className=\"h-4 w-4\" />\n                        <span>{deal.contact.company}</span>\n                      </p>\n                    </div>\n                  )}\n                  {deal.contact.role && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Role</label>\n                      <p className=\"text-gray-900\">{deal.contact.role}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Financial Information */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <DollarSign className=\"h-5 w-5\" />\n                    <span>Financial Details</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Publishing Fee</label>\n                      <p className=\"text-gray-900 font-medium\">\n                        {deal.ourFee ? `$${Number(deal.ourFee).toLocaleString()}` : \"TBD\"}\n                      </p>\n                      {deal.fullSongValue && (\n                        <p className=\"text-xs text-gray-500\">\n                          of ${Number(deal.fullSongValue).toLocaleString()} total\n                        </p>\n                      )}\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Recording Fee</label>\n                      <p className=\"text-gray-900 font-medium\">\n                        {deal.ourRecordingFee ? `$${Number(deal.ourRecordingFee).toLocaleString()}` : \"TBD\"}\n                      </p>\n                      {deal.fullRecordingFee && (\n                        <p className=\"text-xs text-gray-500\">\n                          of ${Number(deal.fullRecordingFee).toLocaleString()} total\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  {(deal.ourFee && deal.ourRecordingFee) && (\n                    <div className=\"pt-2 border-t\">\n                      <label className=\"text-sm font-medium text-gray-600\">Total Our Fees</label>\n                      <p className=\"text-gray-900 font-medium text-lg\">\n                        ${(Number(deal.ourFee) + Number(deal.ourRecordingFee)).toLocaleString()}\n                      </p>\n                    </div>\n                  )}\n                  {deal.usage && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-600\">Usage</label>\n                      <p className=\"text-gray-900\">{deal.usage}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n\n            {deal.notes && (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Notes</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-gray-900 whitespace-pre-wrap\">{deal.notes}</p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"timeline\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Clock className=\"h-5 w-5\" />\n                  <span>Deal Timeline</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg\">\n                    <Calendar className=\"h-5 w-5 text-gray-500\" />\n                    <div>\n                      <p className=\"font-medium\">Air Date</p>\n                      <p className=\"text-sm text-gray-600\">{formatDate(deal.airDate)}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg\">\n                    <Calendar className=\"h-5 w-5 text-gray-500\" />\n                    <div>\n                      <p className=\"font-medium\">Pitch Date</p>\n                      <p className=\"text-sm text-gray-600\">{formatDate(deal.pitchDate)}</p>\n                    </div>\n                  </div>\n\n                  {/* Status Timeline */}\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"flex items-center space-x-4 p-3 bg-blue-50 rounded-lg\">\n                      <Calendar className=\"h-4 w-4 text-blue-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-blue-700\">New Request</p>\n                        <p className=\"text-xs text-blue-600\">{formatDateTime(deal.pitchedDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-yellow-50 rounded-lg\">\n                      <Calendar className=\"h-4 w-4 text-yellow-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-yellow-700\">Pending Approval</p>\n                        <p className=\"text-xs text-yellow-600\">{formatDateTime(deal.pendingApprovalDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-purple-50 rounded-lg\">\n                      <Calendar className=\"h-4 w-4 text-purple-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-purple-700\">Quoted</p>\n                        <p className=\"text-xs text-purple-600\">{formatDateTime(deal.quotedDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-green-50 rounded-lg\">\n                      <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-green-700\">Use Confirmed</p>\n                        <p className=\"text-xs text-green-600\">{formatDateTime(deal.useConfirmedDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-indigo-50 rounded-lg\">\n                      <FileText className=\"h-4 w-4 text-indigo-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-indigo-700\">Being Drafted</p>\n                        <p className=\"text-xs text-indigo-600\">{formatDateTime(deal.beingDraftedDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-orange-50 rounded-lg\">\n                      <FileText className=\"h-4 w-4 text-orange-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-orange-700\">Out for Signature</p>\n                        <p className=\"text-xs text-orange-600\">{formatDateTime(deal.outForSignatureDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-emerald-50 rounded-lg\">\n                      <DollarSign className=\"h-4 w-4 text-emerald-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-emerald-700\">Payment Received</p>\n                        <p className=\"text-xs text-emerald-600\">{formatDateTime(deal.paymentReceivedDate)}</p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-4 p-3 bg-green-50 rounded-lg\">\n                      <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                      <div>\n                        <p className=\"text-xs font-medium text-green-700\">Completed</p>\n                        <p className=\"text-xs text-green-600\">{formatDateTime(deal.completedDate)}</p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div>\n                  <p className=\"text-sm text-gray-600\">Created: {formatDateTime(deal.createdAt)}</p>\n                  <p className=\"text-sm text-gray-600\">Last Updated: {formatDateTime(deal.updatedAt)}</p>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"pitches\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Pitches</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {deal.pitches && deal.pitches.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {deal.pitches.map((pitch) => {\n                      const isExpanded = expandedPitches.has(pitch.id);\n                      return (\n                        <div \n                          key={pitch.id} \n                          className=\"border rounded-lg overflow-hidden hover:border-purple-300 transition-colors\"\n                        >\n                          <button\n                            onClick={() => {\n                              const newExpanded = new Set(expandedPitches);\n                              if (isExpanded) {\n                                newExpanded.delete(pitch.id);\n                              } else {\n                                newExpanded.add(pitch.id);\n                              }\n                              setExpandedPitches(newExpanded);\n                            }}\n                            className=\"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-left\"\n                            data-testid={`button-expand-pitch-${pitch.id}`}\n                          >\n                            <div className=\"flex items-center space-x-3\">\n                              {isExpanded ? (\n                                <ChevronDown className=\"h-5 w-5 text-purple-600\" />\n                              ) : (\n                                <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                              )}\n                              <div>\n                                <p className=\"font-medium\">Pitch #{pitch.id}</p>\n                                <p className=\"text-sm text-gray-600\">Created: {formatDateTime(pitch.createdAt)}</p>\n                              </div>\n                            </div>\n                            <Badge className=\"bg-purple-100 text-purple-800\">\n                              {pitch.status}\n                            </Badge>\n                          </button>\n                          \n                          {isExpanded && (\n                            <div className=\"px-4 pb-4 pt-2 bg-gray-50 dark:bg-gray-800 border-t\">\n                              <div className=\"space-y-3\">\n                                <div className=\"flex items-start space-x-3\">\n                                  <Music className=\"h-5 w-5 text-purple-600 mt-0.5\" />\n                                  <div className=\"flex-1\">\n                                    <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Song Pitched</p>\n                                    {deal.song ? (\n                                      <>\n                                        <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                                          {deal.song.title}\n                                        </p>\n                                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                          by {deal.song.artist}\n                                        </p>\n                                        {deal.song.album && (\n                                          <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n                                            Album: {deal.song.album}\n                                          </p>\n                                        )}\n                                      </>\n                                    ) : (\n                                      <p className=\"text-sm text-gray-500 dark:text-gray-500 italic\">\n                                        No song information available\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                                \n                                <div className=\"pt-2 border-t\">\n                                  <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Notes</p>\n                                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                    {pitch.notes || <span className=\"italic text-gray-400\">No notes added</span>}\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"text-gray-500\">No pitches recorded for this deal.</p>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"payments\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {deal.payments && deal.payments.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {deal.payments.map((payment) => (\n                      <div key={payment.id} className=\"p-4 border rounded-lg\">\n                        <div className=\"flex items-center justify-between\">\n                          <p className=\"font-medium\">${Number(payment.amount).toLocaleString()}</p>\n                          <Badge className={payment.status === 'paid' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}>\n                            {payment.status}\n                          </Badge>\n                        </div>\n                        <p className=\"text-sm text-gray-600\">Due: {formatDate(payment.dueDate)}</p>\n                        {payment.paidDate && (\n                          <p className=\"text-sm text-gray-600\">Paid: {formatDate(payment.paidDate)}</p>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-gray-500\">No payments recorded for this deal.</p>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"documents\" className=\"space-y-4\">\n            <AttachmentsList \n              entityType=\"deal\" \n              entityId={deal.id} \n              title=\"Deal Documents\"\n            />\n            <div className=\"text-sm text-gray-600 bg-blue-50 border border-blue-200 rounded-lg p-4\">\n              <p className=\"font-medium text-blue-800 mb-2\">Upload Files for This Deal:</p>\n              <ul className=\"list-disc list-inside space-y-1 text-blue-700\">\n                <li>Contracts, agreements, and licensing documents</li>\n                <li>Email communications with clients and supervisors</li>\n                <li>Project briefs and creative materials</li>\n                <li>Demo tracks, stems, and alternative versions</li>\n                <li>Payment receipts and invoices</li>\n              </ul>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </DialogContent>\n      \n      <ComprehensiveAddDealForm \n        deal={deal}\n        open={showEditForm}\n        onClose={() => setShowEditForm(false)}\n      />\n    </Dialog>\n  );\n}","size_bytes":29062},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":1921},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/workflow-automation.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Zap, Clock, Mail, Bell, Settings, Plus, Edit, Trash2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { WorkflowAutomation, InsertWorkflowAutomation } from \"@shared/schema\";\nimport { insertWorkflowAutomationSchema } from \"@shared/schema\";\n\nexport default function WorkflowAutomationPanel() {\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const { toast } = useToast();\n\n  const { data: automations = [], isLoading } = useQuery<WorkflowAutomation[]>({\n    queryKey: [\"/api/workflow-automation\"],\n  });\n\n  const createAutomationMutation = useMutation({\n    mutationFn: async (data: InsertWorkflowAutomation) => {\n      const response = await apiRequest(\"POST\", \"/api/workflow-automation\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Automation created successfully\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/workflow-automation\"] });\n      setShowCreateDialog(false);\n      form.reset();\n    },\n  });\n\n  const toggleAutomationMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: number; isActive: boolean }) => {\n      const response = await apiRequest(\"PUT\", `/api/workflow-automation/${id}`, { isActive });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/workflow-automation\"] });\n    },\n  });\n\n  const form = useForm<InsertWorkflowAutomation>({\n    resolver: zodResolver(insertWorkflowAutomationSchema),\n    defaultValues: {\n      name: \"\",\n      triggerType: \"date\",\n      triggerCondition: \"\",\n      actionType: \"email\",\n      actionData: \"\",\n      isActive: true,\n      entityType: \"deal\",\n    },\n  });\n\n  const getTriggerIcon = (type: string) => {\n    switch (type) {\n      case 'date': return Clock;\n      case 'status_change': return Settings;\n      case 'time_elapsed': return Zap;\n      default: return Clock;\n    }\n  };\n\n  const getActionIcon = (type: string) => {\n    switch (type) {\n      case 'email': return Mail;\n      case 'notification': return Bell;\n      case 'status_update': return Settings;\n      default: return Bell;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {[...Array(3)].map((_, i) => (\n          <div key={i} className=\"h-24 bg-gray-100 rounded-lg animate-pulse\"></div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">Workflow Automation</h3>\n          <p className=\"text-sm text-gray-600\">Automate routine tasks and reminders</p>\n        </div>\n        <Button onClick={() => setShowCreateDialog(true)}>\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Create Automation\n        </Button>\n      </div>\n\n      {automations.length === 0 ? (\n        <Card>\n          <CardContent className=\"text-center py-8\">\n            <Zap className=\"mx-auto h-8 w-8 text-gray-400 mb-4\" />\n            <h4 className=\"font-medium text-gray-900 mb-2\">No automations yet</h4>\n            <p className=\"text-gray-600 mb-4\">\n              Set up automated workflows to streamline your licensing process.\n            </p>\n            <Button onClick={() => setShowCreateDialog(true)}>\n              Create Your First Automation\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {automations.map((automation) => {\n            const TriggerIcon = getTriggerIcon(automation.triggerType);\n            const ActionIcon = getActionIcon(automation.actionType);\n            \n            return (\n              <Card key={automation.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"flex items-center space-x-2\">\n                        <TriggerIcon className=\"h-4 w-4 text-gray-600\" />\n                        <span className=\"text-sm text-gray-600\"></span>\n                        <ActionIcon className=\"h-4 w-4 text-gray-600\" />\n                      </div>\n                      <div>\n                        <h4 className=\"font-medium\">{automation.name}</h4>\n                        <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                          <Badge variant=\"outline\">{automation.triggerType.replace('_', ' ')}</Badge>\n                          <span></span>\n                          <Badge variant=\"outline\">{automation.actionType}</Badge>\n                          <span></span>\n                          <Badge variant=\"secondary\">{automation.entityType}</Badge>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <Switch\n                        checked={automation.isActive}\n                        onCheckedChange={(checked) => \n                          toggleAutomationMutation.mutate({ \n                            id: automation.id, \n                            isActive: checked \n                          })\n                        }\n                      />\n                      <Button variant=\"ghost\" size=\"sm\">\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button variant=\"ghost\" size=\"sm\" className=\"text-red-600\">\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Create Automation Dialog */}\n      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Create Workflow Automation</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={form.handleSubmit((data) => createAutomationMutation.mutate(data))} className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Automation Name</label>\n              <Input\n                {...form.register(\"name\")}\n                placeholder=\"e.g., Follow-up reminder after 7 days\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Entity Type</label>\n                <Select value={form.watch(\"entityType\")} onValueChange={(value) => form.setValue(\"entityType\", value)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"deal\">Deals</SelectItem>\n                    <SelectItem value=\"pitch\">Pitches</SelectItem>\n                    <SelectItem value=\"payment\">Payments</SelectItem>\n                    <SelectItem value=\"contact\">Contacts</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Trigger Type</label>\n                <Select value={form.watch(\"triggerType\")} onValueChange={(value) => form.setValue(\"triggerType\", value)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"date\">Specific Date</SelectItem>\n                    <SelectItem value=\"status_change\">Status Change</SelectItem>\n                    <SelectItem value=\"time_elapsed\">Time Elapsed</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Trigger Condition (JSON)</label>\n              <Textarea\n                {...form.register(\"triggerCondition\")}\n                placeholder='{\"days\": 7, \"status\": \"sent\"}'\n                rows={3}\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Define when this automation should trigger (JSON format)\n              </p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Action Type</label>\n              <Select value={form.watch(\"actionType\")} onValueChange={(value) => form.setValue(\"actionType\", value)}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"email\">Send Email</SelectItem>\n                  <SelectItem value=\"notification\">Show Notification</SelectItem>\n                  <SelectItem value=\"status_update\">Update Status</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Action Data (JSON)</label>\n              <Textarea\n                {...form.register(\"actionData\")}\n                placeholder='{\"template\": \"follow_up\", \"recipient\": \"client\"}'\n                rows={4}\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Define what action to take (JSON format)\n              </p>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowCreateDialog(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={createAutomationMutation.isPending}>\n                {createAutomationMutation.isPending ? \"Creating...\" : \"Create Automation\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":10785},"client/src/pages/deals.tsx":{"content":"import { useState, useMemo, useTransition } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport ComprehensiveAddDealForm from \"@/components/forms/comprehensive-add-deal-form\";\nimport DealDetailsDialog from \"@/components/deal-details-dialog\";\nimport ImportDealsDialog from \"@/components/forms/import-deals-dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Handshake, Edit, Trash2, DollarSign, Calendar, Building, Upload } from \"lucide-react\";\nimport type { DealWithRelations } from \"@shared/schema\";\n\nexport default function Deals() {\n  const [showAddDeal, setShowAddDeal] = useState(false);\n  const [showImportDeals, setShowImportDeals] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [isPending, startTransition] = useTransition();\n  const [selectedDeal, setSelectedDeal] = useState<DealWithRelations | null>(null);\n  const [showDealDetails, setShowDealDetails] = useState(false);\n  const [editingDeal, setEditingDeal] = useState<DealWithRelations | null>(null);\n  const [showEditDeal, setShowEditDeal] = useState(false);\n\n  const handleDealClick = (deal: DealWithRelations) => {\n    setSelectedDeal(deal);\n    setShowDealDetails(true);\n  };\n\n  const handleEditDeal = (e: React.MouseEvent, deal: DealWithRelations) => {\n    e.stopPropagation(); // Prevent the card click from firing\n    setEditingDeal(deal);\n    setShowEditDeal(true);\n  };\n\n  const { data: deals = [], isLoading } = useQuery<DealWithRelations[]>({\n    queryKey: [\"/api/deals\"],\n  });\n\n  const getStatusColor = (status: string) => {\n    // Normalize status to handle both underscore and space formats\n    const normalizedStatus = status.replace(/_/g, ' ').toLowerCase();\n    \n    switch (normalizedStatus) {\n      case \"new request\":\n        return \"bg-red-100 text-red-800\";\n      case \"pending approval\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"quoted\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"use confirmed\":\n        return \"bg-green-100 text-green-800\";\n      case \"being drafted\":\n        return \"bg-purple-100 text-purple-800\";\n      case \"out for signature\":\n        return \"bg-orange-100 text-orange-800\";\n      case \"payment received\":\n        return \"bg-emerald-100 text-emerald-800\";\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    return status.replace(\"_\", \" \").replace(/\\b\\w/g, l => l.toUpperCase());\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"N/A\";\n    return new Date(date).toLocaleDateString();\n  };\n\n  const getLatestStatusDate = (deal: DealWithRelations) => {\n    // Get the most recent status date based on current status\n    const statusDates = {\n      'new request': deal.pitchedDate,\n      'pending approval': deal.pendingApprovalDate,\n      'quoted': deal.quotedDate,\n      'use confirmed': deal.useConfirmedDate,\n      'being drafted': deal.beingDraftedDate,\n      'out for signature': deal.outForSignatureDate,\n      'payment received': deal.paymentReceivedDate,\n      'completed': deal.completedDate\n    };\n    \n    const currentStatusDate = statusDates[deal.status as keyof typeof statusDates];\n    return formatDate(currentStatusDate);\n  };\n\n  const filteredDeals = useMemo(() => {\n    return activeTab === \"all\" ? deals : deals.filter(deal => deal.status === activeTab);\n  }, [deals, activeTab]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-lg text-gray-600\">Loading deals...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Deal Pipeline\"\n        description=\"Manage your sync licensing deals from pitch to payment\"\n        searchPlaceholder=\"Search deals, projects, contacts...\"\n        newItemLabel=\"New Deal\"\n        onNewItem={() => setShowAddDeal(true)}\n      />\n      \n      <div className=\"p-6\">\n        <div className=\"flex justify-end mb-4\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setShowImportDeals(true)}\n            data-testid=\"button-import-deals\"\n          >\n            <Upload className=\"h-4 w-4 mr-2\" />\n            Import Deals\n          </Button>\n        </div>\n      \n        \n        <Tabs value={activeTab} onValueChange={(value) => {\n          startTransition(() => {\n            setActiveTab(value);\n          });\n        }} className=\"mb-6\">\n          <TabsList>\n            <TabsTrigger value=\"all\" className=\"data-[state=active]:bg-gray-100\">All Deals</TabsTrigger>\n            <TabsTrigger value=\"new request\" className=\"data-[state=active]:bg-red-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-red-300 rounded-full\"></div>\n                <span>New Request</span>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger value=\"pending approval\" className=\"data-[state=active]:bg-yellow-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-yellow-500 rounded-full\"></div>\n                <span>Pending Approval</span>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger value=\"quoted\" className=\"data-[state=active]:bg-blue-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                <span>Quoted</span>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger value=\"confirmed\" className=\"data-[state=active]:bg-green-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                <span>Confirmed</span>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger value=\"completed\" className=\"data-[state=active]:bg-green-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-green-600 rounded-full\"></div>\n                <span>Completed</span>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger value=\"paid\" className=\"data-[state=active]:bg-emerald-100\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-emerald-500 rounded-full\"></div>\n                <span>Paid</span>\n              </div>\n            </TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value={activeTab} className=\"mt-6\">\n            {filteredDeals.length === 0 ? (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-16\">\n                  <Handshake className=\"h-12 w-12 text-gray-400 mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No deals found</h3>\n                  <p className=\"text-gray-600 text-center mb-6\">\n                    {activeTab === \"all\"\n                      ? \"Start tracking your sync licensing deals by creating your first deal.\"\n                      : `No deals with status \"${getStatusLabel(activeTab)}\" found.`\n                    }\n                  </p>\n                  <Button onClick={() => setShowAddDeal(true)} className=\"bg-brand-primary hover:bg-blue-700\">\n                    Create Your First Deal\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid gap-6\">\n                {filteredDeals.map((deal) => (\n                  <Card \n                    key={deal.id} \n                    className=\"hover:shadow-md transition-shadow cursor-pointer\"\n                    onClick={() => handleDealClick(deal)}\n                  >\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start space-x-4\">\n                          <div className=\"w-16 h-16 bg-brand-primary/10 rounded-lg flex items-center justify-center\">\n                            <Handshake className=\"h-8 w-8 text-brand-primary\" />\n                          </div>\n                          \n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center space-x-2 mb-2\">\n                              <h3 className=\"text-lg font-semibold text-gray-900\">{deal.projectName}</h3>\n                              <Badge className={getStatusColor(deal.status)}>\n                                {getStatusLabel(deal.status)}\n                              </Badge>\n                            </div>\n                            \n                            <p className=\"text-gray-600 mb-2\">{deal.projectType}</p>\n                            \n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4\">\n                              <div className=\"flex items-center space-x-2\">\n                                <div className=\"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center\">\n                                  <span className=\"text-xs font-medium\"></span>\n                                </div>\n                                <div>\n                                  <p className=\"font-medium\">{deal.song.title}</p>\n                                  <p className=\"text-xs\">by {deal.song.artist}</p>\n                                </div>\n                              </div>\n                              \n                              <div className=\"flex items-center space-x-2\">\n                                <Building className=\"h-4 w-4 text-gray-400\" />\n                                <div>\n                                  <p className=\"font-medium\">{deal.contact.name}</p>\n                                  <p className=\"text-xs\">{deal.contact.company}</p>\n                                </div>\n                              </div>\n                              \n                              <div className=\"flex items-center space-x-2\">\n                                <DollarSign className=\"h-4 w-4 text-gray-400\" />\n                                <div>\n                                  <p className=\"font-medium\">\n                                    {deal.ourFee && deal.ourRecordingFee \n                                      ? `$${Number(deal.ourFee).toLocaleString()} / $${Number(deal.ourRecordingFee).toLocaleString()}`\n                                      : deal.ourFee \n                                        ? `$${Number(deal.ourFee).toLocaleString()} Pub`\n                                        : deal.ourRecordingFee\n                                          ? `$${Number(deal.ourRecordingFee).toLocaleString()} Rec`\n                                          : \"TBD\"\n                                    }\n                                  </p>\n                                  <p className=\"text-xs\">\n                                    {deal.ourFee && deal.ourRecordingFee \n                                      ? \"Publishing / Recording\"\n                                      : deal.ourFee \n                                        ? \"Publishing Fee\"\n                                        : deal.ourRecordingFee\n                                          ? \"Recording Fee\"\n                                          : \"Fees TBD\"\n                                    }\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\n                              <div className=\"flex items-center space-x-1\">\n                                <Calendar className=\"h-4 w-4\" />\n                                <span>Updated: {getLatestStatusDate(deal)}</span>\n                              </div>\n                              {deal.useConfirmedDate && (\n                                <div className=\"flex items-center space-x-1\">\n                                  <Calendar className=\"h-4 w-4\" />\n                                  <span>Confirmed: {formatDate(deal.useConfirmedDate)}</span>\n                                </div>\n                              )}\n                            </div>\n                            \n                            {deal.projectDescription && (\n                              <p className=\"text-sm text-gray-600 mt-3\">{deal.projectDescription}</p>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex space-x-2\">\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={(e) => handleEditDeal(e, deal)}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button size=\"sm\" variant=\"outline\" className=\"text-red-600 hover:text-red-700\">\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <ComprehensiveAddDealForm open={showAddDeal} onClose={() => setShowAddDeal(false)} />\n      \n      <ComprehensiveAddDealForm \n        open={showEditDeal} \n        onClose={() => {\n          setShowEditDeal(false);\n          setEditingDeal(null);\n        }}\n        deal={editingDeal}\n      />\n      \n      <DealDetailsDialog \n        deal={selectedDeal}\n        open={showDealDetails}\n        onClose={() => setShowDealDetails(false)}\n      />\n      \n      <ImportDealsDialog\n        open={showImportDeals}\n        onClose={() => setShowImportDeals(false)}\n      />\n    </div>\n  );\n}\n","size_bytes":14340},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/templates.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Copy, Download, Edit, Trash2 } from \"lucide-react\";\nimport DuplicateTemplateDialog from \"@/components/duplicate-template-dialog\";\nimport type { Template } from \"@shared/schema\";\n\nexport default function Templates() {\n  const [templates, setTemplates] = useState<Template[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [editName, setEditName] = useState(\"\");\n  const [editContent, setEditContent] = useState(\"\");\n  const [duplicateDialogOpen, setDuplicateDialogOpen] = useState(false);\n  const [duplicatingTemplate, setDuplicatingTemplate] = useState<Template | null>(null);\n\n  const fetchTemplates = async () => {\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/templates\");\n      const data = await res.json();\n      setTemplates(data);\n    } catch {\n      alert(\" Failed to load templates.\");\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    fetchTemplates();\n  }, []);\n\n  const openDuplicateDialog = (template: Template) => {\n    setDuplicatingTemplate(template);\n    setDuplicateDialogOpen(true);\n  };\n\n  const handleDuplicateSuccess = () => {\n    fetchTemplates();\n  };\n\n  const downloadTemplate = async (id: number) => {\n    try {\n      const res = await fetch(`/api/templates/${id}/download`);\n      if (!res.ok) throw new Error(\"Download failed\");\n\n      const blob = await res.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `template-${id}.txt`;\n      a.click();\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      alert(\" Download failed\");\n    }\n  };\n\n  const deleteTemplate = async (id: number) => {\n    if (!confirm(\"Are you sure you want to delete this template?\")) return;\n    try {\n      const res = await fetch(`/api/templates/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Delete failed\");\n      alert(\" Template deleted successfully!\");\n      fetchTemplates();\n    } catch (err) {\n      alert(\" Delete failed\");\n    }\n  };\n\n  const startEdit = (template: Template) => {\n    setEditingId(template.id);\n    setEditName(template.name);\n    setEditContent(template.content);\n  };\n\n  const cancelEdit = () => {\n    setEditingId(null);\n    setEditName(\"\");\n    setEditContent(\"\");\n  };\n\n  const saveEdit = async (id: number) => {\n    try {\n      const res = await fetch(`/api/templates/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ name: editName, type: templates.find(t => t.id === id)?.type || \"\", content: editContent }),\n      });\n      if (!res.ok) throw new Error(\"Update failed\");\n      alert(\" Template updated!\");\n      setEditingId(null);\n      fetchTemplates();\n    } catch (err) {\n      alert(\" Update failed\");\n    }\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-semibold text-foreground\">Templates</h1>\n        <p className=\"text-muted-foreground\">Manage document templates for contracts, quotes, and licensing</p>\n      </div>\n\n      {loading ? (\n        <p className=\"text-muted-foreground\">Loading templates...</p>\n      ) : templates.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-16\">\n            <p className=\"text-muted-foreground\">No templates found. Create your first template to get started.</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {templates.map((template) => (\n            <Card key={template.id} className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4\">\n                {editingId === template.id ? (\n                  <>\n                    <Input\n                      className=\"mb-2\"\n                      value={editName}\n                      onChange={(e) => setEditName(e.target.value)}\n                      placeholder=\"Template name\"\n                      data-testid=\"edit-template-name\"\n                    />\n                    <Textarea\n                      className=\"mb-2 min-h-[150px] font-mono text-sm\"\n                      value={editContent}\n                      onChange={(e) => setEditContent(e.target.value)}\n                      placeholder=\"Template content\"\n                      data-testid=\"edit-template-content\"\n                    />\n                    <div className=\"flex justify-end gap-2\">\n                      <Button variant=\"outline\" size=\"sm\" onClick={cancelEdit} data-testid=\"cancel-edit\">\n                        Cancel\n                      </Button>\n                      <Button size=\"sm\" onClick={() => saveEdit(template.id)} data-testid=\"save-edit\">\n                        Save\n                      </Button>\n                    </div>\n                  </>\n                ) : (\n                  <>\n                    <div className=\"flex justify-between items-start mb-2\">\n                      <h3 className=\"text-lg font-semibold text-foreground\">\n                        {template.name || \"(Untitled Template)\"}\n                      </h3>\n                      <div className=\"flex gap-1\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => openDuplicateDialog(template)}\n                          title=\"Duplicate template\"\n                          data-testid={`duplicate-template-${template.id}`}\n                        >\n                          <Copy className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => downloadTemplate(template.id)}\n                          title=\"Download template\"\n                          data-testid={`download-template-${template.id}`}\n                        >\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => startEdit(template)}\n                          title=\"Edit template\"\n                          data-testid={`edit-template-${template.id}`}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          className=\"text-destructive hover:text-destructive/90\"\n                          onClick={() => deleteTemplate(template.id)}\n                          title=\"Delete template\"\n                          data-testid={`delete-template-${template.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <p className=\"text-xs text-muted-foreground mb-3\">\n                      Updated: {new Date(template.updatedAt).toLocaleDateString()}\n                    </p>\n                    \n                    <div className=\"bg-muted rounded p-3 border border-border\">\n                      <p className=\"text-xs text-muted-foreground mb-1 font-medium\">Preview:</p>\n                      <div className=\"text-sm text-foreground font-mono whitespace-pre-wrap line-clamp-4\">\n                        {template.content.slice(0, 150)}\n                        {template.content.length > 150 && \"...\"}\n                      </div>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n      \n      {duplicatingTemplate && (\n        <DuplicateTemplateDialog\n          open={duplicateDialogOpen}\n          onClose={() => {\n            setDuplicateDialogOpen(false);\n            setDuplicatingTemplate(null);\n          }}\n          templateId={duplicatingTemplate.id}\n          templateName={duplicatingTemplate.name}\n          onSuccess={handleDuplicateSuccess}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":8611},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/forms/comprehensive-song-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertSongSchema, type InsertSong } from \"@shared/schema\";\nimport { Plus, X } from \"lucide-react\";\n\ninterface ComprehensiveSongFormProps {\n  open: boolean;\n  onClose: () => void;\n  song?: any; // For editing existing songs\n}\n\nexport default function ComprehensiveSongForm({ open, onClose, song }: ComprehensiveSongFormProps) {\n  const { toast } = useToast();\n  const isEditing = !!song;\n  \n  // State for managing multiple artists \n  const [legacyArtists, setLegacyArtists] = useState<string[]>(\n    song?.artist ? song.artist.split(', ').filter(Boolean) : ['']\n  );\n  \n  // Structure to store composer and their associated publisher and ownership\n  interface ComposerPublisher {\n    composer: string;\n    publisher: string;\n    publishingOwnership: string;\n    isMine: boolean;\n  }\n  \n  // Structure to store artist and their associated label and ownership\n  interface ArtistLabel {\n    artist: string;\n    label: string;\n    labelOwnership: string;\n    isMine: boolean;\n  }\n  \n  const [composerPublishers, setComposerPublishers] = useState<ComposerPublisher[]>(() => {\n    if (song?.composer || song?.publisher) {\n      const composers = song?.composer ? song.composer.split(', ').filter(Boolean) : [''];\n      const publishers = song?.publisher ? song.publisher.split(', ').filter(Boolean) : [''];\n      \n      // Match composers with publishers, padding with empty strings if needed\n      const maxLength = Math.max(composers.length, publishers.length);\n      const result: ComposerPublisher[] = [];\n      for (let i = 0; i < maxLength; i++) {\n        result.push({\n          composer: composers[i] || '',\n          publisher: publishers[i] || '',\n          publishingOwnership: '',\n          isMine: false\n        });\n      }\n      return result.length > 0 ? result : [{ composer: '', publisher: '', publishingOwnership: '', isMine: false }];\n    }\n    return [{ composer: '', publisher: '', publishingOwnership: '', isMine: false }];\n  });\n  \n  const [artistLabels, setArtistLabels] = useState<ArtistLabel[]>(() => {\n    if (song?.artist || song?.producer) {\n      const artists = song?.artist ? song.artist.split(', ').filter(Boolean) : [''];\n      const labels = song?.producer ? [song.producer] : [''];\n      \n      // Match artists with labels, padding with empty strings if needed\n      const maxLength = Math.max(artists.length, labels.length);\n      const result: ArtistLabel[] = [];\n      for (let i = 0; i < maxLength; i++) {\n        result.push({\n          artist: artists[i] || '',\n          label: labels[i] || '',\n          labelOwnership: '',\n          isMine: false\n        });\n      }\n      return result.length > 0 ? result : [{ artist: '', label: '', labelOwnership: '', isMine: false }];\n    }\n    return [{ artist: '', label: '', labelOwnership: '', isMine: false }];\n  });\n  \n  // Reset state when song prop changes\n  useEffect(() => {\n    // Reset legacy artists\n    setLegacyArtists(song?.artist ? song.artist.split(', ').filter(Boolean) : ['']);\n    \n    // Reset composer-publisher data - use structured data if available, otherwise fall back to legacy\n    if (song?.composerPublishers && Array.isArray(song.composerPublishers) && song.composerPublishers.length > 0) {\n      // Use saved structured data\n      setComposerPublishers(song.composerPublishers);\n    } else if (song?.composer || song?.publisher) {\n      // Fall back to legacy comma-separated strings\n      const composers = song?.composer ? song.composer.split(', ').filter(Boolean) : [''];\n      const publishers = song?.publisher ? song.publisher.split(', ').filter(Boolean) : [''];\n      \n      const maxLength = Math.max(composers.length, publishers.length);\n      const result: ComposerPublisher[] = [];\n      for (let i = 0; i < maxLength; i++) {\n        result.push({\n          composer: composers[i] || '',\n          publisher: publishers[i] || '',\n          publishingOwnership: '',\n          isMine: false\n        });\n      }\n      setComposerPublishers(result.length > 0 ? result : [{ composer: '', publisher: '', publishingOwnership: '', isMine: false }]);\n    } else {\n      setComposerPublishers([{ composer: '', publisher: '', publishingOwnership: '', isMine: false }]);\n    }\n    \n    // Reset artist-label data - use structured data if available, otherwise fall back to legacy\n    if (song?.artistLabels && Array.isArray(song.artistLabels) && song.artistLabels.length > 0) {\n      // Use saved structured data\n      setArtistLabels(song.artistLabels);\n    } else if (song?.artist || song?.producer) {\n      // Fall back to legacy comma-separated strings\n      const artists = song?.artist ? song.artist.split(', ').filter(Boolean) : [''];\n      const labels = song?.producer ? [song.producer] : [''];\n      \n      const maxLength = Math.max(artists.length, labels.length);\n      const result: ArtistLabel[] = [];\n      for (let i = 0; i < maxLength; i++) {\n        result.push({\n          artist: artists[i] || '',\n          label: labels[i] || '',\n          labelOwnership: '',\n          isMine: false\n        });\n      }\n      setArtistLabels(result.length > 0 ? result : [{ artist: '', label: '', labelOwnership: '', isMine: false }]);\n    } else {\n      setArtistLabels([{ artist: '', label: '', labelOwnership: '', isMine: false }]);\n    }\n  }, [song]);\n  \n  // Helper functions for managing legacy artist arrays (keeping for backward compatibility)\n  const addLegacyArtist = () => setLegacyArtists([...legacyArtists, '']);\n  const removeLegacyArtist = (index: number) => {\n    if (legacyArtists.length > 1) {\n      setLegacyArtists(legacyArtists.filter((_, i) => i !== index));\n    }\n  };\n  const updateLegacyArtist = (index: number, value: string) => {\n    const newArtists = [...legacyArtists];\n    newArtists[index] = value;\n    setLegacyArtists(newArtists);\n  };\n\n  // Helper functions for managing composer-publisher pairs\n  const addComposerPublisher = () => setComposerPublishers([...composerPublishers, { composer: '', publisher: '', publishingOwnership: '', isMine: false }]);\n  const removeComposerPublisher = (index: number) => {\n    if (composerPublishers.length > 1) {\n      setComposerPublishers(composerPublishers.filter((_, i) => i !== index));\n    }\n  };\n  const updateComposer = (index: number, value: string) => {\n    const newComposerPublishers = [...composerPublishers];\n    newComposerPublishers[index].composer = value;\n    setComposerPublishers(newComposerPublishers);\n  };\n  const updatePublisher = (index: number, value: string) => {\n    const newComposerPublishers = [...composerPublishers];\n    newComposerPublishers[index].publisher = value;\n    setComposerPublishers(newComposerPublishers);\n  };\n  const updatePublishingOwnership = (index: number, value: string) => {\n    const newComposerPublishers = [...composerPublishers];\n    newComposerPublishers[index].publishingOwnership = value;\n    setComposerPublishers(newComposerPublishers);\n  };\n  const updateComposerIsMine = (index: number, value: boolean) => {\n    const newComposerPublishers = [...composerPublishers];\n    newComposerPublishers[index].isMine = value;\n    setComposerPublishers(newComposerPublishers);\n  };\n\n  // Helper functions for managing artist-label pairs\n  const addArtistLabel = () => setArtistLabels([...artistLabels, { artist: '', label: '', labelOwnership: '', isMine: false }]);\n  const removeArtistLabel = (index: number) => {\n    if (artistLabels.length > 1) {\n      setArtistLabels(artistLabels.filter((_, i) => i !== index));\n    }\n  };\n  const updateArtist = (index: number, value: string) => {\n    const newArtistLabels = [...artistLabels];\n    newArtistLabels[index].artist = value;\n    setArtistLabels(newArtistLabels);\n  };\n  const updateLabel = (index: number, value: string) => {\n    const newArtistLabels = [...artistLabels];\n    newArtistLabels[index].label = value;\n    setArtistLabels(newArtistLabels);\n  };\n  const updateLabelOwnership = (index: number, value: string) => {\n    const newArtistLabels = [...artistLabels];\n    newArtistLabels[index].labelOwnership = value;\n    setArtistLabels(newArtistLabels);\n  };\n  const updateArtistIsMine = (index: number, value: boolean) => {\n    const newArtistLabels = [...artistLabels];\n    newArtistLabels[index].isMine = value;\n    setArtistLabels(newArtistLabels);\n  };\n\n\n  \n  const form = useForm<InsertSong>({\n    resolver: zodResolver(insertSongSchema),\n    defaultValues: {\n      title: song?.title || \"\",\n      artist: song?.artist || \"\",\n      album: song?.album || \"\",\n      composer: song?.composer || \"\",\n      producer: song?.producer || \"\",\n      publisher: song?.publisher || \"\",\n      irc: song?.irc || \"\",\n      isrc: song?.isrc || \"\",\n      upcEan: song?.upcEan || \"\",\n      pNumbers: song?.pNumbers || \"\",\n      proCueSheetId: song?.proCueSheetId || \"\",\n      genreSubGenre: song?.genreSubGenre || \"\",\n      moodTheme: song?.moodTheme || \"\",\n      bpmKey: song?.bpmKey || \"\",\n      vocalInstrumentation: song?.vocalInstrumentation || \"\",\n      explicitContent: song?.explicitContent ?? false,\n      lyrics: song?.lyrics || \"\",\n      durationFormatted: song?.durationFormatted || \"\",\n      version: song?.version || \"\",\n      coverArtDescription: song?.coverArtDescription || \"\",\n      fileTypeSampleRate: song?.fileTypeSampleRate || \"\",\n      contentRepresentationCode: song?.contentRepresentationCode || \"\",\n      masterRightsContact: song?.masterRightsContact || \"\",\n      publishingRightsContact: song?.publishingRightsContact || \"\",\n      syncRepresentation: song?.syncRepresentation || \"\",\n      contentRepresented: song?.contentRepresented || \"\",\n      smartLinkQrCode: song?.smartLinkQrCode || \"\",\n      // Legacy fields\n      genre: song?.genre || \"\",\n      mood: song?.mood || \"\",\n      tempo: song?.tempo || undefined,\n      duration: song?.duration || undefined,\n      key: song?.key || \"\",\n      bpm: song?.bpm || undefined,\n      description: song?.description || \"\",\n      tags: song?.tags || [],\n      filePath: song?.filePath || \"\",\n      // Ownership fields\n      publishingOwnership: song?.publishingOwnership || undefined,\n      masterOwnership: song?.masterOwnership || undefined,\n      splitDetails: song?.splitDetails || \"\",\n      restrictions: song?.restrictions || \"\",\n    },\n  });\n\n  // Reset form when song prop changes\n  useEffect(() => {\n    if (song) {\n      form.reset({\n        title: song.title || \"\",\n        artist: song.artist || \"\",\n        album: song.album || \"\",\n        composer: song.composer || \"\",\n        producer: song.producer || \"\",\n        publisher: song.publisher || \"\",\n        irc: song.irc || \"\",\n        isrc: song.isrc || \"\",\n        upcEan: song.upcEan || \"\",\n        pNumbers: song.pNumbers || \"\",\n        proCueSheetId: song.proCueSheetId || \"\",\n        genreSubGenre: song.genreSubGenre || \"\",\n        moodTheme: song.moodTheme || \"\",\n        bpmKey: song.bpmKey || \"\",\n        vocalInstrumentation: song.vocalInstrumentation || \"\",\n        explicitContent: song.explicitContent ?? false,\n        lyrics: song.lyrics || \"\",\n        durationFormatted: song.durationFormatted || \"\",\n        version: song.version || \"\",\n        coverArtDescription: song.coverArtDescription || \"\",\n        fileTypeSampleRate: song.fileTypeSampleRate || \"\",\n        contentRepresentationCode: song.contentRepresentationCode || \"\",\n        masterRightsContact: song.masterRightsContact || \"\",\n        publishingRightsContact: song.publishingRightsContact || \"\",\n        syncRepresentation: song.syncRepresentation || \"\",\n        contentRepresented: song.contentRepresented || \"\",\n        smartLinkQrCode: song.smartLinkQrCode || \"\",\n        genre: song.genre || \"\",\n        mood: song.mood || \"\",\n        tempo: song.tempo || undefined,\n        duration: song.duration || undefined,\n        key: song.key || \"\",\n        bpm: song.bpm || undefined,\n        description: song.description || \"\",\n        tags: song.tags || [],\n        filePath: song.filePath || \"\",\n        publishingOwnership: song.publishingOwnership || undefined,\n        masterOwnership: song.masterOwnership || undefined,\n        splitDetails: song.splitDetails || \"\",\n        restrictions: song.restrictions || \"\",\n      });\n    } else {\n      // Reset to empty form when no song is provided\n      form.reset({\n        title: \"\",\n        artist: \"\",\n        album: \"\",\n        composer: \"\",\n        producer: \"\",\n        publisher: \"\",\n        irc: \"\",\n        isrc: \"\",\n        upcEan: \"\",\n        pNumbers: \"\",\n        proCueSheetId: \"\",\n        genreSubGenre: \"\",\n        moodTheme: \"\",\n        bpmKey: \"\",\n        vocalInstrumentation: \"\",\n        explicitContent: false,\n        lyrics: \"\",\n        durationFormatted: \"\",\n        version: \"\",\n        coverArtDescription: \"\",\n        fileTypeSampleRate: \"\",\n        contentRepresentationCode: \"\",\n        masterRightsContact: \"\",\n        publishingRightsContact: \"\",\n        syncRepresentation: \"\",\n        contentRepresented: \"\",\n        smartLinkQrCode: \"\",\n        genre: \"\",\n        mood: \"\",\n        tempo: undefined,\n        duration: undefined,\n        key: \"\",\n        bpm: undefined,\n        description: \"\",\n        tags: [],\n        filePath: \"\",\n        publishingOwnership: undefined,\n        masterOwnership: undefined,\n        splitDetails: \"\",\n        restrictions: \"\",\n      });\n    }\n  }, [song, form]);\n\n  const createSongMutation = useMutation({\n    mutationFn: async (data: InsertSong) => {\n      console.log('Mutation starting with data:', data);\n      const endpoint = isEditing ? `/api/songs/${song.id}` : \"/api/songs\";\n      const method = isEditing ? \"PUT\" : \"POST\";\n      console.log('Making API call:', method, endpoint);\n      \n      try {\n        const response = await apiRequest(endpoint, {\n          method,\n          body: data,\n        });\n        console.log('API response received:', response);\n        const result = await response.json();\n        console.log('Parsed response:', result);\n        return result;\n      } catch (error) {\n        console.error('API call failed:', error);\n        throw error;\n      }\n    },\n    onSuccess: (data) => {\n      console.log('Mutation succeeded:', data);\n      toast({\n        title: \"Success\",\n        description: isEditing ? \"Song updated successfully\" : \"Song added successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/songs\"] });\n      onClose();\n      form.reset();\n    },\n    onError: (error: any) => {\n      console.error('Mutation failed:', error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to save song\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertSong) => {\n    console.log('Form submitted with data:', data);\n    console.log('Form errors:', form.formState.errors);\n    \n    // Convert tags string to array if provided, handle undefined/empty values\n    let processedTags: string[] = [];\n    if (data.tags && Array.isArray(data.tags) && data.tags[0] && data.tags[0] !== \"undefined\") {\n      processedTags = data.tags[0].split(\",\").map(tag => tag.trim()).filter(tag => tag.length > 0);\n    }\n    \n    // Combine multiple artists and composers into comma-separated strings\n    const combinedArtist = artistLabels.map(al => al.artist).filter(artist => artist.trim()).join(', ');\n    const combinedLabel = artistLabels.map(al => al.label).filter(label => label.trim()).join(', ');\n    const combinedComposer = composerPublishers.map(cp => cp.composer).filter(composer => composer.trim()).join(', ');\n    const combinedPublisher = composerPublishers.map(cp => cp.publisher).filter(publisher => publisher.trim()).join(', ');\n    \n    // Calculate Jonas's total ownership percentages\n    const jonasPublishingOwnership = composerPublishers\n      .filter(cp => cp.isMine && cp.publishingOwnership)\n      .reduce((total, cp) => total + parseFloat(cp.publishingOwnership || '0'), 0);\n    \n    const jonasLabelOwnership = artistLabels\n      .filter(al => al.isMine && al.labelOwnership)\n      .reduce((total, al) => total + parseFloat(al.labelOwnership || '0'), 0);\n    \n    const processedData = {\n      ...data,\n      artist: combinedArtist,\n      producer: combinedLabel, // Label goes into producer field\n      composer: combinedComposer,\n      publisher: combinedPublisher,\n      tags: processedTags,\n      // Include structured ownership data\n      composerPublishers: composerPublishers,\n      artistLabels: artistLabels,\n      // Include calculated ownership percentages for display\n      publishingOwnership: jonasPublishingOwnership > 0 ? jonasPublishingOwnership : null,\n      masterOwnership: jonasLabelOwnership > 0 ? jonasLabelOwnership : null,\n    };\n    \n    console.log('Processed data for submission:', processedData);\n    createSongMutation.mutate(processedData);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[90vh] overflow-hidden\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? \"Edit Song\" : \"Add New Song\"}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit, (errors) => {\n          console.log('Form validation failed:', errors);\n          toast({\n            title: \"Validation Error\",\n            description: \"Please check the form for errors\",\n            variant: \"destructive\",\n          });\n        })} className=\"h-full overflow-hidden\">\n          <Tabs defaultValue=\"basic\" className=\"h-full flex flex-col\">\n            <TabsList className=\"grid w-full grid-cols-5\">\n              <TabsTrigger value=\"basic\">Basic Info</TabsTrigger>\n              <TabsTrigger value=\"metadata\">Metadata</TabsTrigger>\n              <TabsTrigger value=\"rights\">Rights</TabsTrigger>\n              <TabsTrigger value=\"technical\">Technical</TabsTrigger>\n              <TabsTrigger value=\"content\">Content</TabsTrigger>\n            </TabsList>\n\n            <div className=\"flex-1 overflow-y-auto p-1\">\n              <TabsContent value=\"basic\" className=\"space-y-4\">\n                {/* Part 1: Basic Song Details - Light Purple */}\n                <Card className=\"bg-purple-50 border-purple-200\">\n                  <CardHeader className=\"bg-purple-100 border-b border-purple-200\">\n                    <CardTitle className=\"text-purple-800\">Basic Song Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4 bg-purple-50\">\n                    {/* First line: Title, Album */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"title\">Title *</Label>\n                        <Input\n                          id=\"title\"\n                          {...form.register(\"title\")}\n                          placeholder=\"Song title\"\n                        />\n                        {form.formState.errors.title && (\n                          <p className=\"text-sm text-red-600\">{form.formState.errors.title.message}</p>\n                        )}\n                      </div>\n                      <div>\n                        <Label htmlFor=\"album\">Album</Label>\n                        <Input\n                          id=\"album\"\n                          {...form.register(\"album\")}\n                          placeholder=\"Album name\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Second line: Jonas's Ownership Summary */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"publishingOwnership\">Publishing Ownership (%)</Label>\n                        <Input\n                          id=\"publishingOwnership\"\n                          type=\"number\"\n                          min=\"0\"\n                          max=\"100\"\n                          step=\"0.01\"\n                          value={composerPublishers\n                            .filter(cp => cp.isMine && cp.publishingOwnership)\n                            .reduce((total, cp) => total + parseFloat(cp.publishingOwnership || '0'), 0)\n                            .toFixed(2)}\n                          readOnly\n                          className=\"bg-purple-100/50 font-semibold\"\n                          placeholder=\"0.00\"\n                        />\n                        <p className=\"text-xs text-purple-600 mt-1\">Auto-calculated from Jonas's checked composers</p>\n                      </div>\n                      <div>\n                        <Label htmlFor=\"masterOwnership\">Label Recording Ownership (%)</Label>\n                        <Input\n                          id=\"masterOwnership\"\n                          type=\"number\"\n                          min=\"0\"\n                          max=\"100\"\n                          step=\"0.01\"\n                          value={artistLabels\n                            .filter(al => al.isMine && al.labelOwnership)\n                            .reduce((total, al) => total + parseFloat(al.labelOwnership || '0'), 0)\n                            .toFixed(2)}\n                          readOnly\n                          className=\"bg-purple-100/50 font-semibold\"\n                          placeholder=\"0.00\"\n                        />\n                        <p className=\"text-xs text-purple-600 mt-1\">Auto-calculated from Jonas's checked artists</p>\n                      </div>\n                    </div>\n\n                  </CardContent>\n                </Card>\n                \n                {/* Part 2: Publishing Information - Green */}\n                <Card className=\"bg-green-50 border-green-200\">\n                  <CardHeader className=\"bg-green-100 border-b border-green-200\">\n                    <CardTitle className=\"text-green-800\">Publishing Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4 bg-green-50\">\n                    <div>\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <Label className=\"text-base font-semibold\">Composer(s), Publisher(s) & Ownership</Label>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={addComposerPublisher}\n                          className=\"h-6 px-2\"\n                        >\n                          <Plus className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"space-y-3\">\n                        <div className=\"grid grid-cols-12 gap-2 text-sm font-medium text-green-700\">\n                          <div className=\"col-span-4\">Composer Name</div>\n                          <div className=\"col-span-4\">Publisher</div>\n                          <div className=\"col-span-2\">Ownership (%)</div>\n                          <div className=\"col-span-1\">Jonas</div>\n                          <div className=\"col-span-1\">Actions</div>\n                        </div>\n                        {composerPublishers.map((item, index) => (\n                          <div key={index} className=\"grid grid-cols-12 gap-2\">\n                            <div className=\"col-span-4\">\n                              <Input\n                                value={item.composer}\n                                onChange={(e) => updateComposer(index, e.target.value)}\n                                placeholder=\"Composer name\"\n                              />\n                            </div>\n                            <div className=\"col-span-4\">\n                              <Input\n                                value={item.publisher}\n                                onChange={(e) => updatePublisher(index, e.target.value)}\n                                placeholder=\"Publisher name\"\n                              />\n                            </div>\n                            <div className=\"col-span-2\">\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                max=\"100\"\n                                step=\"0.01\"\n                                value={item.publishingOwnership}\n                                onChange={(e) => updatePublishingOwnership(index, e.target.value)}\n                                placeholder=\"0.00\"\n                              />\n                            </div>\n                            <div className=\"col-span-1 flex justify-center items-center\">\n                              <Checkbox\n                                checked={item.isMine}\n                                onCheckedChange={(checked: boolean | string) => updateComposerIsMine(index, Boolean(checked))}\n                              />\n                            </div>\n                            <div className=\"col-span-1 flex justify-center\">\n                              {composerPublishers.length > 1 && (\n                                <Button\n                                  type=\"button\"\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => removeComposerPublisher(index)}\n                                  className=\"h-10 px-3 flex-shrink-0\"\n                                >\n                                  <X className=\"h-4 w-4\" />\n                                </Button>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"splitDetails\">Split Details</Label>\n                      <Textarea\n                        id=\"splitDetails\"\n                        {...form.register(\"splitDetails\")}\n                        placeholder=\"Detailed breakdown of all ownership splits and agreements\"\n                        rows={3}\n                      />\n                      <p className=\"text-xs text-green-600 mt-1\">Include detailed information about all parties' ownership shares and agreements</p>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                {/* Part 3: Label Information - Blue */}\n                <Card className=\"bg-blue-50 border-blue-200\">\n                  <CardHeader className=\"bg-blue-100 border-b border-blue-200\">\n                    <CardTitle className=\"text-blue-800\">Label Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4 bg-blue-50\">\n                    <div>\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <Label className=\"text-base font-semibold\">Artist(s), Label(s) & Ownership</Label>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={addArtistLabel}\n                          className=\"h-6 px-2\"\n                        >\n                          <Plus className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <div className=\"space-y-3\">\n                        <div className=\"grid grid-cols-12 gap-2 text-sm font-medium text-blue-700\">\n                          <div className=\"col-span-4\">Artist Name</div>\n                          <div className=\"col-span-4\">Label</div>\n                          <div className=\"col-span-2\">Ownership (%)</div>\n                          <div className=\"col-span-1\">Jonas</div>\n                          <div className=\"col-span-1\">Actions</div>\n                        </div>\n                        {artistLabels.map((item, index) => (\n                          <div key={index} className=\"grid grid-cols-12 gap-2\">\n                            <div className=\"col-span-4\">\n                              <Input\n                                value={item.artist}\n                                onChange={(e) => updateArtist(index, e.target.value)}\n                                placeholder=\"Artist name\"\n                              />\n                            </div>\n                            <div className=\"col-span-4\">\n                              <Input\n                                value={item.label}\n                                onChange={(e) => updateLabel(index, e.target.value)}\n                                placeholder=\"Label name\"\n                              />\n                            </div>\n                            <div className=\"col-span-2\">\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                max=\"100\"\n                                step=\"0.01\"\n                                value={item.labelOwnership}\n                                onChange={(e) => updateLabelOwnership(index, e.target.value)}\n                                placeholder=\"0.00\"\n                              />\n                            </div>\n                            <div className=\"col-span-1 flex justify-center items-center\">\n                              <Checkbox\n                                checked={item.isMine}\n                                onCheckedChange={(checked: boolean | string) => updateArtistIsMine(index, Boolean(checked))}\n                              />\n                            </div>\n                            <div className=\"col-span-1 flex justify-center\">\n                              {artistLabels.length > 1 && (\n                                <Button\n                                  type=\"button\"\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => removeArtistLabel(index)}\n                                  className=\"h-10 px-3 flex-shrink-0\"\n                                >\n                                  <X className=\"h-4 w-4\" />\n                                </Button>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                  </CardContent>\n                </Card>\n                \n                {/* Part 4: Restrictions - Yellow */}\n                <Card className=\"bg-yellow-50 border-yellow-200\">\n                  <CardHeader className=\"bg-yellow-100 border-b border-yellow-200\">\n                    <CardTitle className=\"text-yellow-800\">Restrictions</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4 bg-yellow-50\">\n                    <div>\n                      <Label htmlFor=\"restrictions\">Usage Restrictions</Label>\n                      <Textarea\n                        id=\"restrictions\"\n                        {...form.register(\"restrictions\")}\n                        placeholder=\"Any usage restrictions, limitations, or special licensing requirements for this song\"\n                        rows={3}\n                      />\n                      <p className=\"text-xs text-yellow-600 mt-1\">Include any restrictions on territory, media, exclusivity, or other licensing limitations</p>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"metadata\" className=\"space-y-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Metadata & Identifiers</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"irc\">IRC</Label>\n                        <Input\n                          id=\"irc\"\n                          {...form.register(\"irc\")}\n                          placeholder=\"International Recording Code\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"isrc\">ISRC</Label>\n                        <Input\n                          id=\"isrc\"\n                          {...form.register(\"isrc\")}\n                          placeholder=\"International Standard Recording Code\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"upcEan\">UPC/EAN</Label>\n                        <Input\n                          id=\"upcEan\"\n                          {...form.register(\"upcEan\")}\n                          placeholder=\"UPC/EAN barcode\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"pNumbers\">(P) Number(s)</Label>\n                        <Input\n                          id=\"pNumbers\"\n                          {...form.register(\"pNumbers\")}\n                          placeholder=\"P-line information\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"proCueSheetId\">PRO Cue Sheet ID</Label>\n                        <Input\n                          id=\"proCueSheetId\"\n                          {...form.register(\"proCueSheetId\")}\n                          placeholder=\"PRO cue sheet identifier\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"version\">Version</Label>\n                        <Input\n                          id=\"version\"\n                          {...form.register(\"version\")}\n                          placeholder=\"Version (e.g., Radio Edit, Extended)\"\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"rights\" className=\"space-y-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Rights & Representation</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 gap-4\">\n                      <div>\n                        <Label htmlFor=\"masterRightsContact\">Master Rights Contact</Label>\n                        <Input\n                          id=\"masterRightsContact\"\n                          {...form.register(\"masterRightsContact\")}\n                          placeholder=\"Master rights contact information\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"publishingRightsContact\">Publishing Rights Contact</Label>\n                        <Input\n                          id=\"publishingRightsContact\"\n                          {...form.register(\"publishingRightsContact\")}\n                          placeholder=\"Publishing rights contact information\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"syncRepresentation\">Sync Representation</Label>\n                        <Input\n                          id=\"syncRepresentation\"\n                          {...form.register(\"syncRepresentation\")}\n                          placeholder=\"Sync representation details\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"contentRepresented\">Content Represented</Label>\n                        <Input\n                          id=\"contentRepresented\"\n                          {...form.register(\"contentRepresented\")}\n                          placeholder=\"Content representation details\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"contentRepresentationCode\">Content Representation Code</Label>\n                        <Input\n                          id=\"contentRepresentationCode\"\n                          {...form.register(\"contentRepresentationCode\")}\n                          placeholder=\"Content representation code\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div className=\"border-t pt-4\">\n                      <h4 className=\"font-semibold text-lg mb-4\">Ownership Information</h4>\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"publishingOwnership\">Publishing Ownership (%)</Label>\n                          <Input\n                            id=\"publishingOwnership\"\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.01\"\n                            {...form.register(\"publishingOwnership\")}\n                            placeholder=\"e.g., 50.00\"\n                          />\n                          <p className=\"text-xs text-gray-600 mt-1\">Your publishing ownership percentage (0-100%)</p>\n                        </div>\n                        <div>\n                          <Label htmlFor=\"masterOwnership\">Master Recording Ownership (%)</Label>\n                          <Input\n                            id=\"masterOwnership\"\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.01\"\n                            {...form.register(\"masterOwnership\")}\n                            placeholder=\"e.g., 50.00\"\n                          />\n                          <p className=\"text-xs text-gray-600 mt-1\">Your master recording ownership percentage (0-100%)</p>\n                        </div>\n                      </div>\n                      <div className=\"mt-4\">\n                        <Label htmlFor=\"splitDetails\">Split Details</Label>\n                        <Textarea\n                          id=\"splitDetails\"\n                          {...form.register(\"splitDetails\")}\n                          placeholder=\"Detailed breakdown of all ownership splits and agreements\"\n                          rows={3}\n                        />\n                        <p className=\"text-xs text-gray-600 mt-1\">Include detailed information about all parties' ownership shares and agreements</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"technical\" className=\"space-y-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Technical Details</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"genreSubGenre\">Genre/Sub-Genre</Label>\n                        <Input\n                          id=\"genreSubGenre\"\n                          {...form.register(\"genreSubGenre\")}\n                          placeholder=\"Genre and sub-genre\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"moodTheme\">Mood/Theme</Label>\n                        <Input\n                          id=\"moodTheme\"\n                          {...form.register(\"moodTheme\")}\n                          placeholder=\"Mood and theme\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"bpmKey\">BPM / Key</Label>\n                        <Input\n                          id=\"bpmKey\"\n                          {...form.register(\"bpmKey\")}\n                          placeholder=\"BPM and key signature\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"vocalInstrumentation\">Vocal/Instrumentation</Label>\n                        <Input\n                          id=\"vocalInstrumentation\"\n                          {...form.register(\"vocalInstrumentation\")}\n                          placeholder=\"Vocal and instrumentation details\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"durationFormatted\">Duration</Label>\n                        <Input\n                          id=\"durationFormatted\"\n                          {...form.register(\"durationFormatted\")}\n                          placeholder=\"MM:SS format\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"fileTypeSampleRate\">File Type/Sample Rate</Label>\n                        <Input\n                          id=\"fileTypeSampleRate\"\n                          {...form.register(\"fileTypeSampleRate\")}\n                          placeholder=\"File format and sample rate\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Legacy numeric fields for compatibility */}\n                    <div className=\"grid grid-cols-3 gap-4 pt-4 border-t\">\n                      <div>\n                        <Label htmlFor=\"tempo\">Tempo</Label>\n                        <Input\n                          id=\"tempo\"\n                          type=\"number\"\n                          {...form.register(\"tempo\")}\n                          placeholder=\"e.g., 120\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"duration\">Duration (seconds)</Label>\n                        <Input\n                          id=\"duration\"\n                          type=\"number\"\n                          {...form.register(\"duration\")}\n                          placeholder=\"e.g., 180\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"bpm\">BPM</Label>\n                        <Input\n                          id=\"bpm\"\n                          type=\"number\"\n                          {...form.register(\"bpm\")}\n                          placeholder=\"e.g., 120\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-4 pt-4\">\n                      <div>\n                        <Label htmlFor=\"key\">Key</Label>\n                        <Input\n                          id=\"key\"\n                          {...form.register(\"key\")}\n                          placeholder=\"e.g., C Major, A Minor\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"tags\">Tags</Label>\n                        <Input\n                          id=\"tags\"\n                          {...form.register(\"tags.0\")}\n                          placeholder=\"Comma-separated tags\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"filePath\">File Path</Label>\n                      <Input\n                        id=\"filePath\"\n                        {...form.register(\"filePath\")}\n                        placeholder=\"File path or URL\"\n                      />\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <Switch\n                        id=\"explicitContent\"\n                        checked={form.watch(\"explicitContent\") || false}\n                        onCheckedChange={(checked) => form.setValue(\"explicitContent\", !!checked)}\n                      />\n                      <Label htmlFor=\"explicitContent\">Explicit Content</Label>\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"content\" className=\"space-y-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Content & Artwork</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"lyrics\">Lyrics</Label>\n                      <Textarea\n                        id=\"lyrics\"\n                        {...form.register(\"lyrics\")}\n                        placeholder=\"Song lyrics\"\n                        rows={6}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"coverArtDescription\">Cover Art Description</Label>\n                      <Textarea\n                        id=\"coverArtDescription\"\n                        {...form.register(\"coverArtDescription\")}\n                        placeholder=\"Description of cover art\"\n                        rows={3}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"smartLinkQrCode\">Smart Link / QR Code</Label>\n                      <Input\n                        id=\"smartLinkQrCode\"\n                        {...form.register(\"smartLinkQrCode\")}\n                        placeholder=\"Smart link or QR code URL\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"description\">Description</Label>\n                      <Textarea\n                        id=\"description\"\n                        {...form.register(\"description\")}\n                        placeholder=\"General description of the song\"\n                        rows={4}\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </div>\n\n            <div className=\"flex justify-end space-x-2 pt-4 border-t\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={createSongMutation.isPending}>\n                {createSongMutation.isPending ? \"Saving...\" : isEditing ? \"Update Song\" : \"Add Song\"}\n              </Button>\n            </div>\n          </Tabs>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":47422},"client/src/components/forms/add-email-template-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { insertEmailTemplateSchema, type InsertEmailTemplate, type EmailTemplate } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AddEmailTemplateFormProps {\n  open: boolean;\n  onClose: () => void;\n  template?: EmailTemplate | null;\n}\n\nconst stages = [\n  { value: \"initial_pitch\", label: \"Initial Pitch\" },\n  { value: \"follow_up\", label: \"Follow Up\" },\n  { value: \"negotiation\", label: \"Negotiation\" },\n  { value: \"contract_sent\", label: \"Contract Sent\" },\n  { value: \"deal_confirmed\", label: \"Deal Confirmed\" },\n  { value: \"payment_reminder\", label: \"Payment Reminder\" },\n  { value: \"thank_you\", label: \"Thank You\" },\n];\n\nexport default function AddEmailTemplateForm({ open, onClose, template }: AddEmailTemplateFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [variables, setVariables] = useState<string[]>([]);\n  const isEditing = !!template;\n\n  const form = useForm<InsertEmailTemplate>({\n    resolver: zodResolver(insertEmailTemplateSchema),\n    defaultValues: {\n      name: \"\",\n      stage: \"\",\n      subject: \"\",\n      body: \"\",\n      variables: [],\n    },\n  });\n\n  useEffect(() => {\n    if (template) {\n      form.reset({\n        name: template.name,\n        stage: template.stage,\n        subject: template.subject,\n        body: template.body,\n        variables: template.variables || [],\n      });\n      if (Array.isArray(template.variables)) {\n        setVariables(template.variables.map(v => typeof v === 'string' ? v : v.name));\n      }\n    } else {\n      form.reset({\n        name: \"\",\n        stage: \"\",\n        subject: \"\",\n        body: \"\",\n        variables: [],\n      });\n      setVariables([]);\n    }\n  }, [template, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertEmailTemplate) => {\n      const url = isEditing ? `/api/email-templates/${template.id}` : \"/api/email-templates\";\n      const method = isEditing ? \"PUT\" : \"POST\";\n      return await apiRequest(url, {\n        method,\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/email-templates\"] });\n      toast({\n        title: isEditing ? \"Email template updated\" : \"Email template created\",\n        description: isEditing \n          ? \"The email template has been successfully updated.\"\n          : \"The email template has been successfully created.\",\n      });\n      onClose();\n      form.reset();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: `Failed to ${isEditing ? 'update' : 'create'} email template. Please try again.`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertEmailTemplate) => {\n    mutation.mutate({\n      ...data,\n      variables: variables.map(v => ({ name: v, description: `Variable for ${v}` })),\n    });\n  };\n\n  const extractVariables = (text: string) => {\n    const matches = text.match(/\\{\\{(\\w+)\\}\\}/g);\n    if (matches) {\n      const vars = matches.map(match => match.replace(/[{}]/g, ''));\n      setVariables(Array.from(new Set(vars)));\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? 'Edit Email Template' : 'Add Email Template'}</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Name</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Template name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"stage\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Stage</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select stage\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {stages.map((stage) => (\n                        <SelectItem key={stage.value} value={stage.value}>\n                          {stage.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"subject\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Subject</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"Email subject (use {{variable}} for placeholders)\"\n                      {...field}\n                      onChange={(e) => {\n                        field.onChange(e);\n                        extractVariables(e.target.value);\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"body\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Body</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Email body (use {{variable}} for placeholders like {{clientName}}, {{songTitle}})\"\n                      className=\"min-h-[120px]\"\n                      {...field}\n                      onChange={(e) => {\n                        field.onChange(e);\n                        extractVariables(e.target.value + form.getValues(\"subject\"));\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {variables.length > 0 && (\n              <div className=\"text-sm text-muted-foreground\">\n                <p>Detected variables: {variables.join(\", \")}</p>\n              </div>\n            )}\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending}>\n                {mutation.isPending \n                  ? (isEditing ? \"Updating...\" : \"Creating...\")\n                  : (isEditing ? \"Update Template\" : \"Create Template\")\n                }\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":7828},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/forms/add-template-form.tsx":{"content":"import { useRef, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertTemplateSchema, type InsertTemplate, type Template } from \"@shared/schema\";\n\ninterface AddTemplateFormProps {\n  open: boolean;\n  onClose: () => void;\n  template?: Template | null;\n}\n\nconst placeholders = [\n  { category: \"Project Details\", items: [\n    { name: \"productionCompany\", label: \"Production Company\" },\n    { name: \"projectName\", label: \"Project Name\" },\n    { name: \"projectType\", label: \"Project Type\" },\n    { name: \"episodeNumber\", label: \"Episode Number\" },\n    { name: \"airDate\", label: \"Air Date\" },\n    { name: \"synopsis\", label: \"Synopsis\" },\n  ]},\n  { category: \"Song Information\", items: [\n    { name: \"songTitle\", label: \"Song Title\" },\n    { name: \"artist\", label: \"Artist\" },\n    { name: \"composer\", label: \"Composer\" },\n    { name: \"label\", label: \"Record Label\" },\n    { name: \"writersPublishing\", label: \"Writers/Publishing\" },\n  ]},\n  { category: \"Usage Details\", items: [\n    { name: \"useTiming\", label: \"Use/Timing\" },\n    { name: \"sceneDescription\", label: \"Scene Description\" },\n    { name: \"media\", label: \"Media Rights\" },\n  ]},\n  { category: \"Deal Terms\", items: [\n    { name: \"term\", label: \"Term\" },\n    { name: \"territory\", label: \"Territory\" },\n    { name: \"fee\", label: \"Fee\" },\n    { name: \"feePerSide\", label: \"Fee Per Side\" },\n    { name: \"fullSongValue\", label: \"Full Song Value\" },\n    { name: \"ourFee\", label: \"Our Fee\" },\n    { name: \"fullRecordingFee\", label: \"Full Recording Fee\" },\n    { name: \"ourRecordingFee\", label: \"Our Recording Fee\" },\n    { name: \"dealValue\", label: \"Deal Value\" },\n  ]},\n  { category: \"Contact Information\", items: [\n    { name: \"clientName\", label: \"Client Name\" },\n    { name: \"contactName\", label: \"Contact Name\" },\n    { name: \"contactEmail\", label: \"Contact Email\" },\n    { name: \"musicSupervisorName\", label: \"Music Supervisor\" },\n    { name: \"licenseeCompanyName\", label: \"Licensee Company\" },\n  ]},\n  { category: \"Dates\", items: [\n    { name: \"quotedDate\", label: \"Quoted Date\" },\n    { name: \"dueDate\", label: \"Due Date\" },\n    { name: \"deadline\", label: \"Deadline\" },\n  ]},\n];\n\nexport default function AddTemplateForm({ open, onClose, template }: AddTemplateFormProps) {\n  const { toast } = useToast();\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const isEditing = !!template;\n  \n  const form = useForm<InsertTemplate>({\n    resolver: zodResolver(insertTemplateSchema),\n    defaultValues: {\n      name: \"\",\n      type: \"\",\n      content: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (template) {\n      form.reset({\n        name: template.name,\n        type: template.type,\n        content: template.content,\n      });\n    } else {\n      form.reset({\n        name: \"\",\n        type: \"\",\n        content: \"\",\n      });\n    }\n  }, [template, form]);\n\n  const createTemplateMutation = useMutation({\n    mutationFn: async (data: InsertTemplate) => {\n      const url = isEditing ? `/api/templates/${template.id}` : \"/api/templates\";\n      const method = isEditing ? \"PUT\" : \"POST\";\n      return await apiRequest(url, {\n        method,\n        body: data,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: isEditing ? \"Template updated successfully\" : \"Template added successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      form.reset();\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: isEditing ? \"Failed to update template\" : \"Failed to add template\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTemplate) => {\n    createTemplateMutation.mutate(data);\n  };\n\n  const insertPlaceholder = (placeholderName: string) => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const placeholder = `{{${placeholderName}}}`;\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const currentValue = form.getValues(\"content\") || \"\";\n    \n    const newValue = currentValue.substring(0, start) + placeholder + currentValue.substring(end);\n    \n    form.setValue(\"content\", newValue, { shouldValidate: true });\n    \n    setTimeout(() => {\n      textarea.focus();\n      const newCursorPos = start + placeholder.length;\n      textarea.setSelectionRange(newCursorPos, newCursorPos);\n    }, 0);\n  };\n\n  const templateTypes = [\n    { value: \"contract\", label: \"Contract\" },\n    { value: \"quote\", label: \"Quote\" },\n    { value: \"invoice\", label: \"Invoice\" },\n    { value: \"license\", label: \"License Agreement\" },\n    { value: \"approval_request\", label: \"Approval Request\" },\n    { value: \"other\", label: \"Other\" },\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? 'Edit Template' : 'Add New Template'}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"name\">Template Name *</Label>\n              <Input\n                id=\"name\"\n                {...form.register(\"name\")}\n                placeholder=\"Enter template name\"\n              />\n              {form.formState.errors.name && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.name.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"type\">Type *</Label>\n              <Select \n                value={form.watch(\"type\")}\n                onValueChange={(value) => form.setValue(\"type\", value)}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select template type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {templateTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      {type.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {form.formState.errors.type && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.type.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"content\">Template Content *</Label>\n            <Textarea\n              id=\"content\"\n              ref={textareaRef}\n              value={form.watch(\"content\")}\n              onChange={(e) => form.setValue(\"content\", e.target.value)}\n              placeholder=\"Enter template content with placeholders. Click or drag placeholders below to insert them.\"\n              rows={12}\n              className=\"font-mono text-sm\"\n              onDrop={(e) => {\n                e.preventDefault();\n                const placeholder = e.dataTransfer.getData(\"text/plain\");\n                const textarea = textareaRef.current;\n                if (!textarea) return;\n                \n                const start = textarea.selectionStart;\n                const end = textarea.selectionEnd;\n                const currentValue = form.getValues(\"content\") || \"\";\n                \n                const newValue = currentValue.substring(0, start) + placeholder + currentValue.substring(end);\n                form.setValue(\"content\", newValue, { shouldValidate: true });\n                \n                setTimeout(() => {\n                  textarea.focus();\n                  const newCursorPos = start + placeholder.length;\n                  textarea.setSelectionRange(newCursorPos, newCursorPos);\n                }, 0);\n              }}\n              onDragOver={(e) => e.preventDefault()}\n            />\n            {form.formState.errors.content && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.content.message}</p>\n            )}\n          </div>\n\n          <div className=\"bg-gradient-to-br from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200\">\n            <h4 className=\"font-medium text-gray-900 mb-3 flex items-center gap-2\">\n              <span className=\"text-purple-600\"></span>\n              Available Placeholders:\n              <span className=\"text-xs text-gray-500 font-normal\">(Click to insert)</span>\n            </h4>\n            <div className=\"grid grid-cols-2 gap-4 max-h-64 overflow-y-auto\">\n              {placeholders.map((category) => (\n                <div key={category.category}>\n                  <h5 className=\"text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide\">\n                    {category.category}\n                  </h5>\n                  <div className=\"flex flex-wrap gap-1.5\">\n                    {category.items.map((item) => (\n                      <Badge\n                        key={item.name}\n                        variant=\"outline\"\n                        className=\"cursor-pointer hover:bg-purple-100 hover:border-purple-300 transition-colors text-xs\"\n                        onClick={() => insertPlaceholder(item.name)}\n                        data-testid={`placeholder-${item.name}`}\n                        draggable\n                        onDragStart={(e) => {\n                          e.dataTransfer.setData(\"text/plain\", `{{${item.name}}}`);\n                        }}\n                      >\n                        {`{{${item.name}}}`}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createTemplateMutation.isPending}\n            >\n              {createTemplateMutation.isPending \n                ? (isEditing ? \"Updating...\" : \"Adding...\")\n                : (isEditing ? \"Update Template\" : \"Add Template\")\n              }\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":10995},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"server/openai.ts":{"content":"import OpenAI from \"openai\";\n\n// the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nexport interface SyncAnalysis {\n  suitability: number; // 1-10 score\n  reasoning: string;\n  sceneMatches: string[];\n  emotionalTones: string[];\n  narrativeElements: string[];\n  recommendedUsage: string[];\n  targetDemographics: string[];\n  similarReferences: string[];\n  themes: string[]; // Christmas, Mother's Day, Siblings, etc.\n  seasonality: string[]; // Holiday, Summer, Back-to-school, etc.\n  occasions: string[]; // Wedding, Graduation, Birthday, etc.\n}\n\nexport interface PitchRecommendation {\n  songId: number;\n  songTitle: string;\n  matchScore: number;\n  analysis: SyncAnalysis;\n}\n\nexport async function analyzeForSync(\n  songData: {\n    title: string;\n    artist: string;\n    lyrics?: string;\n    genre?: string;\n    mood?: string;\n    tempo?: number;\n    key?: string;\n    energy?: string;\n    instrumentalDescription?: string;\n  },\n  projectBrief: {\n    title: string;\n    description: string;\n    targetAudience?: string;\n    projectType: string; // TV, Film, Commercial, Game, etc.\n    sceneDescription?: string;\n    desiredMood?: string;\n    targetDemographics?: string;\n  }\n): Promise<SyncAnalysis> {\n  try {\n    const prompt = `\nYou are a music sync licensing expert. Analyze how well this song matches the project brief for sync licensing.\n\nSONG DETAILS:\n- Title: ${songData.title}\n- Artist: ${songData.artist}\n- Genre: ${songData.genre || 'Not specified'}\n- Mood: ${songData.mood || 'Not specified'}\n- Tempo: ${songData.tempo || 'Not specified'} BPM\n- Key: ${songData.key || 'Not specified'}\n- Energy: ${songData.energy || 'Not specified'}\n- Instrumental Description: ${songData.instrumentalDescription || 'Not specified'}\n- Lyrics: ${songData.lyrics || 'Instrumental/No lyrics provided'}\n\nPROJECT BRIEF:\n- Project: ${projectBrief.title}\n- Type: ${projectBrief.projectType}\n- Description: ${projectBrief.description}\n- Scene Description: ${projectBrief.sceneDescription || 'Not specified'}\n- Target Audience: ${projectBrief.targetAudience || 'Not specified'}\n- Desired Mood: ${projectBrief.desiredMood || 'Not specified'}\n- Target Demographics: ${projectBrief.targetDemographics || 'Not specified'}\n\nPlease provide a comprehensive sync analysis in JSON format with the following structure:\n{\n  \"suitability\": <number 1-10>,\n  \"reasoning\": \"<detailed explanation of why this song fits or doesn't fit>\",\n  \"sceneMatches\": [\"<specific scenes this would work well in>\"],\n  \"emotionalTones\": [\"<emotions this song evokes>\"],\n  \"narrativeElements\": [\"<story elements the song supports>\"],\n  \"recommendedUsage\": [\"<how to use this song (background, montage, credits, etc.)>\"],\n  \"targetDemographics\": [\"<which demographics this appeals to>\"],\n  \"similarReferences\": [\"<similar songs or artists that have worked in sync>\"],\n  \"themes\": [\"<specific themes like Christmas, Mother's Day, Siblings, Family, Romance, etc.>\"],\n  \"seasonality\": [\"<seasonal relevance like Holiday, Summer, Back-to-school, Spring, etc.>\"],\n  \"occasions\": [\"<special occasions like Wedding, Graduation, Birthday, Anniversary, etc.>\"]\n}\n\nFocus on:\n- Lyrical content and themes (including specific themes like Christmas, Mother's Day, Siblings, Family, Romance, Friendship, etc.)\n- Musical characteristics (tempo, energy, instrumentation)\n- Emotional impact and mood\n- Scene compatibility\n- Audience appeal\n- Industry trends and successful sync examples\n- Seasonal relevance (Holiday, Summer, Back-to-school, Spring, etc.)\n- Special occasions (Wedding, Graduation, Birthday, Anniversary, etc.)\n- Universal themes vs. niche appeal\n`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are an expert music supervisor with 20+ years of experience in sync licensing. Provide detailed, actionable analysis for sync opportunities.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.7\n    });\n\n    const analysis = JSON.parse(response.choices[0].message.content || '{}');\n    \n    return {\n      suitability: analysis.suitability || 0,\n      reasoning: analysis.reasoning || '',\n      sceneMatches: analysis.sceneMatches || [],\n      emotionalTones: analysis.emotionalTones || [],\n      narrativeElements: analysis.narrativeElements || [],\n      recommendedUsage: analysis.recommendedUsage || [],\n      targetDemographics: analysis.targetDemographics || [],\n      similarReferences: analysis.similarReferences || [],\n      themes: analysis.themes || [],\n      seasonality: analysis.seasonality || [],\n      occasions: analysis.occasions || []\n    };\n\n  } catch (error) {\n    console.error('Error analyzing sync potential:', error);\n    throw new Error('Failed to analyze sync potential: ' + (error as Error).message);\n  }\n}\n\nexport async function generatePitchRecommendations(\n  songs: Array<{\n    id: number;\n    title: string;\n    artist: string;\n    lyrics?: string;\n    genre?: string;\n    mood?: string;\n    tempo?: number;\n    key?: string;\n    energy?: string;\n    instrumentalDescription?: string;\n  }>,\n  projectBrief: {\n    title: string;\n    description: string;\n    targetAudience?: string;\n    projectType: string;\n    sceneDescription?: string;\n    desiredMood?: string;\n    targetDemographics?: string;\n  }\n): Promise<PitchRecommendation[]> {\n  const recommendations: PitchRecommendation[] = [];\n\n  for (const song of songs) {\n    try {\n      const analysis = await analyzeForSync(song, projectBrief);\n      \n      recommendations.push({\n        songId: song.id,\n        songTitle: song.title,\n        matchScore: analysis.suitability,\n        analysis\n      });\n    } catch (error) {\n      console.error(`Error analyzing song ${song.title}:`, error);\n      // Continue with other songs even if one fails\n    }\n  }\n\n  // Sort by match score (highest first)\n  return recommendations.sort((a, b) => b.matchScore - a.matchScore);\n}\n\nexport async function analyzeLyrics(lyrics: string): Promise<{\n  themes: string[];\n  emotions: string[];\n  narrative: string;\n  marketability: number;\n  syncPotential: string[];\n}> {\n  try {\n    const prompt = `\nAnalyze these song lyrics for sync licensing potential:\n\nLYRICS:\n${lyrics}\n\nPlease provide analysis in JSON format:\n{\n  \"themes\": [\"<main themes in the lyrics>\"],\n  \"emotions\": [\"<emotional tones present>\"],\n  \"narrative\": \"<brief description of the story/narrative>\",\n  \"marketability\": <number 1-10 for commercial appeal>,\n  \"syncPotential\": [\"<types of media/scenes this would work well in>\"]\n}\n\nFocus on:\n- Commercial viability\n- Emotional resonance\n- Narrative coherence\n- Brand safety\n- Universal vs. niche appeal\n`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a music industry expert specializing in sync licensing and commercial music placement.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.7\n    });\n\n    const analysis = JSON.parse(response.choices[0].message.content || '{}');\n    \n    return {\n      themes: analysis.themes || [],\n      emotions: analysis.emotions || [],\n      narrative: analysis.narrative || '',\n      marketability: analysis.marketability || 0,\n      syncPotential: analysis.syncPotential || []\n    };\n\n  } catch (error) {\n    console.error('Error analyzing lyrics:', error);\n    throw new Error('Failed to analyze lyrics: ' + (error as Error).message);\n  }\n}\n\nexport async function generateContractFromTemplate(\n  dealData: {\n    songTitle: string;\n    artist: string;\n    licenseType: string;\n    territory: string;\n    term: string;\n    fee: number;\n    usage: string;\n    clientName: string;\n    projectTitle: string;\n  },\n  templateType: string = 'standard'\n): Promise<string> {\n  try {\n    const prompt = `\nGenerate a professional sync licensing contract based on this information:\n\nDEAL DETAILS:\n- Song: \"${dealData.songTitle}\" by ${dealData.artist}\n- License Type: ${dealData.licenseType}\n- Territory: ${dealData.territory}\n- Term: ${dealData.term}\n- Fee: $${dealData.fee}\n- Usage: ${dealData.usage}\n- Client: ${dealData.clientName}\n- Project: ${dealData.projectTitle}\n- Template Type: ${templateType}\n\nGenerate a comprehensive sync licensing agreement that includes:\n- Parties and definitions\n- Grant of rights\n- Territory and term\n- Compensation\n- Usage restrictions\n- Delivery requirements\n- Warranties and representations\n- Termination clauses\n\nMake it professional and industry-standard while being clear and readable.\n`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a music industry lawyer specializing in sync licensing contracts. Generate professional, legally sound agreements.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      temperature: 0.3 // Lower temperature for more consistent legal language\n    });\n\n    return response.choices[0].message.content || '';\n\n  } catch (error) {\n    console.error('Error generating contract:', error);\n    throw new Error('Failed to generate contract: ' + (error as Error).message);\n  }\n}","size_bytes":9563},"client/src/components/forms/add-payment-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertPaymentSchema, type InsertPayment, type DealWithRelations } from \"@shared/schema\";\n\ninterface AddPaymentFormProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport default function AddPaymentForm({ open, onClose }: AddPaymentFormProps) {\n  const { toast } = useToast();\n  \n  const form = useForm<InsertPayment>({\n    resolver: zodResolver(insertPaymentSchema),\n    defaultValues: {\n      dealId: 0,\n      amount: \"\",\n      dueDate: new Date(),\n      paidDate: undefined,\n      status: \"pending\",\n      notes: \"\",\n    },\n  });\n\n  const { data: deals = [] } = useQuery<DealWithRelations[]>({\n    queryKey: [\"/api/deals\"],\n  });\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: InsertPayment) => {\n      const response = await apiRequest(\"POST\", \"/api/payments\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Payment added successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      form.reset();\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertPayment) => {\n    createPaymentMutation.mutate({\n      ...data,\n      dueDate: new Date(data.dueDate),\n      paidDate: data.paidDate ? new Date(data.paidDate) : undefined,\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader>\n          <DialogTitle>Add New Payment</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"dealId\">Deal *</Label>\n            <Select onValueChange={(value) => form.setValue(\"dealId\", parseInt(value))}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select a deal\" />\n              </SelectTrigger>\n              <SelectContent>\n                {deals.map((deal) => (\n                  <SelectItem key={deal.id} value={deal.id.toString()}>\n                    {deal.projectName} - ${deal.dealValue ? Number(deal.dealValue).toLocaleString() : \"TBD\"}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label htmlFor=\"amount\">Amount *</Label>\n            <Input\n              id=\"amount\"\n              type=\"number\"\n              step=\"0.01\"\n              {...form.register(\"amount\")}\n              placeholder=\"Enter payment amount\"\n            />\n            {form.formState.errors.amount && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.amount.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"dueDate\">Due Date *</Label>\n            <Input\n              id=\"dueDate\"\n              type=\"date\"\n              {...form.register(\"dueDate\")}\n            />\n            {form.formState.errors.dueDate && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.dueDate.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"status\">Status</Label>\n            <Select onValueChange={(value) => form.setValue(\"status\", value)}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n                <SelectItem value=\"paid\">Paid</SelectItem>\n                <SelectItem value=\"overdue\">Overdue</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label htmlFor=\"paidDate\">Paid Date</Label>\n            <Input\n              id=\"paidDate\"\n              type=\"date\"\n              {...form.register(\"paidDate\")}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"notes\">Notes</Label>\n            <Textarea\n              id=\"notes\"\n              {...form.register(\"notes\")}\n              placeholder=\"Enter any additional notes\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createPaymentMutation.isPending}\n            >\n              {createPaymentMutation.isPending ? \"Adding...\" : \"Add Payment\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":5591},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line } from \"recharts\";\nimport { ChartBar, Download, Calendar, TrendingUp, DollarSign } from \"lucide-react\";\nimport type { DashboardMetrics, DealWithRelations } from \"@shared/schema\";\n\nexport default function Reports() {\n  const [dateRange, setDateRange] = useState(\"last-30-days\");\n  const [reportType, setReportType] = useState(\"overview\");\n\n  const { data: metrics, isLoading: metricsLoading } = useQuery<DashboardMetrics>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  const { data: deals = [], isLoading: dealsLoading } = useQuery<DealWithRelations[]>({\n    queryKey: [\"/api/deals\"],\n  });\n\n  const isLoading = metricsLoading || dealsLoading;\n\n  // Process data for charts\n  const dealsByStatusData = metrics?.dealsByStatus ? Object.entries(metrics.dealsByStatus).map(([status, count]) => ({\n    name: status.replace(\"_\", \" \").replace(/\\b\\w/g, l => l.toUpperCase()),\n    value: count\n  })) : [];\n\n  const revenueByMonthData = [\n    { month: \"Jan\", revenue: 45000, deals: 12 },\n    { month: \"Feb\", revenue: 52000, deals: 15 },\n    { month: \"Mar\", revenue: 48000, deals: 11 },\n    { month: \"Apr\", revenue: 61000, deals: 18 },\n    { month: \"May\", revenue: 55000, deals: 14 },\n    { month: \"Jun\", revenue: 67000, deals: 20 },\n  ];\n\n  const topProjectTypes = deals.reduce((acc, deal) => {\n    acc[deal.projectType] = (acc[deal.projectType] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const projectTypeData = Object.entries(topProjectTypes).map(([type, count]) => ({\n    name: type.charAt(0).toUpperCase() + type.slice(1),\n    value: count\n  }));\n\n  const COLORS = ['#2563EB', '#059669', '#7C3AED', '#EF4444', '#F59E0B'];\n\n  if (isLoading) {\n    return (\n      <div>\n        <Header\n          title=\"Reports\"\n          description=\"Analyze your sync licensing performance and revenue trends\"\n        />\n        <div className=\"p-6\">\n          <div className=\"flex items-center space-x-4 mb-6\">\n            <div className=\"h-10 bg-gray-200 rounded w-48 animate-pulse\"></div>\n            <div className=\"h-10 bg-gray-200 rounded w-48 animate-pulse\"></div>\n          </div>\n          <div className=\"grid gap-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              {[...Array(4)].map((_, i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"h-8 bg-gray-200 rounded w-3/4 mb-2\"></div>\n                    <div className=\"h-6 bg-gray-200 rounded w-1/2\"></div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {[...Array(4)].map((_, i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-6 bg-gray-200 rounded w-1/2\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"h-64 bg-gray-200 rounded\"></div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Reports\"\n        description=\"Analyze your sync licensing performance and revenue trends\"\n        searchPlaceholder=\"Search reports...\"\n        newItemLabel=\"Export Report\"\n        onNewItem={() => {}}\n        showSearch={false}\n      />\n      \n      <div className=\"p-6\">\n        {/* Filters */}\n        <div className=\"flex items-center space-x-4 mb-6\">\n          <div className=\"flex items-center space-x-2\">\n            <Calendar className=\"h-4 w-4 text-gray-500\" />\n            <Select value={dateRange} onValueChange={setDateRange}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"last-7-days\">Last 7 Days</SelectItem>\n                <SelectItem value=\"last-30-days\">Last 30 Days</SelectItem>\n                <SelectItem value=\"last-90-days\">Last 90 Days</SelectItem>\n                <SelectItem value=\"last-year\">Last Year</SelectItem>\n                <SelectItem value=\"all-time\">All Time</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <ChartBar className=\"h-4 w-4 text-gray-500\" />\n            <Select value={reportType} onValueChange={setReportType}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"overview\">Overview</SelectItem>\n                <SelectItem value=\"revenue\">Revenue Analysis</SelectItem>\n                <SelectItem value=\"deals\">Deal Performance</SelectItem>\n                <SelectItem value=\"contacts\">Contact Analysis</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <Button variant=\"outline\" className=\"ml-auto\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export PDF\n          </Button>\n        </div>\n\n        {/* Key Metrics Summary */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Total Revenue</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">${metrics?.totalRevenue.toLocaleString()}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n                  <DollarSign className=\"h-6 w-6 text-green-600\" />\n                </div>\n              </div>\n              <div className=\"mt-2 flex items-center text-sm\">\n                <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />\n                <span className=\"text-green-500 font-medium\">+12.5%</span>\n                <span className=\"text-gray-600 ml-1\">vs last period</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Active Deals</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{metrics?.activeDeals}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <ChartBar className=\"h-6 w-6 text-blue-600\" />\n                </div>\n              </div>\n              <div className=\"mt-2 flex items-center text-sm\">\n                <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />\n                <span className=\"text-green-500 font-medium\">+8.3%</span>\n                <span className=\"text-gray-600 ml-1\">vs last period</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Success Rate</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">73%</p>\n                </div>\n                <div className=\"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center\">\n                  <TrendingUp className=\"h-6 w-6 text-purple-600\" />\n                </div>\n              </div>\n              <div className=\"mt-2 flex items-center text-sm\">\n                <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />\n                <span className=\"text-green-500 font-medium\">+5.2%</span>\n                <span className=\"text-gray-600 ml-1\">vs last period</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Avg Deal Value</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">$4,250</p>\n                </div>\n                <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center\">\n                  <DollarSign className=\"h-6 w-6 text-orange-600\" />\n                </div>\n              </div>\n              <div className=\"mt-2 flex items-center text-sm\">\n                <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />\n                <span className=\"text-green-500 font-medium\">+15.7%</span>\n                <span className=\"text-gray-600 ml-1\">vs last period</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Charts */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          {/* Revenue Trend */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Revenue Trend</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <LineChart data={revenueByMonthData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"month\" />\n                  <YAxis />\n                  <Tooltip formatter={(value) => [`$${value.toLocaleString()}`, 'Revenue']} />\n                  <Line type=\"monotone\" dataKey=\"revenue\" stroke=\"#2563EB\" strokeWidth={2} />\n                </LineChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n\n          {/* Deal Status Distribution */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Deal Status Distribution</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <PieChart>\n                  <Pie\n                    data={dealsByStatusData}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                  >\n                    {dealsByStatusData.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip />\n                </PieChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Project Types */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Project Types</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={projectTypeData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" />\n                  <YAxis />\n                  <Tooltip />\n                  <Bar dataKey=\"value\" fill=\"#059669\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n\n          {/* Recent Performance */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Performance</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"font-medium\">Deals Closed This Month</p>\n                    <p className=\"text-sm text-gray-600\">Target: 15 deals</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-2xl font-bold text-green-600\">18</p>\n                    <Badge className=\"bg-green-100 text-green-800\">+20%</Badge>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"font-medium\">Average Response Time</p>\n                    <p className=\"text-sm text-gray-600\">Target: 5 days</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-2xl font-bold text-blue-600\">3.2</p>\n                    <Badge className=\"bg-blue-100 text-blue-800\">Excellent</Badge>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"font-medium\">Client Satisfaction</p>\n                    <p className=\"text-sm text-gray-600\">Based on feedback</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-2xl font-bold text-purple-600\">4.8</p>\n                    <Badge className=\"bg-purple-100 text-purple-800\">Outstanding</Badge>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":13952},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage as dbStorage } from \"./storage\";\nimport { \n  insertSongSchema, insertContactSchema, insertDealSchema,\n  insertPitchSchema, insertPaymentSchema, insertTemplateSchema,\n  insertEmailTemplateSchema, insertAttachmentSchema, insertCalendarEventSchema,\n  type InsertTemplate\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport * as XLSX from \"xlsx\";\n\n// Configure multer for file uploads\nconst multerStorage = multer.diskStorage({\n  destination: (req, file, cb) => {\n    const uploadDir = path.join(process.cwd(), 'uploads');\n    if (!fs.existsSync(uploadDir)) {\n      fs.mkdirSync(uploadDir, { recursive: true });\n    }\n    cb(null, uploadDir);\n  },\n  filename: (req, file, cb) => {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));\n  }\n});\n\nconst upload = multer({ \n  storage: multerStorage,\n  limits: { fileSize: 10 * 1024 * 1024 }, // 10MB limit\n  fileFilter: (req, file, cb) => {\n    // Allow most file types for sync licensing\n    const allowedTypes = /jpeg|jpg|png|gif|pdf|doc|docx|txt|mp3|wav|aiff|flac|m4a|zip|rar|xlsx|xls|csv/;\n    const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());\n    const mimetype = allowedTypes.test(file.mimetype) || file.mimetype === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || file.mimetype === 'application/vnd.ms-excel' || file.mimetype === 'text/csv';\n    \n    if (mimetype && extname) {\n      return cb(null, true);\n    } else {\n      cb(new Error('Invalid file type'));\n    }\n  }\n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Songs endpoints\n  app.get(\"/api/songs\", async (req, res) => {\n    try {\n      const { search, genre, limit } = req.query;\n      const songs = await dbStorage.getSongs(\n        search as string,\n        genre as string,\n        limit ? parseInt(limit as string) : undefined\n      );\n      res.json(songs);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch songs\" });\n    }\n  });\n\n  app.get(\"/api/songs/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const song = await dbStorage.getSong(id);\n      if (!song) {\n        return res.status(404).json({ error: \"Song not found\" });\n      }\n      res.json(song);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch song\" });\n    }\n  });\n\n  app.post(\"/api/songs\", async (req, res) => {\n    try {\n      const validatedData = insertSongSchema.parse(req.body);\n      const song = await dbStorage.createSong(validatedData);\n      res.json(song);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create song\" });\n    }\n  });\n\n  app.put(\"/api/songs/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertSongSchema.partial().parse(req.body);\n      const song = await dbStorage.updateSong(id, validatedData);\n      res.json(song);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update song\" });\n    }\n  });\n\n  app.delete(\"/api/songs/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteSong(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete song\" });\n    }\n  });\n\n  // Contacts endpoints\n  app.get(\"/api/contacts\", async (req, res) => {\n    try {\n      const { search, limit } = req.query;\n      const contacts = await dbStorage.getContacts(\n        search as string,\n        limit ? parseInt(limit as string) : undefined\n      );\n      res.json(contacts);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch contacts\" });\n    }\n  });\n\n  app.get(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const contact = await dbStorage.getContact(id);\n      if (!contact) {\n        return res.status(404).json({ error: \"Contact not found\" });\n      }\n      res.json(contact);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch contact\" });\n    }\n  });\n\n  app.post(\"/api/contacts\", async (req, res) => {\n    try {\n      const validatedData = insertContactSchema.parse(req.body);\n      const contact = await dbStorage.createContact(validatedData);\n      res.json(contact);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create contact\" });\n    }\n  });\n\n  app.put(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertContactSchema.partial().parse(req.body);\n      const contact = await dbStorage.updateContact(id, validatedData);\n      res.json(contact);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update contact\" });\n    }\n  });\n\n  app.delete(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteContact(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete contact\" });\n    }\n  });\n\n  // Deals endpoints\n  app.get(\"/api/deals\", async (req, res) => {\n    try {\n      const { status, limit } = req.query;\n      const deals = await dbStorage.getDeals(\n        status as string,\n        limit ? parseInt(limit as string) : undefined\n      );\n      res.json(deals);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch deals\" });\n    }\n  });\n\n  app.get(\"/api/deals/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deal = await dbStorage.getDeal(id);\n      if (!deal) {\n        return res.status(404).json({ error: \"Deal not found\" });\n      }\n      res.json(deal);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch deal\" });\n    }\n  });\n\n  app.post(\"/api/deals\", async (req, res) => {\n    try {\n      console.log('Received deal data:', req.body);\n      const validatedData = insertDealSchema.parse(req.body);\n      console.log('Validated data:', validatedData);\n      \n      // Convert date strings to Date objects for database insertion\n      const processedData = {\n        ...validatedData,\n        airDate: validatedData.airDate && validatedData.airDate !== '' ? new Date(validatedData.airDate) : null,\n        pitchDate: validatedData.pitchDate && validatedData.pitchDate !== '' ? new Date(validatedData.pitchDate) : null,\n        responseDate: validatedData.responseDate && validatedData.responseDate !== '' ? new Date(validatedData.responseDate) : null,\n        confirmationDate: validatedData.confirmationDate && validatedData.confirmationDate !== '' ? new Date(validatedData.confirmationDate) : null,\n        completionDate: validatedData.completionDate && validatedData.completionDate !== '' ? new Date(validatedData.completionDate) : null,\n        paymentDate: validatedData.paymentDate && validatedData.paymentDate !== '' ? new Date(validatedData.paymentDate) : null,\n        paymentDueDate: validatedData.paymentDueDate && validatedData.paymentDueDate !== '' ? new Date(validatedData.paymentDueDate) : null,\n        // Status change date fields\n        pitchedDate: validatedData.pitchedDate && validatedData.pitchedDate !== '' ? new Date(validatedData.pitchedDate) : null,\n        pendingApprovalDate: validatedData.pendingApprovalDate && validatedData.pendingApprovalDate !== '' ? new Date(validatedData.pendingApprovalDate) : null,\n        quotedDate: validatedData.quotedDate && validatedData.quotedDate !== '' ? new Date(validatedData.quotedDate) : null,\n        useConfirmedDate: validatedData.useConfirmedDate && validatedData.useConfirmedDate !== '' ? new Date(validatedData.useConfirmedDate) : null,\n        beingDraftedDate: validatedData.beingDraftedDate && validatedData.beingDraftedDate !== '' ? new Date(validatedData.beingDraftedDate) : null,\n        outForSignatureDate: validatedData.outForSignatureDate && validatedData.outForSignatureDate !== '' ? new Date(validatedData.outForSignatureDate) : null,\n        paymentReceivedDate: validatedData.paymentReceivedDate && validatedData.paymentReceivedDate !== '' ? new Date(validatedData.paymentReceivedDate) : null,\n        completedDate: validatedData.completedDate && validatedData.completedDate !== '' ? new Date(validatedData.completedDate) : null\n      };\n      \n      console.log('Processed data:', processedData);\n      const deal = await dbStorage.createDeal(processedData);\n      \n      res.json(deal);\n    } catch (error) {\n      console.error(\"Error creating deal:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create deal\", details: error.message });\n    }\n  });\n\n  app.put(\"/api/deals/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log(\"PUT /api/deals/:id - Updating deal:\", id);\n      console.log(\"Request body:\", req.body);\n      \n      // Now validate with the updated schema that accepts string dates\n      const validatedData = insertDealSchema.partial().parse(req.body);\n      console.log(\"Validated data:\", validatedData);\n      \n      const deal = await dbStorage.updateDeal(id, validatedData);\n      console.log(\"Updated deal:\", deal);\n      \n      res.json(deal);\n    } catch (error) {\n      console.error(\"Error updating deal:\", error);\n      if (error instanceof z.ZodError) {\n        console.error(\"Validation errors:\", error.errors);\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update deal\", details: error.message });\n    }\n  });\n\n  app.patch(\"/api/deals/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log(\"PATCH /api/deals/:id - Updating deal:\", id);\n      console.log(\"Request body:\", req.body);\n      \n      // Now validate with the updated schema that accepts string dates\n      const validatedData = insertDealSchema.partial().parse(req.body);\n      console.log(\"Validated data:\", validatedData);\n      \n      // Convert date strings to Date objects for database insertion (same as POST route)\n      const processedData = {\n        ...validatedData,\n        airDate: validatedData.airDate && validatedData.airDate !== '' ? new Date(validatedData.airDate) : null,\n        pitchDate: validatedData.pitchDate && validatedData.pitchDate !== '' ? new Date(validatedData.pitchDate) : null,\n        responseDate: validatedData.responseDate && validatedData.responseDate !== '' ? new Date(validatedData.responseDate) : null,\n        confirmationDate: validatedData.confirmationDate && validatedData.confirmationDate !== '' ? new Date(validatedData.confirmationDate) : null,\n        completionDate: validatedData.completionDate && validatedData.completionDate !== '' ? new Date(validatedData.completionDate) : null,\n        paymentDate: validatedData.paymentDate && validatedData.paymentDate !== '' ? new Date(validatedData.paymentDate) : null,\n        paymentDueDate: validatedData.paymentDueDate && validatedData.paymentDueDate !== '' ? new Date(validatedData.paymentDueDate) : null,\n        // Status change date fields\n        pitchedDate: validatedData.pitchedDate && validatedData.pitchedDate !== '' ? new Date(validatedData.pitchedDate) : null,\n        pendingApprovalDate: validatedData.pendingApprovalDate && validatedData.pendingApprovalDate !== '' ? new Date(validatedData.pendingApprovalDate) : null,\n        quotedDate: validatedData.quotedDate && validatedData.quotedDate !== '' ? new Date(validatedData.quotedDate) : null,\n        useConfirmedDate: validatedData.useConfirmedDate && validatedData.useConfirmedDate !== '' ? new Date(validatedData.useConfirmedDate) : null,\n        beingDraftedDate: validatedData.beingDraftedDate && validatedData.beingDraftedDate !== '' ? new Date(validatedData.beingDraftedDate) : null,\n        outForSignatureDate: validatedData.outForSignatureDate && validatedData.outForSignatureDate !== '' ? new Date(validatedData.outForSignatureDate) : null,\n        paymentReceivedDate: validatedData.paymentReceivedDate && validatedData.paymentReceivedDate !== '' ? new Date(validatedData.paymentReceivedDate) : null,\n        completedDate: validatedData.completedDate && validatedData.completedDate !== '' ? new Date(validatedData.completedDate) : null,\n      };\n      \n      const deal = await dbStorage.updateDeal(id, processedData);\n      console.log(\"Updated deal:\", deal);\n      \n      res.json(deal);\n    } catch (error) {\n      console.error(\"Error updating deal:\", error);\n      if (error instanceof z.ZodError) {\n        console.error(\"Validation errors:\", error.errors);\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update deal\", details: error.message });\n    }\n  });\n\n  app.delete(\"/api/deals/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteDeal(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete deal\" });\n    }\n  });\n\n  // Bulk import deals endpoints\n  app.post(\"/api/deals/import/parse\", upload.single('file'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No file uploaded\" });\n      }\n\n      const filePath = req.file.path;\n      const fileExtension = path.extname(req.file.originalname).toLowerCase();\n\n      let workbook;\n      if (fileExtension === '.csv') {\n        const fileContent = fs.readFileSync(filePath, 'utf8');\n        workbook = XLSX.read(fileContent, { type: 'string' });\n      } else {\n        workbook = XLSX.readFile(filePath);\n      }\n\n      const sheetName = workbook.SheetNames[0];\n      const worksheet = workbook.Sheets[sheetName];\n      const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });\n\n      // Get headers\n      const headers = jsonData.length > 0 ? Object.keys(jsonData[0]) : [];\n\n      // Clean up uploaded file\n      fs.unlinkSync(filePath);\n\n      res.json({\n        headers,\n        preview: jsonData.slice(0, 10), // First 10 rows for preview\n        data: jsonData, // Full dataset for import\n        totalRows: jsonData.length\n      });\n    } catch (error) {\n      console.error(\"Error parsing file:\", error);\n      if (req.file?.path) {\n        try {\n          fs.unlinkSync(req.file.path);\n        } catch (cleanupError) {\n          console.error(\"Error cleaning up file:\", cleanupError);\n        }\n      }\n      res.status(500).json({ error: \"Failed to parse file\", details: error.message });\n    }\n  });\n\n  app.post(\"/api/deals/import/create\", async (req, res) => {\n    try {\n      const { data, mapping, autoCreateSongs, autoCreateContacts } = req.body;\n\n      if (!data || !Array.isArray(data)) {\n        return res.status(400).json({ error: \"Invalid data format\" });\n      }\n\n      if (!mapping || typeof mapping !== 'object') {\n        return res.status(400).json({ error: \"Missing column mapping\" });\n      }\n\n      const results = {\n        created: 0,\n        failed: 0,\n        errors: [] as Array<{ row: number; error: string }>\n      };\n\n      for (let i = 0; i < data.length; i++) {\n        try {\n          const row = data[i];\n          \n          // Map columns to deal fields\n          const dealData: any = {\n            projectName: row[mapping.projectName] || 'Untitled Project',\n            projectType: row[mapping.projectType] || 'other',\n            songId: null,\n            contactId: null,\n            status: row[mapping.status] || 'new_request',\n            territory: row[mapping.territory] || 'worldwide',\n            exclusivity: row[mapping.exclusivity]?.toLowerCase() === 'exclusive' || row[mapping.exclusivity]?.toLowerCase() === 'true',\n            projectDescription: row[mapping.projectDescription] || null,\n            term: row[mapping.term] || null,\n            usage: row[mapping.usage] || null,\n            totalFee: row[mapping.totalFee] ? parseFloat(row[mapping.totalFee]) : null,\n            publishingFee: row[mapping.publishingFee] ? parseFloat(row[mapping.publishingFee]) : null,\n            recordingFee: row[mapping.recordingFee] ? parseFloat(row[mapping.recordingFee]) : null,\n            notes: row[mapping.notes] || null,\n            airDate: row[mapping.airDate] ? new Date(row[mapping.airDate]) : null\n          };\n\n          // Handle song - find existing or create new\n          if (mapping.songTitle && row[mapping.songTitle]) {\n            const songTitle = row[mapping.songTitle];\n            const songs = await dbStorage.getSongs(songTitle);\n            let song = songs.find(s => s.title.toLowerCase() === songTitle.toLowerCase());\n            \n            if (!song && autoCreateSongs) {\n              // Create new song\n              const songData: any = {\n                title: songTitle,\n                artist: row[mapping.songArtist] || 'Unknown Artist'\n              };\n              if (mapping.songComposer && row[mapping.songComposer]) {\n                songData.composer = row[mapping.songComposer];\n              }\n              if (mapping.songPublisher && row[mapping.songPublisher]) {\n                songData.publisher = row[mapping.songPublisher];\n              }\n              song = await dbStorage.createSong(songData);\n            }\n            \n            if (song) {\n              dealData.songId = song.id;\n            }\n          }\n\n          // Handle contact - find existing or create new\n          if (mapping.contactName && row[mapping.contactName]) {\n            const contactName = row[mapping.contactName];\n            const contacts = await dbStorage.getContacts(contactName);\n            let contact = contacts.find(c => c.name.toLowerCase() === contactName.toLowerCase());\n            \n            if (!contact && autoCreateContacts) {\n              // Create new contact\n              const contactData: any = {\n                name: contactName,\n                email: row[mapping.contactEmail] || null,\n                phone: row[mapping.contactPhone] || null,\n                company: row[mapping.contactCompany] || null\n              };\n              contact = await dbStorage.createContact(contactData);\n            }\n            \n            if (contact) {\n              dealData.contactId = contact.id;\n            }\n          }\n\n          // Create the deal\n          await dbStorage.createDeal(dealData);\n          results.created++;\n        } catch (error) {\n          results.failed++;\n          results.errors.push({\n            row: i + 1,\n            error: error instanceof Error ? error.message : 'Unknown error'\n          });\n        }\n      }\n\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error importing deals:\", error);\n      res.status(500).json({ error: \"Failed to import deals\", details: error.message });\n    }\n  });\n\n  // Pitches endpoints\n  app.get(\"/api/pitches\", async (req, res) => {\n    try {\n      const { dealId, limit } = req.query;\n      const pitches = await dbStorage.getPitches(\n        dealId ? parseInt(dealId as string) : undefined,\n        limit ? parseInt(limit as string) : undefined\n      );\n      res.json(pitches);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch pitches\" });\n    }\n  });\n\n  app.post(\"/api/pitches\", async (req, res) => {\n    try {\n      console.log(\"POST /api/pitches - Request body:\", req.body);\n      \n      // Manual validation and processing since submissionDate is auto-generated\n      const { dealId, customDealName, status, notes, followUpDate } = req.body;\n      \n      // Either dealId or customDealName must be provided\n      if (!dealId && !customDealName) {\n        return res.status(400).json({ error: \"Either dealId or customDealName is required\" });\n      }\n      \n      const processedData = {\n        dealId: dealId ? parseInt(dealId) : null,\n        customDealName: customDealName || null,\n        status: status || \"pending\",\n        notes: notes || \"\",\n        followUpDate: followUpDate ? new Date(followUpDate) : null,\n      };\n      \n      console.log(\"Processed pitch data:\", processedData);\n      const pitch = await dbStorage.createPitch(processedData);\n      console.log(\"Created pitch:\", pitch);\n      res.json(pitch);\n    } catch (error) {\n      console.error(\"Error creating pitch:\", error);\n      res.status(500).json({ error: \"Failed to create pitch\", details: error.message });\n    }\n  });\n\n  app.put(\"/api/pitches/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log(\"PUT /api/pitches/:id - Updating pitch:\", id);\n      console.log(\"Request body:\", req.body);\n      \n      const { status, notes, followUpDate } = req.body;\n      \n      const processedData = {\n        status: status || undefined,\n        notes: notes || undefined,\n        followUpDate: followUpDate ? new Date(followUpDate) : undefined,\n      };\n      \n      // Remove undefined fields\n      const updateData = Object.fromEntries(\n        Object.entries(processedData).filter(([_, value]) => value !== undefined)\n      );\n      \n      console.log(\"Processed update data:\", updateData);\n      const pitch = await dbStorage.updatePitch(id, updateData);\n      console.log(\"Updated pitch:\", pitch);\n      res.json(pitch);\n    } catch (error) {\n      console.error(\"Error updating pitch:\", error);\n      res.status(500).json({ error: \"Failed to update pitch\", details: error.message });\n    }\n  });\n\n  // Payments endpoints\n  app.get(\"/api/payments\", async (req, res) => {\n    try {\n      const { status, limit } = req.query;\n      const payments = await dbStorage.getPayments(\n        status as string,\n        limit ? parseInt(limit as string) : undefined\n      );\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch payments\" });\n    }\n  });\n\n  app.post(\"/api/payments\", async (req, res) => {\n    try {\n      const validatedData = insertPaymentSchema.parse(req.body);\n      const payment = await dbStorage.createPayment(validatedData);\n      res.json(payment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create payment\" });\n    }\n  });\n\n  app.put(\"/api/payments/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertPaymentSchema.partial().parse(req.body);\n      const payment = await dbStorage.updatePayment(id, validatedData);\n      res.json(payment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update payment\" });\n    }\n  });\n\n  // Templates endpoints\n  app.get(\"/api/templates\", async (req, res) => {\n    try {\n      const { type } = req.query;\n      const templates = await dbStorage.getTemplates(type as string);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch templates\" });\n    }\n  });\n\n  app.post(\"/api/templates\", async (req, res) => {\n    try {\n      const validatedData = insertTemplateSchema.parse(req.body);\n      const template = await dbStorage.createTemplate(validatedData);\n      res.json(template);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create template\" });\n    }\n  });\n\n  app.post(\"/api/templates/:id/duplicate\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { name } = req.body;\n      const templates = await dbStorage.getTemplates();\n      const original = templates.find(t => t.id === id);\n      \n      if (!original) {\n        return res.status(404).json({ error: \"Template not found\" });\n      }\n\n      const copyData: InsertTemplate = {\n        name: name || `${original.name} (Copy)`,\n        type: original.type,\n        content: original.content,\n      };\n\n      const newTemplate = await dbStorage.createTemplate(copyData);\n      res.json(newTemplate);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to duplicate template\" });\n    }\n  });\n\n  app.get(\"/api/templates/:id/download\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const templates = await dbStorage.getTemplates();\n      const template = templates.find(t => t.id === id);\n      \n      if (!template) {\n        return res.status(404).json({ error: \"Template not found\" });\n      }\n\n      const filename = `${template.name || 'template'}.txt`;\n      res.setHeader('Content-Type', 'text/plain');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n      res.send(template.content);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to download template\" });\n    }\n  });\n\n  app.put(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertTemplateSchema.parse(req.body);\n      const template = await dbStorage.updateTemplate(id, validatedData);\n      if (!template) {\n        return res.status(404).json({ error: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to update template\" });\n    }\n  });\n\n  app.delete(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteTemplate(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete template\" });\n    }\n  });\n\n  // Dashboard endpoint\n  app.get(\"/api/dashboard\", async (req, res) => {\n    try {\n      const metrics = await dbStorage.getDashboardMetrics();\n      res.json(metrics);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Email Templates endpoints\n  app.get(\"/api/email-templates\", async (req, res) => {\n    try {\n      const { stage } = req.query;\n      const templates = await dbStorage.getEmailTemplates(stage as string);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch email templates\" });\n    }\n  });\n\n  app.get(\"/api/email-templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const template = await dbStorage.getEmailTemplate(id);\n      if (!template) {\n        return res.status(404).json({ error: \"Email template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch email template\" });\n    }\n  });\n\n  app.post(\"/api/email-templates\", async (req, res) => {\n    try {\n      const data = insertEmailTemplateSchema.parse(req.body);\n      const template = await dbStorage.createEmailTemplate(data);\n      res.status(201).json(template);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid email template data\" });\n    }\n  });\n\n  app.put(\"/api/email-templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const data = insertEmailTemplateSchema.partial().parse(req.body);\n      const template = await dbStorage.updateEmailTemplate(id, data);\n      res.json(template);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid email template data\" });\n    }\n  });\n\n  app.delete(\"/api/email-templates/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteEmailTemplate(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete email template\" });\n    }\n  });\n\n  // File upload endpoint\n  app.post(\"/api/upload\", upload.single('file'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No file uploaded\" });\n      }\n      \n      const { entityType, entityId, description } = req.body;\n      \n      const attachmentData = {\n        filename: req.file.filename,\n        originalName: req.file.originalname,\n        mimeType: req.file.mimetype,\n        size: req.file.size,\n        path: req.file.path,\n        entityType,\n        entityId: parseInt(entityId),\n        description\n      };\n      \n      const attachment = await dbStorage.createAttachment(attachmentData);\n      res.status(201).json(attachment);\n    } catch (error) {\n      res.status(400).json({ error: \"File upload failed\" });\n    }\n  });\n\n  // Serve uploaded files\n  app.get(\"/api/files/:filename\", (req, res) => {\n    const filename = req.params.filename;\n    const filePath = path.join(process.cwd(), 'uploads', filename);\n    \n    if (!fs.existsSync(filePath)) {\n      return res.status(404).json({ error: \"File not found\" });\n    }\n    \n    res.sendFile(filePath);\n  });\n\n  // Attachments endpoints\n  app.get(\"/api/attachments\", async (req, res) => {\n    try {\n      const { entityType, entityId } = req.query;\n      const attachments = await dbStorage.getAttachments(\n        entityType as string,\n        entityId ? parseInt(entityId as string) : undefined\n      );\n      res.json(attachments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch attachments\" });\n    }\n  });\n\n  app.get(\"/api/attachments/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const attachment = await dbStorage.getAttachment(id);\n      if (!attachment) {\n        return res.status(404).json({ error: \"Attachment not found\" });\n      }\n      res.json(attachment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch attachment\" });\n    }\n  });\n\n  app.post(\"/api/attachments\", async (req, res) => {\n    try {\n      const data = insertAttachmentSchema.parse(req.body);\n      const attachment = await dbStorage.createAttachment(data);\n      res.status(201).json(attachment);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid attachment data\" });\n    }\n  });\n\n  app.delete(\"/api/attachments/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteAttachment(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete attachment\" });\n    }\n  });\n\n  // Calendar Events endpoints\n  app.get(\"/api/calendar-events\", async (req, res) => {\n    try {\n      const { entityType, entityId, startDate, endDate } = req.query;\n      const events = await dbStorage.getCalendarEvents(\n        entityType as string,\n        entityId ? parseInt(entityId as string) : undefined,\n        startDate ? new Date(startDate as string) : undefined,\n        endDate ? new Date(endDate as string) : undefined\n      );\n      res.json(events);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch calendar events\" });\n    }\n  });\n\n  app.get(\"/api/calendar-events/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const event = await dbStorage.getCalendarEvent(id);\n      if (!event) {\n        return res.status(404).json({ error: \"Calendar event not found\" });\n      }\n      res.json(event);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch calendar event\" });\n    }\n  });\n\n  app.post(\"/api/calendar-events\", async (req, res) => {\n    try {\n      // Convert string dates to Date objects before validation\n      const processedData = {\n        ...req.body,\n        startDate: req.body.startDate ? new Date(req.body.startDate) : undefined,\n        endDate: req.body.endDate ? new Date(req.body.endDate) : undefined,\n      };\n      \n      const data = insertCalendarEventSchema.parse(processedData);\n      const event = await dbStorage.createCalendarEvent(data);\n      res.status(201).json(event);\n    } catch (error) {\n      console.error('Calendar event validation error:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(400).json({ error: \"Invalid calendar event data\" });\n    }\n  });\n\n  app.put(\"/api/calendar-events/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Convert string dates to Date objects before validation\n      const processedData = {\n        ...req.body,\n        startDate: req.body.startDate ? new Date(req.body.startDate) : undefined,\n        endDate: req.body.endDate ? new Date(req.body.endDate) : undefined,\n      };\n      \n      const data = insertCalendarEventSchema.partial().parse(processedData);\n      const event = await dbStorage.updateCalendarEvent(id, data);\n      \n      // If this is an air date event for a deal, update the deal's air date too\n      if (event.entityType === 'deal' && event.entityId && event.title.includes('Air Date:')) {\n        try {\n          await dbStorage.updateDeal(event.entityId, { \n            airDate: event.startDate \n          });\n        } catch (dealError) {\n          console.error('Error updating deal air date:', dealError);\n          // Don't fail the calendar update if deal update fails\n        }\n      }\n      \n      res.json(event);\n    } catch (error) {\n      console.error('Error updating calendar event:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(400).json({ error: \"Invalid calendar event data\" });\n    }\n  });\n\n  app.delete(\"/api/calendar-events/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await dbStorage.deleteCalendarEvent(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete calendar event\" });\n    }\n  });\n\n  // Playlists endpoints\n  app.get('/api/playlists', async (req, res) => {\n    try {\n      const playlists = await dbStorage.getPlaylists();\n      res.json(playlists);\n    } catch (error) {\n      console.error('Error fetching playlists:', error);\n      res.status(500).json({ error: 'Failed to fetch playlists' });\n    }\n  });\n\n  app.post('/api/playlists', async (req, res) => {\n    try {\n      const playlist = await dbStorage.createPlaylist(req.body);\n      res.status(201).json(playlist);\n    } catch (error) {\n      console.error('Error creating playlist:', error);\n      res.status(500).json({ error: 'Failed to create playlist' });\n    }\n  });\n\n  app.get('/api/playlist-songs/:playlistId', async (req, res) => {\n    try {\n      const songs = await dbStorage.getPlaylistSongs(parseInt(req.params.playlistId));\n      res.json(songs);\n    } catch (error) {\n      console.error('Error fetching playlist songs:', error);\n      res.status(500).json({ error: 'Failed to fetch playlist songs' });\n    }\n  });\n\n  // Workflow Automation endpoints\n  app.get('/api/workflow-automation', async (req, res) => {\n    try {\n      const automations = await dbStorage.getWorkflowAutomations();\n      res.json(automations);\n    } catch (error) {\n      console.error('Error fetching workflow automations:', error);\n      res.status(500).json({ error: 'Failed to fetch workflow automations' });\n    }\n  });\n\n  app.post('/api/workflow-automation', async (req, res) => {\n    try {\n      const automation = await dbStorage.createWorkflowAutomation(req.body);\n      res.status(201).json(automation);\n    } catch (error) {\n      console.error('Error creating workflow automation:', error);\n      res.status(500).json({ error: 'Failed to create workflow automation' });\n    }\n  });\n\n  app.put('/api/workflow-automation/:id', async (req, res) => {\n    try {\n      const automation = await dbStorage.updateWorkflowAutomation(parseInt(req.params.id), req.body);\n      res.json(automation);\n    } catch (error) {\n      console.error('Error updating workflow automation:', error);\n      res.status(500).json({ error: 'Failed to update workflow automation' });\n    }\n  });\n\n  // Saved Searches endpoints\n  app.get('/api/saved-searches', async (req, res) => {\n    try {\n      const searches = await dbStorage.getSavedSearches();\n      res.json(searches);\n    } catch (error) {\n      console.error('Error fetching saved searches:', error);\n      res.status(500).json({ error: 'Failed to fetch saved searches' });\n    }\n  });\n\n  app.post('/api/saved-searches', async (req, res) => {\n    try {\n      const search = await dbStorage.createSavedSearch(req.body);\n      res.status(201).json(search);\n    } catch (error) {\n      console.error('Error creating saved search:', error);\n      res.status(500).json({ error: 'Failed to create saved search' });\n    }\n  });\n\n  // Smart Pitch Matching endpoints\n  app.post('/api/smart-pitch-analyze', async (req, res) => {\n    try {\n      const { songs, projectBrief } = req.body;\n      const { generatePitchRecommendations } = await import('./openai');\n      \n      const recommendations = await generatePitchRecommendations(songs, projectBrief);\n      res.json(recommendations);\n    } catch (error) {\n      console.error('Error generating pitch recommendations:', error);\n      res.status(500).json({ error: 'Failed to generate recommendations' });\n    }\n  });\n\n  app.post('/api/analyze-lyrics', async (req, res) => {\n    try {\n      const { lyrics } = req.body;\n      const { analyzeLyrics } = await import('./openai');\n      \n      const analysis = await analyzeLyrics(lyrics);\n      res.json(analysis);\n    } catch (error) {\n      console.error('Error analyzing lyrics:', error);\n      res.status(500).json({ error: 'Failed to analyze lyrics' });\n    }\n  });\n\n  app.post('/api/generate-contract', async (req, res) => {\n    try {\n      const { dealData, templateType } = req.body;\n      const { generateContractFromTemplate } = await import('./openai');\n      \n      const contract = await generateContractFromTemplate(dealData, templateType);\n      res.json({ contract });\n    } catch (error) {\n      console.error('Error generating contract:', error);\n      res.status(500).json({ error: 'Failed to generate contract' });\n    }\n  });\n\n  // Invoice Management endpoints\n  app.get('/api/invoices', async (req, res) => {\n    try {\n      // Mock data for invoices since we haven't implemented the storage methods yet\n      res.json([]);\n    } catch (error) {\n      console.error('Error fetching invoices:', error);\n      res.status(500).json({ error: 'Failed to fetch invoices' });\n    }\n  });\n\n  app.post('/api/invoices', async (req, res) => {\n    try {\n      // Mock implementation - would store in database\n      res.status(201).json({ id: Date.now(), ...req.body });\n    } catch (error) {\n      console.error('Error creating invoice:', error);\n      res.status(500).json({ error: 'Failed to create invoice' });\n    }\n  });\n\n  // Expense Tracking endpoints\n  app.get('/api/expenses', async (req, res) => {\n    try {\n      // Mock data for expenses since we haven't implemented the storage methods yet\n      res.json([]);\n    } catch (error) {\n      console.error('Error fetching expenses:', error);\n      res.status(500).json({ error: 'Failed to fetch expenses' });\n    }\n  });\n\n  app.post('/api/expenses', async (req, res) => {\n    try {\n      // Mock implementation - would store in database\n      res.status(201).json({ id: Date.now(), ...req.body });\n    } catch (error) {\n      console.error('Error creating expense:', error);\n      res.status(500).json({ error: 'Failed to create expense' });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":40299},"client/src/components/layout/header.tsx":{"content":"import { Search, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface HeaderProps {\n  title: string;\n  description?: string;\n  searchPlaceholder?: string;\n  onSearch?: (query: string) => void;\n  onNewItem?: () => void;\n  newItemLabel?: string;\n  showSearch?: boolean;\n  showNewButton?: boolean;\n}\n\nexport default function Header({\n  title,\n  description,\n  searchPlaceholder = \"Search...\",\n  onSearch,\n  onNewItem,\n  newItemLabel = \"New Item\",\n  showSearch = true,\n  showNewButton = true,\n}: HeaderProps) {\n  return (\n    <header className=\"bg-white shadow-sm border-b border-gray-200 px-6 py-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">{title}</h2>\n          {description && (\n            <p className=\"text-sm text-gray-600 mt-1\">{description}</p>\n          )}\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          {showSearch && (\n            <div className=\"relative\">\n              <Input\n                type=\"text\"\n                placeholder={searchPlaceholder}\n                aria-label={searchPlaceholder}\n                className=\"w-64 pl-10\"\n                onChange={(e) => onSearch?.(e.target.value)}\n              />\n              <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" aria-hidden=\"true\" />\n            </div>\n          )}\n          {showNewButton && (\n            <Button onClick={onNewItem} className=\"bg-brand-primary hover:bg-blue-700\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              {newItemLabel}\n            </Button>\n          )}\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":1743},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.5rem;\n  \n  /* Custom colors matching the design */\n  --brand-primary: hsl(207, 90%, 54%);\n  --brand-secondary: hsl(157, 100%, 29%);\n  --brand-accent: hsl(260, 84%, 56%);\n  --status-overdue: hsl(0, 84%, 60%);\n  --status-pending: hsl(43, 96%, 56%);\n  --status-completed: hsl(142, 76%, 36%);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n@layer utilities {\n  .text-brand-primary {\n    color: var(--brand-primary);\n  }\n  \n  .text-brand-secondary {\n    color: var(--brand-secondary);\n  }\n  \n  .text-brand-accent {\n    color: var(--brand-accent);\n  }\n  \n  .text-status-overdue {\n    color: var(--status-overdue);\n  }\n  \n  .text-status-pending {\n    color: var(--status-pending);\n  }\n  \n  .text-status-completed {\n    color: var(--status-completed);\n  }\n  \n  .bg-brand-primary {\n    background-color: var(--brand-primary);\n  }\n  \n  .bg-brand-secondary {\n    background-color: var(--brand-secondary);\n  }\n  \n  .bg-brand-accent {\n    background-color: var(--brand-accent);\n  }\n  \n  .bg-status-overdue {\n    background-color: var(--status-overdue);\n  }\n  \n  .bg-status-pending {\n    background-color: var(--status-pending);\n  }\n  \n  .bg-status-completed {\n    background-color: var(--status-completed);\n  }\n  \n  .hover\\:bg-brand-primary:hover {\n    background-color: var(--brand-primary);\n  }\n  \n  .hover\\:bg-brand-secondary:hover {\n    background-color: var(--brand-secondary);\n  }\n  \n  .hover\\:bg-brand-accent:hover {\n    background-color: var(--brand-accent);\n  }\n}\n","size_bytes":3090},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"sync-licensing-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};","size_bytes":1611},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/forms/comprehensive-add-deal-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertDealSchema, insertContactSchema, type InsertDeal, type InsertContact, type Song, type Contact } from \"@shared/schema\";\nimport { Plus, Building, User, FileText, DollarSign, X, Check, ChevronsUpDown } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport AddContactForm from \"@/components/forms/add-contact-form\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\n\n// Currency formatting functions\nconst formatCurrency = (value: string | number) => {\n  if (!value && value !== 0) return '';\n  const numValue = typeof value === 'string' ? parseFloat(value.replace(/[^0-9.-]+/g, '')) : value;\n  if (isNaN(numValue)) return '';\n  if (numValue === 0) return '';\n  return '$' + numValue.toLocaleString('en-US', {\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 2\n  });\n};\n\ninterface ComprehensiveAddDealFormProps {\n  open: boolean;\n  onClose: () => void;\n  deal?: any;\n}\n\nexport default function ComprehensiveAddDealForm({ open, onClose, deal }: ComprehensiveAddDealFormProps) {\n  const { toast } = useToast();\n  const isEditing = !!deal;\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [selectedSong, setSelectedSong] = useState<Song | null>(null);\n  const [songSearchOpen, setSongSearchOpen] = useState(false);\n  const [songSearchValue, setSongSearchValue] = useState(\"\");\n  const [contactSearchOpen, setContactSearchOpen] = useState(false);\n  const [contactSearchValue, setContactSearchValue] = useState(\"\");\n\n  // State for managing composer-publisher and artist-label data from selected song\n  interface ComposerPublisher {\n    composer: string;\n    publisher: string;\n    publishingOwnership: string;\n    isMine: boolean;\n  }\n  \n  interface ArtistLabel {\n    artist: string;\n    label: string;\n    labelOwnership: string;\n    isMine: boolean;\n    paymentDate: string;\n  }\n  \n  const [composerPublishers, setComposerPublishers] = useState<ComposerPublisher[]>([\n    { composer: '', publisher: '', publishingOwnership: '', isMine: false }\n  ]);\n  \n  const [artistLabels, setArtistLabels] = useState<ArtistLabel[]>([\n    { artist: '', label: '', labelOwnership: '', isMine: false, paymentDate: '' }\n  ]);\n\n  const form = useForm<InsertDeal>({\n    shouldFocusError: false,\n    defaultValues: {\n      projectName: deal?.projectName || \"\",\n      episodeNumber: deal?.episodeNumber || \"\",\n      projectType: deal?.projectType || \"\",\n      projectDescription: deal?.projectDescription || \"\",\n      songId: deal?.songId || undefined,\n      contactId: deal?.contactId || undefined,\n      \n      // Contact Information\n      licenseeCompanyName: deal?.licenseeCompanyName || \"\",\n      licenseeAddress: deal?.licenseeAddress || \"\",\n      licenseeContactName: deal?.licenseeContactName || \"\",\n      licenseeContactEmail: deal?.licenseeContactEmail || \"\",\n      licenseeContactPhone: deal?.licenseeContactPhone || \"\",\n      \n      musicSupervisorName: deal?.musicSupervisorName || \"\",\n      musicSupervisorAddress: deal?.musicSupervisorAddress || \"\",\n      musicSupervisorContactName: deal?.musicSupervisorContactName || \"\",\n      musicSupervisorContactEmail: deal?.musicSupervisorContactEmail || \"\",\n      musicSupervisorContactPhone: deal?.musicSupervisorContactPhone || \"\",\n      \n      clearanceCompanyName: deal?.clearanceCompanyName || \"\",\n      clearanceCompanyContactName: deal?.clearanceCompanyContactName || \"\",\n      clearanceCompanyContactEmail: deal?.clearanceCompanyContactEmail || \"\",\n      clearanceCompanyContactPhone: deal?.clearanceCompanyContactPhone || \"\",\n      clearanceCompanyAddress: deal?.clearanceCompanyAddress || \"\",\n      \n      status: deal?.status || \"new request\",\n      dealValue: deal?.dealValue || undefined,\n      fullSongValue: deal?.fullSongValue || undefined,\n      ourFee: deal?.ourFee || undefined,\n      fullRecordingFee: deal?.fullRecordingFee || undefined,\n      ourRecordingFee: deal?.ourRecordingFee || undefined,\n      \n      // Status dates\n      pitchedDate: deal?.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n      pendingApprovalDate: deal?.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n      quotedDate: deal?.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n      useConfirmedDate: deal?.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n      beingDraftedDate: deal?.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n      outForSignatureDate: deal?.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n      paymentReceivedDate: deal?.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n      completedDate: deal?.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n      \n      usage: deal?.usage || \"\",\n      sceneDescription: deal?.sceneDescription || \"\",\n      media: deal?.media || \"\",\n      territory: deal?.territory || \"Worldwide\",\n      term: deal?.term || \"\",\n      options: deal?.options || \"\",\n      writers: deal?.writers || \"\",\n      publishingInfo: deal?.publishingInfo || \"\",\n      splits: deal?.splits || \"\",\n      artist: deal?.artist || \"\",\n      label: deal?.label || \"\",\n      artistLabelSplits: deal?.artistLabelSplits || \"\",\n      exclusivity: deal?.exclusivity ?? false,\n      exclusivityRestrictions: deal?.exclusivityRestrictions || \"\",\n      notes: deal?.notes || \"\",\n      airDate: deal?.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n    },\n  });\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: ['/api/songs'],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  // Reset form when deal prop changes (for editing)\n  useEffect(() => {\n    if (deal) {\n      // Set up selectedSong state for editing\n      if (deal.songId && songs.length > 0) {\n        const song = songs.find(s => s.id === deal.songId);\n        if (song) {\n          setSelectedSong(song);\n          \n          // Load structured ownership data if available\n          if (song.composerPublishers && Array.isArray(song.composerPublishers)) {\n            setComposerPublishers(song.composerPublishers);\n          } else if (song.composer || song.publisher) {\n            // Fall back to legacy comma-separated strings\n            const composers = song.composer ? song.composer.split(', ').filter(Boolean) : [''];\n            const publishers = song.publisher ? song.publisher.split(', ').filter(Boolean) : [''];\n            \n            const maxLength = Math.max(composers.length, publishers.length);\n            const result: ComposerPublisher[] = [];\n            for (let i = 0; i < maxLength; i++) {\n              result.push({\n                composer: composers[i] || '',\n                publisher: publishers[i] || '',\n                publishingOwnership: '',\n                isMine: false\n              });\n            }\n            setComposerPublishers(result.length > 0 ? result : [{ composer: '', publisher: '', publishingOwnership: '', isMine: false }]);\n          }\n          \n          // Load artist-label data if available\n          if (song.artistLabels && Array.isArray(song.artistLabels)) {\n            setArtistLabels(song.artistLabels);\n          } else if (song.artist || song.producer) {\n            // Fall back to legacy comma-separated strings\n            const artists = song.artist ? song.artist.split(', ').filter(Boolean) : [''];\n            const labels = song.producer ? [song.producer] : [''];\n            \n            const maxLength = Math.max(artists.length, labels.length);\n            const result: ArtistLabel[] = [];\n            for (let i = 0; i < maxLength; i++) {\n              result.push({\n                artist: artists[i] || '',\n                label: labels[i] || '',\n                labelOwnership: '',\n                isMine: false\n              });\n            }\n            setArtistLabels(result.length > 0 ? result : [{ artist: '', label: '', labelOwnership: '', isMine: false }]);\n          }\n        }\n      }\n      \n      form.reset({\n        projectName: deal.projectName || \"\",\n        episodeNumber: deal.episodeNumber || \"\",\n        projectType: deal.projectType || \"\",\n        projectDescription: deal.projectDescription || \"\",\n        songId: deal.songId || undefined,\n        contactId: deal.contactId || undefined,\n        \n        // Contact Information\n        licenseeCompanyName: deal.licenseeCompanyName || \"\",\n        licenseeAddress: deal.licenseeAddress || \"\",\n        licenseeContactName: deal.licenseeContactName || \"\",\n        licenseeContactEmail: deal.licenseeContactEmail || \"\",\n        licenseeContactPhone: deal.licenseeContactPhone || \"\",\n        \n        musicSupervisorName: deal.musicSupervisorName || \"\",\n        musicSupervisorAddress: deal.musicSupervisorAddress || \"\",\n        musicSupervisorContactName: deal.musicSupervisorContactName || \"\",\n        musicSupervisorContactEmail: deal.musicSupervisorContactEmail || \"\",\n        musicSupervisorContactPhone: deal.musicSupervisorContactPhone || \"\",\n        \n        clearanceCompanyName: deal.clearanceCompanyName || \"\",\n        clearanceCompanyContactName: deal.clearanceCompanyContactName || \"\",\n        clearanceCompanyContactEmail: deal.clearanceCompanyContactEmail || \"\",\n        clearanceCompanyContactPhone: deal.clearanceCompanyContactPhone || \"\",\n        clearanceCompanyAddress: deal.clearanceCompanyAddress || \"\",\n        \n        status: deal.status || \"new request\",\n        dealValue: deal.dealValue || undefined,\n        fullSongValue: deal.fullSongValue || undefined,\n        ourFee: deal.ourFee || undefined,\n        fullRecordingFee: deal.fullRecordingFee || undefined,\n        ourRecordingFee: deal.ourRecordingFee || undefined,\n        \n        // Status dates\n        pitchedDate: deal.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n        pendingApprovalDate: deal.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n        quotedDate: deal.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n        useConfirmedDate: deal.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n        beingDraftedDate: deal.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n        outForSignatureDate: deal.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n        paymentReceivedDate: deal.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n        completedDate: deal.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n        \n        usage: deal.usage || \"\",\n        sceneDescription: deal.sceneDescription || \"\",\n        media: deal.media || \"\",\n        territory: deal.territory || \"Worldwide\",\n        term: deal.term || \"\",\n        options: deal.options || \"\",\n        writers: deal.writers || \"\",\n        publishingInfo: deal.publishingInfo || \"\",\n        splits: deal.splits || \"\",\n        artist: deal.artist || \"\",\n        label: deal.label || \"\",\n        artistLabelSplits: deal.artistLabelSplits || \"\",\n        exclusivity: deal.exclusivity ?? false,\n        exclusivityRestrictions: deal.exclusivityRestrictions || \"\",\n        restrictions: deal.restrictions || \"\",\n        notes: deal.notes || \"\",\n        airDate: deal.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n      });\n    }\n  }, [deal, form, songs]);\n\n  const createDealMutation = useMutation({\n    mutationFn: async (data: InsertDeal) => {\n      const response = await apiRequest(isEditing ? `/api/deals/${deal.id}` : '/api/deals', { \n        method: isEditing ? 'PATCH' : 'POST', \n        body: data \n      });\n      return response.json();\n    },\n    onSuccess: async (newDeal) => {\n      console.log(\"Deal update successful:\", newDeal);\n      \n      // Invalidate multiple cache keys\n      await queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      await queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      await queryClient.invalidateQueries({ queryKey: ['/api/deals', deal?.id] });\n      \n      // Auto-create calendar event if air date is provided\n      if (newDeal.airDate && !isEditing) {\n        try {\n          await apiRequest('/api/calendar-events', {\n            method: 'POST',\n            body: {\n              title: `${newDeal.projectName} - Air Date`,\n              description: `Air date for ${newDeal.projectName}`,\n              startDate: newDeal.airDate,\n              endDate: newDeal.airDate,\n              allDay: true,\n              entityType: \"deal\",\n              entityId: newDeal.id,\n              status: 'scheduled',\n              reminderMinutes: 1440 // 24 hours before\n            }\n          });\n          queryClient.invalidateQueries({ queryKey: [\"/api/calendar-events\"] });\n        } catch (error) {\n          console.log(\"Failed to create calendar event:\", error);\n        }\n      }\n      \n      toast({\n        title: isEditing ? \"Deal updated successfully\" : \"Deal created successfully\",\n        description: newDeal.airDate && !isEditing\n          ? `The deal has been ${isEditing ? 'updated' : 'created'} and calendar event created for air date.`\n          : `The deal has been ${isEditing ? 'updated' : 'created'}.`,\n      });\n      \n      // Force a brief delay to ensure cache invalidation completes\n      setTimeout(() => {\n        onClose();\n        if (!isEditing) {\n          form.reset();\n        }\n      }, 100);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to ${isEditing ? 'update' : 'create'} deal: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Function to parse our split percentage from splits text\n  const parseOurSplitPercentage = (splitsText: string): number => {\n    if (!splitsText) return 50; // Default to 50%\n    \n    // Look for our percentage patterns\n    const ourPatterns = [\n      /our[:\\s]*(\\d+)%/i,\n      /we[:\\s]*(\\d+)%/i,\n      /us[:\\s]*(\\d+)%/i,\n      /(\\d+)%[^/]*our/i,\n      /(\\d+)%[^/]*we/i,\n      /(\\d+)%[^/]*us/i\n    ];\n    \n    for (const pattern of ourPatterns) {\n      const match = splitsText.match(pattern);\n      if (match) {\n        const percentage = parseInt(match[1]);\n        if (percentage >= 0 && percentage <= 100) {\n          return percentage;\n        }\n      }\n    }\n    \n    // If no specific pattern found, look for any percentage\n    const percentageMatch = splitsText.match(/(\\d+)%/);\n    if (percentageMatch) {\n      const percentage = parseInt(percentageMatch[1]);\n      if (percentage >= 0 && percentage <= 100) {\n        return percentage;\n      }\n    }\n    \n    return 50; // Default to 50% if can't parse\n  };\n\n  // Function to calculate our fee based on splits\n  const calculateOurFee = (fullFee: number, splitsText: string): number => {\n    if (!fullFee || fullFee === 0) return 0;\n    const ourPercentage = parseOurSplitPercentage(splitsText);\n    return (fullFee * ourPercentage) / 100;\n  };\n\n  // Function to calculate our fee based on actual ownership percentages\n  const calculateOurFeeFromOwnership = (fullFee: number, ownershipPercentage: number): number => {\n    if (!fullFee || fullFee === 0) return 0;\n    return (fullFee * ownershipPercentage) / 100;\n  };\n\n  // Recalculate recording fee when artistLabels ownership changes\n  useEffect(() => {\n    const fullRecordingFee = form.watch(\"fullRecordingFee\");\n    if (fullRecordingFee && fullRecordingFee > 0) {\n      const ourOwnershipTotal = artistLabels\n        .filter(al => al.isMine)\n        .reduce((sum, al) => {\n          const ownership = parseFloat(al.labelOwnership) || 0;\n          return sum + ownership;\n        }, 0);\n      \n      if (ourOwnershipTotal > 0) {\n        const ourRecordingFee = calculateOurFeeFromOwnership(fullRecordingFee, ourOwnershipTotal);\n        form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n      }\n    }\n  }, [artistLabels]);\n\n  const onSubmit = (data: InsertDeal) => {\n    console.log(\"Form submission data:\", data);\n    \n    // Validate required fields manually\n    if (!data.projectName || !data.projectType || !data.songId) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please fill in all required fields (Project Name, Project Type, and Song Title).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    createDealMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-7xl max-h-[90vh] overflow-y-auto p-2\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? \"Edit Deal\" : \"Add New Deal\"}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6 pb-16\">\n          {/* Section 1: Project Information */}\n          <Card className=\"bg-purple-50 border-purple-200\">\n            <CardHeader className=\"bg-purple-100 border-b border-purple-200 py-1\">\n              <CardTitle className=\"flex items-center space-x-2 text-purple-800\">\n                <FileText className=\"h-5 w-5\" />\n                <span>Project Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1 bg-purple-50 p-3\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"projectName\">Project Name *</Label>\n                  <Input\n                    id=\"projectName\"\n                    {...form.register(\"projectName\")}\n                    placeholder=\"Project name\"\n                  />\n                  {form.formState.errors.projectName && (\n                    <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.projectName.message}</p>\n                  )}\n                </div>\n                <div>\n                  <Label htmlFor=\"episodeNumber\">Episode #</Label>\n                  <Input\n                    id=\"episodeNumber\"\n                    {...form.register(\"episodeNumber\")}\n                    placeholder=\"e.g., S01E05\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"projectType\">Project Type *</Label>\n                  <Select \n                    value={form.watch(\"projectType\")} \n                    onValueChange={(value) => form.setValue(\"projectType\", value)}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select project type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"commercial\">Commercial</SelectItem>\n                      <SelectItem value=\"documentary\">Documentary</SelectItem>\n                      <SelectItem value=\"film\">Film</SelectItem>\n                      <SelectItem value=\"game\">Video Game</SelectItem>\n                      <SelectItem value=\"indie film\">Indie Film</SelectItem>\n                      <SelectItem value=\"non-profit\">Non-Profit</SelectItem>\n                      <SelectItem value=\"other\">Other</SelectItem>\n                      <SelectItem value=\"podcast\">Podcast</SelectItem>\n                      <SelectItem value=\"promos\">Promos</SelectItem>\n                      <SelectItem value=\"sports\">Sports</SelectItem>\n                      <SelectItem value=\"student film\">Student Film</SelectItem>\n                      <SelectItem value=\"trailers\">Trailers</SelectItem>\n                      <SelectItem value=\"tv show\">TV Show</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"projectDescription\">Project Description</Label>\n                <Textarea\n                  id=\"projectDescription\"\n                  {...form.register(\"projectDescription\")}\n                  placeholder=\"Brief description of the project\"\n                  rows={1}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-2\">\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select\n                    value={form.watch(\"status\")}\n                    onValueChange={(value) => {\n                      form.setValue(\"status\", value);\n                      \n                      // Auto-populate corresponding date when status changes\n                      const currentDate = new Date().toISOString().slice(0, 10); // Format: YYYY-MM-DD\n                      \n                      switch (value) {\n                        case \"new request\":\n                          form.setValue(\"pitchedDate\", currentDate);\n                          break;\n                        case \"pending approval\":\n                          form.setValue(\"pendingApprovalDate\", currentDate);\n                          break;\n                        case \"quoted\":\n                          form.setValue(\"quotedDate\", currentDate);\n                          break;\n                        case \"use confirmed\":\n                          form.setValue(\"useConfirmedDate\", currentDate);\n                          break;\n                        case \"being drafted\":\n                          form.setValue(\"beingDraftedDate\", currentDate);\n                          break;\n                        case \"out for signature\":\n                          form.setValue(\"outForSignatureDate\", currentDate);\n                          break;\n                        case \"payment received\":\n                          form.setValue(\"paymentReceivedDate\", currentDate);\n                          break;\n                        case \"completed\":\n                          form.setValue(\"completedDate\", currentDate);\n                          break;\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"new request\">New Request</SelectItem>\n                      <SelectItem value=\"pending approval\">Pending Approval</SelectItem>\n                      <SelectItem value=\"quoted\">Quoted</SelectItem>\n                      <SelectItem value=\"use confirmed\">Use Confirmed</SelectItem>\n                      <SelectItem value=\"being drafted\">Being Drafted</SelectItem>\n                      <SelectItem value=\"out for signature\">Out for Signature</SelectItem>\n                      <SelectItem value=\"payment received\">Payment Received</SelectItem>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                      <SelectItem value=\"not used\">Not Used</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"airDate\">Air Date</Label>\n                  <Input\n                    id=\"airDate\"\n                    type=\"date\"\n                    {...form.register(\"airDate\")}\n                  />\n                </div>\n              </div>\n\n\n            </CardContent>\n          </Card>\n\n          {/* Section 2: Song Information */}\n          <Card className=\"bg-blue-50 border-blue-200\">\n            <CardHeader className=\"bg-blue-100 border-b border-blue-200 py-1\">\n              <CardTitle className=\"flex items-center space-x-2 text-blue-800\">\n                <span></span>\n                <span>Song Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1 bg-blue-50 p-3\">\n              <div className=\"grid grid-cols-1 gap-2\">\n                <div className=\"relative\">\n                  <Label htmlFor=\"songId\">Song Title *</Label>\n                  <Command className=\"rounded-lg border shadow-md\">\n                    <CommandInput \n                      placeholder=\"Type to search songs...\"\n                      value={songSearchValue}\n                      onValueChange={setSongSearchValue}\n                      onFocus={() => setSongSearchOpen(true)}\n                      onBlur={() => {\n                        // Delay to allow click on item\n                        setTimeout(() => {\n                          if (!form.watch(\"songId\")) {\n                            setSongSearchOpen(false);\n                          }\n                        }, 200);\n                      }}\n                    />\n                    {songSearchOpen && (\n                      <CommandList>\n                        <CommandEmpty>No song found.</CommandEmpty>\n                        <CommandGroup>\n                          {songs.map((song) => (\n                            <CommandItem\n                              key={song.id}\n                              value={`${song.title} ${song.artist}`}\n                              onSelect={() => {\n                                  const songId = song.id;\n                                  form.setValue(\"songId\", songId);\n                                  setSongSearchValue(`${song.title} - ${song.artist}`);\n                                  setSongSearchOpen(false);\n                                  \n                                  // Auto-populate comprehensive song information from database\n                                  setSelectedSong(song);\n                                  \n                                  // Basic song information\n                                  form.setValue(\"artist\", song.artist || \"\");\n                                  form.setValue(\"label\", song.producer || \"\");\n                                  \n                                  // Writers and publishing information\n                                  if (song.composer) {\n                                    form.setValue(\"writers\", song.composer);\n                                  }\n                                  if (song.publisher) {\n                                    form.setValue(\"publishingInfo\", song.publisher);\n                                  }\n                                  \n                                  // Load structured ownership data if available\n                                  if (song.composerPublishers && Array.isArray(song.composerPublishers)) {\n                                    setComposerPublishers(song.composerPublishers);\n                                  } else if (song.composer || song.publisher) {\n                                    // Fall back to legacy comma-separated strings\n                                    const composers = song.composer ? song.composer.split(', ').filter(Boolean) : [''];\n                                    const publishers = song.publisher ? song.publisher.split(', ').filter(Boolean) : [''];\n                                    \n                                    const maxLength = Math.max(composers.length, publishers.length);\n                                    const result: ComposerPublisher[] = [];\n                                    for (let i = 0; i < maxLength; i++) {\n                                      result.push({\n                                        composer: composers[i] || '',\n                                        publisher: publishers[i] || '',\n                                        publishingOwnership: '',\n                                        isMine: false\n                                      });\n                                    }\n                                    setComposerPublishers(result.length > 0 ? result : [{ composer: '', publisher: '', publishingOwnership: '', isMine: false }]);\n                                  }\n                                  \n                                  // Load artist-label data if available\n                                  if (song.artistLabels && Array.isArray(song.artistLabels)) {\n                                    setArtistLabels(song.artistLabels);\n                                  } else if (song.artist || song.producer) {\n                                    // Fall back to legacy comma-separated strings\n                                    const artists = song.artist ? song.artist.split(', ').filter(Boolean) : [''];\n                                    const labels = song.producer ? [song.producer] : [''];\n                                    \n                                    const maxLength = Math.max(artists.length, labels.length);\n                                    const result: ArtistLabel[] = [];\n                                    for (let i = 0; i < maxLength; i++) {\n                                      result.push({\n                                        artist: artists[i] || '',\n                                        label: labels[i] || '',\n                                        labelOwnership: '',\n                                        isMine: false\n                                      });\n                                    }\n                                    setArtistLabels(result.length > 0 ? result : [{ artist: '', label: '', labelOwnership: '', isMine: false }]);\n                                  }\n                                  \n                                  // Use actual split details if available, otherwise calculate from ownership data\n                                  if (song.splitDetails) {\n                                    form.setValue(\"splits\", song.splitDetails);\n                                  } else {\n                                    // Calculate splits from actual ownership percentages\n                                    const publishingOwnership = parseFloat(song.publishingOwnership?.toString() || '0');\n                                    const publisherOwnership = 100 - publishingOwnership;\n                                    form.setValue(\"splits\", `${publishingOwnership}% Writer / ${publisherOwnership}% Publisher`);\n                                  }\n                                  \n                                  // Artist/Label splits from actual ownership data\n                                  const masterOwnership = parseFloat(song.masterOwnership?.toString() || '0');\n                                  const labelOwnership = 100 - masterOwnership;\n                                  form.setValue(\"artistLabelSplits\", `${masterOwnership}% Artist / ${labelOwnership}% Label`);\n                                  \n                                  // Auto-populate restrictions if available\n                                  if (song.restrictions) {\n                                    form.setValue(\"restrictions\", song.restrictions);\n                                  }\n                                }}\n                              >\n                              {song.title} - {song.artist}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      </CommandList>\n                    )}\n                  </Command>\n                  {form.formState.errors.songId && (\n                    <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.songId.message}</p>\n                  )}\n                </div>\n              </div>\n\n              {selectedSong && (\n                <div className=\"space-y-1\">\n                  {/* Basic Song Information */}\n                  <Card className=\"bg-purple-50 border-purple-200\">\n                    <CardHeader className=\"bg-purple-100 border-b border-purple-200\">\n                      <CardTitle className=\"text-purple-800\">Basic Song Information</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-1 bg-purple-50 p-2\">\n                      {/* First line: Title, Album */}\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div>\n                          <Label>Title</Label>\n                          <Input\n                            value={selectedSong.title || \"\"}\n                            readOnly\n                            className=\"bg-purple-25 cursor-not-allowed\"\n                          />\n                        </div>\n                        <div>\n                          <Label>Album</Label>\n                          <Input\n                            value={selectedSong.album || \"\"}\n                            readOnly\n                            className=\"bg-purple-25 cursor-not-allowed\"\n                            placeholder=\"Album name\"\n                          />\n                        </div>\n                      </div>\n                      \n                      {/* Second line: Jonas's Ownership Summary */}\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div>\n                          <Label>Publishing Ownership (%)</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.01\"\n                            value={composerPublishers\n                              .filter(cp => cp.isMine && cp.publishingOwnership)\n                              .reduce((total, cp) => total + parseFloat(cp.publishingOwnership || '0'), 0)\n                              .toFixed(2)}\n                            readOnly\n                            className=\"bg-purple-25 cursor-not-allowed\"\n                            placeholder=\"0.00\"\n                          />\n                          <p className=\"text-xs text-purple-600 mt-1\">Auto-calculated from Jonas's checked composers</p>\n                        </div>\n                        <div>\n                          <Label>Label Recording Ownership (%)</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.01\"\n                            value={artistLabels\n                              .filter(al => al.isMine && al.labelOwnership)\n                              .reduce((total, al) => total + parseFloat(al.labelOwnership || '0'), 0)\n                              .toFixed(2)}\n                            readOnly\n                            className=\"bg-purple-25 cursor-not-allowed\"\n                            placeholder=\"0.00\"\n                          />\n                          <p className=\"text-xs text-purple-600 mt-1\">Auto-calculated from Jonas's checked artists</p>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  {/* Publishing Information */}\n                  <Card className=\"bg-green-50 border-green-200\">\n                    <CardHeader className=\"bg-green-100 border-b border-green-200\">\n                      <CardTitle className=\"text-green-800\">Publishing Information</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-1 bg-green-50 p-2\">\n                      <div>\n                        <Label className=\"text-base font-semibold\">Composer(s), Publisher(s) & Ownership</Label>\n                        <div className=\"space-y-3 mt-3\">\n                          <div className=\"grid grid-cols-12 gap-2 text-sm font-medium text-green-700\">\n                            <div className=\"col-span-4\">Composer Name</div>\n                            <div className=\"col-span-4\">Publisher</div>\n                            <div className=\"col-span-2\">Ownership (%)</div>\n                            <div className=\"col-span-1\">Jonas</div>\n                            <div className=\"col-span-1\"></div>\n                          </div>\n                          {composerPublishers.map((item, index) => (\n                            <div key={index} className=\"grid grid-cols-12 gap-2\">\n                              <div className=\"col-span-4\">\n                                <Input\n                                  value={item.composer}\n                                  readOnly\n                                  className=\"bg-green-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-4\">\n                                <Input\n                                  value={item.publisher}\n                                  readOnly\n                                  className=\"bg-green-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-2\">\n                                <Input\n                                  value={item.publishingOwnership}\n                                  readOnly\n                                  className=\"bg-green-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-1 flex justify-center items-center\">\n                                <Checkbox\n                                  checked={item.isMine}\n                                  disabled\n                                />\n                              </div>\n                              <div className=\"col-span-1\"></div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  {/* Label Information */}\n                  <Card className=\"bg-blue-50 border-blue-200\">\n                    <CardHeader className=\"bg-blue-100 border-b border-blue-200\">\n                      <CardTitle className=\"text-blue-800\">Label Information</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-1 bg-blue-50 p-2\">\n                      <div>\n                        <Label className=\"text-base font-semibold\">Artist(s), Label(s) & Ownership</Label>\n                        <div className=\"space-y-3 mt-3\">\n                          <div className=\"grid grid-cols-12 gap-2 text-sm font-medium text-blue-700\">\n                            <div className=\"col-span-4\">Artist Name</div>\n                            <div className=\"col-span-4\">Label</div>\n                            <div className=\"col-span-2\">Ownership (%)</div>\n                            <div className=\"col-span-1\">Jonas</div>\n                            <div className=\"col-span-1\"></div>\n                          </div>\n                          {artistLabels.map((item, index) => (\n                            <div key={index} className=\"grid grid-cols-12 gap-2\">\n                              <div className=\"col-span-4\">\n                                <Input\n                                  value={item.artist}\n                                  readOnly\n                                  className=\"bg-blue-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-4\">\n                                <Input\n                                  value={item.label}\n                                  readOnly\n                                  className=\"bg-blue-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-2\">\n                                <Input\n                                  value={item.labelOwnership}\n                                  readOnly\n                                  className=\"bg-blue-25 cursor-not-allowed\"\n                                />\n                              </div>\n                              <div className=\"col-span-1 flex justify-center items-center\">\n                                <Checkbox\n                                  checked={item.isMine}\n                                  disabled\n                                />\n                              </div>\n                              <div className=\"col-span-1\"></div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  {/* Deal Terms */}\n                  <div className=\"border-t pt-4\">\n                    <h4 className=\"font-medium mb-3\">Deal Terms</h4>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div>\n                        <Label htmlFor=\"usage\">Usage</Label>\n                        <Input\n                          id=\"usage\"\n                          {...form.register(\"usage\")}\n                          placeholder=\"e.g., Background music\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"sceneDescription\">Scene Description</Label>\n                        <Textarea\n                          id=\"sceneDescription\"\n                          {...form.register(\"sceneDescription\")}\n                          placeholder=\"Describe how music is used in scene\"\n                          rows={2}\n                          className=\"min-h-[60px]\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-3 gap-4 mt-4\">\n                      <div>\n                        <Label htmlFor=\"media\">Media</Label>\n                        <Textarea\n                          id=\"media\"\n                          {...form.register(\"media\")}\n                          placeholder=\"e.g., TV, Film, Streaming, All media and devices...\"\n                          rows={2}\n                          className=\"min-h-[60px]\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"term\">Term</Label>\n                        <Input\n                          id=\"term\"\n                          {...form.register(\"term\")}\n                          placeholder=\"e.g., 5 years, In perpetuity\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"territory\">Territory</Label>\n                        <Input\n                          id=\"territory\"\n                          {...form.register(\"territory\")}\n                          placeholder=\"e.g., Worldwide, North America, etc.\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Fees Section */}\n          <Card className=\"bg-green-50 border-green-200\">\n            <CardHeader className=\"bg-green-100 border-b border-green-200 py-1\">\n              <CardTitle className=\"flex items-center space-x-2 text-green-800\">\n                <DollarSign className=\"h-5 w-5\" />\n                <span>Fees</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1 bg-green-50 p-3\">\n              <div className=\"grid grid-cols-2 gap-2\">\n                <div>\n                  <Label htmlFor=\"fullSongValue\">100% Publishing Fee ($)</Label>\n                  <Input\n                    id=\"fullSongValue\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"fullSongValue\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"fullSongValue\", numericValue);\n                      \n                      // Auto-calculate our fee based on actual publishing ownership percentage\n                      if (selectedSong && selectedSong.publishingOwnership) {\n                        const ownershipPct = parseFloat(selectedSong.publishingOwnership.toString());\n                        const ourFee = calculateOurFeeFromOwnership(numericValue, ownershipPct);\n                        form.setValue(\"ourFee\", Math.round(ourFee * 100) / 100);\n                      } else {\n                        // Fallback to splits text parsing if no ownership data\n                        const splitsText = form.watch(\"splits\") || \"\";\n                        if (splitsText) {\n                          const ourFee = calculateOurFee(numericValue, splitsText);\n                          form.setValue(\"ourFee\", Math.round(ourFee * 100) / 100);\n                        }\n                      }\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"ourFee\">Our Publishing Fee ($)</Label>\n                  <Input\n                    id=\"ourFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"ourFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"ourFee\", numericValue);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-2\">\n                <div>\n                  <Label htmlFor=\"fullRecordingFee\">100% Recording Fee ($)</Label>\n                  <Input\n                    id=\"fullRecordingFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"fullRecordingFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"fullRecordingFee\", numericValue);\n                      \n                      // Calculate our recording fee by summing ownership from checked artist/label rows\n                      const ourOwnershipTotal = artistLabels\n                        .filter(al => al.isMine)\n                        .reduce((sum, al) => {\n                          const ownership = parseFloat(al.labelOwnership) || 0;\n                          return sum + ownership;\n                        }, 0);\n                      \n                      if (ourOwnershipTotal > 0) {\n                        const ourRecordingFee = calculateOurFeeFromOwnership(numericValue, ourOwnershipTotal);\n                        form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                      } else if (selectedSong && selectedSong.masterOwnership) {\n                        // Fallback to song's master ownership if no artist/label splits checked\n                        const ownershipPct = parseFloat(selectedSong.masterOwnership.toString());\n                        const ourRecordingFee = calculateOurFeeFromOwnership(numericValue, ownershipPct);\n                        form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                      } else {\n                        // Final fallback to artist/label splits text parsing\n                        const artistLabelSplitsText = form.watch(\"artistLabelSplits\") || \"\";\n                        if (artistLabelSplitsText) {\n                          const ourRecordingFee = calculateOurFee(numericValue, artistLabelSplitsText);\n                          form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                        }\n                      }\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"ourRecordingFee\">Our Recording Fee ($)</Label>\n                  <Input\n                    id=\"ourRecordingFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"ourRecordingFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"ourRecordingFee\", numericValue);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-2\">\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"exclusivity\"\n                    checked={form.watch(\"exclusivity\") ?? false}\n                    onCheckedChange={(checked) => form.setValue(\"exclusivity\", checked)}\n                  />\n                  <Label htmlFor=\"exclusivity\">Exclusive Deal</Label>\n                </div>\n                <div>\n                  <Label htmlFor=\"exclusivityRestrictions\">Exclusivity Restrictions</Label>\n                  <Input\n                    id=\"exclusivityRestrictions\"\n                    {...form.register(\"exclusivityRestrictions\")}\n                    placeholder=\"Describe any exclusivity restrictions\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 gap-4\">\n                <div>\n                  <Label htmlFor=\"options\">Options</Label>\n                  <Textarea\n                    id=\"options\"\n                    {...form.register(\"options\")}\n                    placeholder=\"Additional options, notes, or special terms for this deal\"\n                    rows={2}\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Section 3: Contacts */}\n          <Card className=\"bg-yellow-50 border-yellow-200\">\n            <CardHeader className=\"bg-yellow-100 border-b border-yellow-200 py-1\">\n              <CardTitle className=\"flex items-center space-x-2 text-yellow-800\">\n                <User className=\"h-5 w-5\" />\n                <span>Contacts</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1 bg-yellow-50 p-3\">\n              {/* Music Supervisor */}\n              <div>\n                <h4 className=\"font-medium mb-1 flex items-center space-x-2\">\n                  <User className=\"h-4 w-4\" />\n                  <span>Music Supervisor</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div>\n                    <Label htmlFor=\"contactId\">Supervisor Name</Label>\n                    <div className=\"flex gap-2\">\n                      <div className=\"flex-1\">\n                        <Command className=\"rounded-lg border shadow-md\">\n                          <CommandInput \n                            placeholder=\"Type to search contacts...\"\n                            value={contactSearchValue}\n                            onValueChange={setContactSearchValue}\n                            onFocus={() => setContactSearchOpen(true)}\n                            onBlur={() => {\n                              setTimeout(() => {\n                                setContactSearchOpen(false);\n                              }, 200);\n                            }}\n                          />\n                          {contactSearchOpen && (\n                            <CommandList>\n                              <CommandEmpty>No contact found.</CommandEmpty>\n                              <CommandGroup>\n                                {contacts.map((contact) => (\n                                  <CommandItem\n                                    key={contact.id}\n                                    value={`${contact.name} ${contact.company || ''}`}\n                                    onSelect={() => {\n                                      const contactId = contact.id;\n                                      form.setValue(\"contactId\", contactId);\n                                      setContactSearchValue(`${contact.name}${contact.company ? ` (${contact.company})` : ''}`);\n                                      setContactSearchOpen(false);\n                                      \n                                      // Auto-fill contact information when supervisor is selected\n                                      form.setValue(\"musicSupervisorContactName\", contact.company || \"\");\n                                      form.setValue(\"musicSupervisorContactEmail\", contact.email || \"\");\n                                      form.setValue(\"musicSupervisorContactPhone\", contact.phone || \"\");\n                                    }}\n                                  >\n                                    {contact.name} {contact.company && `(${contact.company})`}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          )}\n                        </Command>\n                      </div>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setShowAddContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    {form.formState.errors.contactId && (\n                      <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.contactId.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactName\">Company Name</Label>\n                    <Input\n                      id=\"musicSupervisorContactName\"\n                      {...form.register(\"musicSupervisorContactName\")}\n                      placeholder=\"Music company name\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 mt-2\">\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactEmail\">Email</Label>\n                    <Input\n                      id=\"musicSupervisorContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"musicSupervisorContactEmail\")}\n                      placeholder=\"supervisor@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactPhone\">Phone</Label>\n                    <Input\n                      id=\"musicSupervisorContactPhone\"\n                      {...form.register(\"musicSupervisorContactPhone\")}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Licensee / Production Company */}\n              <Separator />\n              <div>\n                <h4 className=\"font-medium mb-1 flex items-center space-x-2\">\n                  <Building className=\"h-4 w-4\" />\n                  <span>Licensee / Production Company</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div>\n                    <Label htmlFor=\"licenseeCompanyName\">Company Name</Label>\n                    <Input\n                      id=\"licenseeCompanyName\"\n                      {...form.register(\"licenseeCompanyName\")}\n                      placeholder=\"Production company name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeContactName\">Contact Name</Label>\n                    <Input\n                      id=\"licenseeContactName\"\n                      {...form.register(\"licenseeContactName\")}\n                      placeholder=\"Contact person name\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-4\">\n                  <div>\n                    <Label htmlFor=\"licenseeContactEmail\">Email</Label>\n                    <Input\n                      id=\"licenseeContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"licenseeContactEmail\")}\n                      placeholder=\"contact@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeContactPhone\">Phone</Label>\n                    <Input\n                      id=\"licenseeContactPhone\"\n                      {...form.register(\"licenseeContactPhone\")}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeAddress\">Address</Label>\n                    <Input\n                      id=\"licenseeAddress\"\n                      {...form.register(\"licenseeAddress\")}\n                      placeholder=\"Company address\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Clearance Company */}\n              <Separator />\n              <div>\n                <h4 className=\"font-medium mb-1 flex items-center space-x-2\">\n                  <Building className=\"h-4 w-4\" />\n                  <span>Clearance Company</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyName\">Company Name</Label>\n                    <Input\n                      id=\"clearanceCompanyName\"\n                      {...form.register(\"clearanceCompanyName\")}\n                      placeholder=\"Clearance company name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactName\">Contact Name</Label>\n                    <Input\n                      id=\"clearanceCompanyContactName\"\n                      {...form.register(\"clearanceCompanyContactName\")}\n                      placeholder=\"Contact person name\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-4\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactEmail\">Email</Label>\n                    <Input\n                      id=\"clearanceCompanyContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"clearanceCompanyContactEmail\")}\n                      placeholder=\"clearance@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactPhone\">Phone</Label>\n                    <Input\n                      id=\"clearanceCompanyContactPhone\"\n                      {...form.register(\"clearanceCompanyContactPhone\")}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyAddress\">Address</Label>\n                    <Input\n                      id=\"clearanceCompanyAddress\"\n                      {...form.register(\"clearanceCompanyAddress\")}\n                      placeholder=\"Company address\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Section 4: Additional Information */}\n          <Card className=\"bg-green-50 border-green-200\">\n            <CardHeader className=\"bg-green-100 border-b border-green-200 py-1\">\n              <CardTitle className=\"flex items-center space-x-2 text-green-800\">\n                <FileText className=\"h-5 w-5\" />\n                <span>Additional Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1 bg-green-50 p-3\">\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  {...form.register(\"notes\")}\n                  placeholder=\"Additional notes about the deal\"\n                  rows={2}\n                />\n              </div>\n\n              {/* Status Date Fields */}\n              <div className=\"border-t pt-2\">\n                <h4 className=\"font-medium mb-2\">Status Dates</h4>\n                <div className=\"grid grid-cols-4 gap-3\">\n                  <div>\n                    <Label htmlFor=\"pitchedDate\" className=\"text-sm\">New Request</Label>\n                    <Input\n                      id=\"pitchedDate\"\n                      type=\"date\"\n                      {...form.register(\"pitchedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"pendingApprovalDate\" className=\"text-sm\">Pending Approval</Label>\n                    <Input\n                      id=\"pendingApprovalDate\"\n                      type=\"date\"\n                      {...form.register(\"pendingApprovalDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"quotedDate\" className=\"text-sm\">Quoted</Label>\n                    <Input\n                      id=\"quotedDate\"\n                      type=\"date\"\n                      {...form.register(\"quotedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"useConfirmedDate\" className=\"text-sm\">Use Confirmed</Label>\n                    <Input\n                      id=\"useConfirmedDate\"\n                      type=\"date\"\n                      {...form.register(\"useConfirmedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-4 gap-3 mt-2\">\n                  <div>\n                    <Label htmlFor=\"beingDraftedDate\" className=\"text-sm\">Being Drafted</Label>\n                    <Input\n                      id=\"beingDraftedDate\"\n                      type=\"date\"\n                      {...form.register(\"beingDraftedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"outForSignatureDate\" className=\"text-sm\">Out for Signature</Label>\n                    <Input\n                      id=\"outForSignatureDate\"\n                      type=\"date\"\n                      {...form.register(\"outForSignatureDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"paymentReceivedDate\" className=\"text-sm\">Payment Received</Label>\n                    <Input\n                      id=\"paymentReceivedDate\"\n                      type=\"date\"\n                      {...form.register(\"paymentReceivedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"completedDate\" className=\"text-sm\">Completed</Label>\n                    <Input\n                      id=\"completedDate\"\n                      type=\"date\"\n                      {...form.register(\"completedDate\")}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"sticky bottom-0 bg-background border-t pt-2 mt-2 flex justify-end space-x-2 z-10\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={createDealMutation.isPending}>\n              {createDealMutation.isPending ? \"Creating...\" : isEditing ? \"Update Deal\" : \"Create Deal\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n      \n      {/* Add Contact Form */}\n      <AddContactForm \n        open={showAddContact}\n        onClose={() => setShowAddContact(false)}\n        onContactCreated={(newContact) => {\n          console.log(\"New contact created:\", newContact);\n          \n          // Refresh contacts query\n          queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n          \n          // Auto-select the new contact and fill form\n          setTimeout(() => {\n            form.setValue(\"contactId\", newContact.id);\n            form.setValue(\"musicSupervisorContactName\", newContact.company || \"\");\n            form.setValue(\"musicSupervisorContactEmail\", newContact.email || \"\");\n            form.setValue(\"musicSupervisorContactPhone\", newContact.phone || \"\");\n            \n            // Trigger form update\n            form.trigger(['contactId', 'musicSupervisorContactName', 'musicSupervisorContactEmail', 'musicSupervisorContactPhone']);\n          }, 100);\n          \n          setShowAddContact(false);\n        }}\n        defaultRole=\"Music Supervisor\"\n      />\n    </Dialog>\n  );\n}","size_bytes":66504},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/income.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport AddPaymentForm from \"@/components/forms/add-payment-form\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { DollarSign, Calendar, AlertTriangle, CheckCircle, Clock, Edit, Trash2 } from \"lucide-react\";\nimport type { Payment } from \"@shared/schema\";\n\nexport default function Income() {\n  const [showAddPayment, setShowAddPayment] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const { data: payments = [], isLoading } = useQuery<Payment[]>({\n    queryKey: [\"/api/payments\"],\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"pending\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"paid\":\n        return \"bg-green-100 text-green-800\";\n      case \"overdue\":\n        return \"bg-red-100 text-red-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"pending\":\n        return <Clock className=\"h-4 w-4\" />;\n      case \"paid\":\n        return <CheckCircle className=\"h-4 w-4\" />;\n      case \"overdue\":\n        return <AlertTriangle className=\"h-4 w-4\" />;\n      default:\n        return <DollarSign className=\"h-4 w-4\" />;\n    }\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"N/A\";\n    return new Date(date).toLocaleDateString();\n  };\n\n  const formatCurrency = (amount: string | null) => {\n    if (!amount) return \"$0.00\";\n    return `$${Number(amount).toLocaleString()}`;\n  };\n\n  const isOverdue = (payment: Payment) => {\n    if (payment.status === \"paid\") return false;\n    return new Date(payment.dueDate) < new Date();\n  };\n\n  const filteredPayments = activeTab === \"all\" \n    ? payments \n    : payments.filter(payment => {\n        if (activeTab === \"overdue\") {\n          return isOverdue(payment);\n        }\n        return payment.status === activeTab;\n      });\n\n  // Calculate totals\n  const totalPending = payments\n    .filter(p => p.status === \"pending\")\n    .reduce((sum, p) => sum + Number(p.amount), 0);\n\n  const totalPaid = payments\n    .filter(p => p.status === \"paid\")\n    .reduce((sum, p) => sum + Number(p.amount), 0);\n\n  const totalOverdue = payments\n    .filter(p => isOverdue(p))\n    .reduce((sum, p) => sum + Number(p.amount), 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-lg text-gray-600\">Loading payments...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Income Tracking\"\n        description=\"Track payments and revenue from your sync licensing deals\"\n        searchPlaceholder=\"Search payments, deals...\"\n        newItemLabel=\"Add Payment\"\n        onNewItem={() => setShowAddPayment(true)}\n      />\n      \n      <div className=\"p-6\">\n        {/* Summary Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Total Paid</p>\n                  <p className=\"text-2xl font-bold text-green-600\">${totalPaid.toLocaleString()}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n                  <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Pending</p>\n                  <p className=\"text-2xl font-bold text-yellow-600\">${totalPending.toLocaleString()}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center\">\n                  <Clock className=\"h-6 w-6 text-yellow-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Overdue</p>\n                  <p className=\"text-2xl font-bold text-red-600\">${totalOverdue.toLocaleString()}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center\">\n                  <AlertTriangle className=\"h-6 w-6 text-red-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"mb-6\">\n          <TabsList>\n            <TabsTrigger value=\"all\">All Payments</TabsTrigger>\n            <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n            <TabsTrigger value=\"paid\">Paid</TabsTrigger>\n            <TabsTrigger value=\"overdue\">Overdue</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value={activeTab} className=\"mt-6\">\n            {filteredPayments.length === 0 ? (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-16\">\n                  <DollarSign className=\"h-12 w-12 text-gray-400 mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No payments found</h3>\n                  <p className=\"text-gray-600 text-center mb-6\">\n                    {activeTab === \"all\"\n                      ? \"Start tracking your income by adding your first payment record.\"\n                      : `No ${activeTab} payments found.`\n                    }\n                  </p>\n                  <Button onClick={() => setShowAddPayment(true)} className=\"bg-brand-primary hover:bg-blue-700\">\n                    Add Your First Payment\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid gap-6\">\n                {filteredPayments.map((payment) => (\n                  <Card key={payment.id} className={`hover:shadow-md transition-shadow ${\n                    isOverdue(payment) ? \"border-red-200 bg-red-50\" : \"\"\n                  }`}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start space-x-4\">\n                          <div className=\"w-16 h-16 bg-brand-primary/10 rounded-lg flex items-center justify-center\">\n                            {getStatusIcon(payment.status)}\n                          </div>\n                          \n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center space-x-2 mb-2\">\n                              <h3 className=\"text-lg font-semibold text-gray-900\">\n                                Payment #{payment.id}\n                              </h3>\n                              <Badge className={getStatusColor(payment.status)}>\n                                {payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}\n                              </Badge>\n                              {isOverdue(payment) && (\n                                <Badge variant=\"destructive\">\n                                  Overdue\n                                </Badge>\n                              )}\n                            </div>\n                            \n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4\">\n                              <div>\n                                <p className=\"font-medium text-gray-900\">Amount</p>\n                                <p className=\"text-lg font-semibold\">{formatCurrency(payment.amount)}</p>\n                              </div>\n                              \n                              <div>\n                                <p className=\"font-medium text-gray-900\">Due Date</p>\n                                <div className=\"flex items-center space-x-1\">\n                                  <Calendar className=\"h-4 w-4 text-gray-400\" />\n                                  <span>{formatDate(payment.dueDate)}</span>\n                                </div>\n                              </div>\n                              \n                              {payment.paidDate && (\n                                <div>\n                                  <p className=\"font-medium text-gray-900\">Paid Date</p>\n                                  <div className=\"flex items-center space-x-1\">\n                                    <Calendar className=\"h-4 w-4 text-gray-400\" />\n                                    <span>{formatDate(payment.paidDate)}</span>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                            \n                            {payment.notes && (\n                              <div className=\"mt-3\">\n                                <p className=\"text-sm font-medium text-gray-700 mb-1\">Notes:</p>\n                                <p className=\"text-sm text-gray-600\">{payment.notes}</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex space-x-2\">\n                          <Button size=\"sm\" variant=\"outline\">\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          {payment.status === \"pending\" && (\n                            <Button size=\"sm\" className=\"bg-brand-secondary hover:bg-emerald-700\">\n                              Mark Paid\n                            </Button>\n                          )}\n                          <Button size=\"sm\" variant=\"outline\" className=\"text-red-600 hover:text-red-700\">\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <AddPaymentForm open={showAddPayment} onClose={() => setShowAddPayment(false)} />\n    </div>\n  );\n}\n","size_bytes":10855},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/advanced-features.tsx":{"content":"import Header from \"@/components/layout/header\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport SmartPitchMatching from \"@/components/smart-pitch-matching\";\nimport InvoiceManagement from \"@/components/invoice-management\";\nimport ExpenseTracking from \"@/components/expense-tracking\";\nimport { Brain, FileText, Receipt, MessageSquare, CheckSquare, BarChart3 } from \"lucide-react\";\n\nexport default function AdvancedFeatures() {\n  return (\n    <div className=\"flex-1 space-y-4 p-4 md:p-8 pt-6\">\n      <Header \n        title=\"Advanced Features\" \n        description=\"AI-powered tools and business management features\"\n      />\n      \n      <Tabs defaultValue=\"smart-pitch\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-6\">\n          <TabsTrigger value=\"smart-pitch\" className=\"flex items-center gap-2\">\n            <Brain className=\"h-4 w-4\" />\n            Smart Pitch\n          </TabsTrigger>\n          <TabsTrigger value=\"invoices\" className=\"flex items-center gap-2\">\n            <FileText className=\"h-4 w-4\" />\n            Invoices\n          </TabsTrigger>\n          <TabsTrigger value=\"expenses\" className=\"flex items-center gap-2\">\n            <Receipt className=\"h-4 w-4\" />\n            Expenses\n          </TabsTrigger>\n          <TabsTrigger value=\"messaging\" className=\"flex items-center gap-2\">\n            <MessageSquare className=\"h-4 w-4\" />\n            Messaging\n          </TabsTrigger>\n          <TabsTrigger value=\"approvals\" className=\"flex items-center gap-2\">\n            <CheckSquare className=\"h-4 w-4\" />\n            Approvals\n          </TabsTrigger>\n          <TabsTrigger value=\"insights\" className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-4 w-4\" />\n            Insights\n          </TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"smart-pitch\" className=\"space-y-4\">\n          <SmartPitchMatching />\n        </TabsContent>\n        \n        <TabsContent value=\"invoices\" className=\"space-y-4\">\n          <InvoiceManagement />\n        </TabsContent>\n        \n        <TabsContent value=\"expenses\" className=\"space-y-4\">\n          <ExpenseTracking />\n        </TabsContent>\n        \n        <TabsContent value=\"messaging\" className=\"space-y-4\">\n          <div className=\"text-center py-12\">\n            <MessageSquare className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Integrated Messaging</h3>\n            <p className=\"text-gray-600 mb-4\">\n              Communicate directly with contacts and manage conversations within deals.\n              Features include email integration, SMS capabilities, and chat history tracking.\n            </p>\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"approvals\" className=\"space-y-4\">\n          <div className=\"text-center py-12\">\n            <CheckSquare className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Approval Workflows</h3>\n            <p className=\"text-gray-600 mb-4\">\n              Set up multi-step approval processes for contracts, deals, and payments.\n              Track progress through approval stages and manage stakeholder sign-offs.\n            </p>\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"insights\" className=\"space-y-4\">\n          <div className=\"text-center py-12\">\n            <BarChart3 className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Market Intelligence</h3>\n            <p className=\"text-gray-600 mb-4\">\n              Industry trend analysis, competitive pricing insights, and performance analytics.\n              Track which songs perform best across different media types and markets.\n            </p>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":3944},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, decimal, timestamp, jsonb, real, date, bigint } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const songs = pgTable(\"songs\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  artist: text(\"artist\").notNull(),\n  album: text(\"album\"),\n  composer: text(\"composer\"),\n  producer: text(\"producer\"),\n  publisher: text(\"publisher\"),\n  irc: text(\"irc\"), // International Recording Code\n  isrc: text(\"isrc\"), // International Standard Recording Code\n  upcEan: text(\"upc_ean\"), // UPC/EAN barcode\n  pNumbers: text(\"p_numbers\"), // (P) Numbers\n  proCueSheetId: text(\"pro_cue_sheet_id\"),\n  genreSubGenre: text(\"genre_sub_genre\"),\n  moodTheme: text(\"mood_theme\"),\n  bpmKey: text(\"bpm_key\"),\n  vocalInstrumentation: text(\"vocal_instrumentation\"),\n  explicitContent: boolean(\"explicit_content\").default(false),\n  lyrics: text(\"lyrics\"),\n  durationFormatted: text(\"duration_formatted\"), // MM:SS format\n  version: text(\"version\"),\n  coverArtDescription: text(\"cover_art_description\"),\n  fileTypeSampleRate: text(\"file_type_sample_rate\"),\n  contentRepresentationCode: text(\"content_representation_code\"),\n  masterRightsContact: text(\"master_rights_contact\"),\n  publishingRightsContact: text(\"publishing_rights_contact\"),\n  syncRepresentation: text(\"sync_representation\"),\n  contentRepresented: text(\"content_represented\"),\n  smartLinkQrCode: text(\"smart_link_qr_code\"),\n  // Legacy fields for backward compatibility\n  genre: text(\"genre\"),\n  mood: text(\"mood\"),\n  tempo: integer(\"tempo\"),\n  duration: integer(\"duration\"), // in seconds\n  key: text(\"key\"),\n  bpm: integer(\"bpm\"),\n  description: text(\"description\"),\n  tags: text(\"tags\").array(),\n  filePath: text(\"file_path\"),\n  // Ownership percentages\n  publishingOwnership: decimal(\"publishing_ownership\", { precision: 5, scale: 2 }), // Our publishing ownership percentage (0-100)\n  masterOwnership: decimal(\"master_ownership\", { precision: 5, scale: 2 }), // Our master recording ownership percentage (0-100)\n  splitDetails: text(\"split_details\"), // Detailed breakdown of all splits\n  restrictions: text(\"restrictions\"), // Usage restrictions or limitations\n  // Structured ownership data\n  composerPublishers: jsonb(\"composer_publishers\"), // Array of {composer, publisher, publishingOwnership, isMine}\n  artistLabels: jsonb(\"artist_labels\"), // Array of {artist, label, labelOwnership, isMine}\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const contacts = pgTable(\"contacts\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  phone: text(\"phone\"),\n  company: text(\"company\"),\n  role: text(\"role\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const deals = pgTable(\"deals\", {\n  id: serial(\"id\").primaryKey(),\n  projectName: text(\"project_name\").notNull(),\n  episodeNumber: text(\"episode_number\"),\n  projectType: text(\"project_type\").notNull(), // commercial, documentary, film, game, indie_film, non_profit, podcast, promos, sports, student_film, trailers, tv, etc.\n  projectDescription: text(\"project_description\"),\n  songId: integer(\"song_id\").references(() => songs.id).notNull(),\n  contactId: integer(\"contact_id\").references(() => contacts.id).notNull(),\n  \n  // Contact Information\n  licenseeCompanyName: text(\"licensee_company_name\"),\n  licenseeAddress: text(\"licensee_address\"),\n  licenseeContactName: text(\"licensee_contact_name\"),\n  licenseeContactEmail: text(\"licensee_contact_email\"),\n  licenseeContactPhone: text(\"licensee_contact_phone\"),\n  \n  musicSupervisorName: text(\"music_supervisor_name\"),\n  musicSupervisorAddress: text(\"music_supervisor_address\"),\n  musicSupervisorContactName: text(\"music_supervisor_contact_name\"),\n  musicSupervisorContactEmail: text(\"music_supervisor_contact_email\"),\n  musicSupervisorContactPhone: text(\"music_supervisor_contact_phone\"),\n  \n  clearanceCompanyName: text(\"clearance_company_name\"),\n  clearanceCompanyAddress: text(\"clearance_company_address\"),\n  clearanceCompanyContactName: text(\"clearance_company_contact_name\"),\n  clearanceCompanyContactEmail: text(\"clearance_company_contact_email\"),\n  clearanceCompanyContactPhone: text(\"clearance_company_contact_phone\"),\n  \n  status: text(\"status\").notNull().default(\"new request\"), // New Request, Pending Approval, Quoted, Use Confirmed, Being Drafted, Out for Signature, Payment Received, Completed\n  \n  // Status change dates\n  pitchedDate: timestamp(\"pitched_date\"),\n  pendingApprovalDate: timestamp(\"pending_approval_date\"),\n  quotedDate: timestamp(\"quoted_date\"),\n  useConfirmedDate: timestamp(\"use_confirmed_date\"),\n  beingDraftedDate: timestamp(\"being_drafted_date\"),\n  outForSignatureDate: timestamp(\"out_for_signature_date\"),\n  paymentReceivedDate: timestamp(\"payment_received_date\"),\n  completedDate: timestamp(\"completed_date\"),\n  dealValue: decimal(\"deal_value\", { precision: 10, scale: 2 }),\n  fullSongValue: decimal(\"full_song_value\", { precision: 10, scale: 2 }),\n  ourFee: decimal(\"our_fee\", { precision: 10, scale: 2 }),\n  fullRecordingFee: decimal(\"full_recording_fee\", { precision: 10, scale: 2 }),\n  ourRecordingFee: decimal(\"our_recording_fee\", { precision: 10, scale: 2 }),\n  usage: text(\"usage\"), // background, featured, opening, etc.\n  sceneDescription: text(\"scene_description\"), // how music is used in the scene\n  media: text(\"media\"), // TV, Film, Commercial, etc.\n  territory: text(\"territory\").default(\"worldwide\"),\n  term: text(\"term\"), // perpetual, 1 year, etc.\n  exclusivity: boolean(\"exclusivity\").default(false),\n  exclusivityRestrictions: text(\"exclusivity_restrictions\"),\n  options: text(\"options\"), // Additional options, notes, or special terms\n  \n  // Song Information\n  writers: text(\"writers\"),\n  publishingInfo: text(\"publishing_info\"),\n  splits: text(\"splits\"),\n  artist: text(\"artist\"),\n  label: text(\"label\"),\n  artistLabelSplits: text(\"artist_label_splits\"),\n  restrictions: text(\"restrictions\"), // Usage restrictions for this deal\n  \n  notes: text(\"notes\"),\n  airDate: timestamp(\"air_date\"),\n  pitchDate: timestamp(\"pitch_date\"),\n  responseDate: timestamp(\"response_date\"),\n  confirmationDate: timestamp(\"confirmation_date\"),\n  completionDate: timestamp(\"completion_date\"),\n  paymentDate: timestamp(\"payment_date\"),\n  paymentDueDate: timestamp(\"payment_due_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const pitches = pgTable(\"pitches\", {\n  id: serial(\"id\").primaryKey(),\n  dealId: integer(\"deal_id\").references(() => deals.id),\n  customDealName: text(\"custom_deal_name\"),\n  submissionDate: timestamp(\"submission_date\").defaultNow().notNull(),\n  followUpDate: timestamp(\"follow_up_date\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, responded, no_response\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const payments = pgTable(\"payments\", {\n  id: serial(\"id\").primaryKey(),\n  dealId: integer(\"deal_id\").references(() => deals.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  dueDate: timestamp(\"due_date\").notNull(),\n  paidDate: timestamp(\"paid_date\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, paid, overdue\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const templates = pgTable(\"templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // contract, quote, invoice, etc.\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const emailTemplates = pgTable(\"email_templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  stage: text(\"stage\").notNull(), // 'initial_pitch', 'follow_up', 'negotiation', 'contract_sent', etc.\n  subject: text(\"subject\").notNull(),\n  body: text(\"body\").notNull(),\n  variables: jsonb(\"variables\").default([]), // placeholders like {{clientName}}, {{songTitle}}\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const emailSends = pgTable(\"email_sends\", {\n  id: serial(\"id\").primaryKey(),\n  templateId: integer(\"template_id\").references(() => emailTemplates.id),\n  dealId: integer(\"deal_id\").references(() => deals.id),\n  contactId: integer(\"contact_id\").references(() => contacts.id),\n  songId: integer(\"song_id\").references(() => songs.id),\n  to: text(\"to\").notNull(), // recipient email address\n  subject: text(\"subject\").notNull(), // rendered subject with placeholders replaced\n  body: text(\"body\").notNull(), // rendered body with placeholders replaced\n  status: text(\"status\").notNull().default(\"sent\"), // sent, delivered, failed, bounced\n  providerMessageId: text(\"provider_message_id\"), // ID from email provider (Resend)\n  error: text(\"error\"), // error message if failed\n  sentAt: timestamp(\"sent_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attachments = pgTable(\"attachments\", {\n  id: serial(\"id\").primaryKey(),\n  filename: text(\"filename\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  mimeType: text(\"mime_type\").notNull(),\n  size: integer(\"size\").notNull(),\n  path: text(\"path\").notNull(),\n  entityType: text(\"entity_type\").notNull(), // 'deal', 'song', 'contact', 'pitch'\n  entityId: integer(\"entity_id\").notNull(),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const calendarEvents = pgTable(\"calendar_events\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\"),\n  allDay: boolean(\"all_day\").default(false),\n  entityType: text(\"entity_type\").notNull(), // 'deal', 'pitch', 'payment'\n  entityId: integer(\"entity_id\").notNull(),\n  reminderMinutes: integer(\"reminder_minutes\").default(60),\n  status: text(\"status\").default('scheduled'), // 'scheduled', 'completed', 'cancelled'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const playlists = pgTable(\"playlists\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  type: text(\"type\").notNull(), // 'client', 'genre', 'mood', 'project', 'custom'\n  clientId: integer(\"client_id\"),\n  isPublic: boolean(\"is_public\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const playlistSongs = pgTable(\"playlist_songs\", {\n  id: serial(\"id\").primaryKey(),\n  playlistId: integer(\"playlist_id\").notNull(),\n  songId: integer(\"song_id\").notNull(),\n  position: integer(\"position\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const savedSearches = pgTable(\"saved_searches\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  searchCriteria: text(\"search_criteria\").notNull(), // JSON string\n  entityType: text(\"entity_type\").notNull(), // 'songs', 'deals', 'contacts', etc.\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const bulkPitches = pgTable(\"bulk_pitches\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  contactId: integer(\"contact_id\").notNull(),\n  playlistId: integer(\"playlist_id\"),\n  emailTemplateId: integer(\"email_template_id\"),\n  status: text(\"status\").default(\"draft\"), // 'draft', 'sent', 'responded'\n  sentDate: timestamp(\"sent_date\"),\n  responseDate: timestamp(\"response_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const bulkPitchSongs = pgTable(\"bulk_pitch_songs\", {\n  id: serial(\"id\").primaryKey(),\n  bulkPitchId: integer(\"bulk_pitch_id\").notNull(),\n  songId: integer(\"song_id\").notNull(),\n  status: text(\"status\").default(\"pending\"), // 'pending', 'accepted', 'rejected', 'maybe'\n  feedback: text(\"feedback\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const clientProfiles = pgTable(\"client_profiles\", {\n  id: serial(\"id\").primaryKey(),\n  contactId: integer(\"contact_id\").notNull(),\n  preferredGenres: text(\"preferred_genres\").array(),\n  preferredMoods: text(\"preferred_moods\").array(),\n  budgetRange: text(\"budget_range\"),\n  projectTypes: text(\"project_types\").array(),\n  communicationPreferences: text(\"communication_preferences\"),\n  successRate: real(\"success_rate\").default(0),\n  totalDeals: integer(\"total_deals\").default(0),\n  averageDealValue: real(\"average_deal_value\").default(0),\n  lastContactDate: timestamp(\"last_contact_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const workflowAutomation = pgTable(\"workflow_automation\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  triggerType: text(\"trigger_type\").notNull(), // 'date', 'status_change', 'time_elapsed'\n  triggerCondition: text(\"trigger_condition\").notNull(), // JSON string\n  actionType: text(\"action_type\").notNull(), // 'email', 'notification', 'status_update'\n  actionData: text(\"action_data\").notNull(), // JSON string\n  isActive: boolean(\"is_active\").default(true),\n  entityType: text(\"entity_type\").notNull(), // 'deal', 'pitch', 'payment'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const analyticsEvents = pgTable(\"analytics_events\", {\n  id: serial(\"id\").primaryKey(),\n  eventType: text(\"event_type\").notNull(), // 'song_pitched', 'deal_created', 'payment_received'\n  entityType: text(\"entity_type\").notNull(),\n  entityId: integer(\"entity_id\").notNull(),\n  metadata: text(\"metadata\"), // JSON string\n  value: real(\"value\"), // monetary value if applicable\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n});\n\n// Rights Clearance Tracker\nexport const rightsClearances = pgTable(\"rights_clearances\", {\n  id: serial(\"id\").primaryKey(),\n  songId: integer(\"song_id\").references(() => songs.id, { onDelete: 'cascade' }),\n  publishingSplits: jsonb(\"publishing_splits\"), // Array of {publisher, percentage}\n  mechanicalRights: text(\"mechanical_rights\").default(\"cleared\"), // cleared, pending, issues\n  syncClearance: text(\"sync_clearance\").default(\"cleared\"), // cleared, pending, issues\n  masterOwner: text(\"master_owner\"),\n  publishingAdmin: text(\"publishing_admin\"),\n  clearanceNotes: text(\"clearance_notes\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow().notNull(),\n});\n\n// Version Control System\nexport const songVersions = pgTable(\"song_versions\", {\n  id: serial(\"id\").primaryKey(),\n  originalSongId: integer(\"original_song_id\").references(() => songs.id, { onDelete: 'cascade' }),\n  versionType: text(\"version_type\").notNull(), // mix, edit, stem, instrumental, etc.\n  versionName: text(\"version_name\").notNull(),\n  duration: integer(\"duration\"), // in seconds\n  fileUrl: text(\"file_url\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Smart Pitch Matching with Themes\nexport const smartPitchMatches = pgTable(\"smart_pitch_matches\", {\n  id: serial(\"id\").primaryKey(),\n  songId: integer(\"song_id\").references(() => songs.id, { onDelete: 'cascade' }),\n  dealId: integer(\"deal_id\").references(() => deals.id, { onDelete: 'cascade' }),\n  matchScore: decimal(\"match_score\", { precision: 3, scale: 2 }), // 0-10\n  analysis: jsonb(\"analysis\").notNull(), // Full AI analysis\n  themes: jsonb(\"themes\"), // Christmas, Mother's Day, Siblings, etc.\n  seasonality: jsonb(\"seasonality\"), // Holiday, Summer, etc.\n  occasions: jsonb(\"occasions\"), // Wedding, Graduation, etc.\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Invoice Generation\nexport const invoices = pgTable(\"invoices\", {\n  id: serial(\"id\").primaryKey(),\n  dealId: integer(\"deal_id\").references(() => deals.id, { onDelete: 'cascade' }),\n  invoiceNumber: text(\"invoice_number\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  taxAmount: decimal(\"tax_amount\", { precision: 10, scale: 2 }).default(\"0\"),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").default(\"draft\"), // draft, sent, paid, overdue\n  dueDate: date(\"due_date\"),\n  paidDate: date(\"paid_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Expense Tracking\nexport const expenses = pgTable(\"expenses\", {\n  id: serial(\"id\").primaryKey(),\n  songId: integer(\"song_id\").references(() => songs.id, { onDelete: 'cascade' }),\n  category: text(\"category\").notNull(), // production, marketing, legal, etc.\n  description: text(\"description\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  date: date(\"date\").notNull(),\n  receipt: text(\"receipt_url\"),\n  taxDeductible: boolean(\"tax_deductible\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Integrated Messaging\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  fromUserId: integer(\"from_user_id\"), // For future user system\n  toContactId: integer(\"to_contact_id\").references(() => contacts.id, { onDelete: 'cascade' }),\n  dealId: integer(\"deal_id\").references(() => deals.id, { onDelete: 'cascade' }),\n  subject: text(\"subject\"),\n  message: text(\"message\").notNull(),\n  messageType: text(\"message_type\").default(\"email\"), // email, sms, chat\n  status: text(\"status\").default(\"sent\"), // sent, delivered, read, replied\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Approval Workflows\nexport const approvalWorkflows = pgTable(\"approval_workflows\", {\n  id: serial(\"id\").primaryKey(),\n  dealId: integer(\"deal_id\").references(() => deals.id, { onDelete: 'cascade' }),\n  workflowType: text(\"workflow_type\").notNull(), // contract, deal, payment\n  currentStage: text(\"current_stage\").notNull(),\n  stages: jsonb(\"stages\").notNull(), // Array of approval stages\n  approvers: jsonb(\"approvers\").notNull(), // Array of approver info\n  status: text(\"status\").default(\"pending\"), // pending, approved, rejected\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Relations\nexport const songsRelations = relations(songs, ({ many }) => ({\n  deals: many(deals),\n  playlistSongs: many(playlistSongs),\n}));\n\nexport const contactsRelations = relations(contacts, ({ many, one }) => ({\n  deals: many(deals),\n  clientProfile: one(clientProfiles, {\n    fields: [contacts.id],\n    references: [clientProfiles.contactId],\n  }),\n  bulkPitches: many(bulkPitches),\n}));\n\nexport const dealsRelations = relations(deals, ({ one, many }) => ({\n  song: one(songs, { fields: [deals.songId], references: [songs.id] }),\n  contact: one(contacts, { fields: [deals.contactId], references: [contacts.id] }),\n  pitches: many(pitches),\n  payments: many(payments),\n}));\n\nexport const pitchesRelations = relations(pitches, ({ one }) => ({\n  deal: one(deals, { fields: [pitches.dealId], references: [deals.id] }),\n}));\n\nexport const paymentsRelations = relations(payments, ({ one }) => ({\n  deal: one(deals, { fields: [payments.dealId], references: [deals.id] }),\n}));\n\nexport const playlistsRelations = relations(playlists, ({ one, many }) => ({\n  client: one(contacts, {\n    fields: [playlists.clientId],\n    references: [contacts.id],\n  }),\n  songs: many(playlistSongs),\n  bulkPitches: many(bulkPitches),\n}));\n\nexport const playlistSongsRelations = relations(playlistSongs, ({ one }) => ({\n  playlist: one(playlists, {\n    fields: [playlistSongs.playlistId],\n    references: [playlists.id],\n  }),\n  song: one(songs, {\n    fields: [playlistSongs.songId],\n    references: [songs.id],\n  }),\n}));\n\nexport const bulkPitchesRelations = relations(bulkPitches, ({ one, many }) => ({\n  contact: one(contacts, {\n    fields: [bulkPitches.contactId],\n    references: [contacts.id],\n  }),\n  playlist: one(playlists, {\n    fields: [bulkPitches.playlistId],\n    references: [playlists.id],\n  }),\n  emailTemplate: one(emailTemplates, {\n    fields: [bulkPitches.emailTemplateId],\n    references: [emailTemplates.id],\n  }),\n  songs: many(bulkPitchSongs),\n}));\n\nexport const bulkPitchSongsRelations = relations(bulkPitchSongs, ({ one }) => ({\n  bulkPitch: one(bulkPitches, {\n    fields: [bulkPitchSongs.bulkPitchId],\n    references: [bulkPitches.id],\n  }),\n  song: one(songs, {\n    fields: [bulkPitchSongs.songId],\n    references: [songs.id],\n  }),\n}));\n\nexport const clientProfilesRelations = relations(clientProfiles, ({ one }) => ({\n  contact: one(contacts, {\n    fields: [clientProfiles.contactId],\n    references: [contacts.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertSongSchema = createInsertSchema(songs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  // Handle numeric fields that might come as strings from forms\n  tempo: z.union([z.number(), z.string().transform(val => val === '' ? undefined : parseInt(val))]).optional().nullable(),\n  duration: z.union([z.number(), z.string().transform(val => val === '' ? undefined : parseInt(val))]).optional().nullable(),\n  bpm: z.union([z.number(), z.string().transform(val => val === '' ? undefined : parseInt(val))]).optional().nullable(),\n  // Handle ownership percentages\n  publishingOwnership: z.union([z.number(), z.string().transform(val => val === '' ? undefined : parseFloat(val))]).optional().nullable(),\n  masterOwnership: z.union([z.number(), z.string().transform(val => val === '' ? undefined : parseFloat(val))]).optional().nullable(),\n});\n\nexport const insertContactSchema = createInsertSchema(contacts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDealSchema = createInsertSchema(deals).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  // Allow string dates from forms that get converted server-side\n  airDate: z.string().optional().nullable(),\n  pitchDate: z.string().optional().nullable(), \n  responseDate: z.string().optional().nullable(),\n  confirmationDate: z.string().optional().nullable(),\n  completionDate: z.string().optional().nullable(),\n  paymentDate: z.string().optional().nullable(),\n  paymentDueDate: z.string().optional().nullable(),\n  // Status date fields\n  pitchedDate: z.string().optional().nullable(),\n  pendingApprovalDate: z.string().optional().nullable(),\n  quotedDate: z.string().optional().nullable(),\n  useConfirmedDate: z.string().optional().nullable(),\n  beingDraftedDate: z.string().optional().nullable(),\n  outForSignatureDate: z.string().optional().nullable(),\n  paymentReceivedDate: z.string().optional().nullable(),\n  completedDate: z.string().optional().nullable(),\n  // Allow string or number for numeric fields (coerced from form inputs)\n  songId: z.union([z.string(), z.number()]).transform((val) => typeof val === 'string' ? parseInt(val) : val),\n  contactId: z.union([z.string(), z.number()]).transform((val) => typeof val === 'string' ? parseInt(val) : val),\n  dealValue: z.union([z.string(), z.number()]).transform((val) => {\n    if (val === null || val === undefined || val === '') return null;\n    return typeof val === 'string' ? parseFloat(val) : val;\n  }).nullable().optional(),\n  fullSongValue: z.union([z.string(), z.number()]).transform((val) => {\n    if (val === null || val === undefined || val === '') return null;\n    return typeof val === 'string' ? parseFloat(val) : val;\n  }).nullable().optional(),\n  ourFee: z.union([z.string(), z.number()]).transform((val) => {\n    if (val === null || val === undefined || val === '') return null;\n    return typeof val === 'string' ? parseFloat(val) : val;\n  }).nullable().optional(),\n  fullRecordingFee: z.union([z.string(), z.number()]).transform((val) => {\n    if (val === null || val === undefined || val === '') return null;\n    return typeof val === 'string' ? parseFloat(val) : val;\n  }).nullable().optional(),\n  ourRecordingFee: z.union([z.string(), z.number()]).transform((val) => {\n    if (val === null || val === undefined || val === '') return null;\n    return typeof val === 'string' ? parseFloat(val) : val;\n  }).nullable().optional(),\n}).partial().extend({\n  // Explicitly require these fields\n  projectName: z.string().min(1, \"Project name is required\"),\n  projectType: z.string().min(1, \"Project type is required\"),\n  songId: z.union([z.string(), z.number()]).transform((val) => typeof val === 'string' ? parseInt(val) : val).refine((val) => val > 0, \"Song selection is required\"),\n  contactId: z.union([z.string(), z.number()]).transform((val) => typeof val === 'string' ? parseInt(val) : val).refine((val) => val > 0, \"Contact selection is required\"),\n});\n\nexport const insertPitchSchema = createInsertSchema(pitches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTemplateSchema = createInsertSchema(templates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  name: z.string().min(1, \"Template name is required\"),\n  type: z.string().min(1, \"Template type is required\"),\n  content: z.string().min(1, \"Template content is required\"),\n});\n\nexport const insertEmailTemplateSchema = createInsertSchema(emailTemplates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEmailSendSchema = createInsertSchema(emailSends).omit({\n  id: true,\n  createdAt: true,\n  sentAt: true,\n});\n\nexport const insertAttachmentSchema = createInsertSchema(attachments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCalendarEventSchema = createInsertSchema(calendarEvents).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPlaylistSchema = createInsertSchema(playlists).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPlaylistSongSchema = createInsertSchema(playlistSongs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSavedSearchSchema = createInsertSchema(savedSearches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertBulkPitchSchema = createInsertSchema(bulkPitches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertBulkPitchSongSchema = createInsertSchema(bulkPitchSongs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertClientProfileSchema = createInsertSchema(clientProfiles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertWorkflowAutomationSchema = createInsertSchema(workflowAutomation).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAnalyticsEventSchema = createInsertSchema(analyticsEvents).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertRightsClearanceSchema = createInsertSchema(rightsClearances).omit({\n  id: true,\n  lastUpdated: true,\n});\n\nexport const insertSongVersionSchema = createInsertSchema(songVersions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSmartPitchMatchSchema = createInsertSchema(smartPitchMatches).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertApprovalWorkflowSchema = createInsertSchema(approvalWorkflows).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type Song = typeof songs.$inferSelect;\nexport type InsertSong = z.infer<typeof insertSongSchema>;\nexport type Contact = typeof contacts.$inferSelect;\nexport type InsertContact = z.infer<typeof insertContactSchema>;\nexport type Deal = typeof deals.$inferSelect;\nexport type InsertDeal = z.infer<typeof insertDealSchema>;\nexport type Pitch = typeof pitches.$inferSelect;\nexport type InsertPitch = z.infer<typeof insertPitchSchema>;\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Template = typeof templates.$inferSelect;\nexport type InsertTemplate = z.infer<typeof insertTemplateSchema>;\nexport type EmailTemplate = typeof emailTemplates.$inferSelect;\nexport type InsertEmailTemplate = z.infer<typeof insertEmailTemplateSchema>;\nexport type EmailSend = typeof emailSends.$inferSelect;\nexport type InsertEmailSend = z.infer<typeof insertEmailSendSchema>;\nexport type Attachment = typeof attachments.$inferSelect;\nexport type InsertAttachment = z.infer<typeof insertAttachmentSchema>;\nexport type CalendarEvent = typeof calendarEvents.$inferSelect;\nexport type InsertCalendarEvent = z.infer<typeof insertCalendarEventSchema>;\nexport type Playlist = typeof playlists.$inferSelect;\nexport type InsertPlaylist = z.infer<typeof insertPlaylistSchema>;\nexport type PlaylistSong = typeof playlistSongs.$inferSelect;\nexport type InsertPlaylistSong = z.infer<typeof insertPlaylistSongSchema>;\nexport type SavedSearch = typeof savedSearches.$inferSelect;\nexport type InsertSavedSearch = z.infer<typeof insertSavedSearchSchema>;\nexport type BulkPitch = typeof bulkPitches.$inferSelect;\nexport type InsertBulkPitch = z.infer<typeof insertBulkPitchSchema>;\nexport type BulkPitchSong = typeof bulkPitchSongs.$inferSelect;\nexport type InsertBulkPitchSong = z.infer<typeof insertBulkPitchSongSchema>;\nexport type ClientProfile = typeof clientProfiles.$inferSelect;\nexport type InsertClientProfile = z.infer<typeof insertClientProfileSchema>;\nexport type WorkflowAutomation = typeof workflowAutomation.$inferSelect;\nexport type InsertWorkflowAutomation = z.infer<typeof insertWorkflowAutomationSchema>;\nexport type AnalyticsEvent = typeof analyticsEvents.$inferSelect;\nexport type InsertAnalyticsEvent = z.infer<typeof insertAnalyticsEventSchema>;\n\nexport type RightsClearance = typeof rightsClearances.$inferSelect;\nexport type InsertRightsClearance = z.infer<typeof insertRightsClearanceSchema>;\nexport type SongVersion = typeof songVersions.$inferSelect;\nexport type InsertSongVersion = z.infer<typeof insertSongVersionSchema>;\nexport type SmartPitchMatch = typeof smartPitchMatches.$inferSelect;\nexport type InsertSmartPitchMatch = z.infer<typeof insertSmartPitchMatchSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type Expense = typeof expenses.$inferSelect;\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type ApprovalWorkflow = typeof approvalWorkflows.$inferSelect;\nexport type InsertApprovalWorkflow = z.infer<typeof insertApprovalWorkflowSchema>;\n\n// Extended types for API responses\nexport type DealWithRelations = Deal & {\n  song: Song;\n  contact: Contact;\n  pitches: Pitch[];\n  payments: Payment[];\n};\n\nexport type DashboardMetrics = {\n  activeDeals: number;\n  totalRevenue: number;\n  pendingPayments: number;\n  totalSongs: number;\n  dealsByStatus: Record<string, number>;\n  recentActivity: Array<{\n    id: string;\n    type: 'payment' | 'deal' | 'pitch' | 'song';\n    message: string;\n    timestamp: Date;\n    metadata?: any;\n  }>;\n  urgentActions: Array<{\n    id: string;\n    type: 'overdue_payment' | 'pending_response' | 'contract_approval';\n    message: string;\n    dueDate?: Date;\n    metadata?: any;\n  }>;\n};\n","size_bytes":32361},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/forms/comprehensive-add-deal-form-backup.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertDealSchema, insertContactSchema, type InsertDeal, type InsertContact, type Song, type Contact } from \"@shared/schema\";\nimport { Plus, Building, User, FileText } from \"lucide-react\";\n\n// Phone number formatting function\nconst formatPhoneNumber = (value: string) => {\n  // Remove all non-numeric characters\n  const phoneNumber = value.replace(/[^\\d]/g, '');\n  \n  // Format based on length\n  if (phoneNumber.length <= 3) {\n    return phoneNumber;\n  } else if (phoneNumber.length <= 6) {\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;\n  } else if (phoneNumber.length <= 10) {\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6)}`;\n  } else {\n    // Handle international numbers or longer formats\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;\n  }\n};\n\n// Currency formatting functions\nconst formatCurrency = (value: string | number) => {\n  if (!value || value === 0) return '';\n  const numValue = typeof value === 'string' ? parseFloat(value.replace(/[^0-9.-]+/g, '')) : value;\n  if (isNaN(numValue) || numValue === 0) return '';\n  return numValue.toLocaleString('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  });\n};\n\nconst parseCurrency = (value: string) => {\n  if (!value || value.trim() === '') return null;\n  const numValue = parseFloat(value.replace(/[^0-9.-]+/g, ''));\n  return isNaN(numValue) ? null : numValue;\n};\n\ninterface ComprehensiveAddDealFormProps {\n  open: boolean;\n  onClose: () => void;\n  deal?: any; // For editing existing deals\n}\n\nexport default function ComprehensiveAddDealForm({ open, onClose, deal }: ComprehensiveAddDealFormProps) {\n  const { toast } = useToast();\n  const isEditing = !!deal;\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [showAddLicenseeContact, setShowAddLicenseeContact] = useState(false);\n  const [showAddClearanceContact, setShowAddClearanceContact] = useState(false);\n  const [newContactName, setNewContactName] = useState(\"\");\n  const [newContactEmail, setNewContactEmail] = useState(\"\");\n  const [newContactPhone, setNewContactPhone] = useState(\"\");\n  const [newContactCompany, setNewContactCompany] = useState(\"\");\n  const [newContactRole, setNewContactRole] = useState(\"\");\n  const [newContactNotes, setNewContactNotes] = useState(\"\");\n  const [newContactProjects, setNewContactProjects] = useState(\"\");\n  \n  const form = useForm<InsertDeal>({\n    // Remove strict validation for now\n    // resolver: zodResolver(insertDealSchema),\n    shouldFocusError: false, // Prevent auto-focus on validation errors\n    defaultValues: {\n      projectName: deal?.projectName || \"\",\n      episodeNumber: deal?.episodeNumber || \"\",\n      projectType: deal?.projectType || \"\",\n      projectDescription: deal?.projectDescription || \"\",\n      songId: deal?.songId || undefined,\n      contactId: deal?.contactId || undefined,\n      \n      // Contact Information\n      licenseeCompanyName: deal?.licenseeCompanyName || \"\",\n      licenseeAddress: deal?.licenseeAddress || \"\",\n      licenseeContactName: deal?.licenseeContactName || \"\",\n      licenseeContactEmail: deal?.licenseeContactEmail || \"\",\n      licenseeContactPhone: deal?.licenseeContactPhone || \"\",\n      \n      musicSupervisorName: deal?.musicSupervisorName || \"\",\n      musicSupervisorAddress: deal?.musicSupervisorAddress || \"\",\n      musicSupervisorContactName: deal?.musicSupervisorContactName || \"\",\n      musicSupervisorContactEmail: deal?.musicSupervisorContactEmail || \"\",\n      musicSupervisorContactPhone: deal?.musicSupervisorContactPhone || \"\",\n      \n      clearanceCompanyName: deal?.clearanceCompanyName || \"\",\n      clearanceCompanyAddress: deal?.clearanceCompanyAddress || \"\",\n      clearanceCompanyContactName: deal?.clearanceCompanyContactName || \"\",\n      clearanceCompanyContactEmail: deal?.clearanceCompanyContactEmail || \"\",\n      clearanceCompanyContactPhone: deal?.clearanceCompanyContactPhone || \"\",\n      \n      status: deal?.status || \"new_request\",\n      dealValue: deal?.dealValue || undefined,\n      fullSongValue: deal?.fullSongValue || undefined,\n      ourFee: deal?.ourFee || undefined,\n      fullRecordingFee: deal?.fullRecordingFee || undefined,\n      ourRecordingFee: deal?.ourRecordingFee || undefined,\n      \n      // Status dates\n      pitchedDate: deal?.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n      pendingApprovalDate: deal?.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n      quotedDate: deal?.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n      useConfirmedDate: deal?.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n      beingDraftedDate: deal?.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n      outForSignatureDate: deal?.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n      paymentReceivedDate: deal?.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n      completedDate: deal?.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n      usage: deal?.usage || \"\",\n      media: deal?.media || \"\",\n      territory: deal?.territory || \"worldwide\",\n      term: deal?.term || \"\",\n      exclusivity: deal?.exclusivity || false,\n      exclusivityRestrictions: deal?.exclusivityRestrictions || \"\",\n      \n      // Song Information\n      writers: deal?.writers || \"\",\n      publishingInfo: deal?.publishingInfo || \"\",\n      splits: deal?.splits || \"\",\n      artist: deal?.artist || \"\",\n      label: deal?.label || \"\",\n      artistLabelSplits: deal?.artistLabelSplits || \"\",\n      \n      notes: deal?.notes || \"\",\n      airDate: deal?.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n      pitchDate: deal?.pitchDate ? new Date(deal.pitchDate).toISOString().split('T')[0] : undefined,\n    },\n  });\n\n  // Reset form when deal prop changes\n  useEffect(() => {\n    form.reset({\n      projectName: deal?.projectName || \"\",\n      episodeNumber: deal?.episodeNumber || \"\",\n      projectType: deal?.projectType || \"\",\n      projectDescription: deal?.projectDescription || \"\",\n      songId: deal?.songId || undefined,\n      contactId: deal?.contactId || undefined,\n      \n      // Contact Information\n      licenseeCompanyName: deal?.licenseeCompanyName || \"\",\n      licenseeAddress: deal?.licenseeAddress || \"\",\n      licenseeContactName: deal?.licenseeContactName || \"\",\n      licenseeContactEmail: deal?.licenseeContactEmail || \"\",\n      licenseeContactPhone: deal?.licenseeContactPhone || \"\",\n      \n      musicSupervisorName: deal?.musicSupervisorName || \"\",\n      musicSupervisorAddress: deal?.musicSupervisorAddress || \"\",\n      musicSupervisorContactName: deal?.musicSupervisorContactName || \"\",\n      musicSupervisorContactEmail: deal?.musicSupervisorContactEmail || \"\",\n      musicSupervisorContactPhone: deal?.musicSupervisorContactPhone || \"\",\n      \n      clearanceCompanyName: deal?.clearanceCompanyName || \"\",\n      clearanceCompanyAddress: deal?.clearanceCompanyAddress || \"\",\n      clearanceCompanyContactName: deal?.clearanceCompanyContactName || \"\",\n      clearanceCompanyContactEmail: deal?.clearanceCompanyContactEmail || \"\",\n      clearanceCompanyContactPhone: deal?.clearanceCompanyContactPhone || \"\",\n      \n      status: deal?.status || \"new_request\",\n      dealValue: deal?.dealValue || undefined,\n      fullSongValue: deal?.fullSongValue || undefined,\n      ourFee: deal?.ourFee || undefined,\n      fullRecordingFee: deal?.fullRecordingFee || undefined,\n      ourRecordingFee: deal?.ourRecordingFee || undefined,\n      \n      // Status dates\n      pitchedDate: deal?.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n      pendingApprovalDate: deal?.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n      quotedDate: deal?.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n      useConfirmedDate: deal?.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n      beingDraftedDate: deal?.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n      outForSignatureDate: deal?.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n      paymentReceivedDate: deal?.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n      completedDate: deal?.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n      usage: deal?.usage || \"\",\n      media: deal?.media || \"\",\n      territory: deal?.territory || \"worldwide\",\n      term: deal?.term || \"\",\n      exclusivity: deal?.exclusivity || false,\n      exclusivityRestrictions: deal?.exclusivityRestrictions || \"\",\n      \n      // Song Information\n      writers: deal?.writers || \"\",\n      publishingInfo: deal?.publishingInfo || \"\",\n      splits: deal?.splits || \"\",\n      artist: deal?.artist || \"\",\n      label: deal?.label || \"\",\n      artistLabelSplits: deal?.artistLabelSplits || \"\",\n      \n      notes: deal?.notes || \"\",\n      airDate: deal?.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n      pitchDate: deal?.pitchDate ? new Date(deal.pitchDate).toISOString().split('T')[0] : undefined,\n    });\n  }, [deal, form]);\n\n  // Watch for status changes to auto-update dates\n  const watchedStatus = form.watch(\"status\");\n  useEffect(() => {\n    if (watchedStatus && watchedStatus !== \"pitched\") {\n      const now = new Date().toISOString().slice(0, 16); // Format for datetime-local\n      const fieldMap = {\n        \"pitched\": \"pitchedDate\",\n        \"pending approval\": \"pendingApprovalDate\",\n        \"quoted\": \"quotedDate\",\n        \"use confirmed\": \"useConfirmedDate\",\n        \"being drafted\": \"beingDraftedDate\",\n        \"out for signature\": \"outForSignatureDate\",\n        \"payment received\": \"paymentReceivedDate\",\n        \"completed\": \"completedDate\"\n      };\n      \n      const dateField = fieldMap[watchedStatus.toLowerCase()];\n      if (dateField && !form.getValues(dateField)) {\n        form.setValue(dateField, now);\n      }\n    }\n  }, [watchedStatus, form]);\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n  });\n\n  const createContactMutation = useMutation({\n    mutationFn: async (contactData: any) => {\n      const response = await apiRequest('/api/contacts', { method: 'POST', body: contactData });\n      return response.json();\n    },\n    onSuccess: (newContact) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      form.setValue('contactId', newContact.id);\n      setShowAddContact(false);\n      // Clear form\n      setNewContactName(\"\");\n      setNewContactEmail(\"\");\n      setNewContactPhone(\"\");\n      setNewContactCompany(\"\");\n      setNewContactRole(\"\");\n      setNewContactNotes(\"\");\n      setNewContactProjects(\"\");\n      toast({\n        title: \"Contact added successfully\",\n        description: `${newContact.name} has been added to your contacts.`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error adding contact\",\n        description: \"Failed to add the contact. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const createDealMutation = useMutation({\n    mutationFn: async (data: InsertDeal) => {\n      // Ensure all required fields are present and properly typed\n      const processedData = {\n        ...data,\n        songId: data.songId ? parseInt(data.songId.toString()) : null,\n        contactId: data.contactId ? parseInt(data.contactId.toString()) : null,\n        dealValue: data.dealValue !== null && data.dealValue !== undefined ? parseFloat(data.dealValue.toString()) : null,\n        fullSongValue: data.fullSongValue !== null && data.fullSongValue !== undefined ? parseFloat(data.fullSongValue.toString()) : null,\n        ourFee: data.ourFee !== null && data.ourFee !== undefined ? parseFloat(data.ourFee.toString()) : null,\n        fullRecordingFee: data.fullRecordingFee !== null && data.fullRecordingFee !== undefined ? parseFloat(data.fullRecordingFee.toString()) : null,\n        ourRecordingFee: data.ourRecordingFee !== null && data.ourRecordingFee !== undefined ? parseFloat(data.ourRecordingFee.toString()) : null,\n        pitchDate: data.pitchDate ? new Date(data.pitchDate).toISOString() : null,\n        \n        // Status dates\n        pitchedDate: data.pitchedDate ? new Date(data.pitchedDate).toISOString() : null,\n        pendingApprovalDate: data.pendingApprovalDate ? new Date(data.pendingApprovalDate).toISOString() : null,\n        quotedDate: data.quotedDate ? new Date(data.quotedDate).toISOString() : null,\n        useConfirmedDate: data.useConfirmedDate ? new Date(data.useConfirmedDate).toISOString() : null,\n        beingDraftedDate: data.beingDraftedDate ? new Date(data.beingDraftedDate).toISOString() : null,\n        outForSignatureDate: data.outForSignatureDate ? new Date(data.outForSignatureDate).toISOString() : null,\n        paymentReceivedDate: data.paymentReceivedDate ? new Date(data.paymentReceivedDate).toISOString() : null,\n        completedDate: data.completedDate ? new Date(data.completedDate).toISOString() : null,\n        airDate: data.airDate ? new Date(data.airDate).toISOString() : null,\n      };\n      \n      console.log(\"Processed data:\", processedData);\n      const endpoint = isEditing ? `/api/deals/${deal.id}` : \"/api/deals\";\n      const method = isEditing ? \"PUT\" : \"POST\";\n      const response = await apiRequest(endpoint, { method, body: processedData });\n      return response.json();\n    },\n    onSuccess: async (newDeal) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/deals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      \n      // Auto-create calendar event if airdate is set\n      if (newDeal.airDate) {\n        try {\n          await apiRequest(\"/api/calendar-events\", {\n            method: \"POST\",\n            body: {\n              title: `Air Date: ${newDeal.projectName}`,\n              description: `Air date for ${newDeal.projectName}`,\n              startDate: newDeal.airDate,\n              endDate: newDeal.airDate,\n              entityType: \"deal\",\n              entityId: newDeal.id,\n              status: \"scheduled\"\n            }\n          });\n          queryClient.invalidateQueries({ queryKey: [\"/api/calendar-events\"] });\n        } catch (error) {\n          console.log(\"Failed to create calendar event:\", error);\n        }\n      }\n      \n      form.reset();\n      onClose();\n      toast({\n        title: isEditing ? \"Deal Updated\" : \"Deal Added\",\n        description: isEditing \n          ? \"Deal has been successfully updated\"\n          : (newDeal.airDate \n              ? \"Deal has been added to the pipeline and calendar event created for air date\"\n              : \"Deal has been successfully added to the pipeline\")\n      });\n    },\n    onError: (error) => {\n      console.error(\"Error creating deal:\", error);\n      toast({\n        title: isEditing ? \"Error Updating Deal\" : \"Error Creating Deal\",\n        description: isEditing \n          ? \"There was an error updating the deal. Please try again.\"\n          : \"There was an error creating the deal. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleAddContact = () => {\n    if (!newContactName.trim() || !newContactEmail.trim()) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please provide at least a name and email for the contact.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const contactData = {\n      name: newContactName.trim(),\n      email: newContactEmail.trim(),\n      phone: newContactPhone.trim() || null,\n      company: newContactCompany.trim() || null,\n      role: newContactRole.trim() || null,\n      notes: `${newContactNotes.trim()}${newContactProjects.trim() ? '\\n\\nCurrent Projects:\\n' + newContactProjects.trim() : ''}`.trim() || null,\n    };\n\n    createContactMutation.mutate(contactData);\n  };\n\n  // Function to parse splits percentage from text\n  const parseOurSplitPercentage = (splitsText: string): number => {\n    if (!splitsText) return 50; // Default to 50% if no splits info\n    \n    // Common patterns to look for our percentage\n    const patterns = [\n      /our\\s*(?:share|split|percentage|%):?\\s*(\\d+)%?/i,\n      /we\\s*(?:get|receive|own):?\\s*(\\d+)%?/i,\n      /(\\d+)%?\\s*(?:our|ours|us)/i,\n      /(\\d+)%?\\s*writer/i, // Assuming we're the writer\n      /(\\d+)%?\\s*publisher/i, // Assuming we're the publisher\n    ];\n    \n    for (const pattern of patterns) {\n      const match = splitsText.match(pattern);\n      if (match && match[1]) {\n        const percentage = parseInt(match[1]);\n        if (percentage >= 0 && percentage <= 100) {\n          return percentage;\n        }\n      }\n    }\n    \n    // If no specific pattern found, look for any percentage\n    const percentageMatch = splitsText.match(/(\\d+)%/);\n    if (percentageMatch) {\n      const percentage = parseInt(percentageMatch[1]);\n      if (percentage >= 0 && percentage <= 100) {\n        return percentage;\n      }\n    }\n    \n    return 50; // Default to 50% if can't parse\n  };\n\n  // Function to calculate our fee based on splits\n  const calculateOurFee = (fullFee: number, splitsText: string): number => {\n    if (!fullFee || fullFee === 0) return 0;\n    const ourPercentage = parseOurSplitPercentage(splitsText);\n    return (fullFee * ourPercentage) / 100;\n  };\n\n  const onSubmit = (data: InsertDeal) => {\n    // Validate required fields manually\n    if (!data.projectName || !data.projectType || !data.songId || !data.contactId) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please fill in all required fields (Project Name, Project Type, Song Title, and Contact).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    createDealMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? \"Edit Deal\" : \"Add New Deal\"}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          {/* Section 1: Song Information */}\n          <Card className=\"bg-blue-50 border-blue-200\">\n            <CardHeader className=\"bg-blue-100 border-b border-blue-200\">\n              <CardTitle className=\"flex items-center space-x-2 text-blue-800\">\n                <span></span>\n                <span>Song Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4 bg-blue-50\">\n              <div className=\"grid grid-cols-1 gap-4\">\n                <div>\n                  <Label htmlFor=\"songId\">Song Title *</Label>\n                  <Select\n                    value={form.watch(\"songId\")?.toString()}\n                    onValueChange={(value) => {\n                      const songId = parseInt(value);\n                      form.setValue(\"songId\", songId);\n                      \n                      // Auto-populate song information fields\n                      const selectedSong = songs.find(s => s.id === songId);\n                      if (selectedSong) {\n                        // Auto-populate Writers field\n                        if (selectedSong.composer) {\n                          form.setValue(\"writers\", selectedSong.composer);\n                        }\n                        \n                        // Auto-populate Publishing Information\n                        if (selectedSong.publisher) {\n                          form.setValue(\"publishingInfo\", selectedSong.publisher);\n                        }\n                        \n                        // Auto-populate Artist field\n                        if (selectedSong.artist) {\n                          form.setValue(\"artist\", selectedSong.artist);\n                        }\n                        \n                        // Auto-populate Label field from producer field\n                        if (selectedSong.producer) {\n                          form.setValue(\"label\", selectedSong.producer);\n                        }\n                        \n                        // Set splits to default 50/50 if not specified\n                        if (!form.watch(\"splits\")) {\n                          form.setValue(\"splits\", \"50% Writer / 50% Publisher\");\n                        }\n                        \n                        // Set artist/label splits to default if not specified\n                        if (!form.watch(\"artistLabelSplits\")) {\n                          form.setValue(\"artistLabelSplits\", \"50% Artist / 50% Label\");\n                        }\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a song\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {songs.map((song) => (\n                        <SelectItem key={song.id} value={song.id.toString()}>\n                          {song.title} - {song.artist}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {form.formState.errors.songId && (\n                    <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.songId.message}</p>\n                  )}\n                </div>\n              </div>\n\n              {/* Deal Terms */}\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-medium mb-3\">Deal Terms</h4>\n                <div className=\"grid grid-cols-4 gap-4\">\n                  <div>\n                    <Label htmlFor=\"usage\">Usage</Label>\n                    <Input\n                      id=\"usage\"\n                      {...form.register(\"usage\")}\n                      placeholder=\"e.g., Background music\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"media\">Media</Label>\n                    <Input\n                      id=\"media\"\n                      {...form.register(\"media\")}\n                      placeholder=\"e.g., TV, Film, Streaming\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"term\">Term</Label>\n                    <Input\n                      id=\"term\"\n                      {...form.register(\"term\")}\n                      placeholder=\"e.g., 5 years, In perpetuity\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"territory\">Territory</Label>\n                    <Select\n                      value={form.watch(\"territory\")}\n                      onValueChange={(value) => form.setValue(\"territory\", value)}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"worldwide\">Worldwide</SelectItem>\n                        <SelectItem value=\"us\">United States</SelectItem>\n                        <SelectItem value=\"north_america\">North America</SelectItem>\n                        <SelectItem value=\"europe\">Europe</SelectItem>\n                        <SelectItem value=\"uk\">United Kingdom</SelectItem>\n                        <SelectItem value=\"other\">Other</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"writers\">Writers</Label>\n                  <Textarea\n                    id=\"writers\"\n                    {...form.register(\"writers\")}\n                    placeholder=\"List of song writers\"\n                    rows={2}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"publishingInfo\">Publishing Information</Label>\n                  <Textarea\n                    id=\"publishingInfo\"\n                    {...form.register(\"publishingInfo\")}\n                    placeholder=\"Publishing company details\"\n                    rows={2}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"splits\">Splits</Label>\n                  <Textarea\n                    id=\"splits\"\n                    {...form.register(\"splits\", {\n                      onChange: (e) => {\n                        // Recalculate fees when splits change\n                        const splitsText = e.target.value;\n                        const fullPublishingFee = form.watch(\"fullSongValue\") || 0;\n                        const fullRecordingFee = form.watch(\"fullRecordingFee\") || 0;\n                        \n                        if (fullPublishingFee > 0) {\n                          const ourPublishingFee = calculateOurFee(fullPublishingFee, splitsText);\n                          form.setValue(\"ourFee\", Math.round(ourPublishingFee * 100) / 100);\n                        }\n                        \n                        if (fullRecordingFee > 0) {\n                          const ourRecordingFee = calculateOurFee(fullRecordingFee, splitsText);\n                          form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                        }\n                      }\n                    })}\n                    placeholder=\"Publishing splits breakdown\"\n                    rows={2}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"artist\">Artist</Label>\n                  <Input\n                    id=\"artist\"\n                    {...form.register(\"artist\")}\n                    placeholder=\"Recording artist\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"label\">Label</Label>\n                  <Input\n                    id=\"label\"\n                    {...form.register(\"label\")}\n                    placeholder=\"Record label\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"artistLabelSplits\">Artist/Label Split Information</Label>\n                  <Textarea\n                    id=\"artistLabelSplits\"\n                    {...form.register(\"artistLabelSplits\")}\n                    placeholder=\"Artist and label split details\"\n                    rows={1}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"exclusivity\"\n                    checked={form.watch(\"exclusivity\")}\n                    onCheckedChange={(checked) => form.setValue(\"exclusivity\", checked)}\n                  />\n                  <Label htmlFor=\"exclusivity\">Exclusive Deal</Label>\n                </div>\n                <div>\n                  <Label htmlFor=\"exclusivityRestrictions\">Exclusivity Restrictions</Label>\n                  <Input\n                    id=\"exclusivityRestrictions\"\n                    {...form.register(\"exclusivityRestrictions\")}\n                    placeholder=\"Describe any exclusivity restrictions\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"fullSongValue\">100% Publishing Fee ($)</Label>\n                  <Input\n                    id=\"fullSongValue\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"fullSongValue\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"fullSongValue\", numericValue);\n                      \n                      // Auto-calculate our fee based on splits\n                      const splitsText = form.watch(\"splits\") || \"\";\n                      const ourFee = calculateOurFee(numericValue, splitsText);\n                      form.setValue(\"ourFee\", Math.round(ourFee * 100) / 100);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"ourFee\">Our Publishing Fee ($)</Label>\n                  <Input\n                    id=\"ourFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"ourFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"ourFee\", numericValue);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"fullRecordingFee\">100% Recording Fee ($)</Label>\n                  <Input\n                    id=\"fullRecordingFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"fullRecordingFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"fullRecordingFee\", numericValue);\n                      \n                      // Auto-calculate our recording fee based on splits\n                      const splitsText = form.watch(\"splits\") || \"\";\n                      const ourRecordingFee = calculateOurFee(numericValue, splitsText);\n                      form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"ourRecordingFee\">Our Recording Fee ($)</Label>\n                  <Input\n                    id=\"ourRecordingFee\"\n                    type=\"text\"\n                    value={formatCurrency(form.watch(\"ourRecordingFee\") || \"\")}\n                    onChange={(e) => {\n                      const numericValue = parseFloat(e.target.value.replace(/[$,]/g, \"\")) || 0;\n                      form.setValue(\"ourRecordingFee\", numericValue);\n                    }}\n                    placeholder=\"$0.00\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Section 2: Licensee / Production Company */}\n          <Card className=\"bg-yellow-50 border-yellow-200\">\n            <CardHeader className=\"bg-yellow-100 border-b border-yellow-200\">\n              <CardTitle className=\"flex items-center space-x-2 text-yellow-800\">\n                <Building className=\"h-5 w-5\" />\n                <span>Licensee / Production Company</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4 bg-yellow-50\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"licenseeCompanyName\">Company Name</Label>\n                  <Input\n                    id=\"licenseeCompanyName\"\n                    {...form.register(\"licenseeCompanyName\")}\n                    placeholder=\"Production company name\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"licenseeContactName\">Contact Name</Label>\n                  <div className=\"flex space-x-2\">\n                    <Select\n                      value=\"\"\n                      onValueChange={(value) => {\n                        const contactId = parseInt(value);\n                        const selectedContact = contacts.find(c => c.id === contactId);\n                        if (selectedContact) {\n                          // Auto-fill all fields from selected contact\n                          form.setValue(\"licenseeCompanyName\", selectedContact.company || \"\");\n                          form.setValue(\"licenseeContactName\", selectedContact.name);\n                          form.setValue(\"licenseeContactEmail\", selectedContact.email || \"\");\n                          form.setValue(\"licenseeContactPhone\", selectedContact.phone || \"\");\n                          // Use notes as address if available\n                          const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                          if (addressMatch) {\n                            form.setValue(\"licenseeAddress\", addressMatch[1]);\n                          }\n                        }\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select Contact Name\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {contacts\n                          .filter(contact => contact.company) // Only show contacts with companies\n                          .map((contact) => (\n                          <SelectItem key={contact.id} value={contact.id.toString()}>\n                            {contact.name} - {contact.company}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <Button \n                      type=\"button\" \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => setShowAddLicenseeContact(true)}\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                <div>\n                  <Label htmlFor=\"licenseeContactEmail\">Email</Label>\n                  <Input\n                    id=\"licenseeContactEmail\"\n                    type=\"email\"\n                    {...form.register(\"licenseeContactEmail\")}\n                    placeholder=\"contact@company.com\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"licenseeContactPhone\">Phone</Label>\n                  <Input\n                    id=\"licenseeContactPhone\"\n                    value={form.watch(\"licenseeContactPhone\") || \"\"}\n                    onChange={(e) => {\n                      const formatted = formatPhoneNumber(e.target.value);\n                      form.setValue(\"licenseeContactPhone\", formatted);\n                    }}\n                    placeholder=\"(555) 123-4567\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"licenseeAddress\">Address</Label>\n                  <Input\n                    id=\"licenseeAddress\"\n                    {...form.register(\"licenseeAddress\")}\n                    placeholder=\"Company address\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Section 3: Project Information */}\n          <Card className=\"bg-purple-50 border-purple-200\">\n            <CardHeader className=\"bg-purple-100 border-b border-purple-200\">\n              <CardTitle className=\"flex items-center space-x-2 text-purple-800\">\n                <FileText className=\"h-5 w-5\" />\n                <span>Project Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4 bg-purple-50\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"projectName\">Project Name *</Label>\n                  <Input\n                    id=\"projectName\"\n                    {...form.register(\"projectName\")}\n                    placeholder=\"Project name\"\n                  />\n                  {form.formState.errors.projectName && (\n                    <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.projectName.message}</p>\n                  )}\n                </div>\n                <div>\n                  <Label htmlFor=\"episodeNumber\">Episode #</Label>\n                  <Input\n                    id=\"episodeNumber\"\n                    {...form.register(\"episodeNumber\")}\n                    placeholder=\"e.g., S01E05\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"projectType\">Project Type *</Label>\n                  <Select \n                    value={form.watch(\"projectType\")} \n                    onValueChange={(value) => form.setValue(\"projectType\", value)}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select project type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"commercial\">Commercial</SelectItem>\n                      <SelectItem value=\"documentary\">Documentary</SelectItem>\n                      <SelectItem value=\"film\">Film</SelectItem>\n                      <SelectItem value=\"game\">Video Game</SelectItem>\n                      <SelectItem value=\"indie_film\">Indie Film</SelectItem>\n                      <SelectItem value=\"non_profit\">Non-Profit</SelectItem>\n                      <SelectItem value=\"other\">Other</SelectItem>\n                      <SelectItem value=\"podcast\">Podcast</SelectItem>\n                      <SelectItem value=\"promos\">Promos</SelectItem>\n                      <SelectItem value=\"sports\">Sports</SelectItem>\n                      <SelectItem value=\"student_film\">Student Film</SelectItem>\n                      <SelectItem value=\"trailers\">Trailers</SelectItem>\n                      <SelectItem value=\"tv\">TV Show</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select\n                    value={form.watch(\"status\")}\n                    onValueChange={(value) => {\n                      form.setValue(\"status\", value);\n                      \n                      // Auto-populate corresponding status date\n                      const now = new Date().toISOString().slice(0, 16); // Format for datetime-local\n                      \n                      // Clear all status dates first\n                      form.setValue(\"pitchedDate\", null);\n                      form.setValue(\"pendingApprovalDate\", null);\n                      form.setValue(\"quotedDate\", null);\n                      form.setValue(\"useConfirmedDate\", null);\n                      form.setValue(\"beingDraftedDate\", null);\n                      form.setValue(\"outForSignatureDate\", null);\n                      form.setValue(\"paymentReceivedDate\", null);\n                      form.setValue(\"completedDate\", null);\n                      \n                      // Set the appropriate status date\n                      if (value === 'new request') {\n                        form.setValue(\"pitchedDate\", now);\n                      } else if (value === 'pending approval') {\n                        form.setValue(\"pendingApprovalDate\", now);\n                      } else if (value === 'quoted') {\n                        form.setValue(\"quotedDate\", now);\n                      } else if (value === 'use confirmed') {\n                        form.setValue(\"useConfirmedDate\", now);\n                      } else if (value === 'being drafted') {\n                        form.setValue(\"beingDraftedDate\", now);\n                      } else if (value === 'out for signature') {\n                        form.setValue(\"outForSignatureDate\", now);\n                      } else if (value === 'payment received') {\n                        form.setValue(\"paymentReceivedDate\", now);\n                      } else if (value === 'completed') {\n                        form.setValue(\"completedDate\", now);\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"new request\">New Request</SelectItem>\n                      <SelectItem value=\"pending approval\">Pending Approval</SelectItem>\n                      <SelectItem value=\"quoted\">Quoted</SelectItem>\n                      <SelectItem value=\"use confirmed\">Use Confirmed</SelectItem>\n                      <SelectItem value=\"being drafted\">Being Drafted</SelectItem>\n                      <SelectItem value=\"out for signature\">Out for Signature</SelectItem>\n                      <SelectItem value=\"payment received\">Payment Received</SelectItem>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"airDate\">Air Date</Label>\n                  <Input\n                    id=\"airDate\"\n                    type=\"date\"\n                    {...form.register(\"airDate\")}\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"projectDescription\">Project Description</Label>\n                <Textarea\n                  id=\"projectDescription\"\n                  {...form.register(\"projectDescription\")}\n                  placeholder=\"Brief description of the project\"\n                  rows={2}\n                />\n              </div>\n\n              {/* Music Supervisor */}\n              <Separator />\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center space-x-2\">\n                  <User className=\"h-4 w-4\" />\n                  <span>Music Supervisor</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"contactId\">Supervisor Name *</Label>\n                    <div className=\"flex space-x-2\">\n                      <Select\n                        value={form.watch(\"contactId\")?.toString() || \"\"}\n                        onValueChange={(value) => {\n                          const contactId = parseInt(value);\n                          form.setValue(\"contactId\", contactId);\n                          \n                          // Auto-populate music supervisor fields with selected contact\n                          const selectedContact = contacts.find(c => c.id === contactId);\n                          if (selectedContact) {\n                            form.setValue(\"musicSupervisorName\", selectedContact.name);\n                            form.setValue(\"musicSupervisorContactName\", selectedContact.company || \"\");\n                            form.setValue(\"musicSupervisorContactEmail\", selectedContact.email || \"\");\n                            form.setValue(\"musicSupervisorContactPhone\", selectedContact.phone || \"\");\n                            // Use notes as address if available\n                            const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                            if (addressMatch) {\n                              form.setValue(\"musicSupervisorAddress\", addressMatch[1]);\n                            }\n                          }\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select supervisor\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {contacts.map((contact) => (\n                            <SelectItem key={contact.id} value={contact.id.toString()}>\n                              {contact.name} {contact.company && `(${contact.company})`}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => setShowAddContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    {form.formState.errors.contactId && (\n                      <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.contactId.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactName\">Company Name</Label>\n                    <Input\n                      id=\"musicSupervisorContactName\"\n                      {...form.register(\"musicSupervisorContactName\")}\n                      placeholder=\"Music company name\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactEmail\">Email</Label>\n                    <Input\n                      id=\"musicSupervisorContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"musicSupervisorContactEmail\")}\n                      placeholder=\"supervisor@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactPhone\">Phone</Label>\n                    <Input\n                      id=\"musicSupervisorContactPhone\"\n                      value={form.watch(\"musicSupervisorContactPhone\") || \"\"}\n                      onChange={(e) => {\n                        const formatted = formatPhoneNumber(e.target.value);\n                        form.setValue(\"musicSupervisorContactPhone\", formatted);\n                      }}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorAddress\">Address</Label>\n                    <Input\n                      id=\"musicSupervisorAddress\"\n                      {...form.register(\"musicSupervisorAddress\")}\n                      placeholder=\"Supervisor address\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Clearance Company */}\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center space-x-2\">\n                  <Shield className=\"h-4 w-4\" />\n                  <span>Clearance Company</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyName\">Company Name</Label>\n                    <Input\n                      id=\"clearanceCompanyName\"\n                      {...form.register(\"clearanceCompanyName\")}\n                      placeholder=\"Clearance company name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactName\">Contact Name</Label>\n                    <div className=\"flex space-x-2\">\n                      <Select\n                        value=\"\"\n                        onValueChange={(value) => {\n                          const contactId = parseInt(value);\n                          const selectedContact = contacts.find(c => c.id === contactId);\n                          if (selectedContact) {\n                            // Auto-fill all fields from selected contact\n                            form.setValue(\"clearanceCompanyName\", selectedContact.company || \"\");\n                            form.setValue(\"clearanceCompanyContactName\", selectedContact.name);\n                            form.setValue(\"clearanceCompanyContactEmail\", selectedContact.email || \"\");\n                            form.setValue(\"clearanceCompanyContactPhone\", selectedContact.phone || \"\");\n                            // Use notes as address if available\n                            const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                            if (addressMatch) {\n                              form.setValue(\"clearanceCompanyAddress\", addressMatch[1]);\n                            }\n                          }\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Contact Name\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {contacts\n                            .filter(contact => contact.company) // Only show contacts with companies\n                            .map((contact) => (\n                            <SelectItem key={contact.id} value={contact.id.toString()}>\n                              {contact.name} - {contact.company}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => setShowAddClearanceContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactEmail\">Email</Label>\n                    <Input\n                      id=\"clearanceCompanyContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"clearanceCompanyContactEmail\")}\n                      placeholder=\"clearance@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactPhone\">Phone</Label>\n                    <Input\n                      id=\"clearanceCompanyContactPhone\"\n                      value={form.watch(\"clearanceCompanyContactPhone\") || \"\"}\n                      onChange={(e) => {\n                        const formatted = formatPhoneNumber(e.target.value);\n                        form.setValue(\"clearanceCompanyContactPhone\", formatted);\n                      }}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyAddress\">Address</Label>\n                    <Input\n                      id=\"clearanceCompanyAddress\"\n                      {...form.register(\"clearanceCompanyAddress\")}\n                      placeholder=\"Company address\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n                        form.setValue(\"outForSignatureDate\", now);\n                      } else if (value === 'payment received') {\n                        form.setValue(\"paymentReceivedDate\", now);\n                      } else if (value === 'completed') {\n                        form.setValue(\"completedDate\", now);\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"new request\">New Request</SelectItem>\n                      <SelectItem value=\"pending approval\">Pending Approval</SelectItem>\n                      <SelectItem value=\"quoted\">Quoted</SelectItem>\n                      <SelectItem value=\"use confirmed\">Use Confirmed</SelectItem>\n                      <SelectItem value=\"being drafted\">Being Drafted</SelectItem>\n                      <SelectItem value=\"out for signature\">Out for Signature</SelectItem>\n                      <SelectItem value=\"payment received\">Payment Received</SelectItem>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"airDate\">Air Date</Label>\n                  <Input\n                    id=\"airDate\"\n                    type=\"date\"\n                    {...form.register(\"airDate\")}\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"projectDescription\">Project Description</Label>\n                <Textarea\n                  id=\"projectDescription\"\n                  {...form.register(\"projectDescription\")}\n                  placeholder=\"Brief description of the project\"\n                  rows={2}\n                />\n              </div>\n\n              {/* Contact Information */}\n              <Separator />\n              \n              {/* Licensee / Production Company */}\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center space-x-2\">\n                  <Building className=\"h-4 w-4\" />\n                  <span>Licensee / Production Company</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"licenseeCompanyName\">Company Name</Label>\n                    <Input\n                      id=\"licenseeCompanyName\"\n                      {...form.register(\"licenseeCompanyName\")}\n                      placeholder=\"Production company name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeContactName\">Contact Name</Label>\n                    <div className=\"flex space-x-2\">\n                      <Select\n                        value=\"\"\n                        onValueChange={(value) => {\n                          const contactId = parseInt(value);\n                          const selectedContact = contacts.find(c => c.id === contactId);\n                          if (selectedContact) {\n                            // Auto-fill all fields from selected contact\n                            form.setValue(\"licenseeCompanyName\", selectedContact.company || \"\");\n                            form.setValue(\"licenseeContactName\", selectedContact.name);\n                            form.setValue(\"licenseeContactEmail\", selectedContact.email || \"\");\n                            form.setValue(\"licenseeContactPhone\", selectedContact.phone || \"\");\n                            // Use notes as address if available\n                            const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                            if (addressMatch) {\n                              form.setValue(\"licenseeAddress\", addressMatch[1]);\n                            }\n                          }\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Contact Name\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {contacts\n                            .filter(contact => contact.company) // Only show contacts with companies\n                            .map((contact) => (\n                            <SelectItem key={contact.id} value={contact.id.toString()}>\n                              {contact.name} - {contact.company}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => setShowAddLicenseeContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                  <div>\n                    <Label htmlFor=\"licenseeContactEmail\">Email</Label>\n                    <Input\n                      id=\"licenseeContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"licenseeContactEmail\")}\n                      placeholder=\"contact@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeContactPhone\">Phone</Label>\n                    <Input\n                      id=\"licenseeContactPhone\"\n                      value={form.watch(\"licenseeContactPhone\") || \"\"}\n                      onChange={(e) => {\n                        const formatted = formatPhoneNumber(e.target.value);\n                        form.setValue(\"licenseeContactPhone\", formatted);\n                      }}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"licenseeAddress\">Address</Label>\n                    <Input\n                      id=\"licenseeAddress\"\n                      {...form.register(\"licenseeAddress\")}\n                      placeholder=\"Company address\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Music Supervisor */}\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center space-x-2\">\n                  <User className=\"h-4 w-4\" />\n                  <span>Music Supervisor</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"contactId\">Supervisor Name *</Label>\n                    <div className=\"flex space-x-2\">\n                      <Select\n                        value={form.watch(\"contactId\")?.toString() || \"\"}\n                        onValueChange={(value) => {\n                          const contactId = parseInt(value);\n                          form.setValue(\"contactId\", contactId);\n                          \n                          // Auto-populate music supervisor fields with selected contact\n                          const selectedContact = contacts.find(c => c.id === contactId);\n                          if (selectedContact) {\n                            form.setValue(\"musicSupervisorName\", selectedContact.name);\n                            form.setValue(\"musicSupervisorContactName\", selectedContact.company || \"\");\n                            form.setValue(\"musicSupervisorContactEmail\", selectedContact.email || \"\");\n                            form.setValue(\"musicSupervisorContactPhone\", selectedContact.phone || \"\");\n                            // Use notes as address if available\n                            const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                            if (addressMatch) {\n                              form.setValue(\"musicSupervisorAddress\", addressMatch[1]);\n                            }\n                          }\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select supervisor\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {contacts.map((contact) => (\n                            <SelectItem key={contact.id} value={contact.id.toString()}>\n                              {contact.name} {contact.company && `(${contact.company})`}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => setShowAddContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    {form.formState.errors.contactId && (\n                      <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.contactId.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactName\">Company Name</Label>\n                    <Input\n                      id=\"musicSupervisorContactName\"\n                      {...form.register(\"musicSupervisorContactName\")}\n                      placeholder=\"Company name\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactEmail\">Email</Label>\n                    <Input\n                      id=\"musicSupervisorContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"musicSupervisorContactEmail\")}\n                      placeholder=\"supervisor@email.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorContactPhone\">Phone</Label>\n                    <Input\n                      id=\"musicSupervisorContactPhone\"\n                      value={form.watch(\"musicSupervisorContactPhone\") || \"\"}\n                      onChange={(e) => {\n                        const formatted = formatPhoneNumber(e.target.value);\n                        form.setValue(\"musicSupervisorContactPhone\", formatted);\n                      }}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"musicSupervisorAddress\">Address</Label>\n                    <Input\n                      id=\"musicSupervisorAddress\"\n                      {...form.register(\"musicSupervisorAddress\")}\n                      placeholder=\"Supervisor address\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Clearance Company */}\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center space-x-2\">\n                  <Building className=\"h-4 w-4\" />\n                  <span>Clearance Company</span>\n                </h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyName\">Company Name</Label>\n                    <Input\n                      id=\"clearanceCompanyName\"\n                      {...form.register(\"clearanceCompanyName\")}\n                      placeholder=\"Clearance company name\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactName\">Contact Name</Label>\n                    <div className=\"flex space-x-2\">\n                      <Select\n                        value=\"\"\n                        onValueChange={(value) => {\n                          const contactId = parseInt(value);\n                          const selectedContact = contacts.find(c => c.id === contactId);\n                          if (selectedContact) {\n                            // Auto-fill all fields from selected contact\n                            form.setValue(\"clearanceCompanyName\", selectedContact.company || \"\");\n                            form.setValue(\"clearanceCompanyContactName\", selectedContact.name);\n                            form.setValue(\"clearanceCompanyContactEmail\", selectedContact.email || \"\");\n                            form.setValue(\"clearanceCompanyContactPhone\", selectedContact.phone || \"\");\n                            // Use notes as address if available\n                            const addressMatch = selectedContact.notes?.match(/Address:\\s*(.+?)(?:\\n|$)/i);\n                            if (addressMatch) {\n                              form.setValue(\"clearanceCompanyAddress\", addressMatch[1]);\n                            }\n                          }\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Contact Name\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {contacts\n                            .filter(contact => contact.company) // Only show contacts with companies\n                            .map((contact) => (\n                            <SelectItem key={contact.id} value={contact.id.toString()}>\n                              {contact.name} - {contact.company}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => setShowAddClearanceContact(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4 mt-3\">\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactEmail\">Email</Label>\n                    <Input\n                      id=\"clearanceCompanyContactEmail\"\n                      type=\"email\"\n                      {...form.register(\"clearanceCompanyContactEmail\")}\n                      placeholder=\"clearance@company.com\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyContactPhone\">Phone</Label>\n                    <Input\n                      id=\"clearanceCompanyContactPhone\"\n                      value={form.watch(\"clearanceCompanyContactPhone\") || \"\"}\n                      onChange={(e) => {\n                        const formatted = formatPhoneNumber(e.target.value);\n                        form.setValue(\"clearanceCompanyContactPhone\", formatted);\n                      }}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"clearanceCompanyAddress\">Address</Label>\n                    <Input\n                      id=\"clearanceCompanyAddress\"\n                      {...form.register(\"clearanceCompanyAddress\")}\n                      placeholder=\"Company address\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n\n            </CardContent>\n          </Card>\n\n          {/* Section 2: Song Information */}\n          <Card className=\"bg-blue-50 border-blue-200\">\n            <CardHeader className=\"bg-blue-100 border-b border-blue-200\">\n              <CardTitle className=\"flex items-center space-x-2 text-blue-800\">\n                <span></span>\n                <span>Song Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4 bg-blue-50\">\n              <div className=\"grid grid-cols-1 gap-4\">\n                <div>\n                  <Label htmlFor=\"songId\">Song Title *</Label>\n                  <Select\n                    value={form.watch(\"songId\")?.toString()}\n                    onValueChange={(value) => {\n                      const songId = parseInt(value);\n                      form.setValue(\"songId\", songId);\n                      \n                      // Auto-populate song information fields\n                      const selectedSong = songs.find(s => s.id === songId);\n                      if (selectedSong) {\n                        // Auto-populate Writers field\n                        if (selectedSong.composer) {\n                          form.setValue(\"writers\", selectedSong.composer);\n                        }\n                        \n                        // Auto-populate Publishing Information\n                        if (selectedSong.publisher) {\n                          form.setValue(\"publishingInfo\", selectedSong.publisher);\n                        }\n                        \n                        // Auto-populate Artist field\n                        if (selectedSong.artist) {\n                          form.setValue(\"artist\", selectedSong.artist);\n                        }\n                        \n                        // Auto-populate Label field from producer field\n                        if (selectedSong.producer) {\n                          form.setValue(\"label\", selectedSong.producer);\n                        }\n                        \n                        // Set splits to default 50/50 if not specified\n                        if (!form.watch(\"splits\")) {\n                          form.setValue(\"splits\", \"50% Writer / 50% Publisher\");\n                        }\n                        \n                        // Set artist/label splits to default if not specified\n                        if (!form.watch(\"artistLabelSplits\")) {\n                          form.setValue(\"artistLabelSplits\", \"50% Artist / 50% Label\");\n                        }\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a song\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {songs.map((song) => (\n                        <SelectItem key={song.id} value={song.id.toString()}>\n                          {song.title} - {song.artist}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {form.formState.errors.songId && (\n                    <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.songId.message}</p>\n                  )}\n                </div>\n              </div>\n\n              {/* Deal Terms - moved from Project Information */}\n              <div className=\"border-t pt-4\">\n                <h4 className=\"font-medium mb-3\">Deal Terms</h4>\n                <div className=\"grid grid-cols-4 gap-4\">\n                  <div>\n                    <Label htmlFor=\"usage\">Usage</Label>\n                    <Input\n                      id=\"usage\"\n                      {...form.register(\"usage\")}\n                      placeholder=\"e.g., Background music\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"media\">Media</Label>\n                    <Input\n                      id=\"media\"\n                      {...form.register(\"media\")}\n                      placeholder=\"e.g., TV, Film, Streaming\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"term\">Term</Label>\n                    <Input\n                      id=\"term\"\n                      {...form.register(\"term\")}\n                      placeholder=\"e.g., 5 years, In perpetuity\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"territory\">Territory</Label>\n                    <Select\n                      value={form.watch(\"territory\")}\n                      onValueChange={(value) => form.setValue(\"territory\", value)}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"worldwide\">Worldwide</SelectItem>\n                        <SelectItem value=\"us\">United States</SelectItem>\n                        <SelectItem value=\"north_america\">North America</SelectItem>\n                        <SelectItem value=\"europe\">Europe</SelectItem>\n                        <SelectItem value=\"uk\">United Kingdom</SelectItem>\n                        <SelectItem value=\"other\">Other</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"writers\">Writers</Label>\n                  <Textarea\n                    id=\"writers\"\n                    {...form.register(\"writers\")}\n                    placeholder=\"List of song writers\"\n                    rows={2}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"publishingInfo\">Publishing Information</Label>\n                  <Textarea\n                    id=\"publishingInfo\"\n                    {...form.register(\"publishingInfo\")}\n                    placeholder=\"Publishing company details\"\n                    rows={2}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"splits\">Splits</Label>\n                  <Textarea\n                    id=\"splits\"\n                    {...form.register(\"splits\", {\n                      onChange: (e) => {\n                        // Recalculate fees when splits change\n                        const splitsText = e.target.value;\n                        const fullPublishingFee = form.watch(\"fullSongValue\") || 0;\n                        const fullRecordingFee = form.watch(\"fullRecordingFee\") || 0;\n                        \n                        if (fullPublishingFee > 0) {\n                          const ourPublishingFee = calculateOurFee(fullPublishingFee, splitsText);\n                          form.setValue(\"ourFee\", Math.round(ourPublishingFee * 100) / 100);\n                        }\n                        \n                        if (fullRecordingFee > 0) {\n                          const ourRecordingFee = calculateOurFee(fullRecordingFee, splitsText);\n                          form.setValue(\"ourRecordingFee\", Math.round(ourRecordingFee * 100) / 100);\n                        }\n                      }\n                    })}\n                    placeholder=\"Publishing splits breakdown\"\n                    rows={2}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"artist\">Artist</Label>\n                  <Input\n                    id=\"artist\"\n                    {...form.register(\"artist\")}\n                    placeholder=\"Recording artist\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"label\">Label</Label>\n                  <Input\n                    id=\"label\"\n                    {...form.register(\"label\")}\n                    placeholder=\"Record label\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"artistLabelSplits\">Artist/Label Split Information</Label>\n                  <Textarea\n                    id=\"artistLabelSplits\"\n                    {...form.register(\"artistLabelSplits\")}\n                    placeholder=\"Artist and label split details\"\n                    rows={1}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"exclusivity\"\n                    checked={form.watch(\"exclusivity\")}\n                    onCheckedChange={(checked) => form.setValue(\"exclusivity\", checked)}\n                  />\n                  <Label htmlFor=\"exclusivity\">Exclusive Deal</Label>\n                </div>\n                <div>\n                  <Label htmlFor=\"exclusivityRestrictions\">Exclusivity Restrictions</Label>\n                  <Input\n                    id=\"exclusivityRestrictions\"\n                    {...form.register(\"exclusivityRestrictions\")}\n                    placeholder=\"Describe any exclusivity restrictions\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"fullSongValue\">100% Publishing Fee ($)</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\">$</span>\n                    <Input\n                      id=\"fullSongValue\"\n                      type=\"text\"\n                      className=\"pl-8\"\n                      value={formatCurrency(form.watch(\"fullSongValue\") || \"\")}\n                      onChange={(e) => {\n                        const numValue = parseCurrency(e.target.value);\n                        form.setValue(\"fullSongValue\", numValue);\n                        \n                        // Auto-calculate our fee based on splits only if splits exist\n                        const splitsText = form.watch(\"splits\") || \"\";\n                        if (splitsText && splitsText.trim()) {\n                          const ourFee = calculateOurFee(numValue, splitsText);\n                          form.setValue(\"ourFee\", Math.round(ourFee * 100) / 100);\n                        }\n                      }}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"ourFee\">Our Fee Based on Splits ($)</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\">$</span>\n                    <Input\n                      id=\"ourFee\"\n                      type=\"text\"\n                      className=\"pl-8\"\n                      value={formatCurrency(form.watch(\"ourFee\") || \"\")}\n                      onChange={(e) => {\n                        const numValue = parseCurrency(e.target.value);\n                        form.setValue(\"ourFee\", numValue);\n                      }}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"fullRecordingFee\">100% Recording Fee ($)</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\">$</span>\n                    <Input\n                      id=\"fullRecordingFee\"\n                      type=\"text\"\n                      className=\"pl-8\"\n                      value={formatCurrency(form.watch(\"fullRecordingFee\") || \"\")}\n                      onChange={(e) => {\n                        const numValue = parseCurrency(e.target.value);\n                        form.setValue(\"fullRecordingFee\", numValue);\n                        \n                        // Auto-calculate our fee based on splits only if splits exist\n                        const splitsText = form.watch(\"splits\") || \"\";\n                        if (splitsText && splitsText.trim()) {\n                          const ourFee = calculateOurFee(numValue, splitsText);\n                          form.setValue(\"ourRecordingFee\", Math.round(ourFee * 100) / 100);\n                        }\n                      }}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"ourRecordingFee\">Our Fee Based on Splits ($)</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\">$</span>\n                    <Input\n                      id=\"ourRecordingFee\"\n                      type=\"text\"\n                      className=\"pl-8\"\n                      value={formatCurrency(form.watch(\"ourRecordingFee\") || \"\")}\n                      onChange={(e) => {\n                        const numValue = parseCurrency(e.target.value);\n                        form.setValue(\"ourRecordingFee\", numValue);\n                      }}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Section 3: Additional Information */}\n          <Card className=\"bg-green-50 border-green-200\">\n            <CardHeader className=\"bg-green-100 border-b border-green-200\">\n              <CardTitle className=\"flex items-center space-x-2 text-green-800\">\n                <span></span>\n                <span>Additional Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4 bg-green-50\">\n              {/* Status Change Dates */}\n              <div>\n                <Label className=\"text-sm font-medium text-green-800\">Status Timeline</Label>\n                <div className=\"grid grid-cols-2 gap-4 mt-2\">\n                  <div>\n                    <Label htmlFor=\"pitchedDate\" className=\"text-xs\">New Request Date</Label>\n                    <Input\n                      id=\"pitchedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"pitchedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"pendingApprovalDate\" className=\"text-xs\">Pending Approval Date</Label>\n                    <Input\n                      id=\"pendingApprovalDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"pendingApprovalDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"quotedDate\" className=\"text-xs\">Quoted Date</Label>\n                    <Input\n                      id=\"quotedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"quotedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"useConfirmedDate\" className=\"text-xs\">Use Confirmed Date</Label>\n                    <Input\n                      id=\"useConfirmedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"useConfirmedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"beingDraftedDate\" className=\"text-xs\">Being Drafted Date</Label>\n                    <Input\n                      id=\"beingDraftedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"beingDraftedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"outForSignatureDate\" className=\"text-xs\">Out for Signature Date</Label>\n                    <Input\n                      id=\"outForSignatureDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"outForSignatureDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"paymentReceivedDate\" className=\"text-xs\">Payment Received Date</Label>\n                    <Input\n                      id=\"paymentReceivedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"paymentReceivedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"completedDate\" className=\"text-xs\">Completed Date</Label>\n                    <Input\n                      id=\"completedDate\"\n                      type=\"datetime-local\"\n                      {...form.register(\"completedDate\")}\n                      className=\"text-xs\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  {...form.register(\"notes\")}\n                  placeholder=\"Additional notes about this deal\"\n                  rows={3}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createDealMutation.isPending}\n\n            >\n              {createDealMutation.isPending \n                ? (isEditing ? \"Updating...\" : \"Creating...\") \n                : (isEditing ? \"Update Deal\" : \"Create Deal\")}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n      \n      {/* Add Contact Dialog */}\n      <Dialog open={showAddContact} onOpenChange={setShowAddContact}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add New Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactName\">Name *</Label>\n                <Input\n                  id=\"newContactName\"\n                  value={newContactName}\n                  onChange={(e) => setNewContactName(e.target.value)}\n                  placeholder=\"Contact name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactEmail\">Email *</Label>\n                <Input\n                  id=\"newContactEmail\"\n                  type=\"email\"\n                  value={newContactEmail}\n                  onChange={(e) => setNewContactEmail(e.target.value)}\n                  placeholder=\"contact@example.com\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactPhone\">Phone</Label>\n                <Input\n                  id=\"newContactPhone\"\n                  type=\"tel\"\n                  value={newContactPhone}\n                  onChange={(e) => setNewContactPhone(formatPhoneNumber(e.target.value))}\n                  placeholder=\"(555) 123-4567\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactCompany\">Company</Label>\n                <Input\n                  id=\"newContactCompany\"\n                  value={newContactCompany}\n                  onChange={(e) => setNewContactCompany(e.target.value)}\n                  placeholder=\"Company name\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactRole\">Role</Label>\n              <Input\n                id=\"newContactRole\"\n                value={newContactRole}\n                onChange={(e) => setNewContactRole(e.target.value)}\n                placeholder=\"e.g., Music Supervisor, Producer\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactProjects\">Current Projects</Label>\n              <Textarea\n                id=\"newContactProjects\"\n                value={newContactProjects}\n                onChange={(e) => setNewContactProjects(e.target.value)}\n                placeholder=\"List current projects or disco links\"\n                rows={3}\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactNotes\">Additional Notes</Label>\n              <Textarea\n                id=\"newContactNotes\"\n                value={newContactNotes}\n                onChange={(e) => setNewContactNotes(e.target.value)}\n                placeholder=\"Any additional notes about this contact\"\n                rows={2}\n              />\n            </div>\n\n            <div className=\"flex space-x-4 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowAddContact(false)} className=\"flex-1\">\n                Cancel\n              </Button>\n              <Button \n                onClick={handleAddContact}\n                className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n                disabled={createContactMutation.isPending}\n              >\n                {createContactMutation.isPending ? \"Adding...\" : \"Add Contact\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Licensee Contact Dialog */}\n      <Dialog open={showAddLicenseeContact} onOpenChange={setShowAddLicenseeContact}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add New Licensee/Production Company Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newLicenseeContactName\">Contact Name *</Label>\n                <Input\n                  id=\"newLicenseeContactName\"\n                  value={newContactName}\n                  onChange={(e) => setNewContactName(e.target.value)}\n                  placeholder=\"Contact person name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newLicenseeCompanyName\">Company Name *</Label>\n                <Input\n                  id=\"newLicenseeCompanyName\"\n                  value={newContactCompany}\n                  onChange={(e) => setNewContactCompany(e.target.value)}\n                  placeholder=\"Production company name\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newLicenseeEmail\">Email *</Label>\n                <Input\n                  id=\"newLicenseeEmail\"\n                  type=\"email\"\n                  value={newContactEmail}\n                  onChange={(e) => setNewContactEmail(e.target.value)}\n                  placeholder=\"contact@company.com\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newLicenseePhone\">Phone</Label>\n                <Input\n                  id=\"newLicenseePhone\"\n                  type=\"tel\"\n                  value={newContactPhone}\n                  onChange={(e) => setNewContactPhone(formatPhoneNumber(e.target.value))}\n                  placeholder=\"(555) 123-4567\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"newLicenseeNotes\">Address</Label>\n              <Textarea\n                id=\"newLicenseeNotes\"\n                value={newContactNotes}\n                onChange={(e) => setNewContactNotes(e.target.value)}\n                placeholder=\"Company address\"\n                rows={2}\n              />\n            </div>\n\n            <div className=\"flex space-x-4 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => {\n                setShowAddLicenseeContact(false);\n                setNewContactName(\"\");\n                setNewContactEmail(\"\");\n                setNewContactPhone(\"\");\n                setNewContactCompany(\"\");\n                setNewContactNotes(\"\");\n              }} className=\"flex-1\">\n                Cancel\n              </Button>\n              <Button \n                onClick={() => {\n                  if (!newContactName.trim() || !newContactEmail.trim() || !newContactCompany.trim()) {\n                    toast({\n                      title: \"Missing required fields\",\n                      description: \"Please provide contact name, email, and company name.\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n\n                  const contactData = {\n                    name: newContactName.trim(),\n                    email: newContactEmail.trim(),\n                    phone: newContactPhone.trim() || null,\n                    company: newContactCompany.trim(),\n                    role: \"Licensee Contact\",\n                    notes: `Address: ${newContactNotes.trim()}`.trim() || null,\n                  };\n\n                  createContactMutation.mutate(contactData);\n                  \n                  // Auto-populate licensee fields\n                  form.setValue(\"licenseeCompanyName\", newContactCompany.trim());\n                  form.setValue(\"licenseeContactName\", newContactName.trim());\n                  form.setValue(\"licenseeContactEmail\", newContactEmail.trim());\n                  form.setValue(\"licenseeContactPhone\", newContactPhone.trim());\n                  form.setValue(\"licenseeAddress\", newContactNotes.trim());\n                  \n                  setShowAddLicenseeContact(false);\n                  setNewContactName(\"\");\n                  setNewContactEmail(\"\");\n                  setNewContactPhone(\"\");\n                  setNewContactCompany(\"\");\n                  setNewContactNotes(\"\");\n                }}\n                className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n                disabled={createContactMutation.isPending}\n              >\n                {createContactMutation.isPending ? \"Adding...\" : \"Add Contact\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Clearance Company Contact Dialog */}\n      <Dialog open={showAddClearanceContact} onOpenChange={setShowAddClearanceContact}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add New Clearance Company Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newClearanceContactName\">Contact Name *</Label>\n                <Input\n                  id=\"newClearanceContactName\"\n                  value={newContactName}\n                  onChange={(e) => setNewContactName(e.target.value)}\n                  placeholder=\"Contact person name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newClearanceCompanyName\">Company Name *</Label>\n                <Input\n                  id=\"newClearanceCompanyName\"\n                  value={newContactCompany}\n                  onChange={(e) => setNewContactCompany(e.target.value)}\n                  placeholder=\"Clearance company name\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newClearanceEmail\">Email *</Label>\n                <Input\n                  id=\"newClearanceEmail\"\n                  type=\"email\"\n                  value={newContactEmail}\n                  onChange={(e) => setNewContactEmail(e.target.value)}\n                  placeholder=\"contact@clearance.com\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newClearancePhone\">Phone</Label>\n                <Input\n                  id=\"newClearancePhone\"\n                  type=\"tel\"\n                  value={newContactPhone}\n                  onChange={(e) => setNewContactPhone(formatPhoneNumber(e.target.value))}\n                  placeholder=\"(555) 123-4567\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"newClearanceNotes\">Address</Label>\n              <Textarea\n                id=\"newClearanceNotes\"\n                value={newContactNotes}\n                onChange={(e) => setNewContactNotes(e.target.value)}\n                placeholder=\"Company address\"\n                rows={2}\n              />\n            </div>\n\n            <div className=\"flex space-x-4 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => {\n                setShowAddClearanceContact(false);\n                setNewContactName(\"\");\n                setNewContactEmail(\"\");\n                setNewContactPhone(\"\");\n                setNewContactCompany(\"\");\n                setNewContactNotes(\"\");\n              }} className=\"flex-1\">\n                Cancel\n              </Button>\n              <Button \n                onClick={() => {\n                  if (!newContactName.trim() || !newContactEmail.trim() || !newContactCompany.trim()) {\n                    toast({\n                      title: \"Missing required fields\",\n                      description: \"Please provide contact name, email, and company name.\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n\n                  const contactData = {\n                    name: newContactName.trim(),\n                    email: newContactEmail.trim(),\n                    phone: newContactPhone.trim() || null,\n                    company: newContactCompany.trim(),\n                    role: \"Clearance Contact\",\n                    notes: `Address: ${newContactNotes.trim()}`.trim() || null,\n                  };\n\n                  createContactMutation.mutate(contactData);\n                  \n                  // Auto-populate clearance fields\n                  form.setValue(\"clearanceCompanyName\", newContactCompany.trim());\n                  form.setValue(\"clearanceCompanyContactName\", newContactName.trim());\n                  form.setValue(\"clearanceCompanyContactEmail\", newContactEmail.trim());\n                  form.setValue(\"clearanceCompanyContactPhone\", newContactPhone.trim());\n                  form.setValue(\"clearanceCompanyAddress\", newContactNotes.trim());\n                  \n                  setShowAddClearanceContact(false);\n                  setNewContactName(\"\");\n                  setNewContactEmail(\"\");\n                  setNewContactPhone(\"\");\n                  setNewContactCompany(\"\");\n                  setNewContactNotes(\"\");\n                }}\n                className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n                disabled={createContactMutation.isPending}\n              >\n                {createContactMutation.isPending ? \"Adding...\" : \"Add Contact\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </Dialog>\n  );\n}","size_bytes":100407},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport MetricsCards from \"@/components/dashboard/metrics-cards\";\nimport DealPipeline from \"@/components/dashboard/deal-pipeline\";\nimport RecentActivity from \"@/components/dashboard/recent-activity\";\nimport UrgentActions from \"@/components/dashboard/urgent-actions\";\nimport ComprehensiveAddDealForm from \"@/components/forms/comprehensive-add-deal-form\";\nimport type { DashboardMetrics, DealWithRelations } from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const [showAddDeal, setShowAddDeal] = useState(false);\n\n  const { data: metrics, isLoading: metricsLoading } = useQuery<DashboardMetrics>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  const { data: deals = [], isLoading: dealsLoading } = useQuery<DealWithRelations[]>({\n    queryKey: [\"/api/deals\"],\n  });\n\n  const isLoading = metricsLoading || dealsLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-lg text-gray-600\">Loading dashboard...</div>\n      </div>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-lg text-red-600\">Failed to load dashboard data</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Dashboard\"\n        description=\"Track your sync licensing deals and revenue\"\n        searchPlaceholder=\"Search songs, deals, contacts...\"\n        newItemLabel=\"New Deal\"\n        onNewItem={() => setShowAddDeal(true)}\n      />\n      \n      <div id=\"dashboard-overview\" className=\"p-6\">\n        <MetricsCards metrics={metrics} />\n        \n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <DealPipeline deals={deals} dealsByStatus={metrics.dealsByStatus} />\n          \n          <div className=\"space-y-6\">\n            <RecentActivity activities={metrics.recentActivity} />\n            \n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200\">\n              <div className=\"p-6 border-b border-gray-200\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Quick Actions</h3>\n              </div>\n              <div className=\"p-6 space-y-3\">\n                <button \n                  id=\"add-song-button\"\n                  className=\"w-full flex items-center justify-center space-x-2 bg-brand-primary text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors\"\n                >\n                  <span>Add New Song</span>\n                </button>\n                <button \n                  id=\"add-deal-button\"\n                  onClick={() => setShowAddDeal(true)}\n                  className=\"w-full flex items-center justify-center space-x-2 bg-brand-secondary text-white px-4 py-3 rounded-lg hover:bg-emerald-700 transition-colors\"\n                >\n                  <span>Create Pitch</span>\n                </button>\n                <button \n                  id=\"add-template-button\"\n                  className=\"w-full flex items-center justify-center space-x-2 bg-brand-accent text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors\"\n                >\n                  <span>Add Contact</span>\n                </button>\n                <button className=\"w-full flex items-center justify-center space-x-2 bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition-colors\">\n                  <span>Export Report</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"mt-8\">\n          <UrgentActions urgentActions={metrics.urgentActions} />\n        </div>\n      </div>\n\n      <ComprehensiveAddDealForm open={showAddDeal} onClose={() => setShowAddDeal(false)} />\n    </div>\n  );\n}\n","size_bytes":3885},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"temp-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertDealSchema, insertContactSchema, type InsertDeal, type InsertContact, type Song, type Contact } from \"@shared/schema\";\nimport { Plus, Building, User, FileText } from \"lucide-react\";\n\n// Phone number formatting function\nconst formatPhoneNumber = (value: string) => {\n  // Remove all non-numeric characters\n  const phoneNumber = value.replace(/[^\\d]/g, '');\n  \n  // Format based on length\n  if (phoneNumber.length <= 3) {\n    return phoneNumber;\n  } else if (phoneNumber.length <= 6) {\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;\n  } else if (phoneNumber.length <= 10) {\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6)}`;\n  } else {\n    // Handle international numbers or longer formats\n    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;\n  }\n};\n\n// Currency formatting functions\nconst formatCurrency = (value: string | number) => {\n  if (!value || value === 0) return '';\n  const numValue = typeof value === 'string' ? parseFloat(value.replace(/[^0-9.-]+/g, '')) : value;\n  if (isNaN(numValue) || numValue === 0) return '';\n  return numValue.toLocaleString('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  });\n};\n\nconst parseCurrency = (value: string) => {\n  if (!value || value.trim() === '') return null;\n  const numValue = parseFloat(value.replace(/[^0-9.-]+/g, ''));\n  return isNaN(numValue) ? null : numValue;\n};\n\ninterface ComprehensiveAddDealFormProps {\n  open: boolean;\n  onClose: () => void;\n  deal?: any; // For editing existing deals\n}\n\nexport default function ComprehensiveAddDealForm({ open, onClose, deal }: ComprehensiveAddDealFormProps) {\n  const { toast } = useToast();\n  const isEditing = !!deal;\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [showAddLicenseeContact, setShowAddLicenseeContact] = useState(false);\n  const [showAddClearanceContact, setShowAddClearanceContact] = useState(false);\n  const [newContactName, setNewContactName] = useState(\"\");\n  const [newContactEmail, setNewContactEmail] = useState(\"\");\n  const [newContactPhone, setNewContactPhone] = useState(\"\");\n  const [newContactCompany, setNewContactCompany] = useState(\"\");\n  const [newContactRole, setNewContactRole] = useState(\"\");\n  const [newContactNotes, setNewContactNotes] = useState(\"\");\n  const [newContactProjects, setNewContactProjects] = useState(\"\");\n  \n  const form = useForm<InsertDeal>({\n    // Remove strict validation for now\n    // resolver: zodResolver(insertDealSchema),\n    shouldFocusError: false, // Prevent auto-focus on validation errors\n    defaultValues: {\n      projectName: deal?.projectName || \"\",\n      episodeNumber: deal?.episodeNumber || \"\",\n      projectType: deal?.projectType || \"\",\n      projectDescription: deal?.projectDescription || \"\",\n      songId: deal?.songId || undefined,\n      contactId: deal?.contactId || undefined,\n      \n      // Contact Information\n      licenseeCompanyName: deal?.licenseeCompanyName || \"\",\n      licenseeAddress: deal?.licenseeAddress || \"\",\n      licenseeContactName: deal?.licenseeContactName || \"\",\n      licenseeContactEmail: deal?.licenseeContactEmail || \"\",\n      licenseeContactPhone: deal?.licenseeContactPhone || \"\",\n      \n      musicSupervisorName: deal?.musicSupervisorName || \"\",\n      musicSupervisorAddress: deal?.musicSupervisorAddress || \"\",\n      musicSupervisorContactName: deal?.musicSupervisorContactName || \"\",\n      musicSupervisorContactEmail: deal?.musicSupervisorContactEmail || \"\",\n      musicSupervisorContactPhone: deal?.musicSupervisorContactPhone || \"\",\n      \n      clearanceCompanyName: deal?.clearanceCompanyName || \"\",\n      clearanceCompanyAddress: deal?.clearanceCompanyAddress || \"\",\n      clearanceCompanyContactName: deal?.clearanceCompanyContactName || \"\",\n      clearanceCompanyContactEmail: deal?.clearanceCompanyContactEmail || \"\",\n      clearanceCompanyContactPhone: deal?.clearanceCompanyContactPhone || \"\",\n      \n      status: deal?.status || \"new_request\",\n      dealValue: deal?.dealValue || undefined,\n      fullSongValue: deal?.fullSongValue || undefined,\n      ourFee: deal?.ourFee || undefined,\n      fullRecordingFee: deal?.fullRecordingFee || undefined,\n      ourRecordingFee: deal?.ourRecordingFee || undefined,\n      \n      // Status dates\n      pitchedDate: deal?.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n      pendingApprovalDate: deal?.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n      quotedDate: deal?.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n      useConfirmedDate: deal?.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n      beingDraftedDate: deal?.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n      outForSignatureDate: deal?.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n      paymentReceivedDate: deal?.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n      completedDate: deal?.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n      usage: deal?.usage || \"\",\n      media: deal?.media || \"\",\n      territory: deal?.territory || \"worldwide\",\n      term: deal?.term || \"\",\n      exclusivity: deal?.exclusivity || false,\n      exclusivityRestrictions: deal?.exclusivityRestrictions || \"\",\n      \n      // Song Information\n      writers: deal?.writers || \"\",\n      publishingInfo: deal?.publishingInfo || \"\",\n      splits: deal?.splits || \"\",\n      artist: deal?.artist || \"\",\n      label: deal?.label || \"\",\n      artistLabelSplits: deal?.artistLabelSplits || \"\",\n      \n      notes: deal?.notes || \"\",\n      airDate: deal?.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n      pitchDate: deal?.pitchDate ? new Date(deal.pitchDate).toISOString().split('T')[0] : undefined,\n    },\n  });\n\n  // Reset form when deal prop changes\n  useEffect(() => {\n    form.reset({\n      projectName: deal?.projectName || \"\",\n      episodeNumber: deal?.episodeNumber || \"\",\n      projectType: deal?.projectType || \"\",\n      projectDescription: deal?.projectDescription || \"\",\n      songId: deal?.songId || undefined,\n      contactId: deal?.contactId || undefined,\n      \n      // Contact Information\n      licenseeCompanyName: deal?.licenseeCompanyName || \"\",\n      licenseeAddress: deal?.licenseeAddress || \"\",\n      licenseeContactName: deal?.licenseeContactName || \"\",\n      licenseeContactEmail: deal?.licenseeContactEmail || \"\",\n      licenseeContactPhone: deal?.licenseeContactPhone || \"\",\n      \n      musicSupervisorName: deal?.musicSupervisorName || \"\",\n      musicSupervisorAddress: deal?.musicSupervisorAddress || \"\",\n      musicSupervisorContactName: deal?.musicSupervisorContactName || \"\",\n      musicSupervisorContactEmail: deal?.musicSupervisorContactEmail || \"\",\n      musicSupervisorContactPhone: deal?.musicSupervisorContactPhone || \"\",\n      \n      clearanceCompanyName: deal?.clearanceCompanyName || \"\",\n      clearanceCompanyAddress: deal?.clearanceCompanyAddress || \"\",\n      clearanceCompanyContactName: deal?.clearanceCompanyContactName || \"\",\n      clearanceCompanyContactEmail: deal?.clearanceCompanyContactEmail || \"\",\n      clearanceCompanyContactPhone: deal?.clearanceCompanyContactPhone || \"\",\n      \n      status: deal?.status || \"new_request\",\n      dealValue: deal?.dealValue || undefined,\n      fullSongValue: deal?.fullSongValue || undefined,\n      ourFee: deal?.ourFee || undefined,\n      fullRecordingFee: deal?.fullRecordingFee || undefined,\n      ourRecordingFee: deal?.ourRecordingFee || undefined,\n      \n      // Status dates\n      pitchedDate: deal?.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n      pendingApprovalDate: deal?.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n      quotedDate: deal?.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n      useConfirmedDate: deal?.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n      beingDraftedDate: deal?.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n      outForSignatureDate: deal?.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n      paymentReceivedDate: deal?.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n      completedDate: deal?.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n      usage: deal?.usage || \"\",\n      media: deal?.media || \"\",\n      territory: deal?.territory || \"worldwide\",\n      term: deal?.term || \"\",\n      exclusivity: deal?.exclusivity || false,\n      exclusivityRestrictions: deal?.exclusivityRestrictions || \"\",\n      \n      // Song Information\n      writers: deal?.writers || \"\",\n      publishingInfo: deal?.publishingInfo || \"\",\n      splits: deal?.splits || \"\",\n      artist: deal?.artist || \"\",\n      label: deal?.label || \"\",\n      artistLabelSplits: deal?.artistLabelSplits || \"\",\n      \n      notes: deal?.notes || \"\",\n      airDate: deal?.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n      pitchDate: deal?.pitchDate ? new Date(deal.pitchDate).toISOString().split('T')[0] : undefined,\n    });\n  }, [deal, form]);\n\n  // Watch for status changes to auto-update dates\n  const watchedStatus = form.watch(\"status\");\n  useEffect(() => {\n    if (watchedStatus && watchedStatus !== \"pitched\") {\n      const now = new Date().toISOString().slice(0, 16); // Format for datetime-local\n      const fieldMap = {\n        \"pitched\": \"pitchedDate\",\n        \"pending approval\": \"pendingApprovalDate\",\n        \"quoted\": \"quotedDate\",\n        \"use confirmed\": \"useConfirmedDate\",\n        \"being drafted\": \"beingDraftedDate\",\n        \"out for signature\": \"outForSignatureDate\",\n        \"payment received\": \"paymentReceivedDate\",\n        \"completed\": \"completedDate\"\n      };\n      \n      const dateField = fieldMap[watchedStatus.toLowerCase()];\n      if (dateField && !form.getValues(dateField)) {\n        form.setValue(dateField, now);\n      }\n    }\n  }, [watchedStatus, form]);\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n  });\n\n  const createContactMutation = useMutation({\n    mutationFn: async (contactData: any) => {\n      const response = await apiRequest('/api/contacts', { method: 'POST', body: contactData });\n      return response.json();\n    },\n    onSuccess: (newContact) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      form.setValue('contactId', newContact.id);\n      setShowAddContact(false);\n      // Clear form\n      setNewContactName(\"\");\n      setNewContactEmail(\"\");\n      setNewContactPhone(\"\");\n      setNewContactCompany(\"\");\n      setNewContactRole(\"\");\n      setNewContactNotes(\"\");\n      setNewContactProjects(\"\");\n      toast({\n        title: \"Contact added successfully\",\n        description: `${newContact.name} has been added to your contacts.`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error adding contact\",\n        description: \"Failed to add the contact. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const createDealMutation = useMutation({\n    mutationFn: async (data: InsertDeal) => {\n      // Ensure all required fields are present and properly typed\n      const processedData = {\n        ...data,\n        songId: data.songId ? parseInt(data.songId.toString()) : null,\n        contactId: data.contactId ? parseInt(data.contactId.toString()) : null,\n        dealValue: data.dealValue !== null && data.dealValue !== undefined ? parseFloat(data.dealValue.toString()) : null,\n        fullSongValue: data.fullSongValue !== null && data.fullSongValue !== undefined ? parseFloat(data.fullSongValue.toString()) : null,\n        ourFee: data.ourFee !== null && data.ourFee !== undefined ? parseFloat(data.ourFee.toString()) : null,\n        fullRecordingFee: data.fullRecordingFee !== null && data.fullRecordingFee !== undefined ? parseFloat(data.fullRecordingFee.toString()) : null,\n        ourRecordingFee: data.ourRecordingFee !== null && data.ourRecordingFee !== undefined ? parseFloat(data.ourRecordingFee.toString()) : null,\n        pitchDate: data.pitchDate ? new Date(data.pitchDate).toISOString() : null,\n        \n        // Status dates\n        pitchedDate: data.pitchedDate ? new Date(data.pitchedDate).toISOString() : null,\n        pendingApprovalDate: data.pendingApprovalDate ? new Date(data.pendingApprovalDate).toISOString() : null,\n        quotedDate: data.quotedDate ? new Date(data.quotedDate).toISOString() : null,\n        useConfirmedDate: data.useConfirmedDate ? new Date(data.useConfirmedDate).toISOString() : null,\n        beingDraftedDate: data.beingDraftedDate ? new Date(data.beingDraftedDate).toISOString() : null,\n        outForSignatureDate: data.outForSignatureDate ? new Date(data.outForSignatureDate).toISOString() : null,\n        paymentReceivedDate: data.paymentReceivedDate ? new Date(data.paymentReceivedDate).toISOString() : null,\n        completedDate: data.completedDate ? new Date(data.completedDate).toISOString() : null,\n        airDate: data.airDate ? new Date(data.airDate).toISOString() : null,\n      };\n      \n      console.log(\"Processed data:\", processedData);\n      const endpoint = isEditing ? `/api/deals/${deal.id}` : \"/api/deals\";\n      const method = isEditing ? \"PUT\" : \"POST\";\n      const response = await apiRequest(endpoint, { method, body: processedData });\n      return response.json();\n    },\n    onSuccess: async (newDeal) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/deals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      \n      // Auto-create calendar event if airdate is set\n      if (newDeal.airDate) {\n        try {\n          await apiRequest(\"/api/calendar-events\", {\n            method: \"POST\",\n            body: {\n              title: `Air Date: ${newDeal.projectName}`,\n              description: `Air date for ${newDeal.projectName}`,\n              startDate: newDeal.airDate,\n              endDate: newDeal.airDate,\n              entityType: \"deal\",\n              entityId: newDeal.id,\n              status: \"scheduled\"\n            }\n          });\n          queryClient.invalidateQueries({ queryKey: [\"/api/calendar-events\"] });\n        } catch (error) {\n          console.log(\"Failed to create calendar event:\", error);\n        }\n      }\n      \n      form.reset();\n      onClose();\n      toast({\n        title: isEditing ? \"Deal Updated\" : \"Deal Added\",\n        description: isEditing \n          ? \"Deal has been successfully updated\"\n          : (newDeal.airDate \n              ? \"Deal has been added to the pipeline and calendar event created for air date\"\n              : \"Deal has been successfully added to the pipeline\")\n      });\n    },\n    onError: (error) => {\n      console.error(\"Error creating deal:\", error);\n      toast({\n        title: isEditing ? \"Error Updating Deal\" : \"Error Creating Deal\",\n        description: isEditing \n          ? \"There was an error updating the deal. Please try again.\"\n          : \"There was an error creating the deal. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleAddContact = () => {\n    if (!newContactName.trim() || !newContactEmail.trim()) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please provide at least a name and email for the contact.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const contactData = {\n      name: newContactName.trim(),\n      email: newContactEmail.trim(),\n      phone: newContactPhone.trim() || null,\n      company: newContactCompany.trim() || null,\n      role: newContactRole.trim() || null,\n      notes: `${newContactNotes.trim()}${newContactProjects.trim() ? '\\n\\nCurrent Projects:\\n' + newContactProjects.trim() : ''}`.trim() || null,\n    };\n\n    createContactMutation.mutate(contactData);\n  };\n\n  // Function to parse splits percentage from text\n  const parseOurSplitPercentage = (splitsText: string): number => {\n    if (!splitsText) return 50; // Default to 50% if no splits info\n    \n    // Common patterns to look for our percentage\n    const patterns = [\n      /our\\s*(?:share|split|percentage|%):?\\s*(\\d+)%?/i,\n      /we\\s*(?:get|receive|own):?\\s*(\\d+)%?/i,\n      /(\\d+)%?\\s*(?:our|ours|us)/i,\n      /(\\d+)%?\\s*writer/i, // Assuming we're the writer\n      /(\\d+)%?\\s*publisher/i, // Assuming we're the publisher\n    ];\n    \n    for (const pattern of patterns) {\n      const match = splitsText.match(pattern);\n      if (match && match[1]) {\n        const percentage = parseInt(match[1]);\n        if (percentage >= 0 && percentage <= 100) {\n          return percentage;\n        }\n      }\n    }\n    \n    // If no specific pattern found, look for any percentage\n    const percentageMatch = splitsText.match(/(\\d+)%/);\n    if (percentageMatch) {\n      const percentage = parseInt(percentageMatch[1]);\n      if (percentage >= 0 && percentage <= 100) {\n        return percentage;\n      }\n    }\n    \n    return 50; // Default to 50% if can't parse\n  };\n\n  // Function to calculate our fee based on splits\n  const calculateOurFee = (fullFee: number, splitsText: string): number => {\n    if (!fullFee || fullFee === 0) return 0;\n    const ourPercentage = parseOurSplitPercentage(splitsText);\n    return (fullFee * ourPercentage) / 100;\n  };\n\n  const onSubmit = (data: InsertDeal) => {\n    // Validate required fields manually\n    if (!data.projectName || !data.projectType || !data.songId || !data.contactId) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please fill in all required fields (Project Name, Project Type, Song Title, and Contact).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    createDealMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? \"Edit Deal\" : \"Add New Deal\"}</DialogTitle>\n        </DialogHeader>\n        \n","size_bytes":19474},"client/src/components/attachments-list.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport FileUploadForm from \"@/components/forms/file-upload-form\";\nimport { Download, File, FileText, Image, Music, Video, Archive, Upload, Trash2 } from \"lucide-react\";\nimport type { Attachment } from \"@shared/schema\";\n\ninterface AttachmentsListProps {\n  entityType: string;\n  entityId: number;\n  title?: string;\n}\n\nexport default function AttachmentsList({ entityType, entityId, title = \"Attachments\" }: AttachmentsListProps) {\n  const [isUploadOpen, setIsUploadOpen] = useState(false);\n\n  const { data: attachments = [], isLoading, error } = useQuery<Attachment[]>({\n    queryKey: [\"/api/attachments\", { entityType, entityId }],\n    queryFn: async () => {\n      const response = await fetch(`/api/attachments?entityType=${entityType}&entityId=${entityId}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch attachments');\n      }\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  const getFileIcon = (mimeType: string) => {\n    if (mimeType.startsWith('image/')) return Image;\n    if (mimeType.startsWith('audio/')) return Music;\n    if (mimeType.startsWith('video/')) return Video;\n    if (mimeType.includes('pdf')) return FileText;\n    if (mimeType.includes('zip') || mimeType.includes('rar')) return Archive;\n    return File;\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return \"0 Bytes\";\n    const k = 1024;\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n  };\n\n  const handleDownload = (attachment: Attachment) => {\n    window.open(`/api/files/${attachment.filename}`, '_blank');\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>{title}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            {[...Array(3)].map((_, i) => (\n              <div key={i} className=\"flex items-center space-x-3 p-3 border rounded-lg animate-pulse\">\n                <div className=\"h-8 w-8 bg-muted rounded\"></div>\n                <div className=\"flex-1 space-y-1\">\n                  <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                  <div className=\"h-3 bg-muted rounded w-1/3\"></div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>{title}</CardTitle>\n          <Button\n            onClick={() => setIsUploadOpen(true)}\n            size=\"sm\"\n            className=\"gap-2\"\n          >\n            <Upload className=\"h-4 w-4\" />\n            Upload File\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {attachments.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <File className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n            <p className=\"text-muted-foreground\">\n              No attachments yet. Upload files related to this {entityType}.\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {attachments.map((attachment) => {\n              const FileIcon = getFileIcon(attachment.mimeType);\n              return (\n                <div key={attachment.id} className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50\">\n                  <div className=\"flex items-center space-x-3\">\n                    <FileIcon className=\"h-8 w-8 text-muted-foreground\" />\n                    <div>\n                      <p className=\"font-medium\">{attachment.originalName}</p>\n                      <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                        <span>{formatFileSize(attachment.size)}</span>\n                        <span></span>\n                        <span>{new Date(attachment.createdAt).toLocaleDateString()}</span>\n                      </div>\n                      {attachment.description && (\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {attachment.description}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleDownload(attachment)}\n                    >\n                      <Download className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"text-red-600 hover:text-red-700\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </CardContent>\n\n      <FileUploadForm\n        open={isUploadOpen}\n        onClose={() => setIsUploadOpen(false)}\n        entityType={entityType}\n        entityId={entityId}\n      />\n    </Card>\n  );\n}","size_bytes":5529},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { Suspense, lazy, useState, useEffect } from \"react\";\nimport Sidebar from \"@/components/layout/sidebar\";\nimport OnboardingTour from \"@/components/OnboardingTour\";\n\nconst Dashboard = lazy(() => import(\"@/pages/dashboard\"));\nconst Songs = lazy(() => import(\"@/pages/songs\"));\nconst Deals = lazy(() => import(\"@/pages/deals\"));\nconst Pitches = lazy(() => import(\"@/pages/pitches\"));\nconst Contacts = lazy(() => import(\"@/pages/contacts\"));\nconst Income = lazy(() => import(\"@/pages/income\"));\nconst Templates = lazy(() => import(\"@/pages/templates\"));\nconst Reports = lazy(() => import(\"@/pages/reports\"));\nconst EmailTemplates = lazy(() => import(\"@/pages/email-templates\"));\nconst Calendar = lazy(() => import(\"@/pages/calendar\"));\nconst Playlists = lazy(() => import(\"@/pages/playlists\"));\nconst Analytics = lazy(() => import(\"@/pages/analytics\"));\nconst NotFound = lazy(() => import(\"@/pages/not-found\"));\n\nfunction App() {\n  const [tourEnabled, setTourEnabled] = useState(false);\n\n  useEffect(() => {\n    const hasSeenTour = localStorage.getItem('hasSeenSyncTrackerTour');\n    if (!hasSeenTour) {\n      // Delay tour start slightly to ensure DOM is ready\n      setTimeout(() => setTourEnabled(true), 500);\n    }\n  }, []);\n\n  const handleTourExit = () => {\n    setTourEnabled(false);\n    localStorage.setItem('hasSeenSyncTrackerTour', 'true');\n  };\n\n  const handleStartTour = () => {\n    setTourEnabled(true);\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          {tourEnabled && <OnboardingTour enabled={tourEnabled} onExit={handleTourExit} />}\n          <div className=\"flex min-h-screen bg-background\">\n            <Sidebar onStartTour={handleStartTour} />\n            <main className=\"flex-1 lg:ml-64 bg-background\">\n              <Suspense fallback={<div className=\"p-6 text-muted-foreground\">Loading...</div>}>\n                <Switch>\n                  <Route path=\"/\" component={Dashboard} />\n                  <Route path=\"/songs\" component={Songs} />\n                  <Route path=\"/deals\" component={Deals} />\n                  <Route path=\"/pitches\" component={Pitches} />\n                  <Route path=\"/contacts\" component={Contacts} />\n                  <Route path=\"/income\" component={Income} />\n                  <Route path=\"/templates\" component={Templates} />\n                  <Route path=\"/reports\" component={Reports} />\n                  <Route path=\"/email-templates\" component={EmailTemplates} />\n                  <Route path=\"/calendar\" component={Calendar} />\n                  <Route path=\"/playlists\" component={Playlists} />\n                  <Route path=\"/analytics\" component={Analytics} />\n                  <Route component={NotFound} />\n                </Switch>\n              </Suspense>\n            </main>\n          </div>\n          <Toaster />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":3288},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/invoice-management.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon, FileText, DollarSign, Send, Check, Clock, AlertCircle, Plus } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Deal } from \"@shared/schema\";\n\ninterface Invoice {\n  id: number;\n  dealId: number;\n  invoiceNumber: string;\n  amount: number;\n  taxAmount: number;\n  totalAmount: number;\n  status: string;\n  dueDate: Date;\n  paidDate?: Date;\n  notes?: string;\n  createdAt: Date;\n  deal?: Deal;\n}\n\nexport default function InvoiceManagement() {\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [selectedDealId, setSelectedDealId] = useState<string>(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [taxRate, setTaxRate] = useState(\"0\");\n  const [dueDate, setDueDate] = useState<Date>();\n  const [notes, setNotes] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: invoices = [] } = useQuery({\n    queryKey: ['/api/invoices'],\n  });\n\n  const { data: deals = [] } = useQuery({\n    queryKey: ['/api/deals'],\n  });\n\n  const createInvoiceMutation = useMutation({\n    mutationFn: async (invoiceData: any) => {\n      return apiRequest('/api/invoices', {\n        method: 'POST',\n        body: invoiceData\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/invoices'] });\n      setShowCreateDialog(false);\n      resetForm();\n      toast({\n        title: \"Invoice Created\",\n        description: \"Invoice has been generated successfully\"\n      });\n    }\n  });\n\n  const updateInvoiceStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return apiRequest(`/api/invoices/${id}`, {\n        method: 'PUT',\n        body: { status }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/invoices'] });\n      toast({\n        title: \"Status Updated\",\n        description: \"Invoice status has been updated\"\n      });\n    }\n  });\n\n  const resetForm = () => {\n    setSelectedDealId(\"\");\n    setAmount(\"\");\n    setTaxRate(\"0\");\n    setDueDate(undefined);\n    setNotes(\"\");\n  };\n\n  const calculateTotal = () => {\n    const baseAmount = parseFloat(amount) || 0;\n    const tax = baseAmount * (parseFloat(taxRate) / 100);\n    return baseAmount + tax;\n  };\n\n  const generateInvoiceNumber = () => {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0');\n    const day = String(now.getDate()).padStart(2, '0');\n    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    return `INV-${year}${month}${day}-${random}`;\n  };\n\n  const handleCreateInvoice = () => {\n    if (!selectedDealId || !amount || !dueDate) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const baseAmount = parseFloat(amount);\n    const taxAmount = baseAmount * (parseFloat(taxRate) / 100);\n    const totalAmount = baseAmount + taxAmount;\n\n    createInvoiceMutation.mutate({\n      dealId: parseInt(selectedDealId),\n      invoiceNumber: generateInvoiceNumber(),\n      amount: baseAmount,\n      taxAmount,\n      totalAmount,\n      dueDate: dueDate.toISOString(),\n      notes\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'paid': return 'bg-green-100 text-green-800';\n      case 'sent': return 'bg-blue-100 text-blue-800';\n      case 'overdue': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'paid': return <Check className=\"h-4 w-4\" />;\n      case 'sent': return <Send className=\"h-4 w-4\" />;\n      case 'overdue': return <AlertCircle className=\"h-4 w-4\" />;\n      default: return <Clock className=\"h-4 w-4\" />;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Invoice Management</h2>\n          <p className=\"text-gray-600\">Generate and track invoices for your deals</p>\n        </div>\n        <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create Invoice\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create New Invoice</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"deal\">Deal</Label>\n                <Select value={selectedDealId} onValueChange={setSelectedDealId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a deal\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {deals.map((deal: Deal) => (\n                      <SelectItem key={deal.id} value={deal.id.toString()}>\n                        {deal.projectTitle} - ${deal.value}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"amount\">Amount ($)</Label>\n                  <Input\n                    id=\"amount\"\n                    type=\"number\"\n                    value={amount}\n                    onChange={(e) => setAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"taxRate\">Tax Rate (%)</Label>\n                  <Input\n                    id=\"taxRate\"\n                    type=\"number\"\n                    value={taxRate}\n                    onChange={(e) => setTaxRate(e.target.value)}\n                    placeholder=\"0\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Due Date</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button variant=\"outline\" className=\"w-full justify-start text-left\">\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {dueDate ? format(dueDate, \"PPP\") : \"Select date\"}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={dueDate}\n                      onSelect={setDueDate}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"notes\">Notes (Optional)</Label>\n                <Input\n                  id=\"notes\"\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  placeholder=\"Additional notes...\"\n                />\n              </div>\n\n              {amount && (\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Subtotal:</span>\n                    <span>${parseFloat(amount || \"0\").toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Tax ({taxRate}%):</span>\n                    <span>${(parseFloat(amount || \"0\") * parseFloat(taxRate) / 100).toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex justify-between font-semibold border-t pt-2 mt-2\">\n                    <span>Total:</span>\n                    <span>${calculateTotal().toFixed(2)}</span>\n                  </div>\n                </div>\n              )}\n\n              <Button onClick={handleCreateInvoice} className=\"w-full\">\n                Generate Invoice\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {invoices.map((invoice: Invoice) => (\n          <Card key={invoice.id}>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4\" />\n                    <span className=\"font-semibold\">{invoice.invoiceNumber}</span>\n                    <Badge className={getStatusColor(invoice.status)}>\n                      {getStatusIcon(invoice.status)}\n                      <span className=\"ml-1\">{invoice.status}</span>\n                    </Badge>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    Due: {format(new Date(invoice.dueDate), \"MMM dd, yyyy\")}\n                  </p>\n                  {invoice.deal && (\n                    <p className=\"text-sm text-gray-600\">\n                      Deal: {invoice.deal.projectTitle}\n                    </p>\n                  )}\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-2xl font-bold\">${invoice.totalAmount.toFixed(2)}</div>\n                  <div className=\"text-sm text-gray-600\">\n                    Tax: ${invoice.taxAmount.toFixed(2)}\n                  </div>\n                </div>\n              </div>\n              \n              {invoice.status !== 'paid' && (\n                <div className=\"flex gap-2 mt-4\">\n                  {invoice.status === 'draft' && (\n                    <Button \n                      size=\"sm\" \n                      onClick={() => updateInvoiceStatusMutation.mutate({ id: invoice.id, status: 'sent' })}\n                    >\n                      <Send className=\"h-4 w-4 mr-1\" />\n                      Send\n                    </Button>\n                  )}\n                  <Button \n                    size=\"sm\" \n                    variant=\"outline\"\n                    onClick={() => updateInvoiceStatusMutation.mutate({ id: invoice.id, status: 'paid' })}\n                  >\n                    <Check className=\"h-4 w-4 mr-1\" />\n                    Mark Paid\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":11449},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  url: string,\n  options?: {\n    method?: string;\n    body?: unknown;\n  }\n): Promise<Response> {\n  const method = options?.method || \"GET\";\n  const data = options?.body;\n  \n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1463},"client/src/pages/smart-pitch.tsx":{"content":"import Header from \"@/components/layout/header\";\nimport SmartPitchMatching from \"@/components/smart-pitch-matching\";\n\nexport default function SmartPitch() {\n  return (\n    <div className=\"flex-1 space-y-4 p-4 md:p-8 pt-6\">\n      <Header \n        title=\"Smart Pitch Matching\" \n        description=\"AI-powered song recommendations for sync licensing opportunities\"\n      />\n      <SmartPitchMatching />\n    </div>\n  );\n}","size_bytes":418},"client/src/pages/email-templates.tsx":{"content":"import { useState, useMemo, useDeferredValue } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport Header from \"@/components/layout/header\";\nimport AddEmailTemplateForm from \"@/components/forms/add-email-template-form\";\nimport { Mail, Plus, Search } from \"lucide-react\";\nimport type { EmailTemplate } from \"@shared/schema\";\n\nexport default function EmailTemplates() {\n  const [isAddFormOpen, setIsAddFormOpen] = useState(false);\n  const [editingTemplate, setEditingTemplate] = useState<EmailTemplate | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const deferredSearchQuery = useDeferredValue(searchQuery);\n\n  const { data: templates = [], isLoading } = useQuery<EmailTemplate[]>({\n    queryKey: [\"/api/email-templates\"],\n  });\n\n  const filteredTemplates = useMemo(() => {\n    return templates.filter(template =>\n      template.name.toLowerCase().includes(deferredSearchQuery.toLowerCase()) ||\n      template.stage.toLowerCase().includes(deferredSearchQuery.toLowerCase()) ||\n      template.subject.toLowerCase().includes(deferredSearchQuery.toLowerCase())\n    );\n  }, [templates, deferredSearchQuery]);\n\n  const getStageColor = (stage: string) => {\n    const colors = {\n      initial_pitch: \"bg-blue-100 text-blue-800\",\n      follow_up: \"bg-yellow-100 text-yellow-800\",\n      negotiation: \"bg-orange-100 text-orange-800\",\n      contract_sent: \"bg-purple-100 text-purple-800\",\n      deal_confirmed: \"bg-green-100 text-green-800\",\n      payment_reminder: \"bg-red-100 text-red-800\",\n      thank_you: \"bg-gray-100 text-gray-800\",\n    };\n    return colors[stage as keyof typeof colors] || \"bg-gray-100 text-gray-800\";\n  };\n\n  const formatStage = (stage: string) => {\n    return stage.split('_').map(word => \n      word.charAt(0).toUpperCase() + word.slice(1)\n    ).join(' ');\n  };\n\n  // Memoize expensive calculations to prevent unnecessary re-renders\n  const mostUsedStage = useMemo(() => {\n    if (templates.length === 0) return \"N/A\";\n    \n    const stageCounts = templates.reduce((acc: Record<string, number>, template) => {\n      acc[template.stage] = (acc[template.stage] || 0) + 1;\n      return acc;\n    }, {});\n    \n    const mostUsed = Object.entries(stageCounts).reduce((max, [stage, count]) => \n      count > max[1] ? [stage, count] : max\n    )[0];\n    \n    return formatStage(mostUsed);\n  }, [templates]);\n\n  const availableStagesCount = useMemo(() => {\n    return new Set(templates.map(t => t.stage)).size;\n  }, [templates]);\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <Header\n          title=\"Email Templates\"\n          description=\"Pre-written email templates for different stages of the licensing process\"\n        />\n        <div className=\"grid gap-4\" role=\"status\" aria-live=\"polite\" aria-label=\"Loading email templates\">\n          {[...Array(5)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-4 bg-muted rounded w-1/3\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-3 bg-muted rounded w-full\"></div>\n              </CardContent>\n            </Card>\n          ))}\n          <span className=\"sr-only\">Loading email templates, please wait...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Header\n        title=\"Email Templates\"\n        description=\"Pre-written email templates for different stages of the licensing process\"\n        searchPlaceholder=\"Search templates...\"\n        onSearch={setSearchQuery}\n        onNewItem={() => setIsAddFormOpen(true)}\n        newItemLabel=\"New Template\"\n        showSearch={true}\n        showNewButton={true}\n      />\n\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Total Templates</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{templates.length}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Most Used Stage</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {mostUsedStage}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Available Stages</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {availableStagesCount}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Email Templates</CardTitle>\n          <CardDescription>\n            Manage your email templates for different licensing stages\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Name</TableHead>\n                <TableHead>Stage</TableHead>\n                <TableHead>Subject</TableHead>\n                <TableHead>Variables</TableHead>\n                <TableHead>Created</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredTemplates.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={6} className=\"text-center py-8\">\n                    <Mail className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                    <p className=\"text-muted-foreground\">\n                      {templates.length === 0 \n                        ? \"No email templates yet. Create your first template!\"\n                        : \"No templates match your search.\"\n                      }\n                    </p>\n                  </TableCell>\n                </TableRow>\n              ) : (\n                filteredTemplates.map((template) => (\n                  <TableRow key={template.id}>\n                    <TableCell className=\"font-medium\">{template.name}</TableCell>\n                    <TableCell>\n                      <Badge className={getStageColor(template.stage)}>\n                        {formatStage(template.stage)}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"max-w-xs truncate\">{template.subject}</TableCell>\n                    <TableCell>\n                      {Array.isArray(template.variables) && template.variables.length > 0 ? (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {template.variables.slice(0, 3).map((variable: any, index: number) => (\n                            <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                              {variable.name || variable}\n                            </Badge>\n                          ))}\n                          {template.variables.length > 3 && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              +{template.variables.length - 3}\n                            </Badge>\n                          )}\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground text-sm\">No variables</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground\">\n                      {new Date(template.createdAt).toLocaleDateString()}\n                    </TableCell>\n                    <TableCell>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\"\n                        onClick={() => setEditingTemplate(template)}\n                      >\n                        Edit\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      <AddEmailTemplateForm\n        open={isAddFormOpen || !!editingTemplate}\n        onClose={() => {\n          setIsAddFormOpen(false);\n          setEditingTemplate(null);\n        }}\n        template={editingTemplate}\n      />\n    </div>\n  );\n}","size_bytes":8788},"client/src/components/advanced-search.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Filter, Save, X } from \"lucide-react\";\n\ninterface SearchCriteria {\n  query: string;\n  genres: string[];\n  moods: string[];\n  bpmRange: [number, number];\n  keySignature: string;\n  vocalType: string;\n  explicitContent: boolean | null;\n  duration: string;\n  composer: string;\n  publisher: string;\n  hasISRC: boolean | null;\n  hasLyrics: boolean | null;\n}\n\ninterface AdvancedSearchProps {\n  open: boolean;\n  onClose: () => void;\n  onSearch: (criteria: SearchCriteria) => void;\n  onSaveSearch?: (name: string, criteria: SearchCriteria) => void;\n}\n\nconst genreOptions = [\n  \"Electronic\", \"Pop\", \"Rock\", \"Hip Hop\", \"Classical\", \"Jazz\", \"Country\", \n  \"Folk\", \"R&B\", \"Reggae\", \"Blues\", \"Funk\", \"Metal\", \"Punk\", \"Alternative\",\n  \"Indie\", \"Cinematic\", \"Ambient\", \"Techno\", \"House\", \"Trance\"\n];\n\nconst moodOptions = [\n  \"Uplifting\", \"Energetic\", \"Calm\", \"Melancholic\", \"Romantic\", \"Aggressive\",\n  \"Peaceful\", \"Dramatic\", \"Mysterious\", \"Playful\", \"Epic\", \"Nostalgic\",\n  \"Dark\", \"Bright\", \"Atmospheric\", \"Driving\", \"Contemplative\", \"Celebratory\"\n];\n\nconst keyOptions = [\n  \"C Major\", \"C Minor\", \"C# Major\", \"C# Minor\", \"D Major\", \"D Minor\",\n  \"D# Major\", \"D# Minor\", \"E Major\", \"E Minor\", \"F Major\", \"F Minor\",\n  \"F# Major\", \"F# Minor\", \"G Major\", \"G Minor\", \"G# Major\", \"G# Minor\",\n  \"A Major\", \"A Minor\", \"A# Major\", \"A# Minor\", \"B Major\", \"B Minor\"\n];\n\nconst vocalOptions = [\n  \"Male Vocals\", \"Female Vocals\", \"Mixed Vocals\", \"Instrumental\", \n  \"Vocal Samples\", \"Spoken Word\", \"Rap/Hip Hop\", \"Choir\"\n];\n\nexport default function AdvancedSearch({ open, onClose, onSearch, onSaveSearch }: AdvancedSearchProps) {\n  const [showSaveDialog, setShowSaveDialog] = useState(false);\n  const [searchName, setSearchName] = useState(\"\");\n  \n  const form = useForm<SearchCriteria>({\n    defaultValues: {\n      query: \"\",\n      genres: [],\n      moods: [],\n      bpmRange: [60, 180],\n      keySignature: \"\",\n      vocalType: \"\",\n      explicitContent: null,\n      duration: \"\",\n      composer: \"\",\n      publisher: \"\",\n      hasISRC: null,\n      hasLyrics: null,\n    },\n  });\n\n  const handleSubmit = (data: SearchCriteria) => {\n    onSearch(data);\n    onClose();\n  };\n\n  const handleSaveSearch = () => {\n    if (searchName.trim() && onSaveSearch) {\n      onSaveSearch(searchName, form.getValues());\n      setShowSaveDialog(false);\n      setSearchName(\"\");\n    }\n  };\n\n  const toggleGenre = (genre: string) => {\n    const currentGenres = form.getValues(\"genres\");\n    const newGenres = currentGenres.includes(genre)\n      ? currentGenres.filter(g => g !== genre)\n      : [...currentGenres, genre];\n    form.setValue(\"genres\", newGenres);\n  };\n\n  const toggleMood = (mood: string) => {\n    const currentMoods = form.getValues(\"moods\");\n    const newMoods = currentMoods.includes(mood)\n      ? currentMoods.filter(m => m !== mood)\n      : [...currentMoods, mood];\n    form.setValue(\"moods\", newMoods);\n  };\n\n  const clearForm = () => {\n    form.reset();\n  };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onClose}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Filter className=\"h-5 w-5\" />\n              Advanced Search\n            </DialogTitle>\n          </DialogHeader>\n\n          <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n            {/* Basic Search */}\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"query\">Search Query</Label>\n                <Input\n                  id=\"query\"\n                  {...form.register(\"query\")}\n                  placeholder=\"Search across all fields...\"\n                />\n              </div>\n            </div>\n\n            {/* Genre Selection */}\n            <div className=\"space-y-3\">\n              <Label>Genres</Label>\n              <div className=\"flex flex-wrap gap-2 max-h-32 overflow-y-auto border rounded-lg p-3\">\n                {genreOptions.map((genre) => (\n                  <Badge\n                    key={genre}\n                    variant={form.watch(\"genres\").includes(genre) ? \"default\" : \"outline\"}\n                    className=\"cursor-pointer\"\n                    onClick={() => toggleGenre(genre)}\n                  >\n                    {genre}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n\n            {/* Mood Selection */}\n            <div className=\"space-y-3\">\n              <Label>Moods</Label>\n              <div className=\"flex flex-wrap gap-2 max-h-32 overflow-y-auto border rounded-lg p-3\">\n                {moodOptions.map((mood) => (\n                  <Badge\n                    key={mood}\n                    variant={form.watch(\"moods\").includes(mood) ? \"default\" : \"outline\"}\n                    className=\"cursor-pointer\"\n                    onClick={() => toggleMood(mood)}\n                  >\n                    {mood}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n\n            {/* Technical Criteria */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-3\">\n                <Label>BPM Range: {form.watch(\"bpmRange\")[0]} - {form.watch(\"bpmRange\")[1]}</Label>\n                <Slider\n                  value={form.watch(\"bpmRange\")}\n                  onValueChange={(value) => form.setValue(\"bpmRange\", value as [number, number])}\n                  min={60}\n                  max={200}\n                  step={1}\n                  className=\"w-full\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"keySignature\">Key Signature</Label>\n                <Select value={form.watch(\"keySignature\")} onValueChange={(value) => form.setValue(\"keySignature\", value)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select key\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"\">Any Key</SelectItem>\n                    {keyOptions.map((key) => (\n                      <SelectItem key={key} value={key}>{key}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"vocalType\">Vocal Type</Label>\n                <Select value={form.watch(\"vocalType\")} onValueChange={(value) => form.setValue(\"vocalType\", value)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select vocal type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"\">Any Vocal Type</SelectItem>\n                    {vocalOptions.map((vocal) => (\n                      <SelectItem key={vocal} value={vocal}>{vocal}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"duration\">Duration</Label>\n                <Select value={form.watch(\"duration\")} onValueChange={(value) => form.setValue(\"duration\", value)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select duration\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"\">Any Duration</SelectItem>\n                    <SelectItem value=\"short\">Short (< 2 min)</SelectItem>\n                    <SelectItem value=\"medium\">Medium (2-4 min)</SelectItem>\n                    <SelectItem value=\"long\">Long (> 4 min)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Metadata Criteria */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"composer\">Composer</Label>\n                <Input\n                  id=\"composer\"\n                  {...form.register(\"composer\")}\n                  placeholder=\"Search by composer\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"publisher\">Publisher</Label>\n                <Input\n                  id=\"publisher\"\n                  {...form.register(\"publisher\")}\n                  placeholder=\"Search by publisher\"\n                />\n              </div>\n            </div>\n\n            {/* Boolean Filters */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"explicitContent\">Explicit Content</Label>\n                <div className=\"flex space-x-4\">\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"explicitContent\"\n                      checked={form.watch(\"explicitContent\") === true}\n                      onChange={() => form.setValue(\"explicitContent\", true)}\n                    />\n                    <span>Yes</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"explicitContent\"\n                      checked={form.watch(\"explicitContent\") === false}\n                      onChange={() => form.setValue(\"explicitContent\", false)}\n                    />\n                    <span>No</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"explicitContent\"\n                      checked={form.watch(\"explicitContent\") === null}\n                      onChange={() => form.setValue(\"explicitContent\", null)}\n                    />\n                    <span>Any</span>\n                  </label>\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"hasISRC\">Has ISRC</Label>\n                <div className=\"flex space-x-4\">\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasISRC\"\n                      checked={form.watch(\"hasISRC\") === true}\n                      onChange={() => form.setValue(\"hasISRC\", true)}\n                    />\n                    <span>Yes</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasISRC\"\n                      checked={form.watch(\"hasISRC\") === false}\n                      onChange={() => form.setValue(\"hasISRC\", false)}\n                    />\n                    <span>No</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasISRC\"\n                      checked={form.watch(\"hasISRC\") === null}\n                      onChange={() => form.setValue(\"hasISRC\", null)}\n                    />\n                    <span>Any</span>\n                  </label>\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"hasLyrics\">Has Lyrics</Label>\n                <div className=\"flex space-x-4\">\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasLyrics\"\n                      checked={form.watch(\"hasLyrics\") === true}\n                      onChange={() => form.setValue(\"hasLyrics\", true)}\n                    />\n                    <span>Yes</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasLyrics\"\n                      checked={form.watch(\"hasLyrics\") === false}\n                      onChange={() => form.setValue(\"hasLyrics\", false)}\n                    />\n                    <span>No</span>\n                  </label>\n                  <label className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"radio\"\n                      name=\"hasLyrics\"\n                      checked={form.watch(\"hasLyrics\") === null}\n                      onChange={() => form.setValue(\"hasLyrics\", null)}\n                    />\n                    <span>Any</span>\n                  </label>\n                </div>\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex justify-between items-center pt-6 border-t\">\n              <div className=\"flex space-x-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={clearForm}>\n                  <X className=\"mr-2 h-4 w-4\" />\n                  Clear\n                </Button>\n                {onSaveSearch && (\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setShowSaveDialog(true)}>\n                    <Save className=\"mr-2 h-4 w-4\" />\n                    Save Search\n                  </Button>\n                )}\n              </div>\n              <div className=\"flex space-x-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\">\n                  <Search className=\"mr-2 h-4 w-4\" />\n                  Search\n                </Button>\n              </div>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Save Search Dialog */}\n      <Dialog open={showSaveDialog} onOpenChange={setShowSaveDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Save Search</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"searchName\">Search Name</Label>\n              <Input\n                id=\"searchName\"\n                value={searchName}\n                onChange={(e) => setSearchName(e.target.value)}\n                placeholder=\"Enter a name for this search\"\n              />\n            </div>\n            <div className=\"flex justify-end space-x-2\">\n              <Button variant=\"outline\" onClick={() => setShowSaveDialog(false)}>\n                Cancel\n              </Button>\n              <Button onClick={handleSaveSearch} disabled={!searchName.trim()}>\n                Save\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","size_bytes":15327},"client/src/components/forms/file-upload-form.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, X } from \"lucide-react\";\n\ninterface FileUploadFormProps {\n  open: boolean;\n  onClose: () => void;\n  entityType: string;\n  entityId: number;\n}\n\nexport default function FileUploadForm({ open, onClose, entityType, entityId }: FileUploadFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [file, setFile] = useState<File | null>(null);\n  const [description, setDescription] = useState(\"\");\n  const [dragActive, setDragActive] = useState(false);\n\n  const mutation = useMutation({\n    mutationFn: async (data: { file: File; description: string }) => {\n      const formData = new FormData();\n      formData.append(\"file\", data.file);\n      formData.append(\"entityType\", entityType);\n      formData.append(\"entityId\", entityId.toString());\n      formData.append(\"description\", data.description);\n\n      const response = await fetch(\"/api/upload\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Upload failed\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attachments\"] });\n      toast({\n        title: \"File uploaded\",\n        description: \"The file has been successfully uploaded.\",\n      });\n      onClose();\n      setFile(null);\n      setDescription(\"\");\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to upload file. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    \n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0) {\n      setFile(files[0]);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (files.length > 0) {\n      setFile(files[0]);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!file) return;\n\n    mutation.mutate({ file, description });\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return \"0 Bytes\";\n    const k = 1024;\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Upload File</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\n              dragActive\n                ? \"border-primary bg-primary/10\"\n                : \"border-muted-foreground/25\"\n            }`}\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n          >\n            {file ? (\n              <div className=\"flex items-center justify-between p-4 bg-muted rounded-lg\">\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"text-sm\">\n                    <p className=\"font-medium\">{file.name}</p>\n                    <p className=\"text-muted-foreground\">\n                      {formatFileSize(file.size)}\n                    </p>\n                  </div>\n                </div>\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setFile(null)}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                <Upload className=\"h-12 w-12 mx-auto text-muted-foreground\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  Drag and drop a file here, or click to select\n                </p>\n                <Input\n                  type=\"file\"\n                  onChange={handleFileChange}\n                  accept=\".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.mp3,.wav,.aiff,.flac,.m4a,.zip,.rar\"\n                  className=\"hidden\"\n                  id=\"file-upload\"\n                />\n                <Label\n                  htmlFor=\"file-upload\"\n                  className=\"cursor-pointer inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2\"\n                >\n                  Choose File\n                </Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Supported: PDF, DOC, TXT, Images, Audio, Archives (max 10MB)\n                </p>\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"description\">Description (optional)</Label>\n            <Textarea\n              id=\"description\"\n              placeholder=\"Add a description for this file...\"\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              className=\"min-h-[80px]\"\n            />\n          </div>\n\n          <div className=\"flex justify-end space-x-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={!file || mutation.isPending}>\n              {mutation.isPending ? \"Uploading...\" : \"Upload\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":6747},"client/src/pages/pitches.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Send, Calendar, Clock, CheckCircle, Plus } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { insertPitchSchema, type Pitch, type InsertPitch, type Deal, type Song } from \"@shared/schema\";\n\nexport default function Pitches() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showAddPitch, setShowAddPitch] = useState(false);\n  const [useCustomDeal, setUseCustomDeal] = useState(false);\n  const [selectedPitch, setSelectedPitch] = useState<Pitch | null>(null);\n  const [showUpdateStatus, setShowUpdateStatus] = useState(false);\n  const [showFollowUp, setShowFollowUp] = useState(false);\n  const { toast } = useToast();\n\n  const { data: rawPitches = [], isLoading } = useQuery<Pitch[]>({\n    queryKey: [\"/api/pitches\"],\n  });\n\n  // Sort pitches by priority: overdue follow-ups first, then upcoming follow-ups, then others\n  const pitches = useMemo(() => {\n    return [...rawPitches].sort((a, b) => {\n      const now = new Date();\n      const aOverdue = a.followUpDate && new Date(a.followUpDate) <= now;\n      const bOverdue = b.followUpDate && new Date(b.followUpDate) <= now;\n      const aHasFollowUp = !!a.followUpDate;\n      const bHasFollowUp = !!b.followUpDate;\n      \n      // Priority 1: Overdue follow-ups first (earliest overdue first)\n      if (aOverdue && !bOverdue) return -1;\n      if (!aOverdue && bOverdue) return 1;\n      if (aOverdue && bOverdue) {\n        return new Date(a.followUpDate!).getTime() - new Date(b.followUpDate!).getTime();\n      }\n      \n      // Priority 2: Upcoming follow-ups (earliest first)\n      if (aHasFollowUp && !bHasFollowUp) return -1;\n      if (!aHasFollowUp && bHasFollowUp) return 1;\n      if (aHasFollowUp && bHasFollowUp) {\n        return new Date(a.followUpDate!).getTime() - new Date(b.followUpDate!).getTime();\n      }\n      \n      // Priority 3: Others by submission date (most recent first)\n      return new Date(b.submissionDate).getTime() - new Date(a.submissionDate).getTime();\n    });\n  }, [rawPitches]);\n\n  const { data: deals = [] } = useQuery<Deal[]>({\n    queryKey: [\"/api/deals\"],\n  });\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const form = useForm({\n    // Temporarily remove resolver to prevent validation issues\n    // resolver: zodResolver(insertPitchSchema),\n    defaultValues: {\n      dealId: \"\",\n      customDealName: \"\",\n      status: \"pitched\",\n      selectedSongs: [],\n      notes: \"\",\n      followUpDate: \"\",\n    },\n  });\n\n  const createPitchMutation = useMutation({\n    mutationFn: async (data: InsertPitch) => {\n      return apiRequest(\"/api/pitches\", {\n        method: \"POST\",\n        body: data,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pitches\"] });\n      toast({\n        title: \"Pitch created\",\n        description: \"Your new pitch has been added successfully.\",\n      });\n      setShowAddPitch(false);\n      setUseCustomDeal(false);\n      form.reset({\n        dealId: \"\",\n        customDealName: \"\",\n        status: \"pitched\",\n        selectedSongs: [],\n        notes: \"\",\n        followUpDate: \"\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error creating pitch\",\n        description: error.message || \"Failed to create pitch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePitchMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<InsertPitch> }) => {\n      return apiRequest(`/api/pitches/${id}`, {\n        method: \"PUT\",\n        body: data,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pitches\"] });\n      toast({\n        title: \"Pitch updated\",\n        description: \"The pitch has been updated successfully.\",\n      });\n      setShowUpdateStatus(false);\n      setShowFollowUp(false);\n      setSelectedPitch(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error updating pitch\",\n        description: error.message || \"Failed to update pitch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    // Validate required fields\n    if (!useCustomDeal && !data.dealId) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a deal for this pitch.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (useCustomDeal && !data.customDealName?.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please enter a deal name for this pitch.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!data.selectedSongs || data.selectedSongs.length === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select at least one song for this pitch.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Convert and validate data - send strings to server, not Date objects\n    const selectedSongTitles = data.selectedSongs?.map((songId: string) => {\n      const song = songs.find(s => s.id === parseInt(songId));\n      return song ? `${song.title} by ${song.artist}` : '';\n    }).filter((title: string) => title).join('\\n') || '';\n\n    const processedData = {\n      dealId: useCustomDeal ? null : parseInt(data.dealId),\n      customDealName: useCustomDeal ? data.customDealName.trim() : null,\n      status: data.status || \"pitched\",\n      notes: selectedSongTitles + (data.notes ? '\\n\\nAdditional Notes:\\n' + data.notes : ''),\n      followUpDate: data.followUpDate && data.followUpDate !== \"\" ? data.followUpDate : undefined,\n    };\n    \n    console.log(\"Submitting pitch data:\", processedData);\n    createPitchMutation.mutate(processedData);\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"pitched\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"follow_up\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusLabel = (status: string) => {\n    switch (status) {\n      case \"pitched\":\n        return \"Pitched\";\n      case \"follow_up\":\n        return \"Follow Up\";\n      case \"completed\":\n        return \"Completed\";\n      default:\n        return status.replace(\"_\", \" \").replace(/\\b\\w/g, l => l.toUpperCase());\n    }\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"N/A\";\n    return new Date(date).toLocaleDateString();\n  };\n\n  const isFollowUpDue = (pitch: Pitch) => {\n    if (!pitch.followUpDate) return false;\n    return new Date(pitch.followUpDate) <= new Date();\n  };\n\n  const isFollowUpOverdue = (pitch: Pitch) => {\n    if (!pitch.followUpDate) return false;\n    const followUpDate = new Date(pitch.followUpDate);\n    const now = new Date();\n    const daysDiff = Math.floor((now.getTime() - followUpDate.getTime()) / (1000 * 60 * 60 * 24));\n    return daysDiff > 0;\n  };\n\n  const getDealName = (pitch: Pitch) => {\n    if (pitch.customDealName) {\n      return pitch.customDealName;\n    }\n    if (pitch.dealId) {\n      const deal = deals.find(d => d.id === pitch.dealId);\n      if (deal) {\n        return `${deal.projectName}${deal.episodeNumber ? ` - Episode ${deal.episodeNumber}` : ''}`;\n      }\n    }\n    return \"Unknown Deal\";\n  };\n\n  if (isLoading) {\n    return (\n      <div>\n        <Header\n          title=\"Sync Pitches\"\n          description=\"Track your pitch submissions and follow-up schedules\"\n          searchPlaceholder=\"Search pitches, projects...\"\n          newItemLabel=\"New Pitch\"\n        />\n        <div className=\"p-6\">\n          <div className=\"grid gap-6\">\n            {[...Array(3)].map((_, i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start space-x-4\">\n                    <div className=\"w-16 h-16 bg-gray-200 rounded-lg\"></div>\n                    <div className=\"flex-1 space-y-3\">\n                      <div className=\"h-5 bg-gray-200 rounded w-2/5\"></div>\n                      <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\n                        <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n                      </div>\n                      <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n                    </div>\n                    <div className=\"flex space-x-2\">\n                      <div className=\"h-6 bg-gray-200 rounded w-16\"></div>\n                      <div className=\"h-8 w-20 bg-gray-200 rounded\"></div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Sync Pitches\"\n        description=\"Track your pitch submissions and follow-up schedules\"\n        searchPlaceholder=\"Search pitches, projects...\"\n        newItemLabel=\"New Pitch\"\n        onSearch={setSearchQuery}\n        onNewItem={() => setShowAddPitch(true)}\n      />\n      \n      <div className=\"p-6\">\n        {pitches.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-16\">\n              <Send className=\"h-12 w-12 text-gray-400 mb-4\" />\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No pitches found</h3>\n              <p className=\"text-gray-600 text-center mb-6\">\n                Pitches are automatically created when you add deals. Start by creating your first deal.\n              </p>\n              <Button className=\"bg-brand-primary hover:bg-blue-700\">\n                Create Your First Deal\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-6\">\n            {pitches.map((pitch) => (\n              <Card key={pitch.id} className={`hover:shadow-md transition-shadow ${\n                isFollowUpDue(pitch) ? \"border-yellow-200 bg-yellow-50\" : \"\"\n              }`}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-start space-x-4\">\n                      <div className=\"w-16 h-16 bg-brand-primary/10 rounded-lg flex items-center justify-center\">\n                        <Send className=\"h-8 w-8 text-brand-primary\" />\n                      </div>\n                      \n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <h3 className=\"text-lg font-semibold text-gray-900\">\n                            Pitch: {getDealName(pitch)}\n                          </h3>\n                          <Badge className={getStatusColor(pitch.status)}>\n                            <span className=\"sr-only\">Status: </span>\n                            {getStatusLabel(pitch.status)}\n                          </Badge>\n                          {isFollowUpOverdue(pitch) && (\n                            <Badge variant=\"outline\" className=\"text-red-600 border-red-600 bg-red-50\">\n                              <span className=\"sr-only\">Follow-up is </span>\n                              Overdue\n                            </Badge>\n                          )}\n                          {isFollowUpDue(pitch) && !isFollowUpOverdue(pitch) && (\n                            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-600 bg-yellow-50\">\n                              <span className=\"sr-only\">Follow-up is </span>\n                              Due Today\n                            </Badge>\n                          )}\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4\">\n                          <div className=\"flex items-center space-x-2\">\n                            <Calendar className=\"h-4 w-4 text-gray-400\" />\n                            <div>\n                              <p className=\"font-medium\">Submitted</p>\n                              <p>{formatDate(pitch.submissionDate)}</p>\n                            </div>\n                          </div>\n                          \n                          {pitch.followUpDate && (\n                            <div className=\"flex items-center space-x-2\">\n                              <Clock className=\"h-4 w-4 text-gray-400\" />\n                              <div>\n                                <p className=\"font-medium\">Follow-up</p>\n                                <p>{formatDate(pitch.followUpDate)}</p>\n                              </div>\n                            </div>\n                          )}\n                          \n                          <div className=\"flex items-center space-x-2\">\n                            <CheckCircle className=\"h-4 w-4 text-gray-400\" />\n                            <div>\n                              <p className=\"font-medium\">Status</p>\n                              <p>{getStatusLabel(pitch.status)}</p>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {pitch.notes && (\n                          <div className=\"mt-3\">\n                            <div className=\"text-sm text-gray-600\">\n                              {pitch.notes.split('\\n').map((line, index) => {\n                                const trimmedLine = line.trim();\n                                if (!trimmedLine) return null;\n                                \n                                if (trimmedLine === 'Additional Notes:') {\n                                  return (\n                                    <div key={index} className=\"mt-3 mb-1\">\n                                      <p className=\"text-sm font-medium text-gray-700\">Additional Notes:</p>\n                                    </div>\n                                  );\n                                }\n                                \n                                // Check if this line appears after \"Additional Notes:\"\n                                const noteLines = pitch.notes?.split('\\n') || [];\n                                const additionalNotesIndex = noteLines.findIndex(l => l.trim() === 'Additional Notes:');\n                                const isAdditionalNote = additionalNotesIndex >= 0 && index > additionalNotesIndex;\n                                \n                                if (isAdditionalNote) {\n                                  return (\n                                    <div key={index} className=\"text-sm text-gray-600 ml-2\">\n                                      {trimmedLine}\n                                    </div>\n                                  );\n                                } else {\n                                  // This is a song\n                                  return (\n                                    <div key={index} className=\"mb-1\">\n                                      <span className=\"text-sm font-medium text-gray-700\"></span>\n                                      <span className=\"text-sm text-gray-600 ml-2\">{trimmedLine}</span>\n                                    </div>\n                                  );\n                                }\n                              })}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex flex-col sm:flex-row gap-2 sm:space-x-2\">\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        className=\"w-full sm:w-auto\"\n                        onClick={() => {\n                          setSelectedPitch(pitch);\n                          setShowUpdateStatus(true);\n                        }}\n                      >\n                        Update Status\n                      </Button>\n                      {(pitch.status === \"pitched\" || pitch.status === \"follow_up\") && (\n                        <Button \n                          size=\"sm\" \n                          className=\"bg-brand-secondary hover:bg-emerald-700 w-full sm:w-auto\"\n                          onClick={() => {\n                            setSelectedPitch(pitch);\n                            setShowFollowUp(true);\n                          }}\n                        >\n                          Follow Up\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Add Pitch Dialog */}\n      <Dialog open={showAddPitch} onOpenChange={setShowAddPitch}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create New Pitch</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <Label>Associated Deal</Label>\n                <div className=\"flex items-center space-x-2\">\n                  <label className=\"text-sm text-gray-600\">\n                    <input\n                      type=\"checkbox\"\n                      checked={useCustomDeal}\n                      onChange={(e) => {\n                        setUseCustomDeal(e.target.checked);\n                        // Clear both fields when switching\n                        form.setValue(\"dealId\", \"\");\n                        form.setValue(\"customDealName\", \"\");\n                      }}\n                      className=\"mr-2\"\n                    />\n                    Enter new deal name\n                  </label>\n                </div>\n              </div>\n              \n              {useCustomDeal ? (\n                <Input\n                  {...form.register(\"customDealName\")}\n                  placeholder=\"Enter new deal name (e.g. 'Netflix Series - Season 2')\"\n                  className=\"w-full\"\n                />\n              ) : (\n                <Select\n                  value={form.watch(\"dealId\")?.toString() || \"\"}\n                  onValueChange={(value) => form.setValue(\"dealId\", value)}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a deal\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {deals.map((deal) => (\n                      <SelectItem key={deal.id} value={deal.id.toString()}>\n                        {deal.projectName} {deal.episodeNumber && `- Episode ${deal.episodeNumber}`}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"status\">Status</Label>\n                <Select\n                  value={form.watch(\"status\")}\n                  onValueChange={(value) => form.setValue(\"status\", value as \"pitched\" | \"follow_up\" | \"completed\")}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"pitched\">Pitched</SelectItem>\n                    <SelectItem value=\"follow_up\">Follow Up</SelectItem>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"followUpDate\">Follow-up Date (Optional)</Label>\n                <Input\n                  id=\"followUpDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"followUpDate\")}\n                  placeholder=\"\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"selectedSongs\">Songs to Pitch</Label>\n              <Select\n                value=\"\"\n                onValueChange={(value: string) => {\n                  const currentSongs = form.watch(\"selectedSongs\") || [];\n                  if (!currentSongs.includes(value)) {\n                    form.setValue(\"selectedSongs\", [...currentSongs, value]);\n                  }\n                }}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select songs to add to this pitch\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {songs.map((song) => (\n                    <SelectItem key={song.id} value={song.id.toString()}>\n                      {song.title} by {song.artist}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              \n              {/* Display selected songs */}\n              {form.watch(\"selectedSongs\")?.length > 0 && (\n                <div className=\"mt-3\">\n                  <p className=\"text-sm font-medium text-gray-700 mb-2\">Selected Songs:</p>\n                  <div className=\"space-y-2\">\n                    {form.watch(\"selectedSongs\").map((songId) => {\n                      const song = songs.find(s => s.id === parseInt(songId));\n                      return song ? (\n                        <div key={songId} className=\"flex items-center justify-between bg-gray-50 p-2 rounded\">\n                          <span className=\"text-sm\">{song.title} by {song.artist}</span>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              const currentSongs = form.watch(\"selectedSongs\") || [];\n                              form.setValue(\"selectedSongs\", currentSongs.filter(id => id !== songId));\n                            }}\n                          >\n                            Remove\n                          </Button>\n                        </div>\n                      ) : null;\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <div>\n              <Label htmlFor=\"notes\">Additional Notes (Optional)</Label>\n              <Textarea\n                id=\"notes\"\n                {...form.register(\"notes\")}\n                placeholder=\"Add any additional notes about this pitch...\"\n                rows={3}\n              />\n            </div>\n\n            <div className=\"flex space-x-4 pt-4\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setShowAddPitch(false)}\n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\"\n                className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n                disabled={createPitchMutation.isPending}\n              >\n                {createPitchMutation.isPending ? \"Creating...\" : \"Create Pitch\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Update Status Dialog */}\n      <Dialog open={showUpdateStatus} onOpenChange={setShowUpdateStatus}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Update Pitch Status</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"status\">Status</Label>\n              <Select \n                defaultValue={selectedPitch?.status}\n                onValueChange={(value) => {\n                  if (selectedPitch) {\n                    updatePitchMutation.mutate({\n                      id: selectedPitch.id,\n                      data: { status: value }\n                    });\n                  }\n                }}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"pitched\">Pitched</SelectItem>\n                  <SelectItem value=\"follow_up\">Follow Up</SelectItem>\n                  <SelectItem value=\"completed\">Completed</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Follow Up Dialog */}\n      <Dialog open={showFollowUp} onOpenChange={setShowFollowUp}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Schedule Follow Up</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"followUpDate\">Follow-up Date</Label>\n              <Input\n                id=\"followUpDate\"\n                type=\"datetime-local\"\n                defaultValue={selectedPitch?.followUpDate ? \n                  new Date(selectedPitch.followUpDate).toISOString().slice(0, 16) : \"\"\n                }\n                onChange={(e) => {\n                  if (selectedPitch && e.target.value) {\n                    updatePitchMutation.mutate({\n                      id: selectedPitch.id,\n                      data: { followUpDate: new Date(e.target.value).toISOString() }\n                    });\n                  }\n                }}\n              />\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":26721},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-full items-center rounded-md border border-input bg-background px-3 py-2 pr-10 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <span className=\"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center justify-center z-50\">\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-muted-foreground opacity-50\">\n        <polyline points=\"6 9 12 15 18 9\"></polyline>\n      </svg>\n    </span>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":6022},"client/src/components/dashboard/metrics-cards.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Handshake, DollarSign, Clock, Music, TrendingUp } from \"lucide-react\";\nimport type { DashboardMetrics } from \"@shared/schema\";\n\ninterface MetricsCardsProps {\n  metrics: DashboardMetrics;\n}\n\nexport default function MetricsCards({ metrics }: MetricsCardsProps) {\n  const cards = [\n    {\n      title: \"Active Deals\",\n      value: metrics.activeDeals.toString(),\n      icon: Handshake,\n      bgColor: \"bg-brand-primary/10\",\n      iconColor: \"text-brand-primary\",\n      trend: \"+12%\",\n      trendLabel: \"from last month\",\n    },\n    {\n      title: \"Total Revenue\",\n      value: `$${metrics.totalRevenue.toLocaleString()}`,\n      icon: DollarSign,\n      bgColor: \"bg-brand-secondary/10\",\n      iconColor: \"text-brand-secondary\",\n      trend: \"+8%\",\n      trendLabel: \"from last month\",\n    },\n    {\n      title: \"Pending Payments\",\n      value: `$${metrics.pendingPayments.toLocaleString()}`,\n      icon: Clock,\n      bgColor: \"bg-status-pending/10\",\n      iconColor: \"text-status-pending\",\n      trend: `${metrics.urgentActions.length} overdue`,\n      trendLabel: \"payments\",\n    },\n    {\n      title: \"Songs in Database\",\n      value: metrics.totalSongs.toString(),\n      icon: Music,\n      bgColor: \"bg-brand-accent/10\",\n      iconColor: \"text-brand-accent\",\n      trend: \"+15\",\n      trendLabel: \"this week\",\n    },\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n      {cards.map((card, index) => {\n        const Icon = card.icon;\n        return (\n          <Card key={index} className=\"border border-gray-200\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">{card.title}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{card.value}</p>\n                </div>\n                <div className={`w-12 h-12 ${card.bgColor} rounded-full flex items-center justify-center`}>\n                  <Icon className={`${card.iconColor}`} size={20} />\n                </div>\n              </div>\n              <div className=\"mt-4 flex items-center text-sm\">\n                <TrendingUp className=\"text-green-500 mr-1\" size={16} />\n                <span className=\"text-green-500 font-medium\">{card.trend}</span>\n                <span className=\"text-gray-600 ml-1\">{card.trendLabel}</span>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":2568},"client/src/components/forms/add-song-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertSongSchema, type InsertSong } from \"@shared/schema\";\n\ninterface AddSongFormProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport default function AddSongForm({ open, onClose }: AddSongFormProps) {\n  const { toast } = useToast();\n  \n  const form = useForm<InsertSong>({\n    resolver: zodResolver(insertSongSchema),\n    defaultValues: {\n      title: \"\",\n      artist: \"\",\n      album: \"\",\n      genre: \"\",\n      mood: \"\",\n      tempo: undefined,\n      duration: undefined,\n      key: \"\",\n      bpm: undefined,\n      lyrics: \"\",\n      description: \"\",\n      tags: [],\n      filePath: \"\",\n      publishingOwnership: undefined,\n      masterOwnership: undefined,\n      splitDetails: \"\",\n    },\n  });\n\n  const createSongMutation = useMutation({\n    mutationFn: async (data: InsertSong) => {\n      const response = await apiRequest(\"/api/songs\", {\n        method: \"POST\",\n        body: data,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Song added successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/songs\"] });\n      form.reset();\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add song\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertSong) => {\n    // Convert tags string to array\n    const tagsArray = data.tags?.length ? data.tags[0].split(\",\").map(tag => tag.trim()) : [];\n    createSongMutation.mutate({\n      ...data,\n      tags: tagsArray,\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>Add New Song</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"title\">Title *</Label>\n              <Input\n                id=\"title\"\n                {...form.register(\"title\")}\n                placeholder=\"Enter song title\"\n              />\n              {form.formState.errors.title && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.title.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"artist\">Artist *</Label>\n              <Input\n                id=\"artist\"\n                {...form.register(\"artist\")}\n                placeholder=\"Enter artist name\"\n              />\n              {form.formState.errors.artist && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.artist.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"album\">Album</Label>\n              <Input\n                id=\"album\"\n                {...form.register(\"album\")}\n                placeholder=\"Enter album name\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"genre\">Genre</Label>\n              <Input\n                id=\"genre\"\n                {...form.register(\"genre\")}\n                placeholder=\"Enter genre\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div>\n              <Label htmlFor=\"mood\">Mood</Label>\n              <Input\n                id=\"mood\"\n                {...form.register(\"mood\")}\n                placeholder=\"e.g., Upbeat, Melancholic\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"tempo\">Tempo</Label>\n              <Input\n                id=\"tempo\"\n                type=\"number\"\n                {...form.register(\"tempo\")}\n                placeholder=\"e.g., 120\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"duration\">Duration (seconds)</Label>\n              <Input\n                id=\"duration\"\n                type=\"number\"\n                {...form.register(\"duration\")}\n                placeholder=\"e.g., 180\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"key\">Key</Label>\n              <Input\n                id=\"key\"\n                {...form.register(\"key\")}\n                placeholder=\"e.g., C Major, A Minor\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"bpm\">BPM</Label>\n              <Input\n                id=\"bpm\"\n                type=\"number\"\n                {...form.register(\"bpm\")}\n                placeholder=\"e.g., 120\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"tags\">Tags (comma-separated)</Label>\n            <Input\n              id=\"tags\"\n              {...form.register(\"tags.0\")}\n              placeholder=\"e.g., Electronic, Dance, Energetic\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"description\">Description</Label>\n            <Textarea\n              id=\"description\"\n              {...form.register(\"description\")}\n              placeholder=\"Enter song description\"\n              rows={3}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"lyrics\">Lyrics</Label>\n            <Textarea\n              id=\"lyrics\"\n              {...form.register(\"lyrics\")}\n              placeholder=\"Enter song lyrics (optional)\"\n              rows={4}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"filePath\">File Path</Label>\n            <Input\n              id=\"filePath\"\n              {...form.register(\"filePath\")}\n              placeholder=\"Enter file path or URL\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"publishingOwnership\">Publishing Ownership (%)</Label>\n              <Input\n                id=\"publishingOwnership\"\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.01\"\n                {...form.register(\"publishingOwnership\")}\n                placeholder=\"e.g., 50.00\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"masterOwnership\">Master Recording Ownership (%)</Label>\n              <Input\n                id=\"masterOwnership\"\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.01\"\n                {...form.register(\"masterOwnership\")}\n                placeholder=\"e.g., 50.00\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"splitDetails\">Split Details (Optional)</Label>\n            <Textarea\n              id=\"splitDetails\"\n              {...form.register(\"splitDetails\")}\n              placeholder=\"Detailed breakdown of ownership splits and agreements\"\n              rows={2}\n            />\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={createSongMutation.isPending}\n            >\n              {createSongMutation.isPending ? \"Adding...\" : \"Add Song\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":8266},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { setTheme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          className=\"w-9 h-9 px-0\"\n          data-testid=\"theme-toggle\"\n        >\n          <Sun className=\"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem onClick={() => setTheme(\"light\")} data-testid=\"theme-light\">\n          <Sun className=\"mr-2 h-4 w-4\" />\n          Light\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")} data-testid=\"theme-dark\">\n          <Moon className=\"mr-2 h-4 w-4\" />\n          Dark\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"system\")} data-testid=\"theme-system\">\n          <Sun className=\"mr-2 h-4 w-4\" />\n          System\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","size_bytes":1520},"client/src/pages/playlists.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Music, Users, Folder, Play, Edit, Trash2, Plus } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Playlist, InsertPlaylist, Contact, Song } from \"@shared/schema\";\nimport { insertPlaylistSchema } from \"@shared/schema\";\n\nexport default function Playlists() {\n  const [showCreatePlaylist, setShowCreatePlaylist] = useState(false);\n  const [selectedPlaylist, setSelectedPlaylist] = useState<Playlist | null>(null);\n  const [showSongs, setShowSongs] = useState(false);\n  const { toast } = useToast();\n\n  const { data: playlists = [], isLoading } = useQuery<Playlist[]>({\n    queryKey: [\"/api/playlists\"],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n  });\n\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const { data: playlistSongs = [] } = useQuery<any[]>({\n    queryKey: [\"/api/playlist-songs\", selectedPlaylist?.id],\n    enabled: !!selectedPlaylist,\n  });\n\n  const createPlaylistMutation = useMutation({\n    mutationFn: async (data: InsertPlaylist) => {\n      const response = await apiRequest(\"POST\", \"/api/playlists\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Playlist created successfully\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/playlists\"] });\n      setShowCreatePlaylist(false);\n      form.reset();\n    },\n  });\n\n  const form = useForm<InsertPlaylist>({\n    resolver: zodResolver(insertPlaylistSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      type: \"custom\",\n      clientId: undefined,\n      isPublic: false,\n    },\n  });\n\n  const getPlaylistIcon = (type: string) => {\n    switch (type) {\n      case 'client': return Users;\n      case 'genre': return Music;\n      case 'mood': return Folder;\n      default: return Folder;\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'client': return 'bg-blue-100 text-blue-800';\n      case 'genre': return 'bg-green-100 text-green-800';\n      case 'mood': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-lg text-gray-600\">Loading playlists...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        title=\"Playlists\"\n        description=\"Organize songs into collections for pitching and management\"\n        newItemLabel=\"Create Playlist\"\n        onNewItem={() => setShowCreatePlaylist(true)}\n      />\n\n      <div className=\"p-6\">\n        {playlists.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Folder className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No playlists yet</h3>\n            <p className=\"text-gray-600 mb-4\">\n              Create playlists to organize your songs for specific clients, genres, or projects.\n            </p>\n            <Button onClick={() => setShowCreatePlaylist(true)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create Your First Playlist\n            </Button>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {playlists.map((playlist) => {\n              const PlaylistIcon = getPlaylistIcon(playlist.type);\n              const client = contacts.find(c => c.id === playlist.clientId);\n              \n              return (\n                <Card key={playlist.id} className=\"hover:shadow-md transition-shadow\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-2\">\n                        <PlaylistIcon className=\"h-5 w-5 text-gray-600\" />\n                        <CardTitle className=\"text-lg\">{playlist.name}</CardTitle>\n                      </div>\n                      <div className=\"flex space-x-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedPlaylist(playlist);\n                            setShowSongs(true);\n                          }}\n                        >\n                          <Play className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\">\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"text-red-600\">\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <Badge className={getTypeColor(playlist.type)}>\n                          {playlist.type.charAt(0).toUpperCase() + playlist.type.slice(1)}\n                        </Badge>\n                        <span className=\"text-sm text-gray-500\">\n                          0 songs {/* TODO: Add song count */}\n                        </span>\n                      </div>\n                      \n                      {client && (\n                        <div className=\"text-sm text-gray-600\">\n                          <span className=\"font-medium\">Client:</span> {client.name}\n                        </div>\n                      )}\n                      \n                      {playlist.description && (\n                        <p className=\"text-sm text-gray-600 line-clamp-2\">\n                          {playlist.description}\n                        </p>\n                      )}\n                      \n                      <div className=\"text-xs text-gray-500\">\n                        Created {new Date(playlist.createdAt).toLocaleDateString()}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Create Playlist Dialog */}\n      <Dialog open={showCreatePlaylist} onOpenChange={setShowCreatePlaylist}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create New Playlist</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={form.handleSubmit((data) => createPlaylistMutation.mutate(data))} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Name</label>\n              <Input\n                {...form.register(\"name\")}\n                placeholder=\"Playlist name\"\n              />\n            </div>\n            \n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Type</label>\n              <Select value={form.watch(\"type\")} onValueChange={(value) => form.setValue(\"type\", value)}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"custom\">Custom</SelectItem>\n                  <SelectItem value=\"client\">Client Specific</SelectItem>\n                  <SelectItem value=\"genre\">Genre Collection</SelectItem>\n                  <SelectItem value=\"mood\">Mood Collection</SelectItem>\n                  <SelectItem value=\"project\">Project Based</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {form.watch(\"type\") === \"client\" && (\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Client</label>\n                <Select \n                  value={form.watch(\"clientId\")?.toString() || \"\"} \n                  onValueChange={(value) => form.setValue(\"clientId\", parseInt(value))}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select client\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {contacts.map((contact) => (\n                      <SelectItem key={contact.id} value={contact.id.toString()}>\n                        {contact.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n            \n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Description</label>\n              <Textarea\n                {...form.register(\"description\")}\n                placeholder=\"Describe this playlist...\"\n                rows={3}\n              />\n            </div>\n            \n            <div className=\"flex justify-end space-x-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowCreatePlaylist(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={createPlaylistMutation.isPending}>\n                {createPlaylistMutation.isPending ? \"Creating...\" : \"Create Playlist\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Playlist Songs Dialog */}\n      <Dialog open={showSongs} onOpenChange={setShowSongs}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>{selectedPlaylist?.name} - Songs</DialogTitle>\n          </DialogHeader>\n          <div className=\"max-h-96 overflow-y-auto\">\n            {playlistSongs.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Music className=\"mx-auto h-8 w-8 text-gray-400 mb-2\" />\n                <p className=\"text-gray-600\">No songs in this playlist yet.</p>\n                <Button className=\"mt-4\">Add Songs</Button>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {playlistSongs.map((item) => (\n                  <div key={item.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                    <div>\n                      <h4 className=\"font-medium\">{item.song?.title}</h4>\n                      <p className=\"text-sm text-gray-600\">{item.song?.artist}</p>\n                    </div>\n                    <Button variant=\"ghost\" size=\"sm\">\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":11480},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, scope = \"col\", ...props }, ref) => (\n  <th\n    ref={ref}\n    scope={scope}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2798},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/dashboard/recent-activity.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { CheckCircle, Handshake, Send, Music, AlertTriangle } from \"lucide-react\";\nimport type { DashboardMetrics } from \"@shared/schema\";\n\ninterface RecentActivityProps {\n  activities: DashboardMetrics['recentActivity'];\n}\n\nexport default function RecentActivity({ activities }: RecentActivityProps) {\n  const getActivityIcon = (type: string) => {\n    switch (type) {\n      case \"payment\":\n        return { icon: CheckCircle, color: \"bg-status-completed/10 text-status-completed\" };\n      case \"deal\":\n        return { icon: Handshake, color: \"bg-brand-primary/10 text-brand-primary\" };\n      case \"pitch\":\n        return { icon: Send, color: \"bg-status-pending/10 text-status-pending\" };\n      case \"song\":\n        return { icon: Music, color: \"bg-brand-accent/10 text-brand-accent\" };\n      default:\n        return { icon: AlertTriangle, color: \"bg-gray-300/10 text-gray-600\" };\n    }\n  };\n\n  const formatTimeAgo = (date: Date) => {\n    const now = new Date();\n    const diff = now.getTime() - new Date(date).getTime();\n    const minutes = Math.floor(diff / (1000 * 60));\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n\n    if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;\n    if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n    return \"Just now\";\n  };\n\n  return (\n    <Card>\n      <CardHeader className=\"border-b border-gray-200\">\n        <h3 className=\"text-lg font-semibold text-gray-900\">Recent Activity</h3>\n      </CardHeader>\n      <CardContent className=\"p-6\">\n        <div className=\"space-y-4\">\n          {activities.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No recent activity to display.\n            </div>\n          ) : (\n            activities.map((activity) => {\n              const { icon: Icon, color } = getActivityIcon(activity.type);\n              return (\n                <div key={activity.id} className=\"flex items-start space-x-3\">\n                  <div className={`w-8 h-8 ${color} rounded-full flex items-center justify-center flex-shrink-0`}>\n                    <Icon size={16} />\n                  </div>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{activity.message}</p>\n                    <p className=\"text-xs text-gray-400 mt-1\">\n                      {formatTimeAgo(activity.timestamp)}\n                    </p>\n                  </div>\n                </div>\n              );\n            })\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2763},"client/src/components/forms/edit-deal-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { insertDealSchema, type InsertDeal, type Song, type Contact, type DealWithRelations } from \"@shared/schema\";\nimport { z } from \"zod\";\n\ninterface EditDealFormProps {\n  deal: DealWithRelations | null;\n  open: boolean;\n  onClose: () => void;\n}\n\nexport default function EditDealForm({ deal, open, onClose }: EditDealFormProps) {\n  const { toast } = useToast();\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [newContactName, setNewContactName] = useState(\"\");\n  const [newContactEmail, setNewContactEmail] = useState(\"\");\n  const [newContactPhone, setNewContactPhone] = useState(\"\");\n  const [newContactCompany, setNewContactCompany] = useState(\"\");\n  const [newContactRole, setNewContactRole] = useState(\"\");\n  const [newContactNotes, setNewContactNotes] = useState(\"\");\n  const [newContactProjects, setNewContactProjects] = useState(\"\");\n\n  const form = useForm<any>({\n    // Remove strict validation for edit form to avoid date type conflicts\n    mode: \"onSubmit\",\n    defaultValues: {\n      projectName: \"\",\n      projectType: \"\",\n      projectDescription: \"\",\n      songId: undefined,\n      contactId: undefined,\n      status: \"pitched\",\n      dealValue: undefined,\n      fullSongValue: undefined,\n      ourFee: undefined,\n      fullRecordingFee: undefined,\n      ourRecordingFee: undefined,\n      \n      // Status dates\n      pitchedDate: undefined,\n      pendingApprovalDate: undefined,\n      quotedDate: undefined,\n      useConfirmedDate: undefined,\n      beingDraftedDate: undefined,\n      outForSignatureDate: undefined,\n      paymentReceivedDate: undefined,\n      completedDate: undefined,\n      usage: \"\",\n      territory: \"worldwide\",\n      term: \"\",\n      exclusivity: false,\n      notes: \"\",\n      airDate: \"\",\n      pitchDate: undefined,\n      \n      // Song information fields\n      songTitle: \"\",\n      songAlbum: \"\",\n      songPublishingOwnership: undefined,\n      songMasterOwnership: undefined,\n    },\n  });\n\n  // Get songs and contacts data\n  const { data: songs = [] } = useQuery<Song[]>({\n    queryKey: [\"/api/songs\"],\n  });\n\n  const { data: contacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n  });\n\n  // Update form values when deal changes\n  useEffect(() => {\n    if (deal) {\n      form.reset({\n        projectName: deal.projectName || \"\",\n        projectType: deal.projectType || \"\",\n        projectDescription: deal.projectDescription || \"\",\n        songId: deal.songId,\n        contactId: deal.contactId,\n        status: deal.status,\n        dealValue: deal.dealValue || undefined,\n        fullSongValue: deal.fullSongValue ?? undefined,\n        ourFee: deal.ourFee ?? undefined,\n        fullRecordingFee: deal.fullRecordingFee ?? undefined,\n        ourRecordingFee: deal.ourRecordingFee ?? undefined,\n        \n        // Status dates\n        pitchedDate: deal.pitchedDate ? new Date(deal.pitchedDate).toISOString().slice(0, 16) : undefined,\n        pendingApprovalDate: deal.pendingApprovalDate ? new Date(deal.pendingApprovalDate).toISOString().slice(0, 16) : undefined,\n        quotedDate: deal.quotedDate ? new Date(deal.quotedDate).toISOString().slice(0, 16) : undefined,\n        useConfirmedDate: deal.useConfirmedDate ? new Date(deal.useConfirmedDate).toISOString().slice(0, 16) : undefined,\n        beingDraftedDate: deal.beingDraftedDate ? new Date(deal.beingDraftedDate).toISOString().slice(0, 16) : undefined,\n        outForSignatureDate: deal.outForSignatureDate ? new Date(deal.outForSignatureDate).toISOString().slice(0, 16) : undefined,\n        paymentReceivedDate: deal.paymentReceivedDate ? new Date(deal.paymentReceivedDate).toISOString().slice(0, 16) : undefined,\n        completedDate: deal.completedDate ? new Date(deal.completedDate).toISOString().slice(0, 16) : undefined,\n        usage: deal.usage || \"\",\n        territory: deal.territory || \"worldwide\",\n        term: deal.term || \"\",\n        exclusivity: deal.exclusivity || false,\n        notes: deal.notes || \"\",\n        airDate: deal.airDate ? new Date(deal.airDate).toISOString().split('T')[0] : \"\",\n        pitchDate: deal.pitchDate ? new Date(deal.pitchDate).toISOString().split('T')[0] : undefined,\n        \n        // Song information\n        songTitle: deal.song?.title || \"\",\n        songAlbum: deal.song?.album || \"\",\n        songPublishingOwnership: deal.song?.publishingOwnership ? parseFloat(deal.song.publishingOwnership.toString()) : undefined,\n        songMasterOwnership: deal.song?.masterOwnership ? parseFloat(deal.song.masterOwnership.toString()) : undefined,\n      });\n    }\n  }, [deal, form]);\n\n  // Watch for song selection changes to update song fields\n  const watchedSongId = form.watch(\"songId\");\n  \n  useEffect(() => {\n    if (watchedSongId && songs.length > 0) {\n      const selectedSong = songs.find(s => s.id === watchedSongId);\n      if (selectedSong) {\n        form.setValue(\"songTitle\", selectedSong.title || \"\");\n        form.setValue(\"songAlbum\", selectedSong.album || \"\");\n        form.setValue(\"songPublishingOwnership\", selectedSong.publishingOwnership ? parseFloat(selectedSong.publishingOwnership.toString()) : undefined);\n        form.setValue(\"songMasterOwnership\", selectedSong.masterOwnership ? parseFloat(selectedSong.masterOwnership.toString()) : undefined);\n      }\n    }\n  }, [watchedSongId, songs, form]);\n\n  // Watch for status changes to auto-update dates\n  const watchedStatus = form.watch(\"status\");\n  const [previousStatus, setPreviousStatus] = useState<string | null>(null);\n  \n  useEffect(() => {\n    if (watchedStatus && watchedStatus !== previousStatus) {\n      const now = new Date().toISOString().slice(0, 16); // Format for datetime-local\n      const fieldMap: Record<string, string> = {\n        \"new request\": \"pitchedDate\",\n        \"pending approval\": \"pendingApprovalDate\",\n        \"quoted\": \"quotedDate\",\n        \"use confirmed\": \"useConfirmedDate\",\n        \"being drafted\": \"beingDraftedDate\",\n        \"out for signature\": \"outForSignatureDate\",\n        \"payment received\": \"paymentReceivedDate\",\n        \"completed\": \"completedDate\"\n      };\n      \n      const dateField = fieldMap[watchedStatus.toLowerCase()];\n      if (dateField && !form.getValues(dateField)) {\n        console.log(\"Status changed from\", previousStatus, \"to\", watchedStatus);\n        console.log(\"Auto-filling date field:\", dateField, \"with:\", now);\n        form.setValue(dateField, now);\n      }\n      \n      setPreviousStatus(watchedStatus);\n    }\n  }, [watchedStatus, previousStatus, form]);\n\n  const createContactMutation = useMutation({\n    mutationFn: async (contactData: any) => {\n      const response = await apiRequest('/api/contacts', {\n        method: 'POST',\n        body: contactData,\n      });\n      return response.json();\n    },\n    onSuccess: (newContact) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      form.setValue('contactId', newContact.id);\n      setShowAddContact(false);\n      // Clear form\n      setNewContactName(\"\");\n      setNewContactEmail(\"\");\n      setNewContactPhone(\"\");\n      setNewContactCompany(\"\");\n      setNewContactRole(\"\");\n      setNewContactNotes(\"\");\n      setNewContactProjects(\"\");\n      toast({\n        title: \"Contact added successfully\",\n        description: `${newContact.name} has been added to your contacts.`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error adding contact\",\n        description: \"Failed to add the contact. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const updateSongMutation = useMutation({\n    mutationFn: async ({ songId, songData }: { songId: number; songData: any }) => {\n      console.log(\"Making API request to update song:\", songId);\n      const response = await apiRequest(`/api/songs/${songId}`, {\n        method: 'PUT',\n        body: songData,\n      });\n      console.log(\"Song update API response received:\", response.status);\n      return response.json();\n    },\n    onSuccess: () => {\n      console.log(\"Song update successful\");\n      queryClient.invalidateQueries({ queryKey: ['/api/songs'] });\n    },\n    onError: (error) => {\n      console.error(\"Song update mutation error:\", error);\n      toast({\n        title: \"Error updating song\",\n        description: \"Failed to update song information. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const updateDealMutation = useMutation({\n    mutationFn: async (dealData: InsertDeal) => {\n      if (!deal) {\n        console.error(\"No deal found for update\");\n        return;\n      }\n      console.log(\"Making API request to update deal:\", deal.id);\n      const response = await apiRequest(`/api/deals/${deal.id}`, {\n        method: 'PUT',\n        body: dealData,\n      });\n      console.log(\"API response received:\", response.status);\n      return response.json();\n    },\n    onSuccess: (result) => {\n      console.log(\"Update successful, result:\", result);\n      queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/calendar-events'] });\n      toast({\n        title: \"Deal updated successfully\",\n        description: \"The deal has been updated.\",\n      });\n      onClose();\n    },\n    onError: (error) => {\n      console.error(\"Update mutation error:\", error);\n      toast({\n        title: \"Error updating deal\",\n        description: \"Failed to update the deal. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleAddContact = () => {\n    if (!newContactName.trim() || !newContactEmail.trim()) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please provide at least a name and email for the contact.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const contactData = {\n      name: newContactName.trim(),\n      email: newContactEmail.trim(),\n      phone: newContactPhone.trim() || null,\n      company: newContactCompany.trim() || null,\n      role: newContactRole.trim() || null,\n      notes: `${newContactNotes.trim()}${newContactProjects.trim() ? '\\n\\nCurrent Projects:\\n' + newContactProjects.trim() : ''}`.trim() || null,\n    };\n\n    createContactMutation.mutate(contactData);\n  };\n\n  const onSubmit = async (data: any) => {\n    console.log(\"Edit form submission data:\", data);\n    console.log(\"Form errors:\", form.formState.errors);\n    \n    // Update song information if it has changed\n    const songId = data.songId;\n    if (songId) {\n      const songData = {\n        title: data.songTitle,\n        album: data.songAlbum || null,\n        publishingOwnership: data.songPublishingOwnership || null,\n        masterOwnership: data.songMasterOwnership || null,\n      };\n      \n      // Check if any song fields have changed\n      const currentSong = deal?.song;\n      const hasChanges = \n        currentSong && (\n          data.songTitle !== currentSong.title ||\n          data.songAlbum !== currentSong.album ||\n          parseFloat(data.songPublishingOwnership || '0') !== parseFloat(currentSong.publishingOwnership?.toString() || '0') ||\n          parseFloat(data.songMasterOwnership || '0') !== parseFloat(currentSong.masterOwnership?.toString() || '0')\n        );\n      \n      if (hasChanges) {\n        console.log(\"Song data has changed, updating song:\", songData);\n        await updateSongMutation.mutateAsync({ songId, songData });\n      }\n    }\n    \n    // Clean and format the deal data properly\n    const formattedData = {\n      projectName: data.projectName,\n      projectType: data.projectType,\n      projectDescription: data.projectDescription,\n      songId: data.songId,\n      contactId: data.contactId,\n      status: data.status,\n      // Convert null values to undefined for proper schema validation\n      fullSongValue: data.fullSongValue === null ? undefined : data.fullSongValue,\n      ourFee: data.ourFee === null ? undefined : data.ourFee,\n      fullRecordingFee: data.fullRecordingFee === null ? undefined : data.fullRecordingFee,\n      ourRecordingFee: data.ourRecordingFee === null ? undefined : data.ourRecordingFee,\n      \n      // Format dates properly\n      airDate: data.airDate ? new Date(data.airDate).toISOString() : null,\n      pitchDate: data.pitchDate ? new Date(data.pitchDate).toISOString() : null,\n      \n      // Status dates - only convert if not empty string\n      pitchedDate: data.pitchedDate && data.pitchedDate !== \"\" ? new Date(data.pitchedDate).toISOString() : null,\n      pendingApprovalDate: data.pendingApprovalDate && data.pendingApprovalDate !== \"\" ? new Date(data.pendingApprovalDate).toISOString() : null,\n      quotedDate: data.quotedDate && data.quotedDate !== \"\" ? new Date(data.quotedDate).toISOString() : null,\n      useConfirmedDate: data.useConfirmedDate && data.useConfirmedDate !== \"\" ? new Date(data.useConfirmedDate).toISOString() : null,\n      beingDraftedDate: data.beingDraftedDate && data.beingDraftedDate !== \"\" ? new Date(data.beingDraftedDate).toISOString() : null,\n      outForSignatureDate: data.outForSignatureDate && data.outForSignatureDate !== \"\" ? new Date(data.outForSignatureDate).toISOString() : null,\n      paymentReceivedDate: data.paymentReceivedDate && data.paymentReceivedDate !== \"\" ? new Date(data.paymentReceivedDate).toISOString() : null,\n      completedDate: data.completedDate && data.completedDate !== \"\" ? new Date(data.completedDate).toISOString() : null,\n      \n      usage: data.usage,\n      territory: data.territory,\n      term: data.term,\n      exclusivity: data.exclusivity,\n      notes: data.notes,\n    };\n\n    console.log(\"Formatted data being sent:\", formattedData);\n    updateDealMutation.mutate(formattedData);\n  };\n\n  if (!deal) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Edit Deal: {deal.projectName}</DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"projectName\">Project Name *</Label>\n              <Input\n                id=\"projectName\"\n                {...form.register(\"projectName\")}\n                placeholder=\"Project name\"\n              />\n              {form.formState.errors.projectName && (\n                <p className=\"text-sm text-red-600 mt-1\">{String(form.formState.errors.projectName.message)}</p>\n              )}\n            </div>\n            <div>\n              <Label htmlFor=\"projectType\">Project Type *</Label>\n              <Select \n                value={form.watch(\"projectType\")} \n                onValueChange={(value) => form.setValue(\"projectType\", value)}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select project type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"commercial\">Commercial</SelectItem>\n                  <SelectItem value=\"documentary\">Documentary</SelectItem>\n                  <SelectItem value=\"film\">Film</SelectItem>\n                  <SelectItem value=\"game\">Video Game</SelectItem>\n                  <SelectItem value=\"indie_film\">Indie Film</SelectItem>\n                  <SelectItem value=\"non_profit\">Non-Profit</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                  <SelectItem value=\"podcast\">Podcast</SelectItem>\n                  <SelectItem value=\"promos\">Promos</SelectItem>\n                  <SelectItem value=\"sports\">Sports</SelectItem>\n                  <SelectItem value=\"student_film\">Student Film</SelectItem>\n                  <SelectItem value=\"trailers\">Trailers</SelectItem>\n                  <SelectItem value=\"tv\">TV Show</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"projectDescription\">Project Description</Label>\n            <Textarea\n              id=\"projectDescription\"\n              {...form.register(\"projectDescription\")}\n              placeholder=\"Brief description of the project\"\n              rows={2}\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"songId\">Song Title *</Label>\n              <Select\n                value={form.watch(\"songId\")?.toString()}\n                onValueChange={(value) => form.setValue(\"songId\", parseInt(value))}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select a song\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {songs.map((song) => (\n                    <SelectItem key={song.id} value={song.id.toString()}>\n                      {song.title} - {song.artist}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"contactId\">Contact *</Label>\n              <div className=\"flex space-x-2\">\n                <Select\n                  value={form.watch(\"contactId\")?.toString()}\n                  onValueChange={(value) => form.setValue(\"contactId\", parseInt(value))}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select contact\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {contacts.map((contact) => (\n                      <SelectItem key={contact.id} value={contact.id.toString()}>\n                        {contact.name} {contact.company && `(${contact.company})`}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={() => setShowAddContact(true)}\n                >\n                  Add New\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Song Information Section */}\n          {form.watch(\"songId\") && (\n            <div className=\"space-y-4 p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n              <div className=\"flex items-center gap-2\">\n                <svg className=\"w-5 h-5 text-purple-900 dark:text-purple-100\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path d=\"M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z\"/>\n                </svg>\n                <h3 className=\"text-lg font-semibold text-purple-900 dark:text-purple-100\">\n                  Song Information\n                </h3>\n              </div>\n              \n              <div className=\"space-y-3 bg-white dark:bg-gray-900 p-4 rounded-md border border-purple-100 dark:border-purple-900\">\n                <p className=\"text-sm font-medium text-purple-800 dark:text-purple-300\">Basic Song Information</p>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"songTitleSelect\">Title</Label>\n                    <Select\n                      value={form.watch(\"songId\")?.toString()}\n                      onValueChange={(value) => {\n                        const songId = parseInt(value);\n                        form.setValue(\"songId\", songId);\n                        const selectedSong = songs.find(s => s.id === songId);\n                        if (selectedSong) {\n                          form.setValue(\"songTitle\", selectedSong.title || \"\");\n                          form.setValue(\"songAlbum\", selectedSong.album || \"\");\n                          form.setValue(\"songPublishingOwnership\", selectedSong.publishingOwnership ? parseFloat(selectedSong.publishingOwnership.toString()) : undefined);\n                          form.setValue(\"songMasterOwnership\", selectedSong.masterOwnership ? parseFloat(selectedSong.masterOwnership.toString()) : undefined);\n                        }\n                      }}\n                    >\n                      <SelectTrigger id=\"songTitleSelect\">\n                        <SelectValue placeholder=\"Select song\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"z-[100]\">\n                        {songs.map((song) => (\n                          <SelectItem key={song.id} value={song.id.toString()}>\n                            {song.title} - {song.artist}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"songAlbum\">Album</Label>\n                    <Input\n                      id=\"songAlbum\"\n                      {...form.register(\"songAlbum\")}\n                      placeholder=\"Album name\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"songPublishingOwnership\">Publishing Ownership (%)</Label>\n                    <Input\n                      id=\"songPublishingOwnership\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      max=\"100\"\n                      {...form.register(\"songPublishingOwnership\", { valueAsNumber: true })}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"songMasterOwnership\">Label Recording Ownership (%)</Label>\n                    <Input\n                      id=\"songMasterOwnership\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      max=\"100\"\n                      {...form.register(\"songMasterOwnership\", { valueAsNumber: true })}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"status\">Status</Label>\n              <Select\n                value={form.watch(\"status\")}\n                onValueChange={(value) => form.setValue(\"status\", value)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"new request\">New Request</SelectItem>\n                  <SelectItem value=\"pending approval\">Pending Approval</SelectItem>\n                  <SelectItem value=\"quoted\">Quoted</SelectItem>\n                  <SelectItem value=\"use confirmed\">Use Confirmed</SelectItem>\n                  <SelectItem value=\"being drafted\">Being Drafted</SelectItem>\n                  <SelectItem value=\"out for signature\">Out for Signature</SelectItem>\n                  <SelectItem value=\"payment received\">Payment Received</SelectItem>\n                  <SelectItem value=\"completed\">Completed</SelectItem>\n                  <SelectItem value=\"not used\">Not Used</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"fullSongValue\">100% Publishing Fee ($)</Label>\n              <Input\n                id=\"fullSongValue\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"fullSongValue\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"ourFee\">Our Fee Based on Splits ($)</Label>\n              <Input\n                id=\"ourFee\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"ourFee\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"fullRecordingFee\">100% Recording Fee ($)</Label>\n              <Input\n                id=\"fullRecordingFee\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"fullRecordingFee\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"ourRecordingFee\">Our Fee Based on Splits ($)</Label>\n              <Input\n                id=\"ourRecordingFee\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                {...form.register(\"ourRecordingFee\", { valueAsNumber: true })}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"usage\">Usage</Label>\n              <Input\n                id=\"usage\"\n                {...form.register(\"usage\")}\n                placeholder=\"e.g., Background music, Main theme\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"territory\">Territory</Label>\n              <Select\n                value={form.watch(\"territory\")}\n                onValueChange={(value) => form.setValue(\"territory\", value)}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"worldwide\">Worldwide</SelectItem>\n                  <SelectItem value=\"us\">United States</SelectItem>\n                  <SelectItem value=\"north_america\">North America</SelectItem>\n                  <SelectItem value=\"europe\">Europe</SelectItem>\n                  <SelectItem value=\"uk\">United Kingdom</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"term\">Term</Label>\n              <Input\n                id=\"term\"\n                {...form.register(\"term\")}\n                placeholder=\"e.g., 5 years, In perpetuity\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-2 pt-6\">\n              <Switch\n                id=\"exclusivity\"\n                checked={form.watch(\"exclusivity\")}\n                onCheckedChange={(checked) => form.setValue(\"exclusivity\", checked)}\n              />\n              <Label htmlFor=\"exclusivity\">Exclusive</Label>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"airDate\">Air Date</Label>\n              <Input\n                id=\"airDate\"\n                type=\"date\"\n                {...form.register(\"airDate\")}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"pitchDate\">New Request Date</Label>\n              <Input\n                id=\"pitchDate\"\n                type=\"date\"\n                {...form.register(\"pitchDate\")}\n              />\n            </div>\n          </div>\n\n          {/* Status Change Dates */}\n          <div>\n            <Label className=\"text-sm font-medium\">Status Timeline</Label>\n            <div className=\"grid grid-cols-2 gap-4 mt-2\">\n              <div>\n                <Label htmlFor=\"pitchedDate\" className=\"text-xs\">Pitched Date</Label>\n                <Input\n                  id=\"pitchedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"pitchedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"pendingApprovalDate\" className=\"text-xs\">Pending Approval Date</Label>\n                <Input\n                  id=\"pendingApprovalDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"pendingApprovalDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"quotedDate\" className=\"text-xs\">Quoted Date</Label>\n                <Input\n                  id=\"quotedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"quotedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"useConfirmedDate\" className=\"text-xs\">Use Confirmed Date</Label>\n                <Input\n                  id=\"useConfirmedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"useConfirmedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"beingDraftedDate\" className=\"text-xs\">Being Drafted Date</Label>\n                <Input\n                  id=\"beingDraftedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"beingDraftedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"outForSignatureDate\" className=\"text-xs\">Out for Signature Date</Label>\n                <Input\n                  id=\"outForSignatureDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"outForSignatureDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"paymentReceivedDate\" className=\"text-xs\">Payment Received Date</Label>\n                <Input\n                  id=\"paymentReceivedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"paymentReceivedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"completedDate\" className=\"text-xs\">Completed Date</Label>\n                <Input\n                  id=\"completedDate\"\n                  type=\"datetime-local\"\n                  {...form.register(\"completedDate\")}\n                  className=\"text-xs\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"notes\">Notes</Label>\n            <Textarea\n              id=\"notes\"\n              {...form.register(\"notes\")}\n              placeholder=\"Additional notes about this deal\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\"flex space-x-4 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n              disabled={updateDealMutation.isPending}\n              onClick={(e) => {\n                console.log(\"Update Deal button clicked!\");\n                console.log(\"Form is valid:\", form.formState.isValid);\n                console.log(\"Form errors:\", form.formState.errors);\n                console.log(\"Form values:\", form.getValues());\n                // Don't prevent default - let form submission handle it\n              }}\n            >\n              {updateDealMutation.isPending ? \"Updating...\" : \"Update Deal\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n      \n      {/* Add Contact Dialog */}\n      <Dialog open={showAddContact} onOpenChange={setShowAddContact}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Add New Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactName\">Name *</Label>\n                <Input\n                  id=\"newContactName\"\n                  value={newContactName}\n                  onChange={(e) => setNewContactName(e.target.value)}\n                  placeholder=\"Contact name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactEmail\">Email *</Label>\n                <Input\n                  id=\"newContactEmail\"\n                  type=\"email\"\n                  value={newContactEmail}\n                  onChange={(e) => setNewContactEmail(e.target.value)}\n                  placeholder=\"contact@example.com\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"newContactPhone\">Phone</Label>\n                <Input\n                  id=\"newContactPhone\"\n                  type=\"tel\"\n                  value={newContactPhone}\n                  onChange={(e) => setNewContactPhone(e.target.value)}\n                  placeholder=\"(555) 123-4567\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newContactCompany\">Company</Label>\n                <Input\n                  id=\"newContactCompany\"\n                  value={newContactCompany}\n                  onChange={(e) => setNewContactCompany(e.target.value)}\n                  placeholder=\"Company name\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactRole\">Role</Label>\n              <Input\n                id=\"newContactRole\"\n                value={newContactRole}\n                onChange={(e) => setNewContactRole(e.target.value)}\n                placeholder=\"e.g., Music Supervisor, Producer\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactProjects\">Current Projects</Label>\n              <Textarea\n                id=\"newContactProjects\"\n                value={newContactProjects}\n                onChange={(e) => setNewContactProjects(e.target.value)}\n                placeholder=\"List current projects or disco links\"\n                rows={3}\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"newContactNotes\">Additional Notes</Label>\n              <Textarea\n                id=\"newContactNotes\"\n                value={newContactNotes}\n                onChange={(e) => setNewContactNotes(e.target.value)}\n                placeholder=\"Any additional notes about this contact\"\n                rows={2}\n              />\n            </div>\n\n            <div className=\"flex space-x-4 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowAddContact(false)} className=\"flex-1\">\n                Cancel\n              </Button>\n              <Button \n                onClick={handleAddContact}\n                className=\"flex-1 bg-brand-primary hover:bg-blue-700\"\n                disabled={createContactMutation.isPending}\n              >\n                {createContactMutation.isPending ? \"Adding...\" : \"Add Contact\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </Dialog>\n  );\n}","size_bytes":36349},"server/storage.ts":{"content":"import { \n  songs, contacts, deals, pitches, payments, templates, emailTemplates, attachments, calendarEvents,\n  playlists, playlistSongs, savedSearches, workflowAutomation, clientProfiles, analyticsEvents,\n  type Song, type InsertSong, type Contact, type InsertContact,\n  type Deal, type InsertDeal, type Pitch, type InsertPitch,\n  type Payment, type InsertPayment, type Template, type InsertTemplate,\n  type EmailTemplate, type InsertEmailTemplate, type Attachment, type InsertAttachment,\n  type CalendarEvent, type InsertCalendarEvent,\n  type Playlist, type InsertPlaylist, type PlaylistSong, type InsertPlaylistSong,\n  type SavedSearch, type InsertSavedSearch, type WorkflowAutomation, type InsertWorkflowAutomation,\n  type ClientProfile, type InsertClientProfile, type AnalyticsEvent, type InsertAnalyticsEvent,\n  type DealWithRelations, type DashboardMetrics\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, asc, count, sum, and, or, gte, lte, like } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Songs\n  getSongs(search?: string, genre?: string, limit?: number): Promise<Song[]>;\n  getSong(id: number): Promise<Song | undefined>;\n  createSong(song: InsertSong): Promise<Song>;\n  updateSong(id: number, song: Partial<InsertSong>): Promise<Song>;\n  deleteSong(id: number): Promise<void>;\n\n  // Contacts\n  getContacts(search?: string, limit?: number): Promise<Contact[]>;\n  getContact(id: number): Promise<Contact | undefined>;\n  createContact(contact: InsertContact): Promise<Contact>;\n  updateContact(id: number, contact: Partial<InsertContact>): Promise<Contact>;\n  deleteContact(id: number): Promise<void>;\n\n  // Deals\n  getDeals(status?: string, limit?: number): Promise<DealWithRelations[]>;\n  getDeal(id: number): Promise<DealWithRelations | undefined>;\n  createDeal(deal: any): Promise<Deal>;\n  updateDeal(id: number, deal: Partial<InsertDeal>): Promise<Deal>;\n  deleteDeal(id: number): Promise<void>;\n\n  // Pitches\n  getPitches(dealId?: number, limit?: number): Promise<Pitch[]>;\n  getPitch(id: number): Promise<Pitch | undefined>;\n  createPitch(pitch: InsertPitch): Promise<Pitch>;\n  updatePitch(id: number, pitch: Partial<InsertPitch>): Promise<Pitch>;\n  deletePitch(id: number): Promise<void>;\n\n  // Payments\n  getPayments(status?: string, limit?: number): Promise<Payment[]>;\n  getPayment(id: number): Promise<Payment | undefined>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  updatePayment(id: number, payment: Partial<InsertPayment>): Promise<Payment>;\n  deletePayment(id: number): Promise<void>;\n\n  // Templates\n  getTemplates(type?: string): Promise<Template[]>;\n  getTemplate(id: number): Promise<Template | undefined>;\n  createTemplate(template: InsertTemplate): Promise<Template>;\n  updateTemplate(id: number, template: Partial<InsertTemplate>): Promise<Template>;\n  deleteTemplate(id: number): Promise<void>;\n\n  // Email Templates\n  getEmailTemplates(stage?: string): Promise<EmailTemplate[]>;\n  getEmailTemplate(id: number): Promise<EmailTemplate | undefined>;\n  createEmailTemplate(template: InsertEmailTemplate): Promise<EmailTemplate>;\n  updateEmailTemplate(id: number, template: Partial<InsertEmailTemplate>): Promise<EmailTemplate>;\n  deleteEmailTemplate(id: number): Promise<void>;\n\n  // Attachments\n  getAttachments(entityType?: string, entityId?: number): Promise<Attachment[]>;\n  getAttachment(id: number): Promise<Attachment | undefined>;\n  createAttachment(attachment: InsertAttachment): Promise<Attachment>;\n  deleteAttachment(id: number): Promise<void>;\n\n  // Calendar Events\n  getCalendarEvents(entityType?: string, entityId?: number, startDate?: Date, endDate?: Date): Promise<CalendarEvent[]>;\n  getCalendarEvent(id: number): Promise<CalendarEvent | undefined>;\n  createCalendarEvent(event: InsertCalendarEvent): Promise<CalendarEvent>;\n  updateCalendarEvent(id: number, event: Partial<InsertCalendarEvent>): Promise<CalendarEvent>;\n  deleteCalendarEvent(id: number): Promise<void>;\n\n  // Dashboard\n  getDashboardMetrics(): Promise<DashboardMetrics>;\n\n  // Playlists\n  getPlaylists(): Promise<Playlist[]>;\n  getPlaylist(id: number): Promise<Playlist | undefined>;\n  createPlaylist(playlist: InsertPlaylist): Promise<Playlist>;\n  updatePlaylist(id: number, playlist: Partial<InsertPlaylist>): Promise<Playlist>;\n  deletePlaylist(id: number): Promise<void>;\n\n  // Playlist Songs\n  getPlaylistSongs(playlistId: number): Promise<PlaylistSong[]>;\n  addSongToPlaylist(playlistSong: InsertPlaylistSong): Promise<PlaylistSong>;\n  removeSongFromPlaylist(playlistId: number, songId: number): Promise<void>;\n\n  // Saved Searches\n  getSavedSearches(): Promise<SavedSearch[]>;\n  getSavedSearch(id: number): Promise<SavedSearch | undefined>;\n  createSavedSearch(search: InsertSavedSearch): Promise<SavedSearch>;\n  deleteSavedSearch(id: number): Promise<void>;\n\n  // Workflow Automation\n  getWorkflowAutomations(): Promise<WorkflowAutomation[]>;\n  getWorkflowAutomation(id: number): Promise<WorkflowAutomation | undefined>;\n  createWorkflowAutomation(automation: InsertWorkflowAutomation): Promise<WorkflowAutomation>;\n  updateWorkflowAutomation(id: number, automation: Partial<InsertWorkflowAutomation>): Promise<WorkflowAutomation>;\n  deleteWorkflowAutomation(id: number): Promise<void>;\n\n  // Client Profiles\n  getClientProfiles(): Promise<ClientProfile[]>;\n  getClientProfile(id: number): Promise<ClientProfile | undefined>;\n  createClientProfile(profile: InsertClientProfile): Promise<ClientProfile>;\n  updateClientProfile(id: number, profile: Partial<InsertClientProfile>): Promise<ClientProfile>;\n  deleteClientProfile(id: number): Promise<void>;\n\n  // Analytics Events\n  createAnalyticsEvent(event: InsertAnalyticsEvent): Promise<AnalyticsEvent>;\n\n  // Contact extraction from deals\n  extractContactsFromDeal(dealData: any): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Songs\n  async getSongs(search?: string, genre?: string, limit = 50): Promise<Song[]> {\n    let query = db.select().from(songs);\n    \n    const conditions = [];\n    if (search) {\n      conditions.push(\n        or(\n          like(songs.title, `%${search}%`),\n          like(songs.artist, `%${search}%`),\n          like(songs.album, `%${search}%`)\n        )\n      );\n    }\n    if (genre) {\n      conditions.push(eq(songs.genre, genre));\n    }\n    \n    if (conditions.length > 0) {\n      query = query.where(and(...conditions));\n    }\n    \n    return query.orderBy(desc(songs.createdAt)).limit(limit);\n  }\n\n  async getSong(id: number): Promise<Song | undefined> {\n    const [song] = await db.select().from(songs).where(eq(songs.id, id));\n    return song || undefined;\n  }\n\n  async createSong(song: InsertSong): Promise<Song> {\n    const [created] = await db.insert(songs).values(song).returning();\n    return created;\n  }\n\n  async updateSong(id: number, song: Partial<InsertSong>): Promise<Song> {\n    const [updated] = await db\n      .update(songs)\n      .set({ ...song, updatedAt: new Date() })\n      .where(eq(songs.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteSong(id: number): Promise<void> {\n    await db.delete(songs).where(eq(songs.id, id));\n  }\n\n  // Contacts\n  async getContacts(search?: string, limit = 50): Promise<Contact[]> {\n    let query = db.select().from(contacts);\n    \n    if (search) {\n      query = query.where(\n        or(\n          like(contacts.name, `%${search}%`),\n          like(contacts.email, `%${search}%`),\n          like(contacts.company, `%${search}%`)\n        )\n      );\n    }\n    \n    return query.orderBy(asc(contacts.name)).limit(limit);\n  }\n\n  async getContact(id: number): Promise<Contact | undefined> {\n    const [contact] = await db.select().from(contacts).where(eq(contacts.id, id));\n    return contact || undefined;\n  }\n\n  async createContact(contact: InsertContact): Promise<Contact> {\n    const [created] = await db.insert(contacts).values(contact).returning();\n    return created;\n  }\n\n  async updateContact(id: number, contact: Partial<InsertContact>): Promise<Contact> {\n    const [updated] = await db\n      .update(contacts)\n      .set({ ...contact, updatedAt: new Date() })\n      .where(eq(contacts.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteContact(id: number): Promise<void> {\n    await db.delete(contacts).where(eq(contacts.id, id));\n  }\n\n  // Deals\n  async getDeals(status?: string, limit = 50): Promise<DealWithRelations[]> {\n    let query = db\n      .select()\n      .from(deals)\n      .leftJoin(songs, eq(deals.songId, songs.id))\n      .leftJoin(contacts, eq(deals.contactId, contacts.id))\n      .leftJoin(pitches, eq(deals.id, pitches.dealId))\n      .leftJoin(payments, eq(deals.id, payments.dealId));\n    \n    if (status) {\n      query = query.where(eq(deals.status, status));\n    }\n    \n    const results = await query.orderBy(desc(deals.createdAt)).limit(limit);\n    \n    // Transform the results to match DealWithRelations type\n    const dealsMap = new Map<number, DealWithRelations>();\n    \n    results.forEach((row) => {\n      const deal = row.deals;\n      const song = row.songs;\n      const contact = row.contacts;\n      const pitch = row.pitches;\n      const payment = row.payments;\n      \n      if (!dealsMap.has(deal.id)) {\n        dealsMap.set(deal.id, {\n          ...deal,\n          song: song!,\n          contact: contact!,\n          pitches: [],\n          payments: []\n        });\n      }\n      \n      const dealWithRelations = dealsMap.get(deal.id)!;\n      \n      if (pitch && !dealWithRelations.pitches.some(p => p.id === pitch.id)) {\n        dealWithRelations.pitches.push(pitch);\n      }\n      \n      if (payment && !dealWithRelations.payments.some(p => p.id === payment.id)) {\n        dealWithRelations.payments.push(payment);\n      }\n    });\n    \n    return Array.from(dealsMap.values());\n  }\n\n  async getDeal(id: number): Promise<DealWithRelations | undefined> {\n    const results = await db\n      .select()\n      .from(deals)\n      .leftJoin(songs, eq(deals.songId, songs.id))\n      .leftJoin(contacts, eq(deals.contactId, contacts.id))\n      .leftJoin(pitches, eq(deals.id, pitches.dealId))\n      .leftJoin(payments, eq(deals.id, payments.dealId))\n      .where(eq(deals.id, id));\n    \n    if (results.length === 0) return undefined;\n    \n    const deal = results[0].deals;\n    const song = results[0].songs;\n    const contact = results[0].contacts;\n    \n    const pitchesData = results.filter(r => r.pitches).map(r => r.pitches!);\n    const paymentsData = results.filter(r => r.payments).map(r => r.payments!);\n    \n    return {\n      ...deal,\n      song: song!,\n      contact: contact!,\n      pitches: pitchesData,\n      payments: paymentsData\n    };\n  }\n\n  async createDeal(deal: any): Promise<Deal> {\n    try {\n      // Auto-populate status change dates based on current status\n      const now = new Date();\n      const processedDeal = { ...deal };\n      \n      if (deal.status === 'pitched' && !deal.pitchedDate) {\n        processedDeal.pitchedDate = now;\n      } else if (deal.status === 'pending_approval' && !deal.pendingApprovalDate) {\n        processedDeal.pendingApprovalDate = now;\n      } else if (deal.status === 'quoted' && !deal.quotedDate) {\n        processedDeal.quotedDate = now;\n      } else if (deal.status === 'use_confirmed' && !deal.useConfirmedDate) {\n        processedDeal.useConfirmedDate = now;\n      } else if (deal.status === 'being_drafted' && !deal.beingDraftedDate) {\n        processedDeal.beingDraftedDate = now;\n      } else if (deal.status === 'out_for_signature' && !deal.outForSignatureDate) {\n        processedDeal.outForSignatureDate = now;\n      } else if (deal.status === 'payment_received' && !deal.paymentReceivedDate) {\n        processedDeal.paymentReceivedDate = now;\n      } else if (deal.status === 'completed' && !deal.completedDate) {\n        processedDeal.completedDate = now;\n      }\n      \n      // Extract contacts from deal data before creating the deal\n      await this.extractContactsFromDeal(processedDeal);\n      \n      const [created] = await db.insert(deals).values(processedDeal).returning();\n      return created;\n    } catch (error) {\n      console.error(\"Database error in createDeal:\", error);\n      throw error;\n    }\n  }\n\n  async updateDeal(id: number, deal: Partial<InsertDeal>): Promise<Deal> {\n    // Convert ISO string dates to Date objects for database storage\n    const processedDeal = {\n      ...deal,\n      // Status dates - convert from ISO strings to Date objects\n      pitchedDate: deal.pitchedDate ? new Date(deal.pitchedDate) : deal.pitchedDate,\n      pendingApprovalDate: deal.pendingApprovalDate ? new Date(deal.pendingApprovalDate) : deal.pendingApprovalDate,\n      quotedDate: deal.quotedDate ? new Date(deal.quotedDate) : deal.quotedDate,\n      useConfirmedDate: deal.useConfirmedDate ? new Date(deal.useConfirmedDate) : deal.useConfirmedDate,\n      beingDraftedDate: deal.beingDraftedDate ? new Date(deal.beingDraftedDate) : deal.beingDraftedDate,\n      outForSignatureDate: deal.outForSignatureDate ? new Date(deal.outForSignatureDate) : deal.outForSignatureDate,\n      paymentReceivedDate: deal.paymentReceivedDate ? new Date(deal.paymentReceivedDate) : deal.paymentReceivedDate,\n      completedDate: deal.completedDate ? new Date(deal.completedDate) : deal.completedDate,\n      // Other dates\n      airDate: deal.airDate ? new Date(deal.airDate) : deal.airDate,\n      pitchDate: deal.pitchDate ? new Date(deal.pitchDate) : deal.pitchDate,\n      updatedAt: new Date()\n    };\n\n    // Extract contacts from deal data when updating\n    await this.extractContactsFromDeal(processedDeal);\n\n    const [updated] = await db\n      .update(deals)\n      .set(processedDeal)\n      .where(eq(deals.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteDeal(id: number): Promise<void> {\n    await db.delete(deals).where(eq(deals.id, id));\n  }\n\n  // Pitches\n  async getPitches(dealId?: number, limit = 50): Promise<Pitch[]> {\n    let query = db.select().from(pitches);\n    \n    if (dealId) {\n      query = query.where(eq(pitches.dealId, dealId));\n    }\n    \n    return query.orderBy(desc(pitches.createdAt)).limit(limit);\n  }\n\n  async getPitch(id: number): Promise<Pitch | undefined> {\n    const [pitch] = await db.select().from(pitches).where(eq(pitches.id, id));\n    return pitch || undefined;\n  }\n\n  async createPitch(pitch: InsertPitch): Promise<Pitch> {\n    const [created] = await db.insert(pitches).values(pitch).returning();\n    return created;\n  }\n\n  async updatePitch(id: number, pitch: Partial<InsertPitch>): Promise<Pitch> {\n    const [updated] = await db\n      .update(pitches)\n      .set({ ...pitch, updatedAt: new Date() })\n      .where(eq(pitches.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deletePitch(id: number): Promise<void> {\n    await db.delete(pitches).where(eq(pitches.id, id));\n  }\n\n  // Payments\n  async getPayments(status?: string, limit = 50): Promise<Payment[]> {\n    let query = db.select().from(payments);\n    \n    if (status) {\n      query = query.where(eq(payments.status, status));\n    }\n    \n    return query.orderBy(desc(payments.createdAt)).limit(limit);\n  }\n\n  async getPayment(id: number): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.id, id));\n    return payment || undefined;\n  }\n\n  async createPayment(payment: InsertPayment): Promise<Payment> {\n    const [created] = await db.insert(payments).values(payment).returning();\n    return created;\n  }\n\n  async updatePayment(id: number, payment: Partial<InsertPayment>): Promise<Payment> {\n    const [updated] = await db\n      .update(payments)\n      .set({ ...payment, updatedAt: new Date() })\n      .where(eq(payments.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deletePayment(id: number): Promise<void> {\n    await db.delete(payments).where(eq(payments.id, id));\n  }\n\n  // Templates\n  async getTemplates(type?: string): Promise<Template[]> {\n    let query = db.select().from(templates);\n    \n    if (type) {\n      query = query.where(eq(templates.type, type));\n    }\n    \n    return query.orderBy(asc(templates.name));\n  }\n\n  async getTemplate(id: number): Promise<Template | undefined> {\n    const [template] = await db.select().from(templates).where(eq(templates.id, id));\n    return template || undefined;\n  }\n\n  async createTemplate(template: InsertTemplate): Promise<Template> {\n    const [created] = await db.insert(templates).values(template).returning();\n    return created;\n  }\n\n  async updateTemplate(id: number, template: Partial<InsertTemplate>): Promise<Template> {\n    const [updated] = await db\n      .update(templates)\n      .set({ ...template, updatedAt: new Date() })\n      .where(eq(templates.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTemplate(id: number): Promise<void> {\n    await db.delete(templates).where(eq(templates.id, id));\n  }\n\n  // Email Templates\n  async getEmailTemplates(stage?: string): Promise<EmailTemplate[]> {\n    let query = db.select().from(emailTemplates);\n    \n    if (stage) {\n      query = query.where(eq(emailTemplates.stage, stage));\n    }\n    \n    return await query.orderBy(asc(emailTemplates.name));\n  }\n\n  async getEmailTemplate(id: number): Promise<EmailTemplate | undefined> {\n    const [template] = await db.select().from(emailTemplates).where(eq(emailTemplates.id, id));\n    return template || undefined;\n  }\n\n  async createEmailTemplate(template: InsertEmailTemplate): Promise<EmailTemplate> {\n    const [newTemplate] = await db.insert(emailTemplates).values(template).returning();\n    return newTemplate;\n  }\n\n  async updateEmailTemplate(id: number, template: Partial<InsertEmailTemplate>): Promise<EmailTemplate> {\n    const [updatedTemplate] = await db.update(emailTemplates)\n      .set({ ...template, updatedAt: new Date() })\n      .where(eq(emailTemplates.id, id))\n      .returning();\n    return updatedTemplate;\n  }\n\n  async deleteEmailTemplate(id: number): Promise<void> {\n    await db.delete(emailTemplates).where(eq(emailTemplates.id, id));\n  }\n\n  // Attachments\n  async getAttachments(entityType?: string, entityId?: number): Promise<Attachment[]> {\n    let query = db.select().from(attachments);\n    \n    const conditions = [];\n    if (entityType) {\n      conditions.push(eq(attachments.entityType, entityType));\n    }\n    if (entityId) {\n      conditions.push(eq(attachments.entityId, entityId));\n    }\n    \n    if (conditions.length > 0) {\n      query = query.where(and(...conditions));\n    }\n    \n    return await query.orderBy(desc(attachments.createdAt));\n  }\n\n  async getAttachment(id: number): Promise<Attachment | undefined> {\n    const [attachment] = await db.select().from(attachments).where(eq(attachments.id, id));\n    return attachment || undefined;\n  }\n\n  async createAttachment(attachment: InsertAttachment): Promise<Attachment> {\n    const [newAttachment] = await db.insert(attachments).values(attachment).returning();\n    return newAttachment;\n  }\n\n  async deleteAttachment(id: number): Promise<void> {\n    await db.delete(attachments).where(eq(attachments.id, id));\n  }\n\n  // Calendar Events\n  async getCalendarEvents(entityType?: string, entityId?: number, startDate?: Date, endDate?: Date): Promise<CalendarEvent[]> {\n    let query = db.select().from(calendarEvents);\n    \n    const conditions = [];\n    if (entityType) {\n      conditions.push(eq(calendarEvents.entityType, entityType));\n    }\n    if (entityId) {\n      conditions.push(eq(calendarEvents.entityId, entityId));\n    }\n    if (startDate) {\n      conditions.push(gte(calendarEvents.startDate, startDate));\n    }\n    if (endDate) {\n      conditions.push(lte(calendarEvents.startDate, endDate));\n    }\n    \n    if (conditions.length > 0) {\n      query = query.where(and(...conditions));\n    }\n    \n    return await query.orderBy(asc(calendarEvents.startDate));\n  }\n\n  async getCalendarEvent(id: number): Promise<CalendarEvent | undefined> {\n    const [event] = await db.select().from(calendarEvents).where(eq(calendarEvents.id, id));\n    return event || undefined;\n  }\n\n  async createCalendarEvent(event: InsertCalendarEvent): Promise<CalendarEvent> {\n    const [newEvent] = await db.insert(calendarEvents).values(event).returning();\n    return newEvent;\n  }\n\n  async updateCalendarEvent(id: number, event: Partial<InsertCalendarEvent>): Promise<CalendarEvent> {\n    const [updatedEvent] = await db.update(calendarEvents)\n      .set({ ...event, updatedAt: new Date() })\n      .where(eq(calendarEvents.id, id))\n      .returning();\n    return updatedEvent;\n  }\n\n  async deleteCalendarEvent(id: number): Promise<void> {\n    await db.delete(calendarEvents).where(eq(calendarEvents.id, id));\n  }\n\n  // Dashboard\n  async getDashboardMetrics(): Promise<DashboardMetrics> {\n    const now = new Date();\n    \n    // Get active deals count\n    const [activeDealsResult] = await db\n      .select({ count: count() })\n      .from(deals)\n      .where(eq(deals.status, 'confirmed'));\n    \n    // Get total revenue\n    const [totalRevenueResult] = await db\n      .select({ sum: sum(payments.amount) })\n      .from(payments)\n      .where(eq(payments.status, 'paid'));\n    \n    // Get pending payments\n    const [pendingPaymentsResult] = await db\n      .select({ sum: sum(payments.amount) })\n      .from(payments)\n      .where(eq(payments.status, 'pending'));\n    \n    // Get total songs\n    const [totalSongsResult] = await db\n      .select({ count: count() })\n      .from(songs);\n    \n    // Get deals by status\n    const dealsByStatusResults = await db\n      .select({ status: deals.status, count: count() })\n      .from(deals)\n      .groupBy(deals.status);\n    \n    const dealsByStatus: Record<string, number> = {};\n    dealsByStatusResults.forEach(row => {\n      dealsByStatus[row.status] = row.count;\n    });\n    \n    // Get recent activity (simplified)\n    const recentDeals = await db\n      .select()\n      .from(deals)\n      .orderBy(desc(deals.updatedAt))\n      .limit(10);\n    \n    const recentActivity = recentDeals.map(deal => ({\n      id: deal.id.toString(),\n      type: 'deal' as const,\n      message: `Deal ${deal.status}: ${deal.projectName}`,\n      timestamp: deal.updatedAt,\n      metadata: { dealId: deal.id, status: deal.status }\n    }));\n    \n    // Get urgent actions\n    const overduePayments = await db\n      .select()\n      .from(payments)\n      .where(\n        and(\n          eq(payments.status, 'pending'),\n          lte(payments.dueDate, now)\n        )\n      )\n      .limit(10);\n    \n    const urgentActions = overduePayments.map(payment => ({\n      id: payment.id.toString(),\n      type: 'overdue_payment' as const,\n      message: `Payment overdue: $${payment.amount}`,\n      dueDate: payment.dueDate,\n      metadata: { paymentId: payment.id, amount: payment.amount }\n    }));\n    \n    return {\n      activeDeals: activeDealsResult.count,\n      totalRevenue: Number(totalRevenueResult.sum) || 0,\n      pendingPayments: Number(pendingPaymentsResult.sum) || 0,\n      totalSongs: totalSongsResult.count,\n      dealsByStatus,\n      recentActivity,\n      urgentActions\n    };\n  }\n\n  // Playlist methods\n  async getPlaylists(): Promise<Playlist[]> {\n    return await db.select().from(playlists).orderBy(desc(playlists.createdAt));\n  }\n\n  async getPlaylist(id: number): Promise<Playlist | undefined> {\n    const [playlist] = await db.select().from(playlists).where(eq(playlists.id, id));\n    return playlist || undefined;\n  }\n\n  async createPlaylist(playlist: InsertPlaylist): Promise<Playlist> {\n    const [newPlaylist] = await db.insert(playlists).values(playlist).returning();\n    return newPlaylist;\n  }\n\n  async updatePlaylist(id: number, playlist: Partial<InsertPlaylist>): Promise<Playlist> {\n    const [updatedPlaylist] = await db\n      .update(playlists)\n      .set(playlist)\n      .where(eq(playlists.id, id))\n      .returning();\n    return updatedPlaylist;\n  }\n\n  async deletePlaylist(id: number): Promise<void> {\n    await db.delete(playlists).where(eq(playlists.id, id));\n  }\n\n  // Playlist Songs methods\n  async getPlaylistSongs(playlistId: number): Promise<PlaylistSong[]> {\n    return await db.select().from(playlistSongs)\n      .where(eq(playlistSongs.playlistId, playlistId))\n      .orderBy(asc(playlistSongs.position));\n  }\n\n  async addSongToPlaylist(playlistSong: InsertPlaylistSong): Promise<PlaylistSong> {\n    const [newPlaylistSong] = await db.insert(playlistSongs).values(playlistSong).returning();\n    return newPlaylistSong;\n  }\n\n  async removeSongFromPlaylist(playlistId: number, songId: number): Promise<void> {\n    await db.delete(playlistSongs)\n      .where(and(\n        eq(playlistSongs.playlistId, playlistId),\n        eq(playlistSongs.songId, songId)\n      ));\n  }\n\n  // Saved Searches methods\n  async getSavedSearches(): Promise<SavedSearch[]> {\n    return await db.select().from(savedSearches).orderBy(desc(savedSearches.createdAt));\n  }\n\n  async getSavedSearch(id: number): Promise<SavedSearch | undefined> {\n    const [search] = await db.select().from(savedSearches).where(eq(savedSearches.id, id));\n    return search || undefined;\n  }\n\n  async createSavedSearch(search: InsertSavedSearch): Promise<SavedSearch> {\n    const [newSearch] = await db.insert(savedSearches).values(search).returning();\n    return newSearch;\n  }\n\n  async deleteSavedSearch(id: number): Promise<void> {\n    await db.delete(savedSearches).where(eq(savedSearches.id, id));\n  }\n\n  // Workflow Automation methods\n  async getWorkflowAutomations(): Promise<WorkflowAutomation[]> {\n    return await db.select().from(workflowAutomation).orderBy(desc(workflowAutomation.createdAt));\n  }\n\n  async getWorkflowAutomation(id: number): Promise<WorkflowAutomation | undefined> {\n    const [automation] = await db.select().from(workflowAutomation).where(eq(workflowAutomation.id, id));\n    return automation || undefined;\n  }\n\n  async createWorkflowAutomation(automation: InsertWorkflowAutomation): Promise<WorkflowAutomation> {\n    const [newAutomation] = await db.insert(workflowAutomation).values(automation).returning();\n    return newAutomation;\n  }\n\n  async updateWorkflowAutomation(id: number, automation: Partial<InsertWorkflowAutomation>): Promise<WorkflowAutomation> {\n    const [updatedAutomation] = await db\n      .update(workflowAutomation)\n      .set(automation)\n      .where(eq(workflowAutomation.id, id))\n      .returning();\n    return updatedAutomation;\n  }\n\n  async deleteWorkflowAutomation(id: number): Promise<void> {\n    await db.delete(workflowAutomation).where(eq(workflowAutomation.id, id));\n  }\n\n  // Client Profiles methods\n  async getClientProfiles(): Promise<ClientProfile[]> {\n    return await db.select().from(clientProfiles).orderBy(desc(clientProfiles.createdAt));\n  }\n\n  async getClientProfile(id: number): Promise<ClientProfile | undefined> {\n    const [profile] = await db.select().from(clientProfiles).where(eq(clientProfiles.id, id));\n    return profile || undefined;\n  }\n\n  async createClientProfile(profile: InsertClientProfile): Promise<ClientProfile> {\n    const [newProfile] = await db.insert(clientProfiles).values(profile).returning();\n    return newProfile;\n  }\n\n  async updateClientProfile(id: number, profile: Partial<InsertClientProfile>): Promise<ClientProfile> {\n    const [updatedProfile] = await db\n      .update(clientProfiles)\n      .set(profile)\n      .where(eq(clientProfiles.id, id))\n      .returning();\n    return updatedProfile;\n  }\n\n  async deleteClientProfile(id: number): Promise<void> {\n    await db.delete(clientProfiles).where(eq(clientProfiles.id, id));\n  }\n\n  // Analytics Events methods\n  async createAnalyticsEvent(event: InsertAnalyticsEvent): Promise<AnalyticsEvent> {\n    const [newEvent] = await db.insert(analyticsEvents).values(event).returning();\n    return newEvent;\n  }\n\n  // Contact extraction from deals\n  async extractContactsFromDeal(dealData: any): Promise<void> {\n    const contactsToCreate: InsertContact[] = [];\n    \n    // Extract Licensee/Production Company contact\n    if (dealData.licenseeContactName && dealData.licenseeContactEmail) {\n      const existingContact = await db.select()\n        .from(contacts)\n        .where(eq(contacts.email, dealData.licenseeContactEmail))\n        .limit(1);\n      \n      if (existingContact.length === 0) {\n        contactsToCreate.push({\n          name: dealData.licenseeContactName,\n          email: dealData.licenseeContactEmail,\n          phone: dealData.licenseeContactPhone || \"\",\n          company: dealData.licenseeCompanyName || \"\",\n          role: \"Licensee/Production Company Contact\",\n          notes: `Contact from ${dealData.projectName} deal. Address: ${dealData.licenseeAddress || \"Not provided\"}`\n        });\n      }\n    }\n    \n    // Extract Music Supervisor contact\n    if (dealData.musicSupervisorContactName && dealData.musicSupervisorContactEmail) {\n      const existingContact = await db.select()\n        .from(contacts)\n        .where(eq(contacts.email, dealData.musicSupervisorContactEmail))\n        .limit(1);\n      \n      if (existingContact.length === 0) {\n        contactsToCreate.push({\n          name: dealData.musicSupervisorContactName,\n          email: dealData.musicSupervisorContactEmail,\n          phone: dealData.musicSupervisorContactPhone || \"\",\n          company: dealData.musicSupervisorName || \"\",\n          role: \"Music Supervisor\",\n          notes: `Contact from ${dealData.projectName} deal. Address: ${dealData.musicSupervisorAddress || \"Not provided\"}`\n        });\n      }\n    }\n    \n    // Extract Clearance Company contact\n    if (dealData.clearanceCompanyContactName && dealData.clearanceCompanyContactEmail) {\n      const existingContact = await db.select()\n        .from(contacts)\n        .where(eq(contacts.email, dealData.clearanceCompanyContactEmail))\n        .limit(1);\n      \n      if (existingContact.length === 0) {\n        contactsToCreate.push({\n          name: dealData.clearanceCompanyContactName,\n          email: dealData.clearanceCompanyContactEmail,\n          phone: dealData.clearanceCompanyContactPhone || \"\",\n          company: dealData.clearanceCompanyName || \"\",\n          role: \"Clearance Company Contact\",\n          notes: `Contact from ${dealData.projectName} deal. Address: ${dealData.clearanceCompanyAddress || \"Not provided\"}`\n        });\n      }\n    }\n    \n    // Create all new contacts\n    if (contactsToCreate.length > 0) {\n      await db.insert(contacts).values(contactsToCreate);\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":30402},"client/src/components/OnboardingTour.tsx":{"content":"import { useEffect } from 'react';\nimport introJs from 'intro.js';\nimport 'intro.js/introjs.css';\n\ninterface OnboardingTourProps {\n  enabled: boolean;\n  onExit: () => void;\n}\n\nconst tourSteps = [\n  {\n    element: '#dashboard-overview',\n    intro: 'Welcome to the SyncTracker Dashboard! Here you can get an overview of your sync licensing deals, revenue metrics, and recent activity.',\n    position: 'bottom' as const\n  },\n  {\n    element: '#add-song-button',\n    intro: 'Use this button to add new songs to your catalog with all the metadata you need.',\n    position: 'right' as const\n  },\n  {\n    element: '#add-deal-button',\n    intro: 'Click here to create a new pitch or deal. Track your licensing opportunities from start to finish.',\n    position: 'right' as const\n  },\n  {\n    element: '#add-template-button',\n    intro: 'Add industry contacts here. Build and maintain relationships with music supervisors, producers, and other professionals.',\n    position: 'right' as const\n  }\n];\n\nexport default function OnboardingTour({ enabled, onExit }: OnboardingTourProps) {\n  useEffect(() => {\n    if (!enabled) return;\n\n    const intro = introJs.tour();\n    \n    intro.setOptions({\n      steps: tourSteps,\n      exitOnOverlayClick: false,\n      showStepNumbers: true,\n      showBullets: false,\n      showProgress: true,\n      scrollToElement: true,\n      overlayOpacity: 0.5,\n    });\n\n    intro.onexit(onExit);\n    intro.start();\n\n    return () => {\n      intro.exit(false);\n    };\n  }, [enabled, onExit]);\n\n  return null;\n}\n","size_bytes":1526},"client/src/components/duplicate-template-dialog.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Copy } from \"lucide-react\";\n\ninterface DuplicateTemplateDialogProps {\n  open: boolean;\n  onClose: () => void;\n  templateId: number;\n  templateName: string;\n  onSuccess: () => void;\n}\n\nexport default function DuplicateTemplateDialog({\n  open,\n  onClose,\n  templateId,\n  templateName,\n  onSuccess\n}: DuplicateTemplateDialogProps) {\n  const [newName, setNewName] = useState(`${templateName} (Copy)`);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleDuplicate = async () => {\n    if (!newName.trim()) {\n      alert(\"Please enter a template name\");\n      return;\n    }\n\n    setIsProcessing(true);\n    try {\n      const response = await fetch(`/api/templates/${templateId}/duplicate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ name: newName })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to duplicate template');\n      }\n\n      onSuccess();\n      onClose();\n      setNewName(`${templateName} (Copy)`);\n    } catch (error) {\n      alert(\"Failed to duplicate template. Please try again.\");\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isProcessing) {\n      setNewName(`${templateName} (Copy)`);\n      onClose();\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Duplicate Template</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"template-name\">New Template Name</Label>\n            <Input\n              id=\"template-name\"\n              value={newName}\n              onChange={(e) => setNewName(e.target.value)}\n              placeholder=\"Enter template name\"\n              data-testid=\"input-duplicate-name\"\n              disabled={isProcessing}\n            />\n          </div>\n          <div className=\"flex justify-start space-x-2\">\n            <Button \n              onClick={handleDuplicate}\n              disabled={!newName.trim() || isProcessing}\n              data-testid=\"button-confirm-duplicate\"\n            >\n              {isProcessing ? (\n                <>Processing...</>\n              ) : (\n                <>\n                  <Copy className=\"h-4 w-4 mr-2\" />\n                  Duplicate\n                </>\n              )}\n            </Button>\n            <Button variant=\"outline\" onClick={handleClose} disabled={isProcessing}>\n              Cancel\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":2940},"client/src/components/forms/import-deals-dialog.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, FileSpreadsheet, CheckCircle2, XCircle, Loader2 } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface ImportDealsDialogProps {\n  open: boolean;\n  onClose: () => void;\n}\n\ninterface ParsedData {\n  headers: string[];\n  preview: any[];\n  data: any[];\n  totalRows: number;\n}\n\ninterface ColumnMapping {\n  projectName?: string;\n  projectType?: string;\n  songTitle?: string;\n  songArtist?: string;\n  songComposer?: string;\n  songPublisher?: string;\n  contactName?: string;\n  contactEmail?: string;\n  contactPhone?: string;\n  contactCompany?: string;\n  status?: string;\n  territory?: string;\n  exclusivity?: string;\n  projectDescription?: string;\n  term?: string;\n  usage?: string;\n  totalFee?: string;\n  publishingFee?: string;\n  recordingFee?: string;\n  notes?: string;\n  airDate?: string;\n}\n\nexport default function ImportDealsDialog({ open, onClose }: ImportDealsDialogProps) {\n  const { toast } = useToast();\n  const [step, setStep] = useState<'upload' | 'map' | 'import' | 'results'>('upload');\n  const [file, setFile] = useState<File | null>(null);\n  const [parsedData, setParsedData] = useState<ParsedData | null>(null);\n  const [mapping, setMapping] = useState<ColumnMapping>({});\n  const [autoCreateSongs, setAutoCreateSongs] = useState(true);\n  const [autoCreateContacts, setAutoCreateContacts] = useState(true);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [importResults, setImportResults] = useState<any>(null);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) {\n      const validTypes = [\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n        'application/vnd.ms-excel',\n        'text/csv'\n      ];\n      \n      if (!validTypes.includes(selectedFile.type) && !selectedFile.name.match(/\\.(xlsx|xls|csv)$/i)) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload an Excel (.xlsx, .xls) or CSV (.csv) file\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n      \n      setFile(selectedFile);\n    }\n  };\n\n  const handleFileUpload = async () => {\n    if (!file) return;\n\n    setIsProcessing(true);\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const response = await fetch('/api/deals/import/parse', {\n        method: 'POST',\n        body: formData\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to parse file');\n      }\n\n      const data = await response.json();\n      setParsedData(data);\n      setStep('map');\n    } catch (error) {\n      toast({\n        title: \"Upload failed\",\n        description: \"Failed to parse the uploaded file. Please check the format and try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleImport = async () => {\n    if (!parsedData || !mapping.projectName) {\n      toast({\n        title: \"Missing required mapping\",\n        description: \"Please map at least the Project Name column\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n    setStep('import');\n\n    try {\n      const response = await fetch('/api/deals/import/create', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          data: parsedData.data, // Send full dataset, not just preview\n          mapping,\n          autoCreateSongs,\n          autoCreateContacts\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to import deals');\n      }\n\n      const results = await response.json();\n      setImportResults(results);\n      setStep('results');\n      \n      // Refresh deals list\n      queryClient.invalidateQueries({ queryKey: ['/api/deals'] });\n      \n      toast({\n        title: \"Import completed\",\n        description: `Successfully imported ${results.created} deals${results.failed > 0 ? ` (${results.failed} failed)` : ''}`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Import failed\",\n        description: \"Failed to import deals. Please try again.\",\n        variant: \"destructive\"\n      });\n      setStep('map');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleClose = () => {\n    setStep('upload');\n    setFile(null);\n    setParsedData(null);\n    setMapping({});\n    setImportResults(null);\n    onClose();\n  };\n\n  const fieldOptions = [\n    { value: 'projectName', label: 'Project Name (Required)' },\n    { value: 'projectType', label: 'Project Type' },\n    { value: 'songTitle', label: 'Song Title' },\n    { value: 'songArtist', label: 'Song Artist' },\n    { value: 'songComposer', label: 'Song Composer' },\n    { value: 'songPublisher', label: 'Song Publisher' },\n    { value: 'contactName', label: 'Contact Name' },\n    { value: 'contactEmail', label: 'Contact Email' },\n    { value: 'contactPhone', label: 'Contact Phone' },\n    { value: 'contactCompany', label: 'Contact Company' },\n    { value: 'status', label: 'Deal Status' },\n    { value: 'territory', label: 'Territory' },\n    { value: 'exclusivity', label: 'Exclusivity' },\n    { value: 'projectDescription', label: 'Description' },\n    { value: 'term', label: 'Term' },\n    { value: 'usage', label: 'Usage' },\n    { value: 'totalFee', label: 'Total Fee' },\n    { value: 'publishingFee', label: 'Publishing Fee' },\n    { value: 'recordingFee', label: 'Recording Fee' },\n    { value: 'notes', label: 'Notes' },\n    { value: 'airDate', label: 'Air Date' }\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Import Deals from Excel/CSV</DialogTitle>\n        </DialogHeader>\n\n        {step === 'upload' && (\n          <div className=\"space-y-6\">\n            <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center\">\n              <FileSpreadsheet className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\n              <Label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                <span className=\"text-sm text-gray-600\">\n                  {file ? file.name : 'Click to upload Excel or CSV file'}\n                </span>\n                <input\n                  id=\"file-upload\"\n                  type=\"file\"\n                  accept=\".xlsx,.xls,.csv\"\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                  data-testid=\"input-import-file\"\n                />\n              </Label>\n            </div>\n\n            {file && (\n              <div className=\"flex justify-end space-x-2\">\n                <Button variant=\"outline\" onClick={() => setFile(null)}>\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleFileUpload} \n                  disabled={isProcessing}\n                  data-testid=\"button-upload-file\"\n                >\n                  {isProcessing ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Processing...\n                    </>\n                  ) : (\n                    <>\n                      <Upload className=\"h-4 w-4 mr-2\" />\n                      Upload & Parse\n                    </>\n                  )}\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n\n        {step === 'map' && parsedData && (\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Map Your Columns</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <p className=\"text-sm text-gray-600\">\n                  Found {parsedData.totalRows} rows. Map your spreadsheet columns to deal fields:\n                </p>\n                \n                <div className=\"grid grid-cols-2 gap-4 max-h-96 overflow-y-auto\">\n                  {parsedData.headers.map((header) => (\n                    <div key={header} className=\"space-y-2\">\n                      <Label className=\"text-sm font-medium\">{header}</Label>\n                      <Select\n                        value={Object.entries(mapping).find(([_, value]) => value === header)?.[0] || ''}\n                        onValueChange={(value) => {\n                          setMapping(prev => ({ ...prev, [value]: header }));\n                        }}\n                      >\n                        <SelectTrigger data-testid={`select-mapping-${header}`}>\n                          <SelectValue placeholder=\"Skip this column\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"skip\">Skip this column</SelectItem>\n                          {fieldOptions.map((option) => (\n                            <SelectItem key={option.value} value={option.value}>\n                              {option.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"space-y-3 pt-4 border-t\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"auto-create-songs\"\n                      checked={autoCreateSongs}\n                      onCheckedChange={(checked) => setAutoCreateSongs(checked as boolean)}\n                      data-testid=\"checkbox-auto-create-songs\"\n                    />\n                    <Label htmlFor=\"auto-create-songs\" className=\"cursor-pointer\">\n                      Automatically create songs if they don't exist\n                    </Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"auto-create-contacts\"\n                      checked={autoCreateContacts}\n                      onCheckedChange={(checked) => setAutoCreateContacts(checked as boolean)}\n                      data-testid=\"checkbox-auto-create-contacts\"\n                    />\n                    <Label htmlFor=\"auto-create-contacts\" className=\"cursor-pointer\">\n                      Automatically create contacts if they don't exist\n                    </Label>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button variant=\"outline\" onClick={handleClose}>\n                Cancel\n              </Button>\n              <Button \n                onClick={handleImport}\n                disabled={!mapping.projectName}\n                data-testid=\"button-start-import\"\n              >\n                Import {parsedData.totalRows} Deals\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {step === 'import' && (\n          <div className=\"flex flex-col items-center justify-center py-12 space-y-4\">\n            <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\n            <p className=\"text-lg font-medium\">Importing deals...</p>\n            <p className=\"text-sm text-gray-600\">This may take a moment</p>\n          </div>\n        )}\n\n        {step === 'results' && importResults && (\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Import Results</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"flex items-center space-x-2 text-green-600\">\n                    <CheckCircle2 className=\"h-5 w-5\" />\n                    <span className=\"font-medium\">{importResults.created} deals created</span>\n                  </div>\n                  {importResults.failed > 0 && (\n                    <div className=\"flex items-center space-x-2 text-red-600\">\n                      <XCircle className=\"h-5 w-5\" />\n                      <span className=\"font-medium\">{importResults.failed} deals failed</span>\n                    </div>\n                  )}\n                </div>\n\n                {importResults.errors && importResults.errors.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-sm font-medium\">Errors:</Label>\n                    <div className=\"max-h-48 overflow-y-auto space-y-1 bg-red-50 p-3 rounded\">\n                      {importResults.errors.map((error: any, index: number) => (\n                        <div key={index} className=\"text-sm text-red-800\">\n                          Row {error.row}: {error.error}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <div className=\"flex justify-end\">\n              <Button onClick={handleClose} data-testid=\"button-close-results\">\n                Close\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":13791}},"version":2}